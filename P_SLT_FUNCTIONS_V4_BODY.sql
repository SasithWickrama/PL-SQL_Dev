CREATE OR REPLACE PACKAGE BODY GCI_MIG.P_SLT_FUNCTIONS_V4 AS
/******************************************************************************
   NAME:       P_SLT_FUNCTIONS_V4
   PURPOSE:

   REVISIONS:
   Ver        Date        Author           Description
   ---------  ----------  ---------------  ------------------------------------
   1.0        9/2/2014      011192       1. Created this package body.
******************************************************************************/

---- Dinesh Perera  01-09-2014 ------
PROCEDURE UPD_SYS_DSP_DATE (      
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
  
        BEGIN     
              

        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_DEFAULTVALUE =  TO_CHAR(SYSDATE,'DD-MON-YYYY HH24:MI') 
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'ACTUAL_DSP_DATE';       
             
      
END UPD_SYS_DSP_DATE;
---- Dinesh Perera  01-09-2014 ------


---- Dinesh Perera  02-09-2014 ------
PROCEDURE UPD_SYS_DSP_DATE_TASK (      
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
  
        BEGIN     
              

        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_DEFAULTVALUE =  TO_CHAR(SYSDATE,'DD-MON-YYYY HH24:MI') 
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'ACTUAL_DSP_DATE';       
             
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   

 EXCEPTION
 WHEN OTHERS THEN


        p_ret_msg  := 'Failed to update DSP Date' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);
          
END UPD_SYS_DSP_DATE_TASK;
---- Dinesh Perera  02-09-2014 ------

--- Jayan Liyanage 2013/12/24
PROCEDURE D_SIP_X_CONNE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS  

v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_work_group_mdf          VARCHAR2 (100);
v_location                VARCHAR2 (100);
v_main_node               VARCHAR2 (100);
v_sub_node                VARCHAR2 (100);
v_acc_nw                  VARCHAR2 (100);
v_acc_bearer_status       VARCHAR2 (100);
v_mig_type                VARCHAR2 (100);
v_access_bear_id          VARCHAR2 (100);
v_ch_dis                  VARCHAR2 (100);
v_cir_trib_status         VARCHAR2 (100);
v_cur_nof_copper          VARCHAR2 (100);
v_pre_nof_copper          VARCHAR2 (100);
v_access_node_chg         VARCHAR2 (100);
v_no_of_copper_pair_cur   VARCHAR2 (100);
v_no_of_copper_pair_pre   VARCHAR2 (100);
v_new_cir_id              VARCHAR2 (100);   
v_new_Cir_Name            VARCHAR2 (100);    
v_acc_nw_pre              VARCHAR2 (100);  
v_trs_nw1                 VARCHAR2 (100);   
v_trs_nw2                 VARCHAR2 (100);  
v_Acc_me_Cur              VARCHAR2 (100); 
v_Acc_me_Pre              VARCHAR2 (100);   
v_acc_nod_chg             VARCHAR2 (100);  
v_trs_nw1_pre             VARCHAR2 (100);           

CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

BEGIN 
OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id; 

SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id; 

SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c 
where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_trs_nw1,v_trs_nw1_pre FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TRANSPORT NETWORK1';

SELECT soa.seoa_defaultvalue INTO v_trs_nw2 FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TRANSPORT NETWORK2';

SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_Acc_me_Cur,v_Acc_me_Pre FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue INTO v_acc_nod_chg  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE';

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,
ar.area_code INTO v_rtom_code, v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA'; 

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; SELECT SUBSTR (v_eq_loc_name, 1, INSTR 

(v_eq_loc_name, '-NODE', '1') - 1)
AS node INTO v_location FROM DUAL; SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1))AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, 

'-') + 1)) AS sub_node INTO v_main_node,
v_sub_node FROM DUAL;

/*OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status;CLOSE cur_tributer;*/

IF v_main_node IS NOT NULL THEN  IF     v_service_type = 'D-SIP TRUNK'  AND v_service_order = 'CREATE' 
AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE'  
AND v_main_node = v_sub_node AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') 
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;
IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-TRANSFER' AND 
(v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-TRANSFER'  
AND v_main_node = v_sub_node AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') 
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE-TRANSFER' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;
IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-OR' AND 
(v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-OR'  
AND v_main_node = v_sub_node AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'G.SHDSL') 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE-OR' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;

IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED' AND 
v_trs_nw1 = 'DSL' AND v_Acc_me_Cur <> v_Acc_me_Pre  AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED'  
AND v_main_node = v_sub_node AND v_trs_nw1 = 'DSL' AND v_Acc_me_Cur <> v_Acc_me_Pre
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'MODIFY-SPEED' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;
IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' AND 
v_trs_nw1 = 'G.SHDSL' AND v_acc_nod_chg = 'YES'  AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CONNECTIONS';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_main_node = v_sub_node AND v_trs_nw1 = 'G.SHDSL' AND v_acc_nod_chg = 'YES'
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  (v_service_order = 'MODIFY-LOCATION' )
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY X CONNECTIONS'; END IF;
IF     v_service_type = 'D-SIP TRUNK'  AND v_service_order = 'DELETE' 
AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL') AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'DELETE'  
AND v_main_node = v_sub_node AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL') 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'DELETE' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;

IF     v_service_type = 'D-SIP TRUNK'  AND v_service_order = 'DELETE-OR' 
AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL') AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'DELETE-OR'  
AND v_main_node = v_sub_node AND (v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL') 
AND v_equip_type LIKE 'MSAN%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'DELETE-OR' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;
IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED' AND 
v_trs_nw1 = 'DSL' AND v_trs_nw1 <> v_trs_nw1_pre   AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED' AND 
v_trs_nw1 = 'DSL' AND v_trs_nw1 <> v_trs_nw1_pre   AND v_main_node = v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CON'; END IF;


IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_main_node <> v_sub_node AND v_trs_nw1 = 'SHDSL' AND v_acc_nod_chg = 'YES'  
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_main_node = v_sub_node AND v_trs_nw1 = 'SHDSL' AND v_acc_nod_chg = 'YES'  
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CON'; END IF;
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_main_node <> v_sub_node AND v_trs_nw1 = 'DSL' 
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CON';
ELSIF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_main_node = v_sub_node AND v_trs_nw1 = 'DSL' 
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'MODIFY-LOCATION' 
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY X CON'; END IF;END IF; 
/*ELSIF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED' AND 
v_trs_nw1 = 'SHDSL' AND v_acc_nod_chg = 'YES'   AND v_main_node <> v_sub_node 
AND v_equip_type LIKE 'MSAN%'THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND  (v_service_order = 'MODIFY-SPEED' OR v_service_order = 'MODIFY-LOCATION' )
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CON'; END IF;*/

IF v_main_node IS NULL  THEN IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE'  
AND v_equip_type LIKE 'MSAN%' AND( v_trs_nw1 = 'DSL' OR v_trs_nw1 = 'G.SHDSL')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-TRANSFER'  
AND v_equip_type LIKE 'MSAN%' AND( v_trs_nw1 = 'DSL' OR v_trs_nw1 = 'G.SHDSL')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE-TRANSFER'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF; 

IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-OR'  
AND v_equip_type LIKE 'MSAN%' AND( v_trs_nw1 = 'DSL' OR v_trs_nw1 = 'G.SHDSL')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS';
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'CREATE-OR'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;  
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED'  
AND v_equip_type LIKE 'MSAN%' AND v_trs_nw1 = 'DSL' AND v_Acc_me_Cur <> v_Acc_me_Pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE X CONNECTIONS'; 
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'MODIFY-SPEED'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE X CONNECTIONS'; END IF;  

IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_equip_type LIKE 'MSAN%' AND v_trs_nw1 = 'G.SHDSL' AND v_acc_nod_chg = 'YES'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CONNECTIONS'; 
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY X CONNECTIONS'; END IF;
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'DELETE'  
AND v_equip_type LIKE 'MSAN%' AND( v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; 
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'DELETE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'DELETE-OR'  
AND v_equip_type LIKE 'MSAN%' AND( v_trs_nw1 = 'DSL'OR v_trs_nw1 = 'SHDSL')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; 
ELSIF v_service_type = 'D-SIP TRUNK' AND  v_service_order = 'DELETE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;
IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED'  
AND v_equip_type LIKE 'MSAN%' AND v_trs_nw1 = 'DSL' AND v_trs_nw1 <> v_trs_nw1_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON'; 
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-SPEED'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CON'; END IF;
IF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'  
AND v_equip_type LIKE 'MSAN%' AND v_trs_nw1 = 'SHDSL' AND v_acc_nod_chg = 'YES'  
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CON'; END IF; 

IF    v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' AND v_trs_nw1 = 'DSL' 
AND v_equip_type LIKE 'MSAN%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY X CON';
ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY X CON'; END IF; 
END IF; 

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
         'Failed to WG Mapping Please check the X Connection   :  - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR');

      INSERT INTO service_task_comments (setc_seit_id,
                                         setc_id,
                                         setc_userid,
                                         setc_timestamp,
                                         setc_text)
           VALUES (p_seit_id,
                   setc_id_seq.NEXTVAL,
                   'CLARITYB',
                   SYSDATE,
                   p_ret_msg);

END D_SIP_X_CONNE;
--- Jayan Liyanage 2013/12/24
 

--- Jayan Liyanage  2014 /07/ 01  
  
PROCEDURE NBN_BTL_BLANK_ATTR (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_bearer_sts   varchar2(100);
v_acc_link_type    varchar2(100);

BEGIN

SELECT SOA.SEOA_DEFAULTVALUE INTO v_acc_bearer_sts
FROM SERVICE_ORDER_ATTRIBUTES SOA  WHERE SOA.SEOA_NAME = 'ACCESS BEARER STATUS'
AND SOA.SEOA_SERO_ID = p_sero_id;

SELECT SOA.SEOA_DEFAULTVALUE INTO v_acc_link_type
FROM SERVICE_ORDER_ATTRIBUTES SOA  WHERE SOA.SEOA_NAME = 'ACCESS LINK TYPE'
AND SOA.SEOA_SERO_ID = p_sero_id;

if v_acc_link_type = 'DAB' and (v_acc_bearer_sts = 'NEW' OR v_acc_bearer_sts = 'TO BE MODIFIED' ) THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SOA SET SOA.SEOA_DEFAULTVALUE = '' WHERE SOA.SEOA_NAME = 'ACCESS BEARER ID'
AND SOA.SEOA_SERO_ID = p_sero_id; END IF;
if v_acc_link_type = 'DAB' and (v_acc_bearer_sts = 'NEW' OR v_acc_bearer_sts = 'TO BE MODIFIED' ) THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_WORG_NAME = 'CORP-SSU'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR DAB' AND SIT.SEIT_SERO_ID = p_sero_id;

ELSE DELETE SERVICE_IMPLEMENTATION_TASKS SIT WHERE SIT.SEIT_TASKNAME = 'WAIT FOR DAB'AND SIT.SEIT_SERO_ID = p_sero_id; END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL SOD  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_BTL_BLANK_ATTR;

--- Jayan Liyanage  2014 /07/ 01

--- Jayan Liyanage  2014 /07/ 01 

PROCEDURE NBN_BTL_CP_ATTR_BEARER (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR bearer_c IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID'AND so.sero_id = p_sero_id;

CURSOR so_copyattr (v_new_bearer_id_b VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
and soa.seoa_name in ('ACCESS N/W INTF','SECTION_HANDLED_BY','NTU MODEL','NTU TYPE','NTU CLASS'
,'ACCESS MEDIUM','ACCESS INTF PORT BW','CUSTOMER INTF TYPE')
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED' AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id_b);

v_so_attr_name     VARCHAR2 (100);
v_so_attr_val      VARCHAR2 (100);
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100);
v_new_bearer_id    VARCHAR2 (100);
v_service_type     VARCHAR2 (100);
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);
v_new_bearer_id_b  VARCHAR2 (100);
v_bearer_id_b      VARCHAR2 (100);
v_so_attr_name_c   VARCHAR2 (100);
v_so_attr_val_c    VARCHAR2 (100);
v_cir_status_c     VARCHAR2 (100);
v_link_ty          VARCHAR2 (100);          

BEGIN
  
OPEN bearer_c;FETCH bearer_c INTO v_bearer_id;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT soa.seoa_defaultvalue  INTO v_link_ty FROM service_order_attributes soa
WHERE soa.seoa_name = 'ACCESS LINK TYPE' AND SOA.SEOA_SERO_ID = p_sero_id;
OPEN so_copyattr (v_bearer_id);LOOP FETCH so_copyattr
INTO v_so_attr_name, v_so_attr_val, v_cir_status; EXIT WHEN so_copyattr%NOTFOUND;

IF v_link_ty = 'DAB' then IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ACCESS N/W INTF' THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION_HANDLED_BY'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. INTF PORT BW'; 
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
end if; IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' 
AND v_so_attr_name = 'ACCESS N/W INTF' THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION_HANDLED_BY'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' 
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. INTF PORT BW'; 
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
end if; IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' 
AND v_so_attr_name = 'ACCESS N/W INTF' THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION_HANDLED_BY'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. INTF PORT BW'; 
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
end if;IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ACCESS N/W INTF' THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION_HANDLED_BY'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. INTF PORT BW'; 
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
end if;IF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS N/W INTF' THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION_HANDLED_BY'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order ='MODIFY-LOCATION'  AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION'  AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. INTF PORT BW'; 
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'MODIFY-LOCATION'  AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
end if;end if;END LOOP; IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
ELSIF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
END IF; CLOSE so_copyattr;CLOSE bearer_c;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL  Copy Attribute In NBN-DAB SOD  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END NBN_BTL_CP_ATTR_BEARER;

--- Jayan Liyanage  2014 /07/ 01 

--- Jayan Liyanage  2014 /07/ 01 
PROCEDURE NBN_D_BTL_CREATE_1 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type            varchar2(100);
v_service_type          varchar2(100);
v_service_order        varchar2(100);
v_area_code            varchar2(100);
v_work_group_nw    varchar2(100);
acc_medi                 varchar2(100);
v_rtom_code            varchar2(100);
v_lea_code               varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';


select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
AS codes, ar.area_code INTO v_rtom_code, v_lea_code
FROM areas ar WHERE ar.area_code = v_area_code AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || 'ENG-NW';

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  acc_medi = 'P2P RADIO' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  v_acc_li_type  = 'DEDICATED LINE' 
AND acc_medi = 'FIBER' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE ACCESS FIBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE ACCESS FIBER'; END IF;  

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_1;
--- Jayan Liyanage  2014 /07/ 01 

--- Jayan Liyanage  2014 /07/ 01 
PROCEDURE NBN_D_BTL_CREATE_2 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type    varchar2(100);
v_service_type   varchar2(100);
v_service_order  varchar2(100);
v_area_code      varchar2(100);
v_work_group_nw  varchar2(100);
v_no_pstn        varchar2(100);
acc_nw_intr_a    varchar2(100);
acc_medi        varchar2(100);
acc_fib_a   varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;



IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  v_acc_li_type  = 'DEDICATED LINE' 
  AND acc_medi = 'FIBER' and
  (acc_fib_a = 'NO' or acc_fib_a = 'INCOMPLETE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PLAN-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'START FIBER LAYING'; END IF;  


/* Changes has been done new modification  Start --- 2014 / 11 / 18

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND v_no_pstn =1 THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE NUMBER'; 
ELSIF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND v_no_pstn >1 THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CEN-SWPL'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE NUMBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE NUMBER'; END IF;  

End 2014 / 11 / 18
*/ 



IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND (acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MSAN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MSAN PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a = 'MLLN PORT' 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MLLN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MLLN PORT'; END IF;  




p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END NBN_D_BTL_CREATE_2;

--- Jayan Liyanage  2014 /07/ 01 

--- Jayan Liyanage  2014 /07/ 01 updated on 02-11-2015
PROCEDURE NBN_D_BTL_CREATE_3 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type          varchar2(100);
v_service_order         varchar2(100);
v_acc_li_type         varchar2(100);
acc_medi             varchar2(100);
acc_fib_a              varchar2(100);
acc_nw_intr_a           varchar2(100);
Trans_nw             varchar2(100);
acc_bearer_a_sta        varchar2(100);
ag_netw                 varchar2(100);
v_service_order_area  varchar2(100);
v_rtom_code         varchar2(100);
v_lea_code           varchar2(100);
v_work_group_os       varchar2(100);
v_work_group_nw       varchar2(100);
v_work_group_cpe      varchar2(100);
v_new_num_level       varchar2(100);
v_no_pstn             varchar2(100);
v_sec_handle            varchar2(100);
Ser_cteg                varchar2(100);
v_exc                   varchar2(100);
v_sw_code               varchar2(100);
v_sw_rtom_code      varchar2(100);
v_sw_lea_code         varchar2(100);
v_sw_wg                 varchar2(100);
v_Ope_Region        varchar2(100);

BEGIN 
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO ag_netw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';
/*
SELECT soa.seoa_defaultvalue INTO Trans_nw_a
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'TRANS. NETWORK-A END';*/

SELECT soa.seoa_defaultvalue INTO acc_bearer_a_sta FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue INTO v_new_num_level FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NEW NUMBER LEVEL (Y/N)?';
SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO v_service_order_area FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';
SELECT soa.seoa_defaultvalue INTO v_exc  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SW CODE';
SELECT soa.seoa_defaultvalue INTO v_Ope_Region  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'OPERATIONAL REGION';


SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_os FROM work_groups wg 
WHERE worg_name = v_rtom_code || '-' || v_lea_code || '-' || 'OSP-NC';       
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code || '-' || 'ENG-NW' ;

select distinct trim(replace(soa.seoa_defaultvalue,'S-')) INTO v_sw_code
from  service_order_attributes soa
where soa.seoa_name = 'SW CODE'
and  soa.seoa_sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_sw_rtom_code,v_sw_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
/*SELECT wg.worg_name INTO v_sw_wg FROM work_groups wg 
WHERE worg_name = v_sw_rtom_code || '-' || v_sw_lea_code ||'-SW-'||v_sw_code;*/

/*select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_service_order_area
 and aw.arwg_grouptype = 'ENG';
 select distinct aw.arwg_worg_name into v_work_group_os  
 from area_workgroups aw where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_service_order_area
 and aw.arwg_grouptype = 'OSP';*/

SELECT soa.seoa_defaultvalue INTO v_sec_handle
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO Ser_cteg FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_handle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM BTL NUMBERS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM BTL NUMBERS'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a = 'SDH PORT'  -- OR ag_netw = 'SDH') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PORTS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND  ag_netw = 'SDH' and acc_nw_intr_a <> 'SDH PORT'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PATH'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a = 'MEN PORT'  
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MEN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MEN PORT'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a <> 'MEN PORT'  
  AND ag_netw = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a <> 'CEN PORT'  
  AND ag_netw = 'CEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND (acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND acc_nw_intr_a = 'OLT PORT'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE OLT PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE OLT PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND(acc_nw_intr_a ='SDH PORT' OR  ag_netw = 'SDH')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE TX LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK'; END IF;  

-- this was modified V3 requirment -- start 2014 / 11 / 19

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'FIBER' and
  (acc_fib_a = 'NO' or acc_fib_a = 'INCOMPLETE')  and v_Ope_Region = 'METRO' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLE'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER'; 
ELSIF v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'FIBER' and
  (acc_fib_a = 'NO' or acc_fib_a = 'INCOMPLETE')  and v_Ope_Region = 'REGION' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER'; 
END IF;   -- End  Modification  2014 / 11 / 19

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'P2P RADIO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INST. SLT-END NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INST. SLT-END NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'P2P RADIO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'COPPER'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND   acc_medi = 'FTTH' AND acc_bearer_a_sta = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; END IF; 
/*
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  (acc_medi = 'FTTH' OR acc_medi = 'COPPER-UTP')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; END IF; */

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  v_new_num_level = 'YES'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TRF'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ROUTES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ROUTES'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  Ser_cteg = 'TEST'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_handle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; END IF; 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  Ser_cteg = 'TEST'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_handle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; END IF; 


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  v_acc_li_type  = 'DAB' AND acc_bearer_a_sta = 'COMMISSIONED'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CSU'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND  (v_exc <> 'S-SH' OR v_exc <> 'S-SZ') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'BSS-IMM-ENG'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'UPDATE MEDIATION'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'UPDATE MEDIATION'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  AND (acc_medi = 'FIBER' OR acc_medi = 'COPPER-UTP' ) THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id  AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'   THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sw_wg
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG SWITCH PORT';  END IF; 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'   THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sw_wg
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE BTL SERVICE';  END IF; 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'   THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sw_wg
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';  END IF; 

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create SOD function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_3;
--- Jayan Liyanage  2014 /07/ 01

--- Jayan Liyanage  2014 /07/ 01

PROCEDURE D_BTL_X_CONNE_WG_CHG (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2)
IS

CURSOR cur_equi_type IS
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname FROM service_orders so, ports p, equipment e
WHERE so.sero_cirt_name = p.port_cirt_name AND 
(   e.equp_equt_abbreviation LIKE 'MSAN%'OR e.equp_equt_abbreviation LIKE 'DSLAM%'
OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;


--CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 )IS
--SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
--WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name
--AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%'
--OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
--AND (   ci.cirt_status NOT LIKE 'CANCE%'OR ci.cirt_status NOT LIKE 'PENDING%'
--)AND ci.CIRT_DISPLAYNAME <> v_new_cir_id AND c.cirt_displayname = parent_name;



v_equip_type             VARCHAR2(100);
v_eq_loc_name            VARCHAR2(100);
v_service_type           VARCHAR2(100);
v_service_order          VARCHAR2(100);
v_service_order_area     VARCHAR2(100);
v_access_id              VARCHAR2(100);
v_acc_medium             VARCHAR2(100);
v_rtom_code              VARCHAR2(100);
v_lea_code               VARCHAR2(100);
v_work_group             VARCHAR2(100);
v_work_group_mdf         VARCHAR2(100);
v_main_node              VARCHAR2(100);
v_sub_node               VARCHAR2(100);
v_new_Cir_Name           VARCHAR2(100);
v_location               VARCHAR2(100);
v_ch_dis                 VARCHAR2(100);
v_cir_trib_status        VARCHAR2(100);
v_acc_port_chg           VARCHAR2(100);
v_acc_node_chg           VARCHAR2(100);
v_acc_li_type            VARCHAR2(100);

BEGIN

OPEN cur_equi_type;FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;CLOSE cur_equi_type;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;

--SELECT soa.seoa_prev_value INTO v_access_id FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
--AND soa.seoa_name = 'ACCESS_ID';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_acc_port_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS INTF PORT CHANGE?';
SELECT soa.seoa_defaultvalue INTO v_acc_node_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS NODE CHANGE?';

SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';


SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name 
and  so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,ar.area_code INTO v_rtom_code, v_lea_code
FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg 
WHERE worg_name = v_rtom_code || '-' || v_lea_code || '-' || 'OSP-NC' ;
SELECT wg.worg_name INTO v_work_group_mdf FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '-' || 'MDF' ;
SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1) AS node INTO v_location FROM DUAL;
SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1)) AS main_node,
TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node, v_sub_node FROM DUAL;

--OPEN cur_tributer (v_access_id,v_new_Cir_Name);
--FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status;CLOSE cur_tributer;


IF v_main_node IS NOT NULL THEN  
   IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MAKE MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MAKE MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MAKE MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_port_chg = 'YES' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MAKE MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_port_chg = 'YES'  THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;  
  IF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_node_chg = 'YES' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MAKE MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'MODIFY-LOCATION' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_node_chg = 'YES'  THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_node_chg = 'YES' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'MODIFY MDF X CONNECT';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'MODIFY-LOCATION' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_node_chg = 'YES'  THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'MODIFY-LOCATION'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'REMOVE X CONNECTION';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'DELETE' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_li_type = 'DEDICATED LINE' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE-OR' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'REMOVE X CONNECTION';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'DELETE-OR' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_li_type = 'DEDICATED LINE' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE-OR'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;

  IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE-DOWNGRADE' AND v_main_node <> v_sub_node 
   AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
       AND sit.seit_taskname = 'REMOVE X CONNECTION';       
ELSIF     v_service_type = 'D-BTL'AND v_service_order = 'DELETE-DOWNGRADE' AND
v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_acc_medium = 'COPPER'and  v_acc_li_type = 'DEDICATED LINE' THEN UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE X CONNECTION';
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE-DOWNGRADE'THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;END IF;

IF v_main_node IS NULL THEN IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-OR'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_port_chg = 'YES' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-TRANSFER'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-LOCATION' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_node_chg = 'YES' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'CREATE-LOCATION' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_node_chg = 'YES' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'REMOVE X CONNECTION'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE-OR' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'REMOVE X CONNECTION'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE-OR'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;
IF     v_service_type = 'D-BTL' AND v_service_order = 'DELETE-DOWNGRADE' AND (
      v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND  v_acc_medium = 'COPPER' and v_acc_li_type = 'DEDICATED LINE' 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id 
     AND sit.seit_taskname = 'REMOVE X CONNECTION'; ELSIF v_service_type = 'D-BTL' AND v_service_order = 'DELETE-DOWNGRADE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE X CONNECTION'; END IF;end if;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED' ); 
EXCEPTION WHEN OTHERS THEN
p_ret_msg := 'Failed to Workgroup Mapping in D-BTL Data Product.Please check the Cross Connection   :  - Erro is:'
|| TO_CHAR (SQLCODE) || '-' || SQLERRM; p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id,'ERROR' );INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_BTL_X_CONNE_WG_CHG;
--- Jayan Liyanage  2014 /07/ 01

--- Jayan Liyanage  2014 /09/ 16 X CONNECT AT MGW task removed on 17/01/2016 X CONNECT AT MGW WG only updated on 25/01/2016
PROCEDURE NBN_D_BTL_CREATE_TX_WG_CHGE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type    varchar2(100);
v_service_type   varchar2(100);
v_service_order  varchar2(100);
v_area_code      varchar2(100);
v_work_group_nw  varchar2(100);
agg_nw           varchar2(100);
tx_wg_mgw        varchar2(100);
tx_wg_bend       varchar2(100);
v_acc_nw_int     varchar2(100);


begin

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO agg_nw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';

SELECT soa.seoa_defaultvalue INTO tx_wg_mgw  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'TX WORK GROUP-MGW';

SELECT soa.seoa_defaultvalue INTO tx_wg_bend FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'TX WORK GROUP-B END';

SELECT soa.seoa_defaultvalue INTO v_acc_nw_int FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  /*AND ( agg_nw = 'SDH' or agg_nw = 'MLLN')*/ THEN --( v_acc_nw_int = 'SDH PORT' or 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_mgw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT MGW'; 
ELSIF   v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  THEN  DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT MGW'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  and  ( v_acc_nw_int <> 'SDH PORT' and agg_nw = 'SDH') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_bend
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT TX NODE'; 
ELSIF  v_service_type = 'D-BTL'AND v_service_order = 'CREATE'  THEN   DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT TX NODE'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR'  /*AND  ( agg_nw = 'SDH' or agg_nw = 'MLLN') */THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_mgw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT MGW'; 
ELSIF  v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR'  THEN   DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT MGW'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR'  AND  ( v_acc_nw_int <> 'SDH PORT' and agg_nw = 'SDH')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_bend
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT TX NODE'; 
ELSIF  v_service_type = 'D-BTL'AND v_service_order = 'CREATE-OR'  THEN  DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT TX NODE'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  /*AND ( agg_nw = 'SDH' or agg_nw = 'MLLN')*/ THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_mgw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT MGW'; 
ELSIF  v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  THEN   DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT MGW'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND  ( v_acc_nw_int <> 'SDH PORT' and agg_nw = 'SDH')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = tx_wg_bend
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'X CONNECT AT TX NODE'; 
ELSIF  v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  THEN  DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT TX NODE'; END IF;  

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL TX Work Group Change SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_TX_WG_CHGE;
--- Jayan Liyanage  2014 /09/ 16

--- Jayan Liyanage  2014 /07/ 01
    
PROCEDURE NBN_BTL_CLOSE_SO (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

BEGIN UPDATE SERVICE_ORDER_ATTRIBUTES SOA SET SOA.SEOA_DEFAULTVALUE = 'INSERVICE' 
WHERE  SOA.SEOA_NAME = 'ACCESS BEARER STATUS' AND SOA.SEOA_SERO_ID = p_sero_id;
UPDATE SERVICE_ORDER_ATTRIBUTES SOA SET SOA.SEOA_DEFAULTVALUE = REPLACE(SOA.SEOA_DEFAULTVALUE,'(N)')
WHERE  SOA.SEOA_NAME = 'ACCESS BEARER ID' AND SOA.SEOA_SERO_ID = p_sero_id;
UPDATE SERVICE_ORDER_ATTRIBUTES SOA SET SOA.SEOA_DEFAULTVALUE = '' 
WHERE  SOA.SEOA_NAME = 'NEW NUMBER LEVEL (Y/N)?' AND SOA.SEOA_SERO_ID = p_sero_id;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL SOD  function. Please check the conditions:'|| 
  ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_BTL_CLOSE_SO;

--- Jayan Liyanage  2014 /07/ 01

--- Indika de SIlva 09/10/2014
PROCEDURE ETH_VPN_CREATE_FOX_CP_ATT (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR bearer
   IS
      SELECT DISTINCT soa.seoa_defaultvalue
                 FROM service_orders so, service_order_attributes soa
                WHERE so.sero_id = soa.seoa_sero_id
                  AND soa.seoa_name = 'ACCESS BEARER ID'
                  AND so.sero_id = p_sero_id;

   CURSOR so_copyattr (v_new_bearer_id VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
                 FROM service_orders so,
                      service_order_attributes soa,
                      circuits c
                WHERE so.sero_id = soa.seoa_sero_id
                  AND so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'CANCELLED'
                       AND c.cirt_status <> 'PENDINGDELETE'
                      )
                  AND so.sero_stas_abbreviation <> 'CANCELLED'
                  AND so.sero_id IN (
                         SELECT MAX (s.sero_id)
                           FROM service_orders s, circuits ci
                          WHERE s.sero_cirt_name = ci.cirt_name
                            AND s.sero_stas_abbreviation <> 'CANCELLED'
                            AND ci.cirt_displayname LIKE v_new_bearer_id ||'%');

   v_so_attr_name       VARCHAR2 (100);
   v_so_attr_val        VARCHAR2 (100);
   v_bearer_id          VARCHAR2 (100);
   v_cir_status         VARCHAR2 (100);
   v_new_bearer_id      VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);
   v_service_order      VARCHAR2 (100);
   v_new_service_type   VARCHAR2 (100);
BEGIN
   OPEN bearer;

   FETCH bearer
    INTO v_bearer_id;

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   OPEN so_copyattr (v_bearer_id);

   LOOP
      FETCH so_copyattr
       INTO v_so_attr_name, v_so_attr_val, v_cir_status;

      EXIT WHEN so_copyattr%NOTFOUND;

      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-FOX'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'CREATE-FOX'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;
  
   END LOOP;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-FOX'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   

   CLOSE so_copyattr;

   CLOSE bearer;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END ETH_VPN_CREATE_FOX_CP_ATT;
---Indika de Silva 09/10/2014

--- 07-05-2014 Samankula Owitipana
PROCEDURE PSTN_SEND_SMS_TO_CUSTOMER (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR tp_select_cur  IS
SELECT SO.SERO_CUSR_ABBREVIATION FROM SERVICE_ORDERs SO
WHERE SO.SERO_ID = p_sero_id;

CURSOR tp_acc_cur  IS
SELECT SO.SERO_ACCT_NUMBER FROM SERVICE_ORDERs SO
WHERE SO.SERO_ID = p_sero_id;

v_CR_NO VARCHAR2(20);
v_service_type VARCHAR2(50);
v_order_type VARCHAR2(50);
v_TP_NO VARCHAR2(20);
v_CUS_TYEP VARCHAR2(50);

v_mobile VARCHAR2(30);
v_CUS_TP VARCHAR2(33);

v_sms_txt VARCHAR2(500);
v_sms_state VARCHAR2(500);

CURSOR tp3_select_cur IS
SELECT '94' || substr(trim(cp.CONP_NUMBER),2,10)
FROM CONTACT_POINTS cp
WHERE cp.CONP_CUSR_ABBREVIATION = v_CR_NO
AND cp.CONP_CONT_ABBREVIATION = 'PHONE'
and trim(cp.CONP_NUMBER) like '07%'
order by cp.CONP_ID desc;

CURSOR c_sa_pstn_no IS
SELECT DISTINCT soa.seoa_defaultvalue
FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id
AND soa.seoa_name = 'SA_PSTN_NUMBER'
AND so.sero_id = p_sero_id;


BEGIN

SELECT SO.SERO_CUSR_ABBREVIATION,so.SERO_SERT_ABBREVIATION,so.SERO_ORDT_TYPE
INTO v_CR_NO,v_service_type,v_order_type
FROM SERVICE_ORDERs SO
WHERE SO.SERO_ID = p_sero_id;

select replace(ci.CIRT_DISPLAYNAME,'(N)','')
into v_TP_NO
from service_orders so,circuits ci
where so.SERO_CIRT_NAME = ci.CIRT_NAME
and SO.SERO_ID = p_sero_id;

OPEN tp3_select_cur;
FETCH tp3_select_cur INTO v_mobile;
CLOSE tp3_select_cur;

OPEN c_sa_pstn_no;
FETCH c_sa_pstn_no INTO v_TP_NO;
CLOSE c_sa_pstn_no;


IF v_mobile is not null THEN

insert into ossrpt.SEND_SMS_DATA values (p_sero_id,p_impt_taskname,v_order_type,v_service_type,v_TP_NO,0,ossrpt.SLT_SMS_ID_SEQ.nextval,v_mobile);

END IF;


IF p_impt_taskname = 'WO FOR OSP' THEN
                      
P_dynamic_procedure.Process_ISSUE_WORK_ORDER(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);
        
ELSE

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

END IF;        


EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to send SMS. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

     INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
     SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
     , p_ret_msg);


END PSTN_SEND_SMS_TO_CUSTOMER;
--- 07-05-2014 Samankula Owitipana

--- Jayan Liyanage  2014 /06/ 04
PROCEDURE D_EP_WIFI (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR bearer IS 
SELECT DISTINCT soa.seoa_defaultvalue 
FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ETHERNET VPN CIRCUIT ID'AND so.sero_id = p_sero_id;
/*
CURSOR so_copyattr (v_new_bearer_id VARCHAR)IS 
SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status FROM service_orders so, service_order_attributes soa, circuits c 
WHERE so.sero_id = soa.seoa_sero_id AND SOA.SEOA_NAME IN ('ACCESS BEARER ID','VPLS ID')
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED' AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname LIKE replace( v_new_bearer_id,'(N)') ||'%');*/

CURSOR so_copyattr (v_new_bearer_id VARCHAR)IS  SELECT  DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c  WHERE so.sero_id = soa.seoa_sero_id AND SOA.SEOA_NAME IN ('ACCESS BEARER ID','VPLS ID') AND so.sero_cirt_name = c.cirt_name 
and c.cirt_displayname LIKE replace( v_new_bearer_id,'(N)') ||'%' AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED'AND  so.sero_datecreated in ( SELECT s.sero_datecreated FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name   and s.sero_id = so.sero_id and c.cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED' );


Cursor Cur_lo(Loc_ci varchar2) is
select distinct lo.locn_ttname,lo1.locn_ttname from circuits c,locations lo,locations lo1
where c.cirt_locn_aend = lo.locn_ttname and c.cirt_locn_bend = lo1.locn_ttname
and c.cirt_displayname like replace(Loc_ci,'(N)')||'%' and c.cirt_inservice in ( select max(ci.cirt_inservice)
from circuits ci where (ci.cirt_status NOT LIKE 'CANCELL%' or ci.cirt_status NOT LIKE 'PENDIN%')
and ci.cirt_displayname like replace(Loc_ci,'(N)')||'%');

v_so_attr_name     VARCHAR2 (100);
v_so_attr_val      VARCHAR2 (100);
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100);
v_new_bearer_id    VARCHAR2 (100);
v_service_type     VARCHAR2 (100);
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);
v_loc_a            VARCHAR2 (100);
v_loc_b            VARCHAR2 (100);
v_end_1            VARCHAR2 (100);       
v_end_2            VARCHAR2 (100);
Loc_ci             VARCHAR2 (100);
v_main_service     VARCHAR2 (100);

BEGIN
OPEN bearer;FETCH bearer INTO v_bearer_id;

/*
SELECT DISTINCT CI.CIRT_DISPLAYNAME
INTO v_main_service FROM CIRCUITS CI WHERE  ( CI.CIRT_STATUS <> 'CANCELLED' OR CI.CIRT_STATUS <> 'PENDINGDELETE')
AND CI.CIRT_NAME IN ( select distinct CH.CIRH_PARENT
from circuits c,CIRCUIT_HIERARCHY CH where C.CIRT_NAME = CH.CIRH_CHILD
AND ( C.CIRT_STATUS <> 'CANCELLED' OR C.CIRT_STATUS <> 'PENDINGDELETE')
AND c.cirt_displayname = v_bearer_id);*/


SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;

OPEN so_copyattr (v_bearer_id);LOOP FETCH so_copyattr
INTO v_so_attr_name, v_so_attr_val, v_cir_status; EXIT WHEN so_copyattr%NOTFOUND;

IF     v_service_type = 'D-ENT WIFI' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ACCESS BEARER ID'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER ID';

ELSIF     v_service_type = 'D-ENT WIFI' AND v_service_order = 'CREATE' AND v_so_attr_name = 'VPLS ID'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS ID';
END IF; 

end loop; CLOSE so_copyattr;

if v_bearer_id is not null then
open Cur_lo (v_bearer_id);  loop fetch Cur_lo into v_loc_a,v_loc_b;EXIT WHEN Cur_lo%NOTFOUND;
v_end_1 := 'A'; v_end_2 := 'B'; 
IF  v_service_type = 'D-ENT WIFI' AND v_service_order = 'CREATE' and v_end_1 = 'A' then
update service_order_attributes soa set soa.seoa_defaultvalue = v_loc_a
where soa.seoa_name = 'A-END LOCATION' and soa.seoa_sero_id = p_sero_id; end if;
if  v_service_type = 'D-ENT WIFI' AND v_service_order = 'CREATE' and v_end_2 = 'B' then
update service_order_attributes soa set soa.seoa_defaultvalue = v_loc_b
where soa.seoa_name = 'B-END LOCATION' and soa.seoa_sero_id = p_sero_id; end if;
end loop;close Cur_lo;end if; CLOSE bearer;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,
'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                  0,
                                  p_seit_id,
                                  'ERROR'
                                 );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_EP_WIFI;
--- Jayan Liyanage  2014 /06/ 04

--- Jayan Liyanage 2014 / 05 / 23
PROCEDURE FTTH_MODIFY_LOC  (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
) IS


v_acc_pipe        varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);
lo_aend           varchar2(100);
lo_bend           varchar2(100);
v_acc_bearer_id   varchar2(100);
v_loc_a           varchar2(100);
v_loc_b           varchar2(100);

Cursor Cur_lo(Loc_ci varchar2) is
select distinct lo.locn_id,lo1.locn_id,lo.locn_ttname,lo1.locn_ttname from circuits c,locations lo,locations lo1
where c.cirt_locn_aend = lo.locn_ttname and c.cirt_locn_bend = lo1.locn_ttname
and c.cirt_displayname like replace(Loc_ci,'(N)')||'%' and c.cirt_inservice in ( select max(ci.cirt_inservice)
from circuits ci where (ci.cirt_status NOT LIKE 'CANCELL%' or ci.cirt_status NOT LIKE 'PENDIN%')
and ci.cirt_displayname like replace(Loc_ci,'(N)')||'%');

begin
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type 
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id = p_sero_id;

/*SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c 
where so.sero_cirt_name = c.cirt_name and so.sero_id = p_sero_id;
*/

IF v_service_type = 'BB-INTERNET FTTH' AND v_service_order = 'MODIFY-LOCATION' 
  THEN select distinct soa.seoa_defaultvalue  into v_acc_pipe from service_order_attributes soa
where soa.seoa_name = 'ACCESS PIPE IDENTIFIER'and soa.seoa_sero_id = p_sero_id;
open Cur_lo(v_acc_pipe); fetch Cur_lo into lo_aend,lo_bend,v_loc_a,v_loc_b;close Cur_lo;
update service_orders so set so.sero_locn_id_aend = lo_aend,so.sero_locn_id_bend = lo_bend
where so.sero_id = p_sero_id; 
update circuits ci set ci.cirt_locn_aend = v_loc_a ,ci.cirt_locn_bend = v_loc_b
where ci.cirt_name in ( select c.cirt_name from service_orders s,circuits c
where s.sero_cirt_name = c.cirt_name and (c.cirt_status NOT LIKE 'CANCELL%' or c.cirt_status NOT LIKE 'PENDIN%')
and s.sero_id = p_sero_id);
end if;

IF v_service_type = 'E-IPTV FTTH' AND v_service_order = 'MODIFY-LOCATION' then
update  circuits c set c.cirt_sped_abbreviation = 'IPTV' where c.cirt_name in ( select distinct ci.cirt_name 
from circuits ci,service_orders so where ci.cirt_name = so.sero_cirt_name
and so.sero_id = p_sero_id ); end if;

IF v_service_type = 'D-ENT WIFI' AND v_service_order = 'CREATE'THEN
select distinct soa.seoa_defaultvalue into v_acc_bearer_id 
from service_order_attributes soa
where soa.seoa_name = 'ACCESS BEARER ID' and soa.seoa_sero_id = p_sero_id; 

if v_acc_bearer_id is not null then open Cur_lo(v_acc_bearer_id); fetch Cur_lo into lo_aend,lo_bend,v_loc_a,v_loc_b;close Cur_lo;
update service_orders so set so.sero_locn_id_aend = lo_aend,so.sero_locn_id_bend = lo_bend
where so.sero_id = p_sero_id; 

update circuits ci set ci.cirt_locn_aend = v_loc_a ,ci.cirt_locn_bend = v_loc_b
where ci.cirt_name in ( select c.cirt_name from service_orders s,circuits c
where s.sero_cirt_name = c.cirt_name and (c.cirt_status NOT LIKE 'CANCELL%' or c.cirt_status NOT LIKE 'PENDIN%')
and s.sero_id = p_sero_id);end if;end if;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Change  Mapping Location A End & B End. Please check Ethernet VPN Loc Ends :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);
  
END FTTH_MODIFY_LOC;
--- Jayan Liyanage 2014 / 05 / 23

--- Dinesh Perera 24-10-2014
PROCEDURE MOD_SPEED_TASK_REMOVE (
   p_serv_id         IN     services.serv_id%TYPE,
   p_sero_id         IN     service_orders.sero_id%TYPE,
   p_seit_id         IN     service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN     implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN     work_order.woro_id%TYPE,
   p_ret_char           OUT VARCHAR2,
   p_ret_number         OUT NUMBER,
   p_ret_msg            OUT VARCHAR2)
   
IS

   v_cur_speed             VARCHAR2 (100);
   v_pre_speed             VARCHAR2 (100); 
   v_sa_wip_order          VARCHAR2 (100);
   
BEGIN

     SELECT soa.seoa_defaultvalue
     INTO v_cur_speed
     FROM service_order_attributes soa
     WHERE soa.seoa_sero_id = p_sero_id
     AND soa.seoa_name = 'SERVICE_SPEED'; 


     SELECT soa.seoa_prev_value
     INTO v_pre_speed
     FROM service_order_attributes soa
     WHERE soa.seoa_sero_id = p_sero_id
     AND soa.seoa_name = 'SERVICE_SPEED'; 
     
     
     

        IF (v_cur_speed = v_pre_speed)    --NO SPEED CHANGE
            THEN
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'QUERY DSLAM VLAN ID';
                                
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'QUERY ZTE VLAN ID';
                                 
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'QUERY PORT STAT ZTE';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'MODIFY BBNET PACKAGE';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP_PROVISION_ZTE';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP_PROV_ZTE';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'DSLAM CONFIGURATION';
               
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'WO TO ADSL';    
                            
        
        END IF;
        

   p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change MOD_SPEED_TASK_REMOVE Process function. Please check the conditions:'
         || ' - Erro is:' || TO_CHAR (SQLCODE) || '-' || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');

      
END MOD_SPEED_TASK_REMOVE;
--- Dinesh Perera 24-10-2014

--- Dilupa Alahakoon 2014 / 10 / 27
    
PROCEDURE D_SCHOOLNET_BACKHAUL_CREATE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
v_dsl_interface           VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_sw_code                 VARCHAR2 (100);
V_access_medium           VARCHAR2 (100);
v_parallel_service        VARCHAR2 (100);
v_main_node               VARCHAR2 (100);
v_sub_node                VARCHAR2 (100);
v_dsl_ntu_class           VARCHAR2 (100);
v_pstn_no                 VARCHAR2 (100);
v_card_model              VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_location                VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_work_group_mdf          VARCHAR2 (100);

CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;


CURSOR cur_pstn_no IS 
SELECT soa.seoa_defaultvalue
FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id
AND soa.seoa_name = 'SA_PSTN_NUMBER'
and soa.seoa_defaultvalue like '0%';

BEGIN 
OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;


OPEN cur_pstn_no; FETCH cur_pstn_no INTO v_pstn_no;
CLOSE cur_pstn_no;


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;
  
SELECT soa.seoa_defaultvalue
INTO V_access_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_parallel_service
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'PARALLEL SERVICE';

SELECT soa.seoa_defaultvalue
INTO v_sw_code
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SW CODE';


SELECT soa.seoa_defaultvalue
INTO v_dsl_interface
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'DSL INTERFACE';

SELECT soa.seoa_defaultvalue
INTO v_dsl_ntu_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'DSL NTU CLASS';

SELECT ca.card_model
INTO  v_card_model
FROM service_order_attributes soa,circuits ci, ports po, cards ca, equipment eq
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SA_PSTN_NUMBER'
AND soa.seoa_defaultvalue= ci.cirt_displayname
AND ci.cirt_name = po.port_cirt_name
AND po.port_equp_id = eq.equp_id
and eq.equp_id = ca.card_equp_id
and po.port_card_slot = ca.card_slot
and po.port_relation ='PARENT';

SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;


SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; 

SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1)
AS node INTO v_location FROM DUAL; 

SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1))AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node,
v_sub_node FROM DUAL;



IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE'  AND v_parallel_service ='PSTN' 
AND v_dsl_interface = 'MSAN' AND v_pstn_no is not null AND v_pstn_no IS NOT NULL AND v_card_model not like '%COMBO%'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name =v_rtom_code||'-'||v_lea_code||'-SW-'||v_sw_code
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE-CONFIG VOICE PORT';
                   
ELSIF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE'  AND v_parallel_service <>'PSTN' AND v_pstn_no IS NULL
THEN                   

                    DELETE service_implementation_tasks sit
                    WHERE sit.seit_sero_id = p_sero_id
                    AND sit.seit_taskname = 'RE-CONFIG VOICE PORT'; 
                   
ELSE
                    DELETE service_implementation_tasks sit
                    WHERE sit.seit_sero_id = p_sero_id
                    AND sit.seit_taskname = 'RE-CONFIG VOICE PORT'; 
                    
END IF;



IF v_main_node IS NOT NULL THEN  

    IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' AND V_access_medium='COPPER' 
    AND v_parallel_service ='NONE' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE  MDF X CONNECT';
    
    ELSIF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' AND V_access_medium='COPPER' 
    AND v_parallel_service ='NONE' AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')THEN
    
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
      where sit.seit_taskname = 'MAKE  MDF X CONNECT';
    
    ELSIF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' THEN
    
    DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'MAKE  MDF X CONNECT'; END IF;
    
    END IF; 
  
    
IF v_main_node IS  NULL THEN   

   IF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' AND V_access_medium='COPPER'
   AND v_parallel_service ='NONE' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') 
        THEN

        UPDATE service_implementation_tasks sit
        SET sit.seit_worg_name = v_work_group_mdf
        WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE  MDF X CONNECT';
        
        ELSIF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' THEN
        
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'MAKE  MDF X CONNECT';      

        END IF;  
END IF;


        IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE' AND V_access_medium='COPPER'AND v_parallel_service ='NONE' AND v_dsl_ntu_class <> 'SLT'   
        THEN
  
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
            WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL OSP';
      
        ELSE
            DELETE service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'INSTALL OSP';  

        END IF;


  IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE'  AND v_parallel_service ='PSTN' 
AND v_dsl_interface = 'MSAN' AND v_pstn_no is not null AND v_card_model not like '%COMBO%'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = v_work_group_mdf
                   WHERE sit.seit_sero_id = p_sero_id
                    AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
                   
ELSE
                    DELETE service_implementation_tasks sit
                    WHERE sit.seit_sero_id = p_sero_id
                    AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
                    
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in d-schoolnet backhaul Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_SCHOOLNET_BACKHAUL_CREATE;
 
 --- Dilupa Alahakoon 2014 / 10 / 27

--- Dilupa Alahakoon 2014 / 10 / 29    
PROCEDURE D_SCHOOLNET_BACK_CRE_TRANSFER (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
v_service_category        VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_cpe_class               VARCHAR2 (100);
V_access_medium           VARCHAR2 (100);
v_section_handle_by       VARCHAR2 (100);
v_main_node               VARCHAR2 (100);
v_sub_node                VARCHAR2 (100);
v_aggregate_network       VARCHAR2 (100);
v_pstn_no                 VARCHAR2 (100);
v_card_model              VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_old_service_type        VARCHAR2 (100);
v_dsl_ntu_class           VARCHAR2 (100);
v_parallel_service        VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_work_group_mdf          VARCHAR2 (100);
v_location                VARCHAR2 (100);


CURSOR cur_equi_type IS 
select DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
from service_orders so,PORT_LINKS pl,PORT_LINK_PORTS plp,PORTS po,equipment e 
where so.sero_cirt_name = pl.porl_cirt_name
and pl.porl_id = plp.polp_porl_id
and plp.polp_port_id = po.port_id
and po.port_equp_id  = e.equp_id
AND (e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND po.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

CURSOR cur_pstn_id IS 
SELECT soa.seoa_defaultvalue,ca.card_model
INTO v_pstn_no, v_card_model
FROM service_order_attributes soa,circuits ci, ports po, cards ca, equipment eq
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SA_PSTN_NUMBER'
AND soa.seoa_defaultvalue= ci.cirt_displayname
AND ci.cirt_name = po.port_cirt_name
AND po.port_equp_id = eq.equp_id
and eq.equp_id = ca.card_equp_id
and po.port_card_slot = ca.card_slot
and po.port_relation ='PARENT';

BEGIN 
OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;

OPEN cur_pstn_id; FETCH cur_pstn_id INTO v_pstn_no, v_card_model;
CLOSE cur_pstn_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_dsl_ntu_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'DSL NTU CLASS';

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;
  
SELECT soa.seoa_defaultvalue
INTO V_access_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_aggregate_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NETWORK';

SELECT soa.seoa_defaultvalue
INTO v_cpe_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'CPE CLASS';


SELECT soa.seoa_defaultvalue
INTO v_pstn_no
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SA_PSTN_NUMBER';

SELECT soa.seoa_defaultvalue
INTO v_service_category
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SERVICE CATEGORY';

SELECT soa.seoa_defaultvalue
INTO v_section_handle_by
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_old_service_type
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'OLD SERVICE TYPE';



SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;


SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; 

SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1)
AS node INTO v_location FROM DUAL; 

SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1))AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node,
v_sub_node FROM DUAL;
                   


IF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER'  AND (v_aggregate_network = 'MEN' OR v_aggregate_network = 'MEN+CEA') 
AND (v_old_service_type = 'CDMA' OR v_old_service_type ='D-IPVPN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name ='DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE MEN VLAN';                
ELSE
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE MEN VLAN';                     
END IF;

      IF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER'  AND (v_aggregate_network = 'CEA' OR v_aggregate_network = 'MEN+CEA') 
      AND (v_old_service_type = 'CDMA' OR v_old_service_type ='D-IPVPN')
      THEN
      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name ='IPNET-PROV'
      WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE CEA VLAN';
      ELSE
      DELETE service_implementation_tasks sit
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'ACTIVATE CEA VLAN';    
      END IF;


IF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER'  AND (v_aggregate_network = 'MEN' OR v_aggregate_network = 'MEN+CEA') 
AND (v_old_service_type = 'D-PREMIUM IPVPN' OR v_old_service_type ='D-VALUE VPN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name ='DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN VLAN';                
ELSE
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY MEN VLAN';                   
END IF;


          IF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER'  AND (v_aggregate_network = 'CEA' OR v_aggregate_network = 'MEN+CEA') 
          AND (v_old_service_type = 'D-PREMIUM IPVPN' OR v_old_service_type ='D-VALUE VPN')
          THEN
          UPDATE service_implementation_tasks sit
          SET sit.seit_worg_name ='IPNET-PROV'
          WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEA VLAN';
          ELSE
          DELETE service_implementation_tasks sit
          WHERE sit.seit_sero_id = p_sero_id
          AND sit.seit_taskname = 'MODIFY CEA VLAN'; 
          END IF;



IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER'  AND v_parallel_service ='PSTN'  AND v_pstn_no is not null AND v_card_model not like '%COMBO%'
THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name =v_rtom_code||'-'||v_lea_code||'-SW'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE-CONFIG VOICE PORT';

ELSE
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RE-CONFIG VOICE PORT'; 

END IF;




IF v_main_node IS NOT NULL THEN  

IF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER' AND V_access_medium='COPPER' 
AND v_old_service_type <> 'D-VALUE VPN' AND v_main_node <> v_sub_node 
THEN

UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';

ELSIF v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER' AND V_access_medium='COPPER' 
AND v_old_service_type <> 'D-VALUE VPN' AND v_main_node = v_sub_node 
THEN

UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = v_work_group_mdf
where sit.seit_taskname = 'MODIFY MDF X CONNECT';

ELSIF  v_service_type  = 'D-SCHOOLNET BACKHAUL' AND   v_oredr_type = 'CREATE-TRANSFER' THEN

DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;

END IF; 


IF v_main_node IS  NULL THEN   

DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY MDF X CONNECT';      


END IF;
       
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in d-schoolnet backhaul Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_SCHOOLNET_BACK_CRE_TRANSFER ;
--- Dilupa Alahakoon 2014 / 10 / 29 

--- Jayan Liyanage 2014 / 09 / 26

PROCEDURE D_ETHERNET_EXT_SER (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_extso_no         varchar2 (100);
v_extso_type       varchar2 (100);
v_sodno              varchar2 (100);
v_sodType          varchar2 (100);
v_sodLink_Type   varchar2 (100);
v_sodOrd_type     varchar2 (100);
v_ext_sod               varchar2 (100);

BEGIN
select distinct  soa.seoa_defaultvalue into v_extso_no from  service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE SO NO' and soa.seoa_sero_id = p_sero_id;
select distinct  soa.seoa_defaultvalue into v_extso_type  from service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sodLink_Type               
from service_order_attributes soa where soa.seoa_name = 'EVPN LINK TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct so.sero_id, so.sero_sert_abbreviation,so.sero_ordt_type into v_sodno,v_sodType,v_sodOrd_type 
from service_orders so where so.sero_id = p_sero_id;
/*
select distinct so.sero_id into v_ext_sod
from service_orders so,circuits ci
where so.sero_cirt_name = ci.cirt_name
and so.sero_stas_abbreviation <> 'CANCELLED'
and (ci.cirt_status <> 'CANCELLED' or ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = v_extso_no
and so.sero_sert_abbreviation = v_extso_type;*/
if  v_extso_no is not null then
select distinct so.sero_id into v_ext_sod
from service_orders so--,circuits ci
--where so.sero_cirt_name = ci.cirt_name
where so.sero_stas_abbreviation <> 'CANCELLED'
--and (ci.cirt_status <> 'CANCELLED' or ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = v_extso_no
and so.sero_sert_abbreviation = v_extso_type;

IF v_sodType = 'D-ETHERNET VPN' AND (v_sodOrd_type = 'CREATE' or v_sodOrd_type = 'CREATE-OR' or v_sodOrd_type = 'MODIFY-PACKAGE' 
or v_sodOrd_type = 'MODIFY-LOCATION'  or v_sodOrd_type = 'MODIFY-SPEED' ) AND
  v_sodLink_Type = 'BACKHAUL LINK' THEN
  
UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_sodno
WHERE SOA.SEOA_NAME = 'E-VPN LINK SO#'
AND SOA.SEOA_SERO_ID = v_extso_no;

END IF; end if;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in D-ETHERTNET to D-ENT-WIFI Products :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END D_ETHERNET_EXT_SER;

--- Jayan Liyanage 2014 / 09 / 26

--- Jayan Liyanage 2014 / 09 / 26

PROCEDURE D_ETHERNET_EXT_SER_WAIT4_WIFI (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_extso_no          varchar2 (100);
v_extso_type        varchar2 (100);
v_sodno             varchar2 (100);
v_sodType           varchar2 (100);
v_sodLink_Type      varchar2 (100);
v_sodOrd_type       varchar2 (100);
v_Cir_Nos           varchar2 (100);
v_ext_sod           varchar2 (100);
v_Cir_No             varchar2 (100);

BEGIN
select distinct  soa.seoa_defaultvalue into v_extso_no from  service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE SO NO' and soa.seoa_sero_id = p_sero_id;
select distinct  soa.seoa_defaultvalue into v_extso_type  from service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sodLink_Type               
from service_order_attributes soa where soa.seoa_name = 'EVPN LINK TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct so.sero_id, so.sero_sert_abbreviation,so.sero_ordt_type into v_sodno,v_sodType,v_sodOrd_type 
from service_orders so where so.sero_id = p_sero_id;

if v_extso_no is not null then
select distinct so.sero_id into v_ext_sod
from service_orders so--,circuits ci
--where so.sero_cirt_name = ci.cirt_name
where so.sero_stas_abbreviation <> 'CANCELLED'
--and (ci.cirt_status <> 'CANCELLED' or ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = v_extso_no
and so.sero_sert_abbreviation = v_extso_type; end if;

SELECT distinct ci.cirt_displayname into v_Cir_No    
FROM service_orders so, circuits ci
where so.sero_cirt_name = ci.cirt_name
and (ci.cirt_status <> 'CANCELLED' OR ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = p_sero_id;

IF v_sodType = 'D-ETHERNET VPN' AND (v_sodOrd_type = 'CREATE' or v_sodOrd_type = 'CREATE-OR'or v_sodOrd_type = 'MODIFY-PACKAGE' 
or v_sodOrd_type = 'MODIFY-LOCATION'  or v_sodOrd_type = 'MODIFY-SPEED' ) AND
  v_sodLink_Type = 'BACKHAUL LINK' THEN
  
UPDATE service_implementation_tasks sit set sit.seit_stas_abbreviation = 'COMPLETED'
WHERE sit.seit_taskname = 'WAIT FOR E-VPN' AND sit.seit_sero_id = v_ext_sod;
UPDATE service_order_attributes soa SET SOA.SEOA_DEFAULTVALUE = v_Cir_No
WHERE SOA.SEOA_NAME = 'ETHERNET VPN CIRCUIT ID' AND SOA.SEOA_SERO_ID = v_extso_no;END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in D-ETHERTNET to D-ENT-WIFI :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END D_ETHERNET_EXT_SER_WAIT4_WIFI;

--- Jayan Liyanage 2014 / 09 / 26

 --- Jayan Liyanage 2014 /10 / 24
 
 PROCEDURE ASS_ACC_FIB_CMP (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_prod_so_num  varchar2 (100);
v_wait_sts     varchar2 (100);         
v_wait_sts_a   varchar2 (100);
v_wait_sts_b   varchar2 (100);
v_service_type varchar2 (100);

BEGIN
select distinct soa.seoa_defaultvalue into v_prod_so_num 
from service_order_attributes soa 
where soa.seoa_name = 'PRODUCT SO NUMBER'and SOA.SEOA_SERO_ID = p_sero_id;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = v_prod_so_num;

IF v_service_type <>  'D-EDL' THEN
select distinct sit.seit_stas_abbreviation into v_wait_sts 
from  service_implementation_tasks sit 
where sit.seit_taskname = 'WAIT FOR FIBER' and sit.seit_sero_id = v_prod_so_num; END IF;

IF v_service_type = 'D-EDL' THEN
select distinct sit.seit_stas_abbreviation into v_wait_sts_a 
from service_implementation_tasks sit 
where sit.seit_taskname = 'WAIT FOR FIBER-A END' and sit.seit_sero_id = v_prod_so_num;
select distinct sit.seit_stas_abbreviation into v_wait_sts_b 
from service_implementation_tasks sit 
where sit.seit_taskname = 'WAIT FOR FIBER-B END' and sit.seit_sero_id = v_prod_so_num; END IF;
 p_ret_msg := '';
 
IF ( v_service_type = 'D-ETHERNET VPN' or v_service_type = 'D-PREMIUM IPVPN' 
  or v_service_type = 'D-BIL') and v_wait_sts = 'ASSIGNED'  THEN
 p_ret_msg := '" WAIT FOR FIBER  "  Task not INPROGRESS in the  '
  || v_service_type ||  '  Service  ! ';

 ELSIF  v_service_type = 'D-EDL' and  v_wait_sts_a  =  'ASSIGNED' 
and v_wait_sts_b  =  'ASSIGNED'   THEN
 p_ret_msg :=  'WAIT FOR FIBER " A-END " and " B-END "  Task are not INPROGRESS in the  ' 
 || v_service_type ||  '  Service !  ';
 
ELSIF  v_service_type = 'D-EDL' and v_wait_sts_a =  'ASSIGNED'
 and   v_wait_sts_b  = 'INPROGRESS' THEN
 p_ret_msg :=  'WAIT FOR FIBER " A-END " Task is not INPROGRESS in the  ' 
 || v_service_type ||  '  Service  ! ';
 
ELSIF  v_service_type = 'D-EDL' and v_wait_sts_a =  'INPROGRESS'
 and   v_wait_sts_b  = 'ASSIGNED' THEN
 p_ret_msg :=  'WAIT FOR FIBER " B-END " Task is not INPROGRESS in the  ' 
 || v_service_type ||  '  Service  !  ';
 ELSE  p_ret_msg := '';  END IF; 
EXCEPTION  WHEN NO_DATA_FOUND THEN p_ret_msg := '';
 
END ASS_ACC_FIB_CMP;
  --- Jayan Liyanage 2014 /10 / 24

-- Jayan Liyanage  2014 / 10 / 24

PROCEDURE ASSIGN_NEW_ACC_FIBE (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_service_type       varchar2(100);
v_acc_fibe_av        varchar2(100);
v_oper_area          varchar2(100);
v_service_order_area varchar2(100);
v_rtom_code              varchar2(100);   
v_lea_code                 varchar2(100);
v_work_group_nw      varchar2(100);
v_service_order         varchar2(100);

BEGIN
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_fibe_av from service_order_attributes soa 
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?'and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_oper_area from service_order_attributes soa 
where soa.seoa_name = 'OPERATIONAL AREA'and soa.seoa_sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code || '-' || 'ENG-NW';

IF v_service_type = 'D-DAB' and v_service_order = 'CREATE' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'METRO' THEN
 
 UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLE'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; 

ELSIF v_service_type = 'D-DAB' and v_service_order = 'CREATE' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'REGION' THEN
  
   UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; 

ELSIF v_service_type = 'D-DAB' and v_service_order = 'CREATE-OR' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'METRO' THEN
 
 UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLE'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; 

ELSIF v_service_type = 'D-DAB' and v_service_order = 'CREATE-OR' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'REGION' THEN
  
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; 

ELSIF v_service_type = 'D-DAB' and v_service_order = 'MODIFY-LOCATION' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'METRO' THEN
 
 UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLE'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; 

ELSIF v_service_type = 'D-DAB' and v_service_order = 'MODIFY-LOCATION' AND
  (v_acc_fibe_av = 'NO' OR v_acc_fibe_av = 'INCOMPLETE')  AND v_oper_area = 'REGION' THEN
  
   UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER';  

ELSIF v_service_type = 'D-DAB' THEN 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id 
AND sit.seit_taskname = 'ASSIGN NEW ACC.FIBER'; END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-DAB WG change Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END ASSIGN_NEW_ACC_FIBE;
-- Jayan Liyanage  2014 / 10 / 24


-- Jayan Liyanage 2014/11/05
PROCEDURE D_DAB_SATART_FIB_LAY (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
v_acc_fib_avail      varchar2(100);
v_service_type       varchar2(100);
v_service_order      varchar2(100);
v_acc_medi           varchar2(100);

BEGIN
  
SELECT soa.seoa_defaultvalue INTO v_acc_fib_avail FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

IF    v_service_type = 'D-DAB'AND v_service_order = 'CREATE' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PLAN-TX' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING'; 
ELSIF    v_service_type = 'D-DAB'AND v_service_order = 'CREATE-OR' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PLAN-TX' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING'; 
ELSIF    v_service_type = 'D-DAB'AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PLAN-TX' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'START FIBER LAYING'; 
END IF; 

--  Start Modify Jayan Liyanage 2014/12/24

IF    v_service_type = 'D-DAB'AND v_service_order = 'CREATE' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'TRG_WAIT_4_FIB_2_SER'; 
ELSIF    v_service_type = 'D-DAB'AND v_service_order = 'CREATE-OR' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'TRG_WAIT_4_FIB_2_SER'; 
ELSIF    v_service_type = 'D-DAB'AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medi = 'FIBER'
AND ( v_acc_fib_avail = 'NO' or v_acc_fib_avail = 'INCOMPLETE')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'TRG_WAIT_4_FIB_2_SER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'TRG_WAIT_4_FIB_2_SER'; END IF; 

--  End;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-DAB  process  function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_DAB_SATART_FIB_LAY;
-- Jayan Liyanage 2014/11/05

-- Jayan Liyanage  2014 / 10 / 22


PROCEDURE WAIT4_FIBER_FOR_DATA_TSK (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS


v_service_type             varchar2 (100);
v_service_order            varchar2 (100);
v_service_order_area       varchar2 (100);
v_rtom_code                varchar2 (100);
v_lea_code                 varchar2 (100);
v_work_group_nw            varchar2 (100);
v_acc_fibe_av              varchar2 (100);
v_oper_area                varchar2 (100);
v_prod_so_num              varchar2 (100);
v_db_b_end                 varchar2 (100);
v_edl_Aend                 varchar2 (100);
v_edl_Bend                 varchar2 (100);
A                          varchar2 (100);
B                          varchar2 (100);


Cursor Cur_Loc_ab is
select distinct ci.cirt_locn_aend,ci.cirt_locn_bend --into v_edl_Aend,v_edl_Bend
from service_orders so,circuits ci where so.sero_cirt_name = ci.cirt_name
and ( ci.cirt_status <> 'CANCELLED' OR ci.cirt_status <> 'PENDINGDELETE')
 and so.sero_id = v_prod_so_num;
BEGIN
  
select distinct trim(soa.seoa_defaultvalue) into  v_prod_so_num from service_order_attributes soa 
where soa.seoa_name = 'PRODUCT SO NUMBER'and soa.seoa_sero_id = p_sero_id;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = v_prod_so_num;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = v_prod_so_num;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = v_prod_so_num;

--Start For One DAB 

IF v_service_type = 'D-ETHERNET VPN' and v_service_order = 'CREATE'  THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;
ELSIF v_service_type = 'D-ETHERNET VPN' and v_service_order = 'CREATE-OR' THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;

ELSIF v_service_type = 'D-ETHERNET VPN' and v_service_order = 'MODIFY-LOCATION'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;END IF;
IF v_service_type = 'D-PREMIUM IPVPN' and v_service_order = 'CREATE'  THEN   
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;

ELSIF v_service_type = 'D-PREMIUM IPVPN' and v_service_order = 'CREATE-OR'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;
ELSIF v_service_type = 'D-PREMIUM IPVPN' and v_service_order = 'MODIFY-LOCATION'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;END IF;

IF v_service_type = 'D-BIL' and v_service_order = 'CREATE' THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;
ELSIF v_service_type = 'D-BIL' and v_service_order = 'CREATE-OR'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;

ELSIF v_service_type = 'D-BIL' and v_service_order = 'MODIFY-LOCATION'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER' AND SIT.SEIT_SERO_ID = v_prod_so_num;END IF;BEGIN 
select distinct ci.cirt_locn_bend INTO v_db_b_end from service_orders so,circuits ci
where so.sero_cirt_name = ci.cirt_name and ( ci.cirt_status <> 'CANCELLED' 
OR ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = p_sero_id;

  open Cur_Loc_ab; fetch Cur_Loc_ab into v_edl_Aend,v_edl_Bend; close Cur_Loc_ab;
IF v_db_b_end =  v_edl_Aend THEN A:= 'A'; ELSIF v_db_b_end = v_edl_Bend THEN B:= 'B';END IF;
IF v_service_type = 'D-EDL' and v_service_order = 'CREATE' AND A = 'A'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-A END' AND SIT.SEIT_SERO_ID = v_prod_so_num;
ELSIF v_service_type = 'D-EDL' and v_service_order = 'CREATE' 
  AND B = 'B'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-B END' AND SIT.SEIT_SERO_ID = v_prod_so_num;  END IF;

IF v_service_type = 'D-EDL' and v_service_order = 'CREATE-OR' AND A = 'A'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-A END' AND SIT.SEIT_SERO_ID = v_prod_so_num;

ELSIF v_service_type = 'D-EDL' and v_service_order = 'CREATE-OR'AND B = 'B'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-B END' AND SIT.SEIT_SERO_ID = v_prod_so_num;END IF;
IF v_service_type = 'D-EDL' and v_service_order = 'MODIFY-LOCATION' AND A = 'A' THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-A END' AND SIT.SEIT_SERO_ID = v_prod_so_num;

ELSIF v_service_type = 'D-EDL' and v_service_order = 'MODIFY-LOCATION' AND B = 'B'THEN
UPDATE SERVICE_IMPLEMENTATION_TASKS SIT SET SIT.SEIT_STAS_ABBREVIATION ='COMPLETED'
WHERE SIT.SEIT_TASKNAME = 'WAIT FOR FIBER-B END' AND SIT.SEIT_SERO_ID = v_prod_so_num;END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in D-DAB to D-EDL Product.
Please Check "Product SO Number" Atttribute  :'
 || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg); END;

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in D-DAB to ' ||v_service_type || 
' Product.Please Check "Product SO Number" Atttribute  :'
 || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END WAIT4_FIBER_FOR_DATA_TSK;

-- Jayan Liyanage  2014 / 10 / 22

-- Jayan Liyanage 2014 / 12 / 01
PROCEDURE  WAIT_4_FIBER_EXIS_OD1SIDE(
p_serv_id                      IN     Services.serv_id%TYPE,
p_sero_id                      IN     Service_Orders.sero_id%TYPE,
p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                      IN     work_order.woro_id%TYPE,
p_ret_char                     OUT    VARCHAR2,
p_ret_number                   OUT    NUMBER,
p_ret_msg                      OUT    VARCHAR2) IS


v_acc_medium                   varchar2(100);
v_acc_bearer_sts               varchar2(100);
v_acc_fib_avil                 varchar2(100);
v_so_ordtype                   varchar2(100);
v_so_serType                   varchar2 (100);

BEGIN
  
select distinct so.sero_ordt_type into v_so_ordtype
from service_orders so where so.sero_id = p_sero_id;

select so.sero_sert_abbreviation into v_so_serType
from service_orders so where so.sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_medium from service_order_attributes soa 
where soa.seoa_name = 'ACCESS MEDIUM' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_bearer_sts from service_order_attributes soa
where soa.seoa_name = 'ACCESS BEARER STATUS' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_fib_avil from service_order_attributes soa
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

IF (v_so_serType = 'D-ETHERNET VPN' OR v_so_serType = 'D-PREMIUM IPVPN' OR v_so_serType = 'D-BIL' ) and  
  v_acc_medium = 'FIBER' and v_acc_bearer_sts = 'COMMISSIONED' and v_acc_fib_avil = 'OLD SO' THEN
  
  update service_implementation_tasks sit set sit.seit_worg_name = 'CORP-SSU-ENG'
  where sit.seit_taskname = 'WAIT FOR FIBER_X'  and sit.seit_sero_id = p_sero_id;
else 
  delete service_implementation_tasks sit 
  where sit.seit_taskname = 'WAIT FOR FIBER_X'
  and sit.seit_sero_id = p_sero_id; END IF;


   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change Wait for fiber_X  process  function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END WAIT_4_FIBER_EXIS_OD1SIDE;
-- Jayan Liyanage  2014 / 12 / 01

-- Jayan Liyanage  2014 / 12 / 01
PROCEDURE  WAIT_4_FIBER_EXIS_EDL(
p_serv_id                      IN     Services.serv_id%TYPE,
p_sero_id                      IN     Service_Orders.sero_id%TYPE,
p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                      IN     work_order.woro_id%TYPE,
p_ret_char                     OUT    VARCHAR2,
p_ret_number                   OUT    NUMBER,
p_ret_msg                      OUT    VARCHAR2) IS


v_acc_mediumA                   varchar2(100);
v_acc_mediumB                   varchar2(100);
v_acc_bearer_stsA               varchar2(100);
v_acc_bearer_stsB               varchar2(100);
v_acc_fib_avilA                 varchar2(100);
v_acc_fib_avilB                 varchar2(100);
v_so_ordtype                   varchar2(100);
v_so_serType                   varchar2 (100);

BEGIN
  
select distinct so.sero_ordt_type into v_so_ordtype
from service_orders so where so.sero_id = p_sero_id;

select so.sero_sert_abbreviation into v_so_serType
from service_orders so where so.sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_mediumA from service_order_attributes soa 
where soa.seoa_name = 'ACCESS MEDIUM-A END' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_mediumB from service_order_attributes soa 
where soa.seoa_name = 'ACCESS MEDIUM-B END' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_bearer_stsA from service_order_attributes soa
where soa.seoa_name = 'ACC. BEARER STATUS-A END' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_bearer_stsB from service_order_attributes soa
where soa.seoa_name = 'ACC. BEARER STATUS-B END' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_fib_avilA from service_order_attributes soa
where soa.seoa_name = 'ACC. FIBER AVAILABLE?-A END' and soa.seoa_sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_acc_fib_avilB from service_order_attributes soa
where soa.seoa_name = 'ACC. FIBER AVAILABLE?-B END' and soa.seoa_sero_id = p_sero_id;



IF (v_so_serType = 'D-EDL' ) and v_acc_mediumA = 'FIBER' and 
v_acc_bearer_stsA = 'COMMISSIONED' and v_acc_fib_avilA = 'OLD SO' THEN
  
update service_implementation_tasks sit
set sit.seit_worg_name = 'CORP-SSU-ENG'
where sit.seit_taskname = 'WAIT FOR FIBER-A _X'
and sit.seit_sero_id = p_sero_id;

ELSE delete service_implementation_tasks sit
  where sit.seit_taskname = 'WAIT FOR FIBER-A _X'
  and sit.seit_sero_id = p_sero_id; END IF;

IF (v_so_serType = 'D-EDL' ) and v_acc_mediumB = 'FIBER' and 
v_acc_bearer_stsB = 'COMMISSIONED' and v_acc_fib_avilB = 'OLD SO' THEN
  
update service_implementation_tasks sit
set sit.seit_worg_name = 'CORP-SSU-ENG'
where sit.seit_taskname = 'WAIT FOR FIBER-B _X'
and sit.seit_sero_id = p_sero_id;

ELSE delete service_implementation_tasks sit
  where sit.seit_taskname = 'WAIT FOR FIBER-B _X'
  and sit.seit_sero_id = p_sero_id; END IF;
  


   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change Wait for fiber_X (D-EDL) process  function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END WAIT_4_FIBER_EXIS_EDL;
-- Jayan Liyanage 2014 / 12 / 01

-- Jayan Liyanage 2014/ 11 / 10
PROCEDURE D_DAB_CH_WO_ACTIVITY_WG (
   P_SERV_ID         IN       SERVICES.SERV_ID%TYPE,
   P_SERO_ID         IN       SERVICE_ORDERS.SERO_ID%TYPE,
   P_SEIT_ID         IN       SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
   P_IMPT_TASKNAME   IN       IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
   P_WORO_ID         IN       WORK_ORDER.WORO_ID%TYPE,
   P_RET_CHAR        OUT      VARCHAR2,
   P_RET_NUMBER      OUT      NUMBER,
   P_RET_MSG         OUT      VARCHAR2
)
IS

CURSOR C_SO_NO IS 
SELECT DISTINCT SIT.SEIT_SERO_ID,SIT.SEIT_ID,SIT.SEIT_TASKNAME
FROM SERVICE_IMPLEMENTATION_TASKS SIT
WHERE SEIT_ID = P_SEIT_ID;

CURSOR C_WO_WG (T_sero_id SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE,
T_SEIT_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%type)IS 
SELECT WORO_WORG_NAME,WORO_ID
FROM WORK_ORDER
WHERE WORO_SERO_ID=T_sero_id
and WORO_SEIT_ID=T_SEIT_ID;

V_WORK_ORDER_WG   WORK_ORDER.WORO_WORG_NAME%TYPE;
V_SEIT_ID         SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE;
V_SEIT_SERO_ID     SERVICE_ORDERS.SERO_ID%TYPE;
V_WORO_ID          WORK_ORDER.WORO_ID%TYPE;
V_WORD_TASK_NM    WORK_ORDER.WORO_ID%TYPE;

BEGIN

OPEN C_SO_NO;
FETCH C_SO_NO INTO V_SEIT_SERO_ID,V_SEIT_ID,V_WORD_TASK_NM;
CLOSE  C_SO_NO;

BEGIN 
P_DYNAMIC_PROCEDURE.PROCESS_ISSUE_WORK_ORDER (
P_SERV_ID         ,
P_SERO_ID         ,
P_SEIT_ID         ,
P_IMPT_TASKNAME   ,
P_WORO_ID         ,
P_RET_CHAR        ,
P_RET_NUMBER      ,
P_RET_MSG         );    

END ;

OPEN C_WO_WG (V_SEIT_SERO_ID,V_SEIT_ID);
FETCH C_WO_WG INTO V_WORK_ORDER_WG,V_WORO_ID;
CLOSE C_WO_WG ;

BEGIN
UPDATE WORK_ORDER_ACTIVITIES WOA
SET WOA.WOOA_WORG_NAME = V_WORK_ORDER_WG
WHERE WOOA_ACTIVITYNAME = 'ASSIGN NTU' 
AND WOOA_WORO_ID = V_WORO_ID;commit; 

END ;
                                      
EXCEPTION
   WHEN OTHERS
   THEN
      P_RET_MSG :=
            'Failed to Change Work Order Activity WG . Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID (P_SERO_ID,
                                                      0,
                                                      P_SEIT_ID,
                                                      'ERROR'
                                                     );

      INSERT INTO SERVICE_TASK_COMMENTS
                  (SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
                   SETC_TEXT
                  )
           VALUES (P_SEIT_ID, SETC_ID_SEQ.NEXTVAL, 'CLARITYB', SYSDATE,
                   P_RET_MSG
                  );
END D_DAB_CH_WO_ACTIVITY_WG;
-- Jayan Liyanage  2014 / 11 / 10

--- Jayan Liyanage 2014 / 11 / 25
PROCEDURE  BTL_SW_WG_CHNG(
p_serv_id                      IN     Services.serv_id%TYPE,
p_sero_id                      IN     Service_Orders.sero_id%TYPE,
p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                      IN     work_order.woro_id%TYPE,
p_ret_char                     OUT    VARCHAR2,
p_ret_number                   OUT    NUMBER,
p_ret_msg                      OUT    VARCHAR2) IS



v_Sw_code                      varchar2(100):= null;
v_Service_type                 varchar2(100);
v_prod_sw_code                 varchar2(100);
v_Service_Odr_Type             varchar2(100);
v_cur_no_pstn#                 number;
v_pre_no_pstn#                 number;



Cursor Cur_Sw_Code is select distinct soa.seoa_defaultvalue
from service_order_attributes soa where soa.seoa_name = 'SW CODE'
and soa.seoa_sero_id = p_sero_id;

Cursor Cur_mapSW(service_ty varchar2,area_sw_code varchar2) is
select distinct aw.arwg_worg_name from area_workgroups aw
where aw.arwg_sert_abbreviation = service_ty
and aw.arwg_area_code = area_sw_code and aw.arwg_grouptype = 'SW WG';


BEGIN

select so.sero_sert_abbreviation,so.sero_ordt_type into v_Service_type,v_Service_Odr_Type
from service_orders so where so.sero_id = p_sero_id; 
open Cur_Sw_Code; fetch Cur_Sw_Code into  v_Sw_code; close Cur_Sw_Code;
open Cur_mapSW(v_Service_type,v_Sw_code); fetch Cur_mapSW into v_prod_sw_code;

select distinct soa.seoa_defaultvalue,soa.seoa_prev_value into v_cur_no_pstn#,v_pre_no_pstn# from service_order_attributes soa 
where soa.seoa_name =  'SA_NO_OF_PSTN NUMBERS' and soa.seoa_sero_id = p_sero_id;

IF v_Service_type = 'D-BTL' and (v_Service_Odr_Type = 'CREATE' OR v_Service_Odr_Type = 'CREATE-OR' OR
  v_Service_Odr_Type = 'CREATE-UPGRADE' OR v_Service_Odr_Type = 'CREATE-TRANSFER') AND v_prod_sw_code IS NULL then 
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY' 
where sit.seit_taskname = 'CONFIG SWITCH PORT' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY'
where sit.seit_taskname = 'ACTIVATE BTL SERVICE' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY'
where sit.seit_taskname = 'CONFIRM  W/ CUSTOMER' and sit.seit_sero_id = p_sero_id;

ELSIF  v_Service_type = 'D-BTL' and (v_Service_Odr_Type = 'CREATE' OR v_Service_Odr_Type = 'CREATE-OR' OR
  v_Service_Odr_Type = 'CREATE-UPGRADE' OR v_Service_Odr_Type = 'CREATE-TRANSFER') AND v_prod_sw_code  IS NOT NULL THEN 
update service_implementation_tasks sit set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'CONFIG SWITCH PORT' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'ACTIVATE BTL SERVICE' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'CONFIRM  W/ CUSTOMER' and sit.seit_sero_id = p_sero_id; end if;

---  Modify Number Switch WG Change

IF v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' and v_prod_sw_code IS NULL then 
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY' 
where sit.seit_taskname = 'ACTIVATE NUMBERS' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY' 
where sit.seit_taskname = 'RECONFIG NUMBERS' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY' 
where sit.seit_taskname = 'DEACTIVATE NUMBERS' and sit.seit_sero_id = p_sero_id;
update service_implementation_tasks sit set sit.seit_worg_name = 'CLARITY' 
where sit.seit_taskname = 'CONFIRM  W/ CUSTOMER' and sit.seit_sero_id = p_sero_id; end if;


IF v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' and v_prod_sw_code  IS NOT NULL and
  NVL(v_cur_no_pstn#,'0') >  NVL(v_pre_no_pstn#,'1') then 
update service_implementation_tasks sit  set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'ACTIVATE NUMBERS' and sit.seit_sero_id = p_sero_id;
elsif v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'ACTIVATE NUMBERS'
and sit.seit_sero_id = p_sero_id; end if;
IF v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' and v_prod_sw_code  IS NOT NULL and
  NVL(v_cur_no_pstn#,'0') =  NVL(v_pre_no_pstn#,'1') then 
update service_implementation_tasks sit  set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'RECONFIG NUMBERS' and sit.seit_sero_id = p_sero_id;
elsif v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'RECONFIG NUMBERS'
and sit.seit_sero_id = p_sero_id; end if;
IF v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' and v_prod_sw_code  IS NOT NULL and
  NVL(v_cur_no_pstn#,'0') <  NVL(v_pre_no_pstn#,'1') then 
update service_implementation_tasks sit  set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'DEACTIVATE NUMBERS' and sit.seit_sero_id = p_sero_id;
elsif v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'DEACTIVATE NUMBERS'
and sit.seit_sero_id = p_sero_id; end if;
IF v_Service_type = 'D-BTL' and v_Service_Odr_Type = 'MODIFY-NUMBER' and v_prod_sw_code  IS NOT NULL then
  update service_implementation_tasks sit  set sit.seit_worg_name = v_prod_sw_code
where sit.seit_taskname = 'CONFIRM  W/ CUSTOMER' and sit.seit_sero_id = p_sero_id; end if;

-- End;


   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-BTL Switch WG Change process  function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END BTL_SW_WG_CHNG;
--- Jayan Liyanage 2014 / 11 / 25

---- Dinesh Update 25-04-2016 ----
----- Sudheera 2014 02 26 ---- UPDATE ADSL CANCELATION ATTRIBUTE-----  
PROCEDURE UPDATE_ADSL_CANC_ATTR (      
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

   
CURSOR CHECK_WO_EXSIST IS
SELECT 
NVL(COUNT(*),0) 
FROM 
     WORK_ORDER 
WHERE
     WORO_SEIT_ID = p_seit_id;
     
CURSOR GET_MANS_NAME IS
SELECT 
DISTINCT SACS_MANS_CLASS 
FROM 
SOP_ACTION_COMMAND_SETS 
WHERE 
SACS_IMPT_TASKNAME IN
(
SELECT
SEIT_TASKNAME
FROM SERVICE_IMPLEMENTATION_TASKS
WHERE SEIT_ID = p_seit_id
);

CURSOR GET_SERO_ID IS
SELECT
SEIT_SERO_ID
FROM SERVICE_IMPLEMENTATION_TASKS
WHERE SEIT_ID = p_seit_id;

WO_EXSISTS NUMBER := 0;
MANS_CLASS SOP_ACTION_COMMAND_SETS.SACS_MANS_CLASS%TYPE;
WO_SO_SERO_ID SERVICE_ORDERS.SERO_ID%TYPE;


BEGIN

OPEN CHECK_WO_EXSIST;
FETCH CHECK_WO_EXSIST INTO WO_EXSISTS;
CLOSE CHECK_WO_EXSIST; 

IF WO_EXSISTS = 0 THEN

OPEN GET_MANS_NAME;
FETCH GET_MANS_NAME INTO MANS_CLASS;
CLOSE GET_MANS_NAME;

OPEN GET_SERO_ID;
FETCH GET_SERO_ID INTO WO_SO_SERO_ID;
CLOSE GET_SERO_ID;

    IF MANS_CLASS = 'HUAWEI' THEN 
        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_PREV_VALUE = 'NO', SEOA_DEFAULTVALUE = 'YES'
        WHERE
        SEOA_SERO_ID = WO_SO_SERO_ID
        AND SEOA_NAME = 'CANCELLATION_HUAWEI';
    END IF;

    IF MANS_CLASS = 'LDAP' THEN 
        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_PREV_VALUE = 'NO', SEOA_DEFAULTVALUE = 'YES'
        WHERE
        SEOA_SERO_ID = WO_SO_SERO_ID
        AND SEOA_NAME = 'CANCELLATION_LDAP';
    END IF;
    
    IF MANS_CLASS = 'PCRF' THEN 
        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_PREV_VALUE = 'NO', SEOA_DEFAULTVALUE = 'YES'
        WHERE
        SEOA_SERO_ID = WO_SO_SERO_ID
        AND SEOA_NAME = 'CANCELLATION_PCRF';
    END IF;
        
    IF MANS_CLASS = 'ZTE' THEN 
        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_PREV_VALUE = 'NO', SEOA_DEFAULTVALUE = 'YES'
        WHERE
        SEOA_SERO_ID = WO_SO_SERO_ID
        AND SEOA_NAME = 'CANCELLATION_ZTE';
    END IF;
    
    
    IF MANS_CLASS = 'ZTENGN5' THEN 
        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_PREV_VALUE = 'NO', SEOA_DEFAULTVALUE = 'YES'
        WHERE
        SEOA_SERO_ID = WO_SO_SERO_ID
        AND SEOA_NAME = 'CANCELLATION_ZTEX';
    END IF;

    p_implementation_tasks.update_task_status_byid (P_SERO_ID, 0,p_seit_id,'COMPLETED' );

END IF;

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Unable to update cancellation attributes :'|| ' - Erro is:'|| 
  TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (P_SERO_ID, 0, p_seit_id, 'COMPLETED');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
    
END UPDATE_ADSL_CANC_ATTR;
----- Sudheera 2014 02 26 ---- UPDATE ADSL CANCELATION ATTRIBUTE-----
---- Dinesh Update 25-04-2016 ---- 

--- Jayan Liyanage 2014/08/04

PROCEDURE BTL_PROVISION_FEATURE_CHECK (
      P_SERV_ID                IN     SERVICES.SERV_ID%TYPE,
      P_SERO_ID                IN     SERVICE_ORDERS.SERO_ID%TYPE,
      P_SEIT_ID                IN     SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
      P_IMPT_TASKNAME          IN     IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
      P_WORO_ID                IN     WORK_ORDER.WORO_ID%TYPE,
      P_RET_CHAR                  OUT    VARCHAR2,
      P_RET_NUMBER                OUT    NUMBER,
      P_RET_MSG                   OUT    VARCHAR2) IS
      

CURSOR Cur_service_OD IS
SELECT SERO_ORDT_TYPE
FROM SERVICE_ORDERS
WHERE SERO_ID = P_SERO_ID;
          
          
CURSOR Cur_sod_feature_cur  IS
SELECT SOFE_FEATURE_NAME, SOFE_DEFAULTVALUE, SOFE_PREV_VALUE,SOFE_PROVISION_STATUS
FROM SERVICE_ORDER_FEATURES
WHERE SOFE_SERO_ID = P_SERO_ID
AND SOFE_DEFAULTVALUE = 'Y'
AND (SOFE_PREV_VALUE = 'N' OR SOFE_PREV_VALUE IS NULL)
AND SOFE_FEATURE_NAME IN ('SF_SMS','SF_IDD');


CURSOR Cur_sod_feature_pre  IS
SELECT SOFE_FEATURE_NAME, SOFE_DEFAULTVALUE, SOFE_PREV_VALUE,SOFE_PROVISION_STATUS
FROM SERVICE_ORDER_FEATURES
WHERE SOFE_SERO_ID = P_SERO_ID
AND SOFE_DEFAULTVALUE = 'N'
AND SOFE_PREV_VALUE = 'Y'
AND SOFE_FEATURE_NAME IN ('SF_SMS','SF_IDD');


v_ser_od_type varchar2(100);
                  

begin

-- DBMS_OUTPUT.put_line ('Please see the Provision Status');
    P_RET_MSG := '';
    
open Cur_service_OD;
fetch Cur_service_OD into v_ser_od_type;
close Cur_service_OD;

for Cur_sod_rec IN Cur_sod_feature_cur  LOOP
  
IF Cur_sod_rec.SOFE_PROVISION_STATUS IS NULL AND v_ser_od_type = 'CREATE'  THEN
  
P_RET_MSG := 'Still SOD Feature not-yet Provisioned. Error is : '||Cur_sod_rec.SOFE_FEATURE_NAME||' '||
Cur_sod_rec.SOFE_DEFAULTVALUE || 
TO_CHAR(SQLCODE) ||'-'|| SQLERRM; 

ELSE  
  p_ret_msg := '';

END IF; END LOOP;

for Cur_sod_rec1 IN Cur_sod_feature_pre  LOOP
  
IF Cur_sod_rec1.SOFE_PROVISION_STATUS IS NULL AND v_ser_od_type = 'CREATE'  THEN
  
P_RET_MSG := 'Still SOD Feature not-yet Provisioned. Error is : '||Cur_sod_rec1.SOFE_FEATURE_NAME||' '||
Cur_sod_rec1.SOFE_DEFAULTVALUE || 
TO_CHAR(SQLCODE) ||'-'|| SQLERRM; 

ELSE  
  p_ret_msg := '';

END IF; END LOOP;



p_implementation_tasks.update_task_status_byid (P_SERO_ID, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'No Data Found , Please see the SOD Features :'|| ' - Erro is:'|| 
  TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (P_SERO_ID, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END BTL_PROVISION_FEATURE_CHECK;

--- Jayan Liyanage 2014/08/04

--- Jayan Liyanage 2014/08/04

PROCEDURE D_BTL_CH_WO_ACTIVITY_WG (
   P_SERV_ID         IN       SERVICES.SERV_ID%TYPE,
   P_SERO_ID         IN       SERVICE_ORDERS.SERO_ID%TYPE,
   P_SEIT_ID         IN       SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
   P_IMPT_TASKNAME   IN       IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
   P_WORO_ID         IN       WORK_ORDER.WORO_ID%TYPE,
   P_RET_CHAR        OUT      VARCHAR2,
   P_RET_NUMBER      OUT      NUMBER,
   P_RET_MSG         OUT      VARCHAR2
)
IS
CURSOR C_SO_NO IS 
SELECT SEIT_SERO_ID,SEIT_ID
FROM SERVICE_IMPLEMENTATION_TASKS
WHERE SEIT_ID = P_SEIT_ID;
CURSOR C_WO_WG (T_sero_id SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE,
T_SEIT_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%type)IS 
SELECT WORO_WORG_NAME,WORO_ID
FROM WORK_ORDER
WHERE WORO_SERO_ID=T_sero_id
and WORO_SEIT_ID=T_SEIT_ID;

V_WORK_ORDER_WG   WORK_ORDER.WORO_WORG_NAME%TYPE;
V_SEIT_ID         SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE;
V_SEIT_SERO_ID     SERVICE_ORDERS.SERO_ID%TYPE;
V_WORO_ID          WORK_ORDER.WORO_ID%TYPE;

BEGIN

OPEN C_SO_NO;

FETCH C_SO_NO INTO V_SEIT_SERO_ID,V_SEIT_ID;

CLOSE  C_SO_NO;


BEGIN P_DYNAMIC_PROCEDURE.PROCESS_ISSUE_WORK_ORDER (
P_SERV_ID         ,
P_SERO_ID         ,
P_SEIT_ID         ,
P_IMPT_TASKNAME   ,
P_WORO_ID         ,
P_RET_CHAR        ,
P_RET_NUMBER      ,
P_RET_MSG         );    
END ;

OPEN C_WO_WG (V_SEIT_SERO_ID,V_SEIT_ID);
FETCH C_WO_WG INTO V_WORK_ORDER_WG,V_WORO_ID;
CLOSE C_WO_WG ;
    
BEGIN

UPDATE WORK_ORDER_ACTIVITIES WOA
SET WOA.WOOA_WORG_NAME = V_WORK_ORDER_WG
WHERE WOOA_ACTIVITYNAME = 'INSTALL NTU' AND WOOA_WORO_ID = V_WORO_ID;commit; 
END ;
                                      
EXCEPTION
   WHEN OTHERS
   THEN
      P_RET_MSG :=
            'Failed to Change Work Order Activity WG . Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID (P_SERO_ID,
                                                      0,
                                                      P_SEIT_ID,
                                                      'ERROR'
                                                     );

      INSERT INTO SERVICE_TASK_COMMENTS
                  (SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
                   SETC_TEXT
                  )
           VALUES (P_SEIT_ID, SETC_ID_SEQ.NEXTVAL, 'CLARITYB', SYSDATE,
                   P_RET_MSG
                  );
END D_BTL_CH_WO_ACTIVITY_WG;

--- Jayan Liyanage 2014/08/04

--- Dinesh Perera 2014/12/19 ----
PROCEDURE REMOVE_IP_TASK_CON_FUNCTION(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_new_val VARCHAR2(100);
v_pre_val VARCHAR2(100);
BEGIN    
select soa.SEOA_DEFAULTVALUE,soa.SEOA_PREV_VALUE
into  v_new_val,v_pre_val
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'ADSL_TYPE';
IF ((v_new_val = 'DYNAMIC PRIVATE IP') OR (v_new_val = 'DYNAMIC PUBLIC IP')) and v_pre_val = 'STATIC' THEN
p_ret_msg := '';
ELSE
p_ret_msg := 'FALSE';
END IF;         
EXCEPTION
WHEN NO_DATA_FOUND THEN
   p_ret_msg := 'FALSE';   
WHEN OTHERS THEN
   p_ret_msg := ''; 
END REMOVE_IP_TASK_CON_FUNCTION;
--- Dinesh Perera 2014/12/19 ----

---- Dinesh Perera 2014/12/30 ----
PROCEDURE PROCESS_UPDATE_SW_ATTR (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS




      
    CURSOR NUMB_ID  IS
    SELECT  NUMB_ID
    FROM    SERVICE_ORDERS SO,NUMBERS NU
    WHERE   SO.SERO_ID=p_sero_id
    AND     NU.NUMB_SERV_ID=SERO_SERV_ID;
      
      
    CURSOR C_NO_AUTO_PROV (T_NUMB_ID NUMBERS.NUMB_ID%TYPE) IS
        SELECT  NIDE_VALUE
        FROM    NUMBER_INSTANCE_DETAILS
        WHERE   NIDE_NUMB_ID=T_NUMB_ID
        AND     NIDE_NAME ='AUTO_PROV';

    CURSOR C_NO_MANS_NAME (T_NUMB_ID NUMBERS.NUMB_ID%TYPE) IS
        SELECT  NIDE_VALUE
        FROM    NUMBER_INSTANCE_DETAILS
        WHERE   NIDE_NUMB_ID=T_NUMB_ID
        AND     NIDE_NAME='MANS_NAME';
      
     

      V_NUMB_ID         NUMBERS.NUMB_ID%TYPE;
      V_SERO_ATTR       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;  
      V_AUTO_PROV       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
      V_MANS_NAME       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;

BEGIN


    OPEN NUMB_ID;
    FETCH NUMB_ID INTO V_NUMB_ID;
    CLOSE NUMB_ID;

      
    OPEN C_NO_AUTO_PROV(V_NUMB_ID);
    FETCH C_NO_AUTO_PROV INTO V_AUTO_PROV;
    CLOSE C_NO_AUTO_PROV;

    
    OPEN C_NO_MANS_NAME(V_NUMB_ID);
    FETCH C_NO_MANS_NAME INTO V_MANS_NAME;
    CLOSE C_NO_MANS_NAME;

 

    IF V_AUTO_PROV IS NOT NULL AND V_MANS_NAME IS NOT NULL THEN
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_MANS_NAME
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    ELSE
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = 'NA'
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    
    END IF;
    

 EXCEPTION
 WHEN OTHERS THEN


        p_ret_msg  := 'UPDATE SW ATTR PROCESS FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);


END PROCESS_UPDATE_SW_ATTR;
---- Dinesh Perera 2014/12/30 ----

-- 23-12-2014 Samankula Owitipana
PROCEDURE FTTH_UPDATE_PKG_NAME (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_crm_order_id      varchar2(100);
v_ab_so_id         varchar2(100);
v_voice_so_id         varchar2(100);
v_iptv_so_id         varchar2(100);
v_pkg_name         varchar2(100);
v_dsp_date           varchar2(100);

cursor c_ab_ftth_so_id is
select so.SERO_ID from service_orders so
where so.SERO_OEID like v_crm_order_id || '-%'
and so.SERO_SERT_ABBREVIATION = 'AB-FTTH'
and so.SERO_STAS_ABBREVIATION in ('PROPOSED','APPROVED');

cursor c_v_voice_so_id is
select so.SERO_ID from service_orders so
where so.SERO_OEID like v_crm_order_id || '-%'
and so.SERO_SERT_ABBREVIATION = 'V-VOICE FTTH'
and so.SERO_STAS_ABBREVIATION in ('PROPOSED','APPROVED');

cursor c_e_iptv_so_id is
select so.SERO_ID from service_orders so
where so.SERO_OEID like v_crm_order_id || '-%'
and so.SERO_SERT_ABBREVIATION = 'E-IPTV FTTH'
and so.SERO_STAS_ABBREVIATION in ('PROPOSED','APPROVED');

BEGIN

    
SELECT substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1)
INTO v_crm_order_id
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;


SELECT nvl(upper(soa.seoa_defaultvalue),'0') 
INTO v_pkg_name
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SA_PACKAGE_NAME';

open c_ab_ftth_so_id;
fetch c_ab_ftth_so_id into v_ab_so_id;
close c_ab_ftth_so_id;

open c_v_voice_so_id;
fetch c_v_voice_so_id into v_voice_so_id;
close c_v_voice_so_id;

open c_e_iptv_so_id;
fetch c_e_iptv_so_id into v_iptv_so_id;
close c_e_iptv_so_id;

IF v_ab_so_id is not null THEN


UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_pkg_name
WHERE SOA.SEOA_SERO_ID = v_ab_so_id
AND SOA.SEOA_NAME = 'SA_PACKAGE_NAME';

UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_pkg_name
WHERE SOA.SEOA_SERO_ID = v_voice_so_id
AND SOA.SEOA_NAME = 'SA_PACKAGE_NAME';

UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_pkg_name
WHERE SOA.SEOA_SERO_ID = v_iptv_so_id
AND SOA.SEOA_NAME = 'SA_PACKAGE_NAME';


END IF;


p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 


EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update ADSL Package name attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_UPDATE_PKG_NAME;
---- 23-12-2014 Samankula Owitipana

---- 02-01-2015 Samankula Owitipana
PROCEDURE FTTH_UPDATE_EQUIP_MANR (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS  
      

      v_cct_name       VARCHAR2(60);
      p_equip_model    VARCHAR2(100);
      p_equip_manr     VARCHAR2(100);
      


CURSOR c_so_order_id IS
SELECT so.SERO_CIRT_NAME
FROM service_orders so
WHERE so.sero_id = p_sero_id;      
      
cursor c_equip_details is
select eq.EQUP_EQUM_MODEL,eq.EQUP_MANR_ABBREVIATION
from port_links pl,port_link_ports plp,ports po,cards ca,equipment eq
where pl.PORL_CIRT_NAME = v_cct_name
and pl.PORL_ID = plp.POLP_PORL_ID
and plp.POLP_PORT_ID = po.PORT_ID
and po.PORT_EQUP_ID = ca.CARD_EQUP_ID
and po.PORT_CARD_SLOT = ca.CARD_SLOT
and ca.CARD_EQUP_ID = eq.EQUP_ID
and ca.CARD_MODEL LIKE 'GPON%'
and eq.EQUP_EQUT_ABBREVIATION like 'MSAN-%';

      
BEGIN
   
      OPEN c_so_order_id;
      FETCH c_so_order_id    INTO v_cct_name;
      CLOSE c_so_order_id;

      OPEN c_equip_details;       
      FETCH c_equip_details INTO p_equip_model,p_equip_manr;
      CLOSE c_equip_details;   
      
      
               update service_order_attributes soa
               set soa.SEOA_DEFAULTVALUE = p_equip_manr
               where soa.SEOA_NAME = 'OLT_MANUFACTURER'
               and soa.SEOA_SERO_ID = p_sero_id;      

    
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 


EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update OLT_MANUFACTURER attribute.'  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_UPDATE_EQUIP_MANR;
---- 02-01-2015 Samankula Owitipana

---- 06-01-2015 Dinesh Perera ----
PROCEDURE FTTH_MANS_NAME_UPDATE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS  
      

      p_num_id         VARCHAR2(60);
      p_nuc_code       VARCHAR2(100);
      p_num_number     VARCHAR2(100);
      p_mans_name      VARCHAR2(100);
      
      

CURSOR c_nuc_numb IS
SELECT (SUBSTR(SEOA_DEFAULTVALUE,1,3)),(SUBSTR(SEOA_DEFAULTVALUE,-7))
FROM SERVICE_ORDER_ATTRIBUTES SOA, SERVICE_ORDERS SO
WHERE SOA.SEOA_SERO_ID = SO.SERO_ID
AND SOA.SEOA_NAME = 'REGISTRATION ID'
AND SO.SERO_ID = p_sero_id;


CURSOR c_num_id IS
SELECT NUMB_ID
FROM NUMBERS
WHERE NUMB_NUMBER = p_num_number
AND NUMB_NUCC_CODE = p_nuc_code;


CURSOR c_mans_name IS
SELECT NIDE_VALUE
FROM NUMBER_INSTANCE_DETAILS
WHERE NIDE_NUMB_ID = p_num_id
AND NIDE_NAME = 'MANS_NAME';

      
BEGIN
   
      OPEN c_nuc_numb;       
      FETCH c_nuc_numb INTO p_nuc_code,p_num_number;
      CLOSE c_nuc_numb;   
      
      OPEN c_num_id;
      FETCH c_num_id    INTO p_num_id;
      CLOSE c_num_id;

      OPEN c_mans_name;       
      FETCH c_mans_name INTO p_mans_name;
      CLOSE c_mans_name;   
      
      
               update service_order_attributes soa
               set soa.SEOA_DEFAULTVALUE = p_mans_name
               where soa.SEOA_NAME = 'MANS_NAME'
               and soa.SEOA_SERO_ID = p_sero_id;      

    
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 


EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update MANS_NAME attribute.'  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_MANS_NAME_UPDATE;
---- 06-01-2015 Dinesh Perera ----

-- 06-01-2015 Samankula Owitipana
---- 12-02-2015 Updated Dinesh ----
PROCEDURE FTTH_CLOSE_WAIT_FOR_FAB (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

IN_PARENT_SERV      SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
V_CRM_ORDER_ID      VARCHAR2(100);       

CURSOR FETCH_SERO_ID ( IN_OEID_FP VARCHAR2 ) IS
SELECT
SERO_ID
FROM
SERVICE_ORDERS
WHERE
SERO_OEID LIKE IN_OEID_FP||'-%'
AND SERO_SERT_ABBREVIATION != 'AB-FTTH';

CURSOR FETCH_TASK_ID (IN_SERO_ID VARCHAR2 ) IS
SELECT 
SEIT_ID, 
SEIT_SERO_ID,
SEIT_TASKNAME,
SEIT_STAS_ABBREVIATION 
FROM 
SERVICE_IMPLEMENTATION_TASKS 
WHERE 
SEIT_SERO_ID = IN_SERO_ID;

BEGIN

SELECT SUBSTR(SO.SERO_OEID,1,INSTR(SO.SERO_OEID,'-')-1)
INTO V_CRM_ORDER_ID
FROM SERVICE_ORDERS SO
WHERE SO.SERO_ID = IN_PARENT_SERV;

FOR GET_SO IN FETCH_SERO_ID (V_CRM_ORDER_ID) LOOP 

    FOR GET_TASK IN FETCH_TASK_ID (GET_SO.SERO_ID) LOOP
    IF ( GET_TASK.SEIT_TASKNAME = 'WAIT FOR FAB' AND GET_TASK.SEIT_STAS_ABBREVIATION = 'INPROGRESS') THEN
    p_implementation_tasks.update_task_status_byid(GET_TASK.SEIT_SERO_ID,0,GET_TASK.SEIT_ID,'COMPLETED');
    END IF;
    END LOOP;

END LOOP;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 


EXCEPTION
WHEN OTHERS THEN

 
p_ret_msg  := 'Failed to complete external task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_CLOSE_WAIT_FOR_FAB;
-- 06-01-2015 Samankula Owitipana
---- 12-02-2015 Updated Dinesh ----

---Dilupa Alahakoon 2014/12/11
PROCEDURE D_WIFI_BACK_CREATE (
      p_serv_id        IN      services.serv_id%TYPE,
      p_sero_id        IN      service_orders.sero_id%TYPE,
      p_seit_id        IN      service_implementation_tasks.seit_id%TYPE,
      p_impt_taskname  IN      implementation_tasks.impt_taskname%TYPE,
      p_woro_id        IN      work_order.woro_id%TYPE,
      p_ret_char       OUT     VARCHAR2,
      p_ret_number     OUT     NUMBER,
      p_ret_msg        OUT     VARCHAR2
   )
   IS
      v_equip_type      VARCHAR2 (100);
      v_eq_loc_name     VARCHAR2 (100);
      v_service_type    VARCHAR2 (100);
      v_oredr_type      VARCHAR2 (100);
      v_vpls_core_netw  VARCHAR2 (100);
      v_rtom_code       VARCHAR2 (100);
      v_sw_code         VARCHAR2 (100);

      CURSOR cur_vpls_core_netw
      IS
         SELECT soa.seoa_defaultvalue
         INTO   v_vpls_core_netw
         FROM   service_order_attributes soa
         WHERE  soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
   BEGIN
      OPEN cur_vpls_core_netw;

      FETCH cur_vpls_core_netw
      INTO  v_vpls_core_netw;

      CLOSE cur_vpls_core_netw;

      SELECT DISTINCT so.sero_sert_abbreviation
      INTO            v_service_type
      FROM            service_orders so
      WHERE           so.sero_id = p_sero_id;

      SELECT DISTINCT so.sero_ordt_type
      INTO            v_oredr_type
      FROM            service_orders so
      WHERE           so.sero_id = p_sero_id;

      IF v_vpls_core_netw IS NOT NULL THEN
         IF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'CEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'IPNET-PROV'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
         ELSIF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'MEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'DS-MEN'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
         ELSE
            DELETE      service_implementation_tasks sit
            WHERE       sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
         END IF;

         IF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'CEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'IPNET-PROV'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
         ELSIF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'MEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'DS-MEN'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
         ELSE
            DELETE      service_implementation_tasks sit
            WHERE       sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
         END IF;

         IF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'CEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'IPNET-PROV'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
         ELSIF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' AND v_vpls_core_netw = 'MEN' THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = 'DS-MEN'
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
         ELSE
            DELETE      service_implementation_tasks sit
            WHERE       sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
         END IF;
      END IF;

      p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');
   EXCEPTION
      WHEN OTHERS THEN
         p_ret_msg :=
             'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:' || ' - Erro is:' || TO_CHAR (SQLCODE) || '-'
             || SQLERRM;
         p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

         INSERT INTO service_task_comments
                     (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
                     )
         VALUES      (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE, p_ret_msg
                     );
   END D_WIFI_BACK_CREATE;

---Dilupa Alahakoon 2014/12/11

---Dilupa Alahakoon 2014/12/12
PROCEDURE D_WIFI_BACK_XCON (
      p_serv_id        IN      services.serv_id%TYPE,
      p_sero_id        IN      service_orders.sero_id%TYPE,
      p_seit_id        IN      service_implementation_tasks.seit_id%TYPE,
      p_impt_taskname  IN      implementation_tasks.impt_taskname%TYPE,
      p_woro_id        IN      work_order.woro_id%TYPE,
      p_ret_char       OUT     VARCHAR2,
      p_ret_number     OUT     NUMBER,
      p_ret_msg        OUT     VARCHAR2
   )
   IS
      v_equip_type          VARCHAR2 (100);
      v_eq_loc_name         VARCHAR2 (100);
      v_service_type        VARCHAR2 (100);
      v_oredr_type          VARCHAR2 (100);
      v_rtom_code           VARCHAR2 (100);
      v_access_medium       VARCHAR2 (100);
      v_parallel_service    VARCHAR2 (100);
      v_main_node           VARCHAR2 (100);
      v_sub_node            VARCHAR2 (100);
      v_service_order_area  VARCHAR2 (100);
      v_lea_code            VARCHAR2 (100);
      v_location            VARCHAR2 (100);
      v_work_group          VARCHAR2 (100);
      v_work_group_mdf      VARCHAR2 (100);

      CURSOR cur_equi_type
      IS
         SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
         FROM            service_orders so, ports p, equipment e
         WHERE           so.sero_cirt_name = p.port_cirt_name
         AND             (   e.equp_equt_abbreviation LIKE 'MSAN%'
                          OR e.equp_equt_abbreviation LIKE 'DSLAM%'
                          OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
                          OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%'
                         )
         AND             p.port_equp_id = e.equp_id
         AND             so.sero_id = p_sero_id;
   BEGIN
      OPEN cur_equi_type;

      FETCH cur_equi_type
      INTO  v_equip_type, v_eq_loc_name;

      CLOSE cur_equi_type;

      SELECT DISTINCT so.sero_sert_abbreviation
      INTO            v_service_type
      FROM            service_orders so
      WHERE           so.sero_id = p_sero_id;

      SELECT DISTINCT so.sero_ordt_type
      INTO            v_oredr_type
      FROM            service_orders so
      WHERE           so.sero_id = p_sero_id;

      SELECT soa.seoa_defaultvalue
      INTO   v_access_medium
      FROM   service_order_attributes soa
      WHERE  soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

      SELECT DISTINCT so.sero_area_code
      INTO            v_service_order_area
      FROM            service_orders so
      WHERE           so.sero_id = p_sero_id;

      SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes_a, ar.area_code
      INTO   v_rtom_code, v_lea_code
      FROM   areas ar
      WHERE  ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

      SELECT wg.worg_name
      INTO   v_work_group
      FROM   work_groups wg
      WHERE  worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

      SELECT wg.worg_name
      INTO   v_work_group_mdf
      FROM   work_groups wg
      WHERE  worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';

      SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1) AS node
      INTO   v_location
      FROM   DUAL;

      SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1)) AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1))
                                                                                                                                                    AS sub_node
      INTO   v_main_node, v_sub_node
      FROM   DUAL;

      IF v_main_node IS NOT NULL THEN
         IF     v_service_type = 'D-WI-FI BACKHAULING'
            AND v_oredr_type = 'CREATE'
            AND v_access_medium = 'COPPER'
            AND v_main_node <> v_sub_node
            AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
         ELSIF     v_service_type = 'D-WI-FI BACKHAULING'
               AND v_oredr_type = 'CREATE'
               AND v_access_medium = 'COPPER'
               AND v_parallel_service = 'NONE'
               AND v_main_node = v_sub_node
               AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
            WHERE  sit.seit_taskname = 'MAKE MDF X CONNECT';
         ELSIF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' THEN
            DELETE      service_implementation_tasks sit
            WHERE       sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
         END IF;
      END IF;

      IF v_main_node IS NULL THEN
         IF     v_service_type = 'D-WI-FI BACKHAULING'
            AND v_oredr_type = 'CREATE'
            AND v_access_medium = 'COPPER'
            AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') THEN
            UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
            WHERE  sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
         ELSIF v_service_type = 'D-WI-FI BACKHAULING' AND v_oredr_type = 'CREATE' THEN
            DELETE      service_implementation_tasks sit
            WHERE       sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
         END IF;
      END IF;

      p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');
   EXCEPTION
      WHEN OTHERS THEN
         p_ret_msg :=
             'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:' || ' - Erro is:' || TO_CHAR (SQLCODE) || '-'
             || SQLERRM;
         p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

         INSERT INTO service_task_comments
                     (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
                     )
         VALUES      (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE, p_ret_msg
                     );
   END D_WIFI_BACK_XCON;

---Dilupa Alahakoon 2014/12/12

---Dilupa Alahakoon  2014/12/26
   PROCEDURE D_WIFI_BK_SPED_TO_UPNDOW_SPED (
      p_serv_id        IN      services.serv_id%TYPE,
      p_sero_id        IN      service_orders.sero_id%TYPE,
      p_seit_id        IN      service_implementation_tasks.seit_id%TYPE,
      p_impt_taskname  IN      implementation_tasks.impt_taskname%TYPE,
      p_woro_id        IN      work_order.woro_id%TYPE,
      p_ret_char       OUT     VARCHAR2,
      p_ret_number     OUT     NUMBER,
      p_ret_msg        OUT     VARCHAR2
   )
   IS
      v_serv_speed  service_order_attributes.seoa_defaultvalue%TYPE;
      v_uplink      VARCHAR (100);
      v_downlink    VARCHAR (100);

      CURSOR cur_srv_speed
      IS
         SELECT soa.seoa_defaultvalue, SUBSTR (soa.seoa_defaultvalue, 1, INSTR (soa.seoa_defaultvalue, '/', 1, 1) - 1) || 'BPS'
              , UPPER (SUBSTR (soa.seoa_defaultvalue, INSTR (soa.seoa_defaultvalue, '/', 1, 1) + 1) || 'BPS')
         INTO   v_serv_speed, v_downlink
              , v_uplink
         FROM   service_order_attributes soa
         WHERE  soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE_SPEED';
   BEGIN
      OPEN cur_srv_speed;

      FETCH cur_srv_speed
      INTO  v_serv_speed, v_downlink, v_uplink;

      CLOSE cur_srv_speed;

      IF v_serv_speed IS NOT NULL THEN
         UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_uplink
         WHERE  soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'UPLINK SPEED';
      END IF;

      IF v_serv_speed IS NOT NULL THEN
         UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_downlink
         WHERE  soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DOWNLINK SPEED';
      END IF;

      p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');
   EXCEPTION
      WHEN OTHERS THEN
         p_ret_msg := 'Failed to update speed attributes:' || ' - Erro is:' || TO_CHAR (SQLCODE) || '-' || SQLERRM;
         p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

         INSERT INTO service_task_comments
                     (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
                     )
         VALUES      (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE, p_ret_msg
                     );
   END D_WIFI_BK_SPED_TO_UPNDOW_SPED;

---Dilupa Alahakoon  2014/12/26

--- Dinesh Perera 2015/01/08 ----
PROCEDURE VDSL_TASK_CON_FUNCTION(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_pkg_val VARCHAR2(100);
v_cpe_val VARCHAR2(100);
v_cpe_pre_val VARCHAR2(100);

BEGIN    
select soa.SEOA_DEFAULTVALUE
into  v_pkg_val
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'SA_PACKAGE_NAME';

select soa.SEOA_DEFAULTVALUE
into  v_cpe_val
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'ADSL_CPE_TYPE';

select soa.SEOA_PREV_VALUE
into  v_cpe_pre_val
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'ADSL_CPE_TYPE';

IF v_pkg_val LIKE 'VDSL%' AND v_cpe_val LIKE 'VDSL%' AND v_cpe_pre_val NOT LIKE 'VDSL%' THEN
p_ret_msg := '';
ELSE
p_ret_msg := 'FALSE';
END IF;         
EXCEPTION
WHEN NO_DATA_FOUND THEN
   p_ret_msg := 'FALSE';   
WHEN OTHERS THEN
   p_ret_msg := ''; 
END VDSL_TASK_CON_FUNCTION;
--- Dinesh Perera 2015/01/08 ----

---- Dulip Fernando 2015-02-13
PROCEDURE  FAULT_ATT_UPDATE(
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_CAUSE_OF_FAULT varchar2(100);
v_FAULT_IN       varchar2(100);
v_PROM_NUMBER    varchar2(100);  


begin

SELECT SUBSTR(SERO_OEID,3) INTO v_PROM_NUMBER
FROM SERVICE_ORDERS
WHERE SERO_ID=p_sero_id;

SELECT PROM_PCAT_NAME INTO v_CAUSE_OF_FAULT
FROM PROBLEMS
WHERE PROM_NUMBER=v_PROM_NUMBER;

SELECT PROM_PRSC_NAME INTO v_FAULT_IN
FROM PROBLEMS
WHERE PROM_NUMBER=v_PROM_NUMBER;

        UPDATE service_order_attributes soa
        SET SOA.SEOA_DEFAULTVALUE = v_CAUSE_OF_FAULT
        where soa.seoa_name = 'CAUSE OF FAULT' and  soa.seoa_sero_id = p_sero_id;
        
        UPDATE service_order_attributes soa
        SET SOA.SEOA_DEFAULTVALUE = v_FAULT_IN
        where soa.seoa_name = 'FAULT IN' and  soa.seoa_sero_id = p_sero_id;

p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');


EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to update FAULT_ATT_UPDATE Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );

END FAULT_ATT_UPDATE;
---- Dulip Fernando 2015-02-13

--- Jayan Liyanage  2014 /09/ 09
    
PROCEDURE NBN_D_BTL_CREATE_UPGR_1 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type    varchar2(100);
v_service_type   varchar2(100);
v_service_order  varchar2(100);
v_area_code      varchar2(100);
v_work_group_nw  varchar2(100);
acc_medi    varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';


select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;

select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'ENG';


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND  acc_medi = 'P2P RADIO' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND  v_acc_li_type  = 'DEDICATED LINE' 
AND acc_medi = 'FIBER' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE ACCESS FIBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE ACCESS FIBER'; END IF; 


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create-Upgrade 1 SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_UPGR_1;
    
--- Jayan Liyanage  2014 /09/ 09

--- Jayan Liyanage  2014 /09/ 09
PROCEDURE NBN_D_BTL_CREATE_UPGR_2 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type    varchar2(100);
v_service_type   varchar2(100);
v_service_order  varchar2(100);
v_area_code      varchar2(100);
v_work_group_nw  varchar2(100);
v_no_pstn        varchar2(100);
acc_nw_intr_a    varchar2(100);
acc_medi        varchar2(100);
acc_fib_a   varchar2(100);
v_exc  varchar2(100);

begin  
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';
SELECT soa.seoa_defaultvalue INTO v_exc  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SW CODE';

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;
select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'ENG';

IF    v_service_type = 'D-BTL'AND v_service_order ='CREATE-UPGRADE'  AND  v_acc_li_type  = 'DEDICATED LINE' 
  AND acc_medi = 'FIBER' and
  (acc_fib_a = 'NO' or acc_fib_a = 'INCOMPLETE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PLAN-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'START FIBER LAYING'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND (acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MSAN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MSAN PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a = 'MLLN PORT' 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MLLN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MLLN PORT'; END IF;  


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create-Upgrade  SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END NBN_D_BTL_CREATE_UPGR_2;
--- Jayan Liyanage  2014 /09/ 09

--- Jayan Liyanage  2014 /08/ 07
PROCEDURE NBN_D_BTL_CREATE_UPGRADE_3 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type          varchar2(100);
v_service_order         varchar2(100);
v_acc_li_type         varchar2(100);
acc_medi             varchar2(100);
acc_fib_a              varchar2(100);
acc_nw_intr_a           varchar2(100);
Trans_nw             varchar2(100);
acc_bearer_a_sta        varchar2(100);
ag_netw                 varchar2(100);
v_service_order_area  varchar2(100);
v_rtom_code         varchar2(100);
v_lea_code           varchar2(100);
v_work_group_os       varchar2(100);
v_work_group_nw       varchar2(100);
v_work_group_cpe      varchar2(100);
v_new_num_level       varchar2(100);
v_no_pstn             varchar2(100);
v_sec_handle            varchar2(100);
Ser_cteg                varchar2(100);
v_exc                   varchar2(100);
v_area_code             varchar2(100);
v_Ope_region            varchar2(100);



BEGIN 
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO ag_netw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_exc  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SW CODE';

SELECT soa.seoa_defaultvalue INTO v_Ope_region  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'OPERATIONAL REGION';
/*
SELECT soa.seoa_defaultvalue INTO Trans_nw_a
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'TRANS. NETWORK-A END';*/

SELECT soa.seoa_defaultvalue INTO acc_bearer_a_sta FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue INTO v_new_num_level FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NEW NUMBER LEVEL (Y/N)?';
SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO v_service_order_area FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';


SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name INTO v_work_group_os FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';                  

SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';



/*select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;
select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'ENG';
select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_work_group_os
 and aw.arwg_grouptype = 'OSP';*/

SELECT soa.seoa_defaultvalue INTO v_sec_handle
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO Ser_cteg FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a = 'SDH PORT' --OR ag_netw = 'SDH') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PORTS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS'; END IF;  

-- Start Modified Jayan Liyanage 2014 / 12 / 02 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND ag_netw = 'SDH' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PATH'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH'; END IF;  -- End;


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a = 'MEN PORT'  
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MEN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MEN PORT'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a <> 'MEN PORT'  
  AND ag_netw = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a <> 'CEN PORT'  
  AND ag_netw = 'CEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND (acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND acc_nw_intr_a = 'OLT PORT'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE OLT PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE OLT PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE' AND(acc_nw_intr_a ='SDH PORT' OR  ag_netw = 'SDH')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE TX LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND   acc_medi = 'FIBER' and
  (acc_fib_a = 'NO' or acc_fib_a = 'INCOMPLETE') and v_Ope_region = 'METRO' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLES'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER'; 
ELSIF v_service_type = 'D-BTL' AND v_service_order = 'CREATE-UPGRADE' AND acc_medi = 'FIBER' and
(acc_fib_a = 'NO' OR acc_fib_a = 'INCOMPLETE') AND v_Ope_region = 'REGION' THEN
Update service_implementation_tasks sit
set sit.seit_worg_name = v_work_group_nw
where sit.seit_taskname = 'WAIT FOR FIBER' and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND   acc_medi = 'P2P RADIO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INST. SLT-END NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INST. SLT-END NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND   acc_medi = 'P2P RADIO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND   acc_medi = 'COPPER'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND   acc_medi = 'FTTH' AND acc_bearer_a_sta = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONSTRUCT FTTH LINK'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND  (acc_medi = 'FIBER' OR acc_medi = 'COPPER-UTP')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; END IF;

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-UPGRADE'  AND  v_acc_li_type  = 'DAB' AND acc_bearer_a_sta = 'COMMISSIONED'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CSU'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF; 

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create-Upgrade SOD function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_UPGRADE_3;
--- Jayan Liyanage  2014 /08/ 07

----Dinesh Perera  2015/02/25  -----
PROCEDURE ONT_SERIAL_NUMBER_CHECK (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS



v_serial_1  varchar2(100);
v_serial_2  varchar2(100);


BEGIN

p_ret_msg := '';

select soa.SEOA_DEFAULTVALUE
into  v_serial_1
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'ONT SERIAL NUMBER';           

select soa.SEOA_DEFAULTVALUE
into  v_serial_2
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'ONT SERIAL NUMBER-1';

IF(v_serial_1<>v_serial_2) THEN
    p_ret_msg := 'ONT SERIAL NUMBER DOES NOT MATCH. PLEASE RE-ENTER : ';
    
ELSE
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
      
END IF;

EXCEPTION
WHEN OTHERS THEN


      p_ret_msg  := 'Failed to Check ONT Serial Number:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );
        

END ONT_SERIAL_NUMBER_CHECK;
----Dinesh Perera  2015/02/25  -----

----Dinesh Perera  2015/03/02  -----
---- Dinesh Perera 03-11-2015 updated ----
PROCEDURE FTTH_HOLD_CHILD_FOR_PARENT (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

      
CHLD_SERO SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
COMMON_OEID SERVICE_ORDERS.SERO_OEID%TYPE;
PARENT_SERO_ID SERVICE_ORDERS.SERO_ID%TYPE;
PARENT_TASK_STAT SERVICE_ORDERS.SERO_STAS_ABBREVIATION%TYPE; 
PARENT_SO_TYPE SERVICE_ORDERS.SERO_ORDT_TYPE%TYPE;   
      

BEGIN

SELECT SUBSTR(SERO_OEID,1,9) INTO COMMON_OEID FROM SERVICE_ORDERS WHERE SERO_ID = CHLD_SERO;

SELECT SERO_ID INTO PARENT_SERO_ID FROM SERVICE_ORDERS WHERE SERO_OEID LIKE COMMON_OEID||'%' AND SERO_SERT_ABBREVIATION = 'AB-FTTH';

SELECT SERO_ORDT_TYPE INTO PARENT_SO_TYPE FROM SERVICE_ORDERS WHERE SERO_ID =  PARENT_SERO_ID;

IF PARENT_SO_TYPE = 'CREATE' AND PARENT_SERO_ID IS NOT NULL THEN 

    SELECT SEIT_STAS_ABBREVIATION INTO PARENT_TASK_STAT FROM SERVICE_IMPLEMENTATION_TASKS WHERE SEIT_SERO_ID =  PARENT_SERO_ID AND SEIT_TASKNAME = 'WAIT FOR FAB';

    IF PARENT_TASK_STAT = 'INPROGRESS' THEN 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

    ELSIF PARENT_TASK_STAT = 'ASSIGNED' THEN 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'INPROGRESS');

    END IF;            
      
ELSIF PARENT_SERO_ID IS NULL THEN

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

END IF;

EXCEPTION
WHEN OTHERS THEN
 
-----p_ret_msg  := 'No Bearer in this OR. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');    
     
END FTTH_HOLD_CHILD_FOR_PARENT ;
----Dinesh Perera  2015/03/02  -----

----Dinesh Perera  2015/03/02  -----
PROCEDURE FTTH_CLOSE_INPROG_CHILD (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

  
CURSOR GET_DEPNDET_CHID_STAT (IN_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
SELECT SEIT_SERO_ID, SEIT_STAS_ABBREVIATION 
FROM SERVICE_IMPLEMENTATION_TASKS 
WHERE SEIT_TASKNAME = 'WAIT FOR FAB'
AND SEIT_SERO_ID IN 
(SELECT SERO_ID FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE IN_OEID||'%' AND SERO_SERT_ABBREVIATION <> 'AB-FTTH');

CURSOR GET_CHILD_TASK_ID ( IN_CHILD_SO SERVICE_ORDERS.SERO_ID%TYPE ) IS
SELECT  SEIT_ID,SEIT_SERO_ID 
FROM SERVICE_IMPLEMENTATION_TASKS 
WHERE SEIT_SERO_ID = IN_CHILD_SO  AND SEIT_TASKNAME = 'WAIT FOR FAB' AND SEIT_STAS_ABBREVIATION = 'INPROGRESS' ;

PARENT_SERO_ID SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
COMMON_OEID SERVICE_ORDERS.SERO_OEID%TYPE;
GET_DEPNDET_CHID_STAT_R GET_DEPNDET_CHID_STAT%ROWTYPE;
GET_CHILD_TASK_ID_R GET_CHILD_TASK_ID%ROWTYPE;

BEGIN

SELECT SUBSTR(SERO_OEID,1,9) INTO COMMON_OEID  FROM SERVICE_ORDERS WHERE SERO_ID = PARENT_SERO_ID;

OPEN GET_DEPNDET_CHID_STAT (COMMON_OEID);
LOOP
FETCH GET_DEPNDET_CHID_STAT INTO GET_DEPNDET_CHID_STAT_R;
EXIT WHEN GET_DEPNDET_CHID_STAT%NOTFOUND;
IF GET_DEPNDET_CHID_STAT_R.SEIT_STAS_ABBREVIATION = 'INPROGRESS' THEN
OPEN GET_CHILD_TASK_ID (GET_DEPNDET_CHID_STAT_R.SEIT_SERO_ID);
FETCH GET_CHILD_TASK_ID INTO GET_CHILD_TASK_ID_R;
p_implementation_tasks.update_task_status_byid(GET_CHILD_TASK_ID_R.SEIT_SERO_ID,0, GET_CHILD_TASK_ID_R.SEIT_ID,'COMPLETED'); 
CLOSE GET_CHILD_TASK_ID;
END IF;
END LOOP;
CLOSE GET_DEPNDET_CHID_STAT; 
      
EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );      
      
END FTTH_CLOSE_INPROG_CHILD;
----Dinesh Perera  2015/03/02  -----

----Dinesh Perera  2015/03/02  -----
PROCEDURE FTTH_CLOSE_PARENT_WAIT_FB (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

CURSOR GET_DEPNDET_CHID_STAT (IN_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
SELECT SERO_ID,SERO_STAS_ABBREVIATION FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE IN_OEID||'%' AND SERO_SERT_ABBREVIATION <> 'AB-FTTH' AND SERO_ID <> p_sero_id ;

CHLD_SERO SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
COMMON_OEID SERVICE_ORDERS.SERO_OEID%TYPE;
GET_DEPNDET_CHID_STAT_R    GET_DEPNDET_CHID_STAT%ROWTYPE;
PARENT_SEIT_STAT SERVICE_IMPLEMENTATION_TASKS.SEIT_STAS_ABBREVIATION%TYPE;
INCOMPLE_TASK_COUNT NUMBER := 0;

PARENT_SERO_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE;
PARENT_SEIT_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE;

PARENT_SO_TYPE SERVICE_ORDERS.SERO_ORDT_TYPE%TYPE;

BEGIN

SELECT SUBSTR(SERO_OEID,1,9) INTO COMMON_OEID FROM SERVICE_ORDERS WHERE SERO_ID = CHLD_SERO;

SELECT SERO_ORDT_TYPE INTO PARENT_SO_TYPE FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE COMMON_OEID||'%' AND SERO_SERT_ABBREVIATION = 'AB-FTTH';

IF PARENT_SO_TYPE = 'CREATE' THEN

OPEN GET_DEPNDET_CHID_STAT (COMMON_OEID);
LOOP
FETCH GET_DEPNDET_CHID_STAT INTO GET_DEPNDET_CHID_STAT_R;
EXIT WHEN GET_DEPNDET_CHID_STAT%NOTFOUND;

SELECT SEIT_STAS_ABBREVIATION INTO PARENT_SEIT_STAT 
FROM SERVICE_IMPLEMENTATION_TASKS 
WHERE SEIT_SERO_ID = GET_DEPNDET_CHID_STAT_R.SERO_ID
AND SEIT_TASKNAME = 'WAIT FOR FAB';

IF PARENT_SEIT_STAT <> 'COMPLETED' THEN 
INCOMPLE_TASK_COUNT := INCOMPLE_TASK_COUNT + 1 ;
END IF;

END LOOP;
CLOSE GET_DEPNDET_CHID_STAT; 

IF INCOMPLE_TASK_COUNT = 0 THEN 
SELECT SEIT_SERO_ID,SEIT_ID INTO PARENT_SERO_ID,PARENT_SEIT_ID FROM SERVICE_IMPLEMENTATION_TASKS WHERE SEIT_SERO_ID = 
(SELECT SERO_ID  FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE COMMON_OEID||'%' AND SERO_SERT_ABBREVIATION = 'AB-FTTH')
AND SEIT_TASKNAME = 'WAIT FOR FAB';
p_implementation_tasks.update_task_status_byid(PARENT_SERO_ID,0,PARENT_SEIT_ID,'COMPLETED'); 
END IF;

p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'COMPLETED'); 

ELSE 

p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'COMPLETED'); 

END IF;

EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_CLOSE_PARENT_WAIT_FB ;
----Dinesh Perera  2015/03/02  -----

---- Dinesh Perera 11/03/2015 ----
PROCEDURE CHANGE_VOICE_FEATURES_TO_N (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_feature_val_1       varchar2(100);
v_feature_val_2       varchar2(100);
v_feature_val_3       varchar2(100);

BEGIN 

SELECT SOF.SOFE_DEFAULTVALUE
INTO v_feature_val_1
FROM SERVICE_ORDER_FEATURES SOF
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_SELECTIVE_CALL_ACCEPTANCE';

SELECT SOF.SOFE_DEFAULTVALUE
INTO v_feature_val_2
FROM SERVICE_ORDER_FEATURES SOF
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_SECRETARY_SERVICE';

SELECT SOF.SOFE_DEFAULTVALUE
INTO v_feature_val_3
FROM SERVICE_ORDER_FEATURES SOF
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_ABSENTEE_SERVICE';

IF v_feature_val_1 = 'Y' THEN

UPDATE SERVICE_ORDER_FEATURES SOF
SET SOF.SOFE_DEFAULTVALUE = 'N'
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_SELECTIVE_CALL_ACCEPTANCE';

END IF;

IF v_feature_val_2 = 'Y' THEN

UPDATE SERVICE_ORDER_FEATURES SOF
SET SOF.SOFE_DEFAULTVALUE = 'N'
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_SECRETARY_SERVICE';

END IF;

IF v_feature_val_3 = 'Y' THEN

UPDATE SERVICE_ORDER_FEATURES SOF
SET SOF.SOFE_DEFAULTVALUE = 'N'
WHERE SOF.SOFE_SERO_ID = p_sero_id
AND SOF.SOFE_FEATURE_NAME = 'SF_ABSENTEE_SERVICE';

END IF;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 


EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update features. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END CHANGE_VOICE_FEATURES_TO_N;
---- Dinesh Perera 11/03/2015 ----

--- Jayan Liyanage 2015/03/10
PROCEDURE INF_SEQ_ID_SET(
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_Seq_Id   VARCHAR2 (100);
BEGIN

   select trim(substr('00000'||clarity.INF_TOWER_CIR_SEQ.nextval,-6))
   INTO v_Seq_Id from dual;
   UPDATE service_order_attributes soa
   SET soa.seoa_defaultvalue = v_Seq_Id
   WHERE soa.seoa_name = 'INF_SEQ_ID' AND soa.seoa_sero_id = p_sero_id;
    
 

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Inf Seq attribute. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END INF_SEQ_ID_SET;

--- Jayan Liyanage 2015/03/10

-- Jayan Liyanage  2014 / 11 / 10

PROCEDURE D_EDL_CREATE_TRANSF (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)

IS

v_service_type                varchar2(100);
v_service_order               varchar2(100);
v_agg_nw_a                    varchar2(100);
v_agg_nw_b                    varchar2(100);
v_ac_nw_inter_a               varchar2(100);
v_ac_nw_inter_b               varchar2(100);
v_acc_bearer_st_a             varchar2(100);
v_acc_bearer_st_b             varchar2(100);
v_mig_end                     varchar2(100);
v_acc_med_a                   varchar2(100);
v_acc_med_b                   varchar2(100);
v_service_order_area_a        varchar2(100);
v_rtom_code_aa                varchar2(100);
v_lea_code_aa                 varchar2(100);
v_work_group_a_os             varchar2(100);
v_service_order_area_b        varchar2(100);
v_work_group_a_nw             varchar2(100);
v_rtom_code_bb                varchar2(100);
v_lea_code_bb                 varchar2(100);
v_work_group_b_os             varchar2(100);
v_work_group_b_nw             varchar2(100);
v_cpe_cls_a                   varchar2(100);
v_cpe_cls_b                   varchar2(100);
v_cpe_chg_a                   varchar2(100);
v_cpe_chg_b                   varchar2(100); 
v_sec_handle                  varchar2(100);    
v_mig_type_a                  varchar2(100);     
v_mig_type_b                  varchar2(100);                                       
v_acc_link_ty_a               varchar2(100);        
v_acc_link_ty_b               varchar2(100);   
v_model_chnB                  varchar2(100);  
v_model_chnA                  varchar2(100);  

BEGIN

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so
WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so 
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_agg_nw_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGG. NETWORK-A END';
SELECT soa.seoa_defaultvalue INTO v_agg_nw_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGG. NETWORK-B END';

SELECT soa.seoa_defaultvalue INTO v_ac_nw_inter_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-A END';
SELECT soa.seoa_defaultvalue INTO v_ac_nw_inter_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-B END';

SELECT soa.seoa_defaultvalue INTO v_acc_bearer_st_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. BEARER STATUS-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_bearer_st_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. BEARER STATUS-B END';

SELECT soa.seoa_defaultvalue INTO v_mig_end FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATED END';
SELECT soa.seoa_defaultvalue INTO v_acc_med_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_med_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-B END';
SELECT soa.seoa_defaultvalue INTO v_mig_end FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATED END';
SELECT soa.seoa_defaultvalue INTO v_cpe_cls_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-A END';
SELECT soa.seoa_defaultvalue INTO v_cpe_cls_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-B END';
SELECT soa.seoa_defaultvalue INTO v_cpe_chg_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-A END';
SELECT soa.seoa_defaultvalue INTO v_cpe_chg_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-B END';
SELECT soa.seoa_defaultvalue INTO v_sec_handle FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue INTO v_model_chnB FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?-B END';
SELECT soa.seoa_defaultvalue INTO v_model_chnA FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?-A END';

SELECT soa.seoa_defaultvalue INTO v_mig_type_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-A END';
SELECT soa.seoa_defaultvalue INTO v_mig_type_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-B END';

SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END';


SELECT soa.seoa_defaultvalue INTO v_service_order_area_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE AREA CODE-A END';
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_aa,v_lea_code_aa FROM areas ar WHERE ar.area_code = v_service_order_area_a AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_a_os FROM work_groups wg 
WHERE worg_name = v_rtom_code_aa || '-' || v_lea_code_aa || '-OSP-NC';                  
SELECT wg.worg_name INTO v_work_group_a_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code_aa || '-' || 'ENG-NW';

SELECT soa.seoa_defaultvalue INTO v_service_order_area_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_bb,v_lea_code_bb FROM areas ar WHERE ar.area_code = v_service_order_area_b AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_b_os FROM work_groups wg 
WHERE worg_name = v_rtom_code_bb || '-' || v_lea_code_bb || '-OSP-NC';                  
SELECT wg.worg_name INTO v_work_group_b_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code_bb || '-' || 'ENG-NW';


IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_agg_nw_a = 'MEN' AND v_ac_nw_inter_a <> 'MEN PORT' )  OR 
( v_agg_nw_b = 'MEN' AND v_ac_nw_inter_b <> 'MEN PORT' )THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_agg_nw_a = 'CEN' AND v_ac_nw_inter_a <> 'CEN PORT' )  OR 
( v_agg_nw_b = 'CEN' AND v_ac_nw_inter_b <> 'CEN PORT' )THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_a = 'MSAN PORT' OR  v_ac_nw_inter_a = 'DSLAM PORT' ) AND v_acc_bearer_st_a = 'COMMISSIONED'
AND ( v_mig_end = 'A END' OR v_mig_end = 'BOTH ENDS') THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_b = 'MSAN PORT' OR  v_ac_nw_inter_b = 'DSLAM PORT' ) AND v_acc_bearer_st_b = 'COMMISSIONED'
AND ( v_mig_end = 'A END' OR v_mig_end = 'BOTH ENDS') THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_a = 'MSAN PORT' OR  v_ac_nw_inter_a = 'DSLAM PORT' ) AND v_acc_bearer_st_a = 'INSERVICE'
AND ( v_mig_end = 'A END' OR v_mig_end = 'BOTH ENDS') THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. TRIB. PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. TRIB. PORT-A'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_b = 'MSAN PORT' OR  v_ac_nw_inter_b = 'DSLAM PORT' ) AND v_acc_bearer_st_b = 'INSERVICE'
AND ( v_mig_end = 'A END' OR v_mig_end = 'BOTH ENDS') THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. TRIB. PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. TRIB. PORT-B'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_med_a = 'COPPER' AND  v_acc_bearer_st_a = 'COMMISSIONED' AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'TEST AGG.LINK- A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGG.LINK- A END'; END IF;


/*IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_med_a = 'COPPER' AND  v_acc_bearer_st_a = 'COMMISSIONED' AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'TEST AGG.LINK- A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGG.LINK- A END'; END IF;*/

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_med_b = 'COPPER' AND  v_acc_bearer_st_b = 'COMMISSIONED' AND ( v_mig_end  = 'B END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'TEST AGG.LINK- B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGG.LINK- B END'; END IF;


IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  (v_acc_med_a = 'FIBER' OR v_acc_med_a = 'COPER-UTP') AND  v_acc_bearer_st_a = 'COMMISSIONED' 
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTAB. ACC.LINK-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTAB. ACC.LINK-A ND'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  (v_acc_med_b = 'FIBER' OR v_acc_med_b = 'COPER-UTP') AND  v_acc_bearer_st_b = 'COMMISSIONED' 
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTAB. ACC.LINK-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTAB. ACC.LINK-B ND'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_med_a = 'CUSTOMER OWN' AND  v_acc_bearer_st_a = 'COMMISSIONED' 
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'PATCH CUST.LINK-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PATCH CUST.LINK-A ND'; END IF;
IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_med_b = 'CUSTOMER OWN' AND  v_acc_bearer_st_b = 'COMMISSIONED' 
  AND ( v_mig_end  = 'B END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'PATCH CUST.LINK-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PATCH CUST.LINK-B ND'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_cpe_cls_a = 'SLT' AND v_cpe_chg_a = 'NEW'
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
v_cpe_cls_b = 'SLT' AND  v_cpe_chg_b = 'NEW'
  AND ( v_mig_end  = 'B END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE-B END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_cpe_cls_a = 'SLT' AND v_cpe_chg_a = 'YES'
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
v_cpe_cls_b = 'SLT' AND  v_cpe_chg_b = 'YES'
  AND ( v_mig_end  = 'B END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE-B END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_cpe_cls_a = 'SLT' AND v_cpe_chg_a = 'NO'
  AND ( v_mig_end  = 'A END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
v_cpe_cls_b = 'SLT' AND  v_cpe_chg_b = 'NO'
  AND ( v_mig_end  = 'B END' OR v_mig_end  = 'BOTH ENDS')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE-B END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_a = 'MEN PORT' OR  v_ac_nw_inter_b  = 'MEN PORT')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. E2E VLL SERVICE';
ELSIF v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_a = 'CEN PORT' OR  v_ac_nw_inter_b  = 'CEN PORT') THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. E2E VLL SERVICE';
ELSIF v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_a = 'MSAN PORT' OR v_ac_nw_inter_a = 'DSLAM PORT' ) OR (v_ac_nw_inter_b = 'MSAN PORT' OR
v_ac_nw_inter_b = 'DSLAM PORT')  THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. E2E VLL SERVICE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. E2E VLL SERVICE'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
( v_ac_nw_inter_b = 'MSAN PORT' OR  v_ac_nw_inter_b  = 'DSLAM PORT' OR v_ac_nw_inter_b  = 'MLLN PORT')
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
 v_ac_nw_inter_b = 'MEN PORT' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
 v_ac_nw_inter_b = 'CEN PORT' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' THEN
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_sec_handle
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE DEL-TRANSFER SO'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_bearer_st_a = 'COMMISSIONED' THEN     
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT.ACC BEARER-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT.ACC BEARER-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
  v_acc_bearer_st_b = 'COMMISSIONED' THEN     
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT.ACC BEARER-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT.ACC BEARER-A END'; END IF;

IF v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND (v_mig_type_a = 'LEGACY to NGN' or v_mig_type_a = 'LEGACY to NGN') THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-CONDESK'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = '';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = ''; END IF;


IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
((v_ac_nw_inter_b  = 'SDH PORT' AND v_acc_link_ty_b = 'DAB' ) or 
(v_ac_nw_inter_a  = 'SDH PORT' AND v_acc_link_ty_a = 'DAB' ))
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE TX PATH'; END IF;

--- New Modification 2015 / 03 / 11 
IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
v_model_chnA = 'YES' and v_acc_med_a = 'COPPER'
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL NTU-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND
v_model_chnB = 'YES' and v_acc_med_b = 'COPPER'
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL NTU-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU-B END'; END IF;


IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND 
  v_mig_type_a = 'LEGACY TO NGN' or v_mig_type_b = 'LEGACY TO NGN'
THEN     UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-CONDESK'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'PLAN SVC MIGRATION';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PLAN SVC MIGRATION'; END IF;

--- New Modification 2015 / 03 / 11 

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-EDL Create transfer Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_EDL_CREATE_TRANSF;

--- Jayan Liyanage  2014 / 11 / 12

--- Jayan  liyanage 2014 / 11 /18

PROCEDURE D_EDL_CREATE_TRS_ATT_CP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS



CURSOR bearer_c IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS BEARER ID-B END'AND so.sero_id = p_sero_id;
CURSOR bearer_d IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS BEARER ID-A END'AND so.sero_id = p_sero_id;
CURSOR so_copyattr (v_new_bearer_id VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
and soa.seoa_name in (
'ACCESS N/W INTF','CPE CLASS','CPE TYPE','CPE MODEL','CPE CHANGE?','NTU MODEL','NTU TYPE','NTU CLASS','NTU MODEL CHANGE?',
'ADDITIONAL NTU MODEL','NTU ROUTING MODE','ACCESS MEDIUM','NO OF COPPER PAIRS','ACCESS INTF PORT BW','DATA RADIO MODEL'
,'CUSTOMER INTF TYPE','VLAN TAGGED/UNTAGGED ?','MIGRATION TYPE'
)AND so.sero_stas_abbreviation <> 'CANCELLED'
AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id);

CURSOR so_copyattr_c (v_new_bearer_id_b VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
and soa.seoa_name in (
'ACCESS N/W INTF','CPE CLASS','CPE TYPE','CPE MODEL','CPE CHANGE?','NTU MODEL','NTU TYPE','NTU CLASS','NTU MODEL CHANGE?',
'ADDITIONAL NTU MODEL','NTU ROUTING MODE','ACCESS MEDIUM','NO OF COPPER PAIRS','ACCESS INTF PORT BW','DATA RADIO MODEL'
,'CUSTOMER INTF TYPE','VLAN TAGGED/UNTAGGED ?','MIGRATION TYPE'
)
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')AND so.sero_stas_abbreviation <> 'CANCELLED'
AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id_b);

v_so_attr_name     VARCHAR2 (100);
v_so_attr_val      VARCHAR2 (100);
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100);
v_new_bearer_id    VARCHAR2 (100);
v_service_type     VARCHAR2 (100);
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);
v_new_bearer_id_b  VARCHAR2 (100);
v_bearer_id_b      VARCHAR2 (100);
v_so_attr_name_c     VARCHAR2 (100);
v_so_attr_val_c      VARCHAR2 (100);
v_cir_status_c      VARCHAR2 (100);
v_acc_lin_type_A      varchar2(100);
v_acc_lin_type_B     varchar2(100);

BEGIN
  
SELECT DISTINCT soa.seoa_defaultvalue INTO v_acc_lin_type_A  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END'AND so.sero_id = p_sero_id;
SELECT DISTINCT soa.seoa_defaultvalue INTO v_acc_lin_type_B  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END'AND so.sero_id = p_sero_id;
OPEN bearer_c;FETCH bearer_c INTO v_bearer_id;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);LOOP FETCH so_copyattr
INTO v_so_attr_name, v_so_attr_val, v_cir_status; EXIT WHEN so_copyattr%NOTFOUND;

if (v_acc_lin_type_B = 'DAB' ) THEN
IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS N/W INTF-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'CPE CLASS' THEN  UPDATE service_order_attributes soa  
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE TYPE-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-B END';

ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'CPE CHANGE?' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-B END'; -- Attribute has Space

ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE-B END'; 
ELSIF     v_service_type = 'D-EDL' 
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL-B END';
ELSIF     v_service_type = 'D-EDL'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL CHANGE?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?-B END';

ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-B END';

ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NO OF COPPER PAIRS-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE-B END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAG/UNTAG?-B END'; 

ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'MIGRATION TYPE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-B END';  end if; end if; END LOOP; 

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACC. BEARER STATUS-B END';
END IF;
 CLOSE so_copyattr;CLOSE bearer_c;OPEN bearer_d;FETCH bearer_d INTO v_bearer_id_b;OPEN so_copyattr_c (v_bearer_id_b);LOOP FETCH so_copyattr_c
INTO v_so_attr_name_c, v_so_attr_val_c, v_cir_status_c; EXIT WHEN so_copyattr_c%NOTFOUND;

if (v_acc_lin_type_A = 'DAB'  )THEN
IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS N/W INTF-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name_c = 'CPE CLASS' THEN  UPDATE service_order_attributes soa  
SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE TYPE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name_c = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name_c = 'CPE CHANGE?' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-A END'; -- Attribute has Space
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name_c = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE-A END'; 
ELSIF     v_service_type = 'D-EDL' 
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name_c = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL-A END';
ELSIF     v_service_type = 'D-EDL'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'NTU MODEL CHANGE?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-A END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NO OF COPPER PAIRS-A END'; 

ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name_c = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name_c = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAG/UNTAG?-A END'; 

ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name_c = 'MIGRATION TYPE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-A END';

END IF; END IF;

END LOOP; 
IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status_c WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACC. BEARER STATUS-A END'; end if;
CLOSE so_copyattr_c;CLOSE bearer_d;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-EDL Create Tansfer SOD Copy Attribute  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_EDL_CREATE_TRS_ATT_CP;

--- Jayan Liyanage  2014 / 11 / 18

--- Jayan Liyanage 2014 / 11 / 12
PROCEDURE D_EDL_CREATE_TRS_SET_ATT (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_accbear_stsa    varchar2(100);
v_accbear_stsb    varchar2(100);
v_linkTy_a        varchar2(100);
v_linkTy_b        varchar2(100);
v_Migr_end        varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);


begin
  

SELECT distinct soa.seoa_defaultvalue into v_accbear_stsa FROM service_order_attributes soa 
where soa.seoa_name = 'ACC. BEARER STATUS-A END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_accbear_stsb FROM service_order_attributes soa 
where soa.seoa_name = 'ACC. BEARER STATUS-B END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_linkTy_a FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS LINK TYPE-A END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_linkTy_b FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS LINK TYPE-B END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_Migr_end FROM service_order_attributes soa 
where soa.seoa_name = 'MIGRATED END' and soa.seoa_sero_id = p_sero_id;
select so.sero_sert_abbreviation  into v_service_type 
from service_orders so where so.sero_id = p_sero_id;
select so.sero_ordt_type  into v_service_order 
from service_orders so where so.sero_id = p_sero_id;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_accbear_stsa  = 'NEW'
  AND v_linkTy_a = 'DAB' AND (v_Migr_end = 'A END' or v_Migr_end = 'BOTH ENDS') THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID-A END' 
And soa.seoa_sero_id = p_sero_id; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-A ND'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_accbear_stsb  = 'NEW'
  AND v_linkTy_b = 'DAB' AND (v_Migr_end = 'B END' or v_Migr_end = 'BOTH ENDS') THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID-B END' 
And soa.seoa_sero_id = p_sero_id; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-B ND'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_accbear_stsa  = 'NEW'
  AND v_linkTy_a = 'DAB' AND (v_Migr_end = 'A END' or v_Migr_end = 'BOTH ENDS') THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB-A END'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'CREATE-TRANSFER' AND v_accbear_stsb  = 'NEW'
  AND v_linkTy_b = 'DAB' AND (v_Migr_end = 'B END' or v_Migr_end = 'BOTH ENDS') THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB-B END'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB-B END'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION 
  WHEN OTHERS 
    THEN p_ret_msg :=
'Failed to Change D-EDL Create Tansfer Set  Attribute  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_EDL_CREATE_TRS_SET_ATT;

--- Jayan Liyanage  2014 / 11 / 12

--- Jayan Liyanage 2014 / 09 / 10
        
PROCEDURE NBN_D_BTL_CREATE_TRANSF_1 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_li_type    varchar2(100);
v_service_type   varchar2(100);
v_service_order  varchar2(100);
v_area_code      varchar2(100);
v_work_group_nw  varchar2(100);
v_no_pstn        varchar2(100);
acc_nw_intr_a    varchar2(100);
acc_medi        varchar2(100);
acc_fib_a   varchar2(100);
old_service_typ varchar2(100);
begin
  
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';

SELECT soa.seoa_defaultvalue INTO old_service_typ FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'OLD SERVCICE TYPE';

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;

select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'ENG';


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND (old_service_typ = 'DIOD' OR 
  old_service_typ = 'ISDN-PRI') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RELEASE USED NUMBERS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RELEASE USED NUMBERS'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND  to_number(to_char(v_no_pstn)) =1 THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE NUMBER'; 
ELSIF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND to_number(to_char(v_no_pstn)) >1 THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CEN-SWPL'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE NUMBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE NUMBER'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND (acc_nw_intr_a = 'MSAN PORT' 
  OR acc_nw_intr_a = 'DSLAM PORT') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MSAN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MSAN PORT'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a = 'MLLN PORT' 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MLLN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MLLN PORT'; END IF; 


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create - Transfer SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END NBN_D_BTL_CREATE_TRANSF_1;


--- Jayan Liyanage 2014 / 09 / 10

--- Jayan Liyanage  2014 /08/ 07

PROCEDURE NBN_D_BTL_CREATE_TRANSFER_2 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type          varchar2(100);
v_service_order         varchar2(100);
v_acc_li_type         varchar2(100);
acc_medi             varchar2(100);
acc_fib_a              varchar2(100);
acc_nw_intr_a           varchar2(100);
Trans_nw             varchar2(100);
acc_bearer_a_sta        varchar2(100);
ag_netw                 varchar2(100);
v_service_order_area  varchar2(100);
v_rtom_code         varchar2(100);
v_lea_code           varchar2(100);
v_work_group_os       varchar2(100);
v_work_group_nw       varchar2(100);
v_work_group_cpe      varchar2(100);
v_new_num_level       varchar2(100);
v_no_pstn             varchar2(100);
v_sec_handle            varchar2(100);
Ser_cteg                varchar2(100);
v_exc                   varchar2(100);
old_service_typ         varchar2(100);
mig_type                varchar2(100);
ntu_model_chg           varchar2(100);
v_area_code          varchar2(100);

BEGIN 
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO acc_medi FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO acc_fib_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';
SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
/*SELECT soa.seoa_defaultvalue INTO ag_netw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';*/
SELECT soa.seoa_defaultvalue INTO old_service_typ FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'OLD SERVCICE TYPE';
SELECT soa.seoa_defaultvalue INTO mig_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
/*SELECT soa.seoa_defaultvalue INTO ntu_model_chg FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';*/


SELECT soa.seoa_defaultvalue INTO acc_bearer_a_sta FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue INTO v_new_num_level FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NEW NUMBER LEVEL (Y/N)?';
SELECT soa.seoa_defaultvalue INTO v_no_pstn FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
SELECT soa.seoa_defaultvalue INTO v_service_order_area FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';
SELECT soa.seoa_defaultvalue INTO v_exc  FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SW CODE';
/*
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_os FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';                  
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';*/

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;
select distinct aw.arwg_worg_name into v_work_group_nw  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'ENG';
select distinct aw.arwg_worg_name into v_work_group_os  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'OSP';

SELECT soa.seoa_defaultvalue INTO v_sec_handle
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO Ser_cteg FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_handle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM BTL NUMBERS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM BTL NUMBERS'; END IF;  

/*IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND (acc_nw_intr_a = 'SDH PORT' OR ag_netw = 'SDH') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PORTS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS'; END IF;  */

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a = 'MEN PORT'  
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE MEN PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MEN PORT'; END IF;  
/*IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a <> 'MEN PORT'  
  AND ag_netw = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;  */

/*IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a <> 'CEN PORT'  
  AND ag_netw = 'CEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF; */ 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND (acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; END IF;  

/*IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND(acc_nw_intr_a ='SDH PORT' OR  ag_netw = 'SDH')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE TX LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK'; END IF;*/  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   mig_type = 'LEGACY TO NGN'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'TEST AGGREGATE LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'TEST AGGREGATE LINK'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   mig_type = 'LEGACY TO NGN'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'PLAN SVC MIGRATION'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'PLAN SVC MIGRATION'; END IF; 

/*IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'YES'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INSTALL NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INSTALL NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'NO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'NO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MODIFY NTU LABEL'; END IF; */


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND  (v_exc <> 'SH' OR v_exc <> 'SZ') AND
  (old_service_typ <> 'DIDO' OR old_service_typ <> 'ISDN-PRI') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'BSS-IMM-ENG'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'UPDATE MEDIATION'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'UPDATE MEDIATION'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND  v_new_num_level = 'YES'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TRF'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ROUTES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ROUTES'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND  to_number(to_char(v_no_pstn)) >1  and  ( old_service_typ <> 'DIDO' or  old_service_typ = 'ISDN-PRI'  )THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'BSS-OPR-SOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'UPDATE EVENT SOURCES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'UPDATE EVENT SOURCES'; END IF;
 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   to_number(to_char(v_no_pstn)) >1 AND ( old_service_typ = 'DIDO' or  old_service_typ = 'ISDN-PRI') AND
  (old_service_typ <> 'DIDO' OR old_service_typ <> 'ISDN-PRI') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'BSS-OPR-SOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'MOVE EVENT SOURCES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MOVE EVENT SOURCES'; END IF; 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND  v_acc_li_type  = 'DAB' AND acc_bearer_a_sta = 'COMMISSIONED'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CSU'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF; 
IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'   THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_handle||'-FO'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ISSUE DEL-TRANS. SO'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ISSUE DEL-TRANS. SO'; END IF; 


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create Transfer SOD function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_TRANSFER_2;

--- Jayan Liyanage  2014 /08/ 07

--- Jayan Liyanage  2015 /03/ 18
 
PROCEDURE NBN_D_BTL_CREATE_TRANSFER_3 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type    varchar2(100);
v_service_order   varchar2(100);
ntu_model_chg     varchar2(100);
v_area_code       varchar2(100);
v_work_group_os   varchar2(100);
acc_nw_intr_a     varchar2(100);
ag_netw           varchar2(100);
v_acc_li_type    varchar2(100);

Begin
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT soa.seoa_defaultvalue INTO ntu_model_chg FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';

SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue INTO ag_netw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';
SELECT distinct soa.seoa_defaultvalue INTO v_acc_li_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';

select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;
select distinct aw.arwg_worg_name into v_work_group_os  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'OSP';

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'YES'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INSTALL NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INSTALL NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'NO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER'  AND   ntu_model_chg = 'NO'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MODIFY NTU LABEL'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND (acc_nw_intr_a = 'SDH PORT' OR ag_netw = 'SDH') 
  AND v_acc_li_type = 'DEDICATED LINE' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'RESERVE TX PORTS'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS'; END IF;  

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a <> 'MEN PORT'  
  AND ag_netw = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;  


IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND acc_nw_intr_a <> 'CEN PORT'  
  AND ag_netw = 'CEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF; 

IF    v_service_type = 'D-BTL'AND v_service_order = 'CREATE-TRANSFER' AND(acc_nw_intr_a ='SDH PORT' OR  ag_netw = 'SDH')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE TX LINK'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK'; END IF;  



p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Create Transfer SOD function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END NBN_D_BTL_CREATE_TRANSFER_3;

--- Jayan Liyanage  2015 /03/ 18

--- Jayan Liyanage 2015/04/28 issues corrected on 20/01/2016

PROCEDURE INF_ATT_UPDATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )is 


Cir_name          varchar2(100);

BEGIN

select replace(c.cirt_displayname,'(N)') into Cir_name
from service_orders s,circuits c
where s.sero_cirt_name = c.cirt_name
AND (c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
and s.sero_id = p_sero_id;

update service_order_attributes soa set soa.seoa_defaultvalue = Cir_name
 where soa.seoa_name =  'PRODUCT ID'
 and soa.seoa_sero_id  = p_sero_id;
  
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change attribute update function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END INF_ATT_UPDATE;

--- Jayan Liyanage 2015/04/28




---  Dinesh Perera 2015/05/13
PROCEDURE UPDATE_SO_FEATURE_FLAG (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR GET_FEATURE_DATA IS 
SELECT 
SOFE_FEATURE_NAME,
SOFE_DEFAULTVALUE,
SOFE_PREV_VALUE 
FROM 
SERVICE_ORDER_FEATURES 
WHERE SOFE_SERO_ID = p_sero_id
AND NVL(SOFE_DEFAULTVALUE,'N') <> NVL(SOFE_PREV_VALUE,'N'); 

PREV_VAL SERVICE_ORDER_FEATURES.SOFE_DEFAULTVALUE%TYPE;
CURR_VAL SERVICE_ORDER_FEATURES.SOFE_PREV_VALUE%TYPE;
FETURE_NAME SERVICE_ORDER_FEATURES.SOFE_FEATURE_NAME%TYPE;

Begin
  
FOR ATTRI_DATA IN GET_FEATURE_DATA LOOP

FETURE_NAME := ATTRI_DATA.SOFE_FEATURE_NAME;
CURR_VAL := ATTRI_DATA.SOFE_DEFAULTVALUE;
PREV_VAL := ATTRI_DATA.SOFE_PREV_VALUE ;

IF CURR_VAL = 'Y' AND PREV_VAL = 'N' 
THEN 
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y', sofe_provision_time = sysdate WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;

ELSIF CURR_VAL = 'Y' AND PREV_VAL IS NULL
THEN 
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y', sofe_provision_time = sysdate WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;

ELSIF CURR_VAL = 'N' AND PREV_VAL = 'Y'
THEN 
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y', sofe_provision_time = sysdate WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;

/*ELSIF CURR_VAL = 'Y' AND PREV_VAL = 'Y'
THEN 
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y' WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;

ELSIF CURR_VAL = 'N' AND PREV_VAL = 'N'
THEN 
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'N' WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;

ELSE
UPDATE SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = NULL WHERE SOFE_SERO_ID = p_sero_id AND SOFE_FEATURE_NAME = FETURE_NAME;*/
END IF;

END LOOP;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to update feature flag'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END UPDATE_SO_FEATURE_FLAG;
---  Dinesh Perera 2015/05/13

--- Dulip Fernando 2015-02-13
--- FAULTS WORK FLOW  CAUSE OF FAULT AND  FAULT IN ATTRIBURE UPDATE 
PROCEDURE  FAULTS_WORK_FLOW_ATT_UPDATE(
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_CAUSE_OF_FAULT varchar2(100);
v_FAULT_IN       varchar2(100);

v_PROM_NUMBER   varchar2(100);  


begin

SELECT SUBSTR(SERO_OEID,3) INTO v_PROM_NUMBER
FROM SERVICE_ORDERS
WHERE SERO_ID=p_sero_id;

SELECT PROM_PCAT_NAME INTO v_CAUSE_OF_FAULT
FROM PROBLEMS
WHERE PROM_NUMBER=v_PROM_NUMBER;

SELECT PROM_PRSC_NAME INTO v_FAULT_IN
FROM PROBLEMS
WHERE PROM_NUMBER=v_PROM_NUMBER;
----PROM_PCAT_NAME -> cause of fault .PROM_PRSC_NAME->FAULT IN
        UPDATE service_order_attributes soa
        SET SOA.SEOA_DEFAULTVALUE = v_CAUSE_OF_FAULT
        where soa.seoa_name = 'CAUSE OF FAULT' and  soa.seoa_sero_id = p_sero_id;
        
        UPDATE service_order_attributes soa
        SET SOA.SEOA_DEFAULTVALUE = v_FAULT_IN
        where soa.seoa_name = 'FAULT IN' and  soa.seoa_sero_id = p_sero_id;
        
        

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed FAULTS_WORK_FLOW_ATT_UPDATE  Process function. Please check the conditions:'
|| ' - Erro is:' || TO_CHAR (SQLCODE) || '-' || SQLERRM;

p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END FAULTS_WORK_FLOW_ATT_UPDATE;
---- Dulip Fernando 2015-02-13

--- Jayan Sri Madura 29/05/2015
PROCEDURE D_DAB_RESERVE_TX (
   P_SERV_ID         IN       SERVICES.SERV_ID%TYPE,
   P_SERO_ID         IN       SERVICE_ORDERS.SERO_ID%TYPE,
   P_SEIT_ID         IN       SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
   P_IMPT_TASKNAME   IN       IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
   P_WORO_ID         IN       WORK_ORDER.WORO_ID%TYPE,
   P_RET_CHAR        OUT      VARCHAR2,
   P_RET_NUMBER      OUT      NUMBER,
   P_RET_MSG         OUT      VARCHAR2
)
IS

v_service_type       varchar2(100);
v_service_order      varchar2(100);
v_acc_net            varchar2(100);
v_acc_node_ch        varchar2(100);



Begin
  

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so
WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so 
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_acc_net FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue INTO v_acc_node_ch FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';

if v_service_type = 'D-DAB' and v_service_order = 'MODIFY-LOCATION' and (
  v_acc_net = 'SDH PORT' OR v_acc_net = 'OTN PORT') and v_acc_node_ch = 'YES' Then
  
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE TX PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE TX PORT'; END IF;
 
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-DAB Modify Loc. function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_DAB_RESERVE_TX;

--- Jayan Sri Madura 29/05/2015

--- Jayan Liyanage 2014/01/24
         
PROCEDURE D_EDL_SUS_RESU(
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type             varchar2(100);
v_service_order            varchar2(100);
v_acc_nw_int_b             varchar2(100);
v_sec_hndl                 varchar2(100);                 

begin
  


SELECT DISTINCT SO.SERO_SERT_ABBREVIATION,SO.SERO_ORDT_TYPE INTO  v_service_type,v_service_order 
FROM service_orders SO WHERE SO.SERO_ID= p_sero_id;

SELECT DISTINCT soa.seoa_defaultvalue INTO v_sec_hndl  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'AND so.sero_id = p_sero_id;
SELECT DISTINCT soa.seoa_defaultvalue INTO v_acc_nw_int_b  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-B END'AND so.sero_id = p_sero_id;

IF    v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND v_sec_hndl like 'SALES-SME-%'  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_hndl||'-PSM'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'APPROVE TEMP DISCON.'; 
ELSIF    v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND
( v_sec_hndl like 'SALES-ENT-%' OR v_sec_hndl like 'SALES-WSALE-%') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_sec_hndl||'-MGR'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'APPROVE TEMP DISCON.'; 
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id =  p_sero_id 
AND sit.seit_taskname = 'APPROVE TEMP DISCON.'; END IF;  


IF v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND ( v_acc_nw_int_b = 'MSAN PORT' 
  OR v_acc_nw_int_b = 'DSLAM PORT'  OR v_acc_nw_int_b = 'MLLN PORT' ) THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SUSPEND VLL PORT-B'; 
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND v_acc_nw_int_b = 'MEN PORT' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SUSPEND VLL PORT-B';
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND v_acc_nw_int_b = 'CEN PORT' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SUSPEND VLL PORT-B';
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'SUSPEND' AND ( v_acc_nw_int_b = 'SDH PORT' OR v_acc_nw_int_b = 'OTN PORT') THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'SUSPEND VLL PORT-B';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id =  p_sero_id 
AND sit.seit_taskname = 'VERIFY NTU-A END'; END IF;  

IF v_service_type = 'D-EDL'AND v_service_order = 'RESUME' AND ( v_acc_nw_int_b = 'MSAN PORT' 
  OR v_acc_nw_int_b = 'DSLAM PORT'  OR v_acc_nw_int_b = 'MLLN PORT' ) THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESUME VLL PORT-B'; 
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'RESUME' AND v_acc_nw_int_b = 'MEN PORT' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESUME VLL PORT-B';
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'RESUME' AND v_acc_nw_int_b = 'CEN PORT' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESUME VLL PORT-B';
ELSIF v_service_type = 'D-EDL'AND v_service_order = 'RESUME' AND ( v_acc_nw_int_b = 'SDH PORT' OR v_acc_nw_int_b = 'OTN PORT') THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESUME VLL PORT-B';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id =  p_sero_id 
AND sit.seit_taskname = 'VERIFY NTU-A END'; END IF;  



 p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change  Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_EDL_SUS_RESU;
--- Jayan Liyanage 2014/01/24

--- Jayan Liyanage 2015/04/28 Updated on 16/09/2015 and 12/10/2015 Error message updated on 06/02/2016

PROCEDURE DAB_PUSH_SO_NUMBER (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2) IS

Cursor Cur_acc is
SELECT DISTINCT SOA.SEOA_DEFAULTVALUE FROM SERVICE_ORDER_ATTRIBUTES SOA 
WHERE SOA.SEOA_NAME = 'PRODUCT SO NUMBER' AND SOA.SEOA_SERO_ID = p_sero_id;

Cursor CurSo ( D_pro varchar2) IS
select distinct  s.sero_id ---into v_so_id
from service_orders s where (s.sero_stas_abbreviation  <> 'CANCELLED' 
AND s.sero_stas_abbreviation <> 'PENDINGDELETE')
and  s.sero_id = D_pro;

Cursor Cur_Dab_so#1 (Dab#1 varchar2) IS
SELECT DISTINCT SOA.SEOA_DEFAULTVALUE FROM SERVICE_ORDER_ATTRIBUTES SOA 
WHERE SOA.SEOA_NAME = 'DAB SO NUMBER' AND SOA.SEOA_SERO_ID = Dab#1;
Cursor Cur_Dab_so#2 (Dab#2 varchar2) IS
SELECT DISTINCT SOA.SEOA_DEFAULTVALUE FROM SERVICE_ORDER_ATTRIBUTES SOA 
WHERE SOA.SEOA_NAME = 'DAB SO NUMBER 2' AND SOA.SEOA_SERO_ID = Dab#2;

v_prod_so           varchar2(100);
v_so_id             varchar2(100);
v_ser_Od_Ty         varchar2(100);
v_ser_ty            varchar2(100);
v_dab_so#1          varchar2(100);              
v_dab_so#2          varchar2(100);   

BEGIN
  

open Cur_acc; fetch Cur_acc into v_prod_so;close Cur_acc;
--open Cur_acc_2; fetch Cur_acc_2 into v_prod_so_2;close Cur_acc_2;
open CurSo (v_prod_so); fetch CurSo into v_so_id; close CurSo;
open Cur_Dab_so#1(v_prod_so);fetch Cur_Dab_so#1 into v_dab_so#1; close Cur_Dab_so#1;
open Cur_Dab_so#2(v_prod_so);fetch Cur_Dab_so#2 into v_dab_so#2; close Cur_Dab_so#2;

SELECT DISTINCT  s.sero_sert_abbreviation,S.SERO_ORDT_TYPE INTO v_ser_ty,v_ser_Od_Ty
FROM SERVICE_ORDERS S WHERE S.SERO_ID = v_so_id;

IF v_ser_ty <>  'D-EDL' and v_so_id is not null Then
update service_order_attributes soa
set soa.seoa_defaultvalue = p_sero_id
where soa.seoa_name = 'DAB SO NUMBER'  and soa.seoa_sero_id = v_so_id; end if;

IF v_ser_ty = 'D-EDL' and v_so_id is not null Then
IF v_dab_so#1 is not null and v_dab_so#2 is not null then
p_ret_msg := 'Failed to Update "DAB SO Number 1&2 " Attribute values: These attributes already filled '  || TO_CHAR(SQLCODE) ;
elsif v_dab_so#1 is null and v_dab_so#2 is null then 
update service_order_attributes soa
set soa.seoa_defaultvalue = p_sero_id
where soa.seoa_name = 'DAB SO NUMBER'  and soa.seoa_sero_id = v_so_id;
elsif v_dab_so#1 is  null and v_dab_so#2 is not null then
update service_order_attributes soa
set soa.seoa_defaultvalue = p_sero_id
where soa.seoa_name = 'DAB SO NUMBER'  and soa.seoa_sero_id = v_so_id;
elsif v_dab_so#1 is not null and v_dab_so#2 is  null then
update service_order_attributes soa
set soa.seoa_defaultvalue = p_sero_id
where soa.seoa_name = 'DAB SO NUMBER 2'  and soa.seoa_sero_id = v_so_id; END IF; 
END IF;

IF p_ret_msg IS NULL THEN
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
else
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);
end if;

/*SELECT DISTINCT so.sero_id into 
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN 
(SELECT MAX (s.sero_id)FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
 AND ci.cirt_displayname LIKE  replace(v_Acc_Id,'(N)')||'%');  
update service_order_attributes soa set soa.seoa_defaultvalue = v_so_id 
where soa.seoa_name =  'DAB SO NUMBER';
*/

--p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change DAB SO #NO Copy function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END DAB_PUSH_SO_NUMBER;
  
--- Jayan Liyanage 2015/04/28 Updated on 16/09/2015 and 12/10/2015
  
--Dulip Fernando 2015-06-11  
-- *****************************************************************

-- Description: Automating DSP in DELETE-TRANSFER Service orders

--  This function configured in MS-LINK P_MONITOR service type and it will automatically close the task ""AIT FOR LPM CCT" in 
--  MS-NVISION service type .

--NAME OF PROGRAMM :  WAIT_FOR_LPM_CCT

-- Error Conditions Raised:

-- Author:      <your name>

--Dulip Fernando 

-- Revision History

-- Date            Author               Reason for Change

----02/07/2015 Jayan Liyanage

-- ----------------------------------------------------------------

-- 2015-06-11    Dulip Fernando        Created. 

-- *****************************************************************

PROCEDURE WAIT_FOR_LPM_CCT(
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
   
)
IS

v_n_vision_so_number           VARCHAR2 (100); 
v_seit_stas                    VARCHAR2 (100); 
v_seit_id                      VARCHAR2 (100); 
v_so_number                    VARCHAR2 (100);

   Cursor Cur_Nvision_So# is SELECT SEOA_DEFAULTVALUE   FROM SERVICE_ORDER_ATTRIBUTES  
   WHERE SEOA_NAME='NVISION SO#' AND SEOA_SERO_ID=p_sero_id;

BEGIN 
      open Cur_Nvision_So#;  fetch Cur_Nvision_So# into v_n_vision_so_number; close Cur_Nvision_So#;
  
      SELECT distinct so.sero_id into v_so_number FROM service_orders so
      where so.sero_id = v_n_vision_so_number;   
/*
    SELECT SEOA_DEFAULTVALUE INTO v_n_vision_so_number
      FROM SERVICE_ORDER_ATTRIBUTES
     WHERE SEOA_NAME='NVISION SO#' AND SEOA_SERO_ID=p_sero_id;*/


--get tasks status of "WAIT FOR LPM CCT"   and its implementation tasks id 

   /* SELECT seit_stas_abbreviation,seit_id  INTO v_seit_stas,v_seit_id
      FROM service_implementation_tasks
     WHERE seit_taskname ='WAIT FOR LPM CCT' 
       AND seit_sero_id=v_n_vision_so_number;
       */
       
IF v_n_vision_so_number is not null AND v_so_number is not null then    
UPDATE  service_implementation_tasks SET seit_stas_abbreviation = 'COMPLETED'
WHERE seit_taskname ='WAIT FOR LPM CCT'  AND seit_sero_id=v_n_vision_so_number;
END IF;
         
                    
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
                


EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WAIT_FOR_LPM_CCT Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END WAIT_FOR_LPM_CCT;

--Dulip Fernando 2015-06-11 

---- Dinesh Perera  28-05-2015 ------
PROCEDURE IPTV_SYS_ATT_UPDATE (      
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
  
        BEGIN     
              

        UPDATE SERVICE_ORDER_ATTRIBUTES 
        SET SEOA_DEFAULTVALUE =  'NEW' 
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'SA_IPTV_SYSTEM';       
             
   p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
  EXCEPTION
  WHEN OTHERS
  THEN
  p_ret_msg :='Failed to update SA_IPTV_SYSTEM attribute:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
  INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
  VALUES(p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
     
END IPTV_SYS_ATT_UPDATE;
---- Dinesh Perera  28-05-2015 ------

---- Jayan Liyanage 2015/07/29 RTOM WG updated on 30/11/2015
PROCEDURE  APPROVE_SO_WGCH_TO_RTOM(
p_serv_id                  IN     Services.serv_id%TYPE,
p_sero_id                  IN     Service_Orders.sero_id%TYPE,
p_seit_id                  IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname            IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                  IN     work_order.woro_id%TYPE,
p_ret_char                 OUT    VARCHAR2,
p_ret_number               OUT    NUMBER,
p_ret_msg                  OUT    VARCHAR2) IS



v_sec_handel_by    VARCHAR2(100):= null;
v_rtom             VARCHAR2(100);
v_ram_Rt           VARCHAR2(100);

CURSOR seoa_cur IS SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION HANDLED BY';

BEGIN
p_ret_char := '';
OPEN seoa_cur;
FETCH seoa_cur INTO v_sec_handel_by;
CLOSE seoa_cur;

select substr(v_sec_handel_by,instr(v_sec_handel_by,'-',1,2)+1) 
into v_ram_Rt from dual;


select distinct replace(ar.area_area_code,'R-') into v_rtom
from service_orders so,areas ar
where so.sero_area_code = ar.area_code
and ar.area_area_code like 'R-%'
and so.sero_id = p_sero_id;

IF v_sec_handel_by is null THEN
p_ret_char := 'CORP-SSU';
ELSIF v_sec_handel_by like '%SME%' THEN
p_ret_char := v_sec_handel_by || '-PSM';
ELSIF v_sec_handel_by = 'Regional Telecom Office' THEN
p_ret_char := v_rtom || '-RTOM';
ELSIF v_sec_handel_by LIKE '%-RAM-%' THEN 
p_ret_char := v_ram_Rt || '-RTOM';
ELSE p_ret_char := v_sec_handel_by || '-MGR';
END IF;
p_ret_msg := '';

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

END APPROVE_SO_WGCH_TO_RTOM;
-- Jayan Liyanage 2015/07/29


------Dinesh Perera 07-08-2015 ---- HLR--for FAULT_WF---
PROCEDURE PROCESS_UPDATE_HLR_FLT_ATTR (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


      
    CURSOR NUMB_ID  IS
    
        SELECT NUMB_ID
        FROM SERVICE_ORDERS, PROBLEMS, PROBLEM_LINKS, CIRCUITS, NUMBERS
        WHERE SERO_ID = p_sero_id
        AND PROM_NUMBER = SUBSTR(SERO_OEID,3)
        AND PROL_PROM_NUMBER = PROM_NUMBER
        AND PROL_FOREIGNTYPE = 'CIRCUITS'
        AND PROL_FOREIGNID = CIRT_NAME
        AND CIRT_SERV_ID = NUMB_SERV_ID;
    
    
    CURSOR C_CDMA_NUMBER  IS
    
        SELECT CIRT_DISPLAYNAME
        FROM SERVICE_ORDERS, PROBLEMS, PROBLEM_LINKS, CIRCUITS
        WHERE SERO_ID = p_sero_id
        AND PROM_NUMBER = SUBSTR(SERO_OEID,3)
        AND PROL_PROM_NUMBER = PROM_NUMBER
        AND PROL_FOREIGNTYPE = 'CIRCUITS'
        AND PROL_FOREIGNID = CIRT_NAME;
         
      
    CURSOR C_NO_AUTO_PROV (T_NUMB_ID NUMBERS.NUMB_ID%TYPE) IS
        SELECT  NIDE_VALUE
        FROM    NUMBER_INSTANCE_DETAILS
        WHERE   NIDE_NUMB_ID=T_NUMB_ID
        AND     NIDE_NAME ='AUTO_PROV';

    CURSOR C_NO_MANS_NAME (T_NUMB_ID NUMBERS.NUMB_ID%TYPE) IS
        SELECT  NIDE_VALUE
        FROM    NUMBER_INSTANCE_DETAILS
        WHERE   NIDE_NUMB_ID=T_NUMB_ID
        AND     NIDE_NAME='MANS_NAME';
      
     

      V_NUMB_ID         NUMBERS.NUMB_ID%TYPE;
      V_CDMA_NUM        VARCHAR2 (20);
      V_SERO_ATTR       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;  
      V_AUTO_PROV       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
      V_MANS_NAME       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;

BEGIN


    OPEN NUMB_ID;
    FETCH NUMB_ID INTO V_NUMB_ID;
    CLOSE NUMB_ID;
    
    
    OPEN C_CDMA_NUMBER;
    FETCH C_CDMA_NUMBER INTO V_CDMA_NUM;
    CLOSE C_CDMA_NUMBER;

      
    OPEN C_NO_AUTO_PROV(V_NUMB_ID);
    FETCH C_NO_AUTO_PROV INTO V_AUTO_PROV;
    CLOSE C_NO_AUTO_PROV;

    
    OPEN C_NO_MANS_NAME(V_NUMB_ID);
    FETCH C_NO_MANS_NAME INTO V_MANS_NAME;
    CLOSE C_NO_MANS_NAME;

 

    IF V_AUTO_PROV IS NOT NULL AND V_MANS_NAME IS NOT NULL THEN
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_MANS_NAME
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_AUTO_PROV
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'AUTO_PROV';
        
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_CDMA_NUM
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'SA_CDMA_NUMBER';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, 

p_seit_id,'COMPLETED');
    ELSE
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = 'NA'
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = 'NA'
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'AUTO_PROV';
        
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = 'NA'
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'SA_CDMA_NUMBER';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, 

p_seit_id,'COMPLETED');
    
    END IF;
    

 EXCEPTION
 WHEN OTHERS THEN


        p_ret_msg  := 'UPDATE HLR ATTR PROCESS FAILED' || ' - Erro is:' || 

TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, 

p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, 

SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  

SYSDATE
          , p_ret_msg);


END PROCESS_UPDATE_HLR_FLT_ATTR;
------Dinesh Perera 07-08-2015 ---- HLR--for FAULT_WF---

--Production updated on 28-08-2015
-- Jayan Liyanage 2014 / 05 / 23
--- 06-06-2014  Samankula Owitipana
PROCEDURE DNR_RENEWAL_EXP_DATE_SET(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR c_dsp_date IS
SELECT TO_DATE(SUBSTR(trim(SOA.SEOA_DEFAULTVALUE),1,11),'DD-MON-YYYY')
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ACTUAL_DSP_DATE';


CURSOR c_up_pay_period IS
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'UPFRONT PAY. PERIOD (YRS)';

v_dsp_date      date;
v_up_pay_period number;
v_service_ren_date date;
v_ren_reminder_date date;

BEGIN



OPEN c_dsp_date;
FETCH c_dsp_date INTO v_dsp_date;
CLOSE c_dsp_date;

OPEN c_up_pay_period;
FETCH c_up_pay_period INTO v_up_pay_period;
CLOSE c_up_pay_period;

v_service_ren_date := ADD_MONTHS(v_dsp_date,v_up_pay_period*12);
v_ren_reminder_date := ADD_MONTHS(v_service_ren_date,-2);



UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_service_ren_date
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'SERVICE RENEWAL DATE' ;

UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_ren_reminder_date
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'RENEWAL REMINDER DATE' ;


p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to set DSERVICE RENEWAL DATE. Please check ACTUAL_DSP_DATE and UPFRONT PAY. PERIOD (YRS) attributes : - Erro is:' || TO_CHAR(SQLCODE) 

||'-'|| SQLERRM;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');


    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);


END DNR_RENEWAL_EXP_DATE_SET;
--- 06-06-2014  Samankula Owitipana

-- Jayan Liyanage 24/08/2015
PROCEDURE ASSOCIATE_PSTN_NUMBER_TO_FTTH (
p_serv_id            IN     Services.serv_id%TYPE,
p_sero_id            IN     Service_Orders.sero_id%TYPE,
p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id            IN     work_order.woro_id%TYPE,
p_ret_char              OUT VARCHAR2,
p_ret_number            OUT NUMBER,
p_ret_msg               OUT VARCHAR2)   IS

      
CURSOR Cur_SER_ID IS
select distinct s.sero_serv_id, s.sero_sert_abbreviation,s.sero_cusr_abbreviation
from Service_Orders s
where s.sero_id=p_sero_id;
      
Cursor Cur_PSTN_Number IS
select distinct substr(SEOA_DEFAULTVALUE,0,3) NUCC_CODE, substr(SEOA_DEFAULTVALUE,4,7) NUMB_NUMBER
from SERVICE_ORDER_ATTRIBUTES
where SEOA_SERO_ID = p_sero_id
and SEOA_NAME='SA_PSTN_NUMBER';
      

CURSOR Cur_Status_id (c_NUCC_CODE IN SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE, 
c_NUM IN SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE)  IS     
select distinct N.NUMB_NUMS_ID,S.SERO_CUSR_ABBREVIATION,N.NUMB_SERV_ID
from  NUMBERS N,service_orders s,CIRCUITS CI
WHERE S.SERO_CIRT_NAME = CI.CIRT_NAME
and s.sero_serv_id = n.numb_serv_id
and s.sero_ordt_type like 'DEL%'
AND NUMB_NUCC_CODE= c_NUCC_CODE
and NUMB_NUMBER = c_NUM
AND CI.CIRT_DISPLAYNAME = NUMB_NUCC_CODE||NUMB_NUMBER
and ci.cirt_outservice in
(select max(cc.cirt_outservice) from circuits cc 
where cc.cirt_displayname = ci.cirt_displayname);
      
V_NUCC_CODE           numbers.numb_nucc_code%TYPE;
V_NUMB_NUMBER         numbers.numb_number%TYPE;
V_SERV_ID             service_orders.sero_serv_id%TYPE;
V_SERVICE_TYPE        service_orders.sero_sert_abbreviation%TYPE;
V_NUMBER_STATUS       numbers.numb_nums_id%TYPE;   
V_CR_NUM              service_orders.sero_cusr_abbreviation%TYPE; 
V_NUM_ID              numbers.numb_nums_id%TYPE;
V_DE_CR_NUM           service_orders.sero_cusr_abbreviation%TYPE;
V_NUM_SER_ID          numbers.numb_serv_id%TYPE;
       
Begin
        
OPEN  Cur_SER_ID;
FETCH  Cur_SER_ID INTO v_SERV_ID, v_SERVICE_TYPE,V_CR_NUM;
IF Cur_SER_ID%NOTFOUND THEN
v_SERV_ID := '';
v_SERVICE_TYPE := '';
END IF; 
CLOSE  Cur_SER_ID;
    
OPEN  Cur_PSTN_Number;
FETCH  Cur_PSTN_Number INTO V_NUCC_CODE, V_NUMB_NUMBER;
IF Cur_PSTN_Number%NOTFOUND THEN
V_NUCC_CODE := '';
V_NUMB_NUMBER := '';
END IF; 
CLOSE  Cur_PSTN_Number;
        
 IF  V_NUCC_CODE IS NULL OR V_NUMB_NUMBER IS NULL 
   or length(v_NUCC_CODE) <> 3 or length(v_NUMB_NUMBER) <> 7  THEN    
   
          p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH,The SA_PSTN_Number Attribute value is Blank or invalid:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
ELSE
 open Cur_Status_id(V_NUCC_CODE,V_NUMB_NUMBER); fetch Cur_Status_id into V_NUM_ID,V_DE_CR_NUM,V_NUM_SER_ID;
IF Cur_Status_id%notfound then
  V_NUM_ID := '';
  V_DE_CR_NUM := '';
  V_NUM_SER_ID := '';
  
end if;
close Cur_Status_id;

  IF V_NUM_ID IS NULL OR V_DE_CR_NUM IS NULL OR V_NUM_SER_ID IS NULL THEN
  p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH,There is NO Delete Order into Previous PSTN Service:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
  ELSIF V_NUM_ID <> 5 THEN--OR V_NUM_ID <> 3   THEN              
  p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH, The number status is invalid :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;     
  ELSIF V_NUM_ID IS NULL OR V_DE_CR_NUM IS NULL OR V_NUM_SER_ID IS NULL THEN
  p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH,There is NO Delete Order into Previous PSTN Service:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
  ELSIF V_DE_CR_NUM <>  V_DE_CR_NUM  THEN    
  p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH: The Customer Referances(CR) are Invalid' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
  ELSIF v_SERV_ID IS NULL THEN
  p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH, Service Id is null:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
  ELSIF V_DE_CR_NUM =  V_DE_CR_NUM and V_NUM_ID = 5 AND V_NUM_SER_ID is not null then
  update CLARITY.NUMBERS set NUMB_NUMS_ID = 3,NUMB_SERV_ID = v_SERV_ID where NUMB_NUCC_CODE = V_NUCC_CODE
  and NUMB_NUMBER = V_NUMB_NUMBER and NUMB_NUMS_ID = 5; END IF; end if;
  IF p_ret_msg IS NULL THEN
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
  else
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
  SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
  , p_ret_msg);
  end if;


    EXCEPTION
        WHEN OTHERS THEN
          p_ret_msg  := 'Failed to Assosiate PSTN Number to FTTH :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;  

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

     INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
     SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
     , p_ret_msg);
    
END ASSOCIATE_PSTN_NUMBER_TO_FTTH;

-- Jayan Liyanage 24/08/2015

--Samankula Owitipana 2013-05-06
PROCEDURE D_BDL_CREATE (
p_serv_id         IN       services.serv_id%TYPE,
 p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS


CURSOR pre_cir (v_old_ids VARCHAR) IS SELECT DISTINCT c.cirt_status FROM circuits c WHERE c.cirt_displayname = v_old_ids;

CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 ) IS SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
FROM circuits c, circuit_hierarchy ch, circuits ci WHERE c.cirt_name = ch.cirh_parent
AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')AND (   ci.cirt_status NOT LIKE 'CANCE%'
OR ci.cirt_status NOT LIKE 'PENDING%')AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' AND c.cirt_displayname = parent_name; 

              
CURSOR cur_Old_tributer (old_parent_name VARCHAR2,v_new_cir_id varchar2 )IS SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
FROM circuits c, circuit_hierarchy ch, circuits ci WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name
AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%' OR ci.cirt_status LIKE 'SUSPEND%'
OR ci.cirt_status LIKE 'COMMISS%')AND (   ci.cirt_status NOT LIKE 'CANCE%'OR ci.cirt_status NOT LIKE 'PENDING%'
) AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' AND c.cirt_displayname = old_parent_name;

cursor Cur_a_s( a_cir varchar2)is select ci.cirt_displayname,ci.cirt_status  from circuits ci where ci.cirt_displayname = a_cir;
cursor Cur_b_s( b_cir varchar2)is select ci.cirt_displayname,ci.cirt_status  from circuits ci where ci.cirt_displayname = b_cir;

acc_nw_intr_a             VARCHAR2 (100);
acc_nw_intr_b             VARCHAR2 (100);
acc_bearer_a_sta          VARCHAR2 (100);
acc_bearer_b_sta          VARCHAR2 (100);
acc_lin_a                 VARCHAR2 (100);
acc_lin_b                 VARCHAR2 (100);
acc_medi_a                VARCHAR2 (100);
acc_medi_b                VARCHAR2 (100);
acc_fib_a                 VARCHAR2 (100);
acc_fib_b                 VARCHAR2 (100);
back_b_capacity_a         VARCHAR2 (100);
back_b_capacity_b         VARCHAR2 (100);
agr_nw_a                  VARCHAR2 (100);
agr_nw_b                  VARCHAR2 (100);
Ntu_Cls_a                 VARCHAR2 (100);
Ntu_Cls_b                 VARCHAR2 (100);
Ntu_model_chg_a           VARCHAR2 (100);
Ntu_model_chg_b           VARCHAR2 (100);
cpe_Cls_a                 VARCHAR2 (100);
cpe_Cls_b                 VARCHAR2 (100);
cur_cpe_model_a           VARCHAR2 (100);
pre_cpe_model_a           VARCHAR2 (100);
cur_cpe_model_b           VARCHAR2 (100);
pre_cpe_model_b           VARCHAR2 (100);
Ser_cteg                  VARCHAR2 (100);
Test_Sr_Al                VARCHAR2 (100);
v_acc_id_a                VARCHAR2 (100);
v_acc_id_b                VARCHAR2 (100);
v_service_order_area_a    VARCHAR2 (100);
v_service_order_area_b    VARCHAR2 (100);
v_rtom_code_aa            VARCHAR2 (100);
v_lea_code_aa             VARCHAR2 (100);
v_work_group_a_os         VARCHAR2 (100);
--v_work_group_a_nw         VARCHAR2 (100);
v_work_group_a_cpe        VARCHAR2 (100);
v_rtom_code_bb            VARCHAR2 (100);
v_lea_code_bb             VARCHAR2 (100);
v_work_group_b_nw         VARCHAR2 (100);
--v_work_group_a_cpe        VARCHAR2 (100);
v_section_hndle           VARCHAR2 (100);
v_service_order           VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_work_group_a_nw         VARCHAR2 (100);
v_work_group_b_os         VARCHAR2 (100);
v_loc_a_cir_dis           VARCHAR2(100);
v_loc_a_cir_Sta           VARCHAR2(100);
v_loc_b_cir_dis           VARCHAR2(100);
v_loc_b_cir_Sta           VARCHAR2(100);
v_work_group_a_mdf  VARCHAR2(100);
v_work_group_b_mdf  VARCHAR2(100);
--v_work_group_a_tx   VARCHAR2(100);
--v_work_group_b_tx   VARCHAR2(100);
v_work_group_b_cpe  VARCHAR2(100);



BEGIN

 SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT DISTINCT so.sero_ordt_type INTO v_service_order 
FROM service_orders so WHERE so.sero_id =  p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_section_hndle
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue INTO v_service_order_area_a
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE AREA CODE-A END';

SELECT soa.seoa_defaultvalue INTO v_service_order_area_b
FROM service_order_attributes soa WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_aa,v_lea_code_aa FROM areas ar WHERE ar.area_code = v_service_order_area_a AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name INTO v_work_group_a_os FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_aa || '-' || v_lea_code_aa || '%' || 'OSP-NC';

SELECT wg.worg_name INTO v_work_group_a_mdf FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_aa || '-' || v_lea_code_aa || '%' || 'MDF';

/*SELECT wg.worg_name INTO v_work_group_a_tx FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_aa || '-' || v_lea_code_aa || '%' || 'TX';*/
                  
SELECT wg.worg_name INTO v_work_group_a_nw FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_aa || '-' || '%' || 'ENG-NW' || '%';

SELECT wg.worg_name INTO v_work_group_a_cpe FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_aa || '-' || '%' || 'CPE-NC' || '%';

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_bb,v_lea_code_bb FROM areas ar WHERE ar.area_code = v_service_order_area_b AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name INTO v_work_group_b_os FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_bb || '-' || v_lea_code_bb || '%' || 'OSP-NC'; 

SELECT wg.worg_name INTO v_work_group_b_mdf FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_bb || '-' || v_lea_code_bb || '%' || 'MDF'; 

/*SELECT wg.worg_name INTO v_work_group_b_tx FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_bb || '-' || v_lea_code_bb || '%' || 'TX'; */
                 
SELECT wg.worg_name INTO v_work_group_b_nw FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_bb || '-' || '%' || 'ENG-NW' || '%';

SELECT wg.worg_name INTO v_work_group_b_cpe FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code_bb || '-' || '%' || 'CPE-NC' || '%';

SELECT soa.seoa_defaultvalue INTO acc_nw_intr_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-A END';

SELECT soa.seoa_defaultvalue INTO acc_nw_intr_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-B END';

SELECT soa.seoa_defaultvalue INTO acc_lin_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END';

SELECT soa.seoa_defaultvalue INTO acc_lin_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END';

SELECT soa.seoa_defaultvalue INTO acc_medi_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-A END';

SELECT soa.seoa_defaultvalue INTO acc_medi_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-B END';

SELECT soa.seoa_defaultvalue INTO agr_nw_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGG. NETWORK-A END';

SELECT soa.seoa_defaultvalue  INTO agr_nw_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'AGG. NETWORK-B END';

SELECT soa.seoa_defaultvalue INTO Ser_cteg FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

SELECT soa.seoa_defaultvalue INTO Test_Sr_Al FROM service_order_attributes soa
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'TEST SERVICE ALTERED?';

IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(agr_nw_b = 'MEN' AND acc_nw_intr_b <> 'MEN PORT') or (agr_nw_a = 'MEN' AND acc_nw_intr_a <> 'MEN PORT')  THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;  
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_nw_intr_a = 'SDH PORT' AND  agr_nw_a = 'SDH') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACT. TX LINK-A END'; 
ELSE 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACT. TX LINK-A END'; END IF;  
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_nw_intr_b = 'SDH PORT' AND  agr_nw_b = 'SDH') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACT. TX LINK-B END'; 
ELSE 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACT. TX LINK-B END'; END IF;  
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_medi_a = 'P2P RADIO' and acc_lin_a = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INST. SLT-END NTU-A'; 
ELSE 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INST. SLT-END NTU-A'; END IF;  
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_medi_a = 'COPPER' and acc_lin_a = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONST.OSP LINE-A END'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONST.OSP LINE-A END'; END IF; 
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_medi_a = 'COPPER' and acc_lin_a = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'MAKE X CONNECT-A END'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MAKE X CONNECT-A END'; END IF; 
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
(acc_medi_b = 'COPPER' and acc_lin_b = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_b_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'MAKE  X CONNECT-B END'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MAKE  X CONNECT-B END'; END IF;   
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
((acc_medi_a = 'FIBER' or acc_medi_a = 'COPPER-UTP') and acc_lin_a = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ESTAB_ACC.LINK-A END'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ESTAB_ACC.LINK-A END'; END IF;
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND 
((acc_medi_b = 'FIBER' or acc_medi_b = 'COPPER-UTP') and acc_lin_b = 'DEDICATED LINE') THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ESTAB_ACC.LINK-B END'; 
ELSE 
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ESTAB_ACC.LINK-B END'; END IF;  
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
( acc_nw_intr_a = 'MEN PORT' OR acc_nw_intr_b = 'MEN PORT')THEN
UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE E2E SERVICE'; 
ELSIF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
(( acc_nw_intr_a = 'MSAN PORT' OR acc_nw_intr_a = 'DSLAM PORT' OR acc_nw_intr_a = 'MLLN PORT') OR
( acc_nw_intr_b = 'MSAN PORT' OR acc_nw_intr_b = 'DSLAM PORT' OR acc_nw_intr_b = 'MLLN PORT'))THEN
UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = 'DS-CPEI' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE E2E SERVICE'; 
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE E2E SERVICE'; END IF;
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
( acc_nw_intr_b = 'MSAN PORT' OR acc_nw_intr_b = 'DSLAM PORT' OR acc_nw_intr_b = 'MLLN PORT')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; 
ELSIF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
acc_nw_intr_b = 'MEN PORT'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; 
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
Ser_cteg = 'TEST' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; END IF;
IF    v_service_type = 'D-BDL'AND v_service_order = 'CREATE'  AND  
Ser_cteg = 'TEST' AND Test_Sr_Al = 'YES' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle||'-ACCM'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
END IF; 
p_implementation_tasks.update_task_status_byid ( p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid ( p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_BDL_CREATE;
--Samankula Owitipana 2013-05-06

-- Jayan Liyanage  24 / 07 / 2015 UPDATED FOR SALES-RAM-XXX ON 10/01/2016
PROCEDURE CENTREX_WG_CHANGE(
p_serv_id                      IN     Services.serv_id%TYPE,
p_sero_id                      IN     Service_Orders.sero_id%TYPE,
p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                      IN     work_order.woro_id%TYPE,
p_ret_char                     OUT    VARCHAR2,
p_ret_number                   OUT    NUMBER,
p_ret_msg                      OUT    VARCHAR2) IS


v_Sec_Hand          varchar2(200) := null;
v_Cent                  varchar2(200) :=  null;
v_rto                   varchar2(200);
v_ar_code           varchar2(100);

Cursor Cur_sec IS
select Distinct soa.seoa_defaultvalue 
from service_order_attributes soa
where soa.seoa_name = 'SECTION HANDLED BY'
and soa.seoa_sero_id = p_sero_id;



BEGIN p_ret_char := '';

select distinct ar.area_area_code
into v_ar_code
from service_orders s,areas ar
where s.sero_area_code = ar.area_code
and ar.area_area_code like 'R-%'
and s.sero_id = p_sero_id;

OPEN  Cur_sec; FETCH Cur_sec 
INTO v_Sec_Hand; CLOSE Cur_sec;

select substr(v_ar_code,instr(v_ar_code,'-',1)+1) Into v_rto
from dual ;
IF v_Sec_Hand is null THEN
p_ret_char := 'CORP-SSU';
ELSIF v_Sec_Hand =  'Regional Telecom Office' Then
p_ret_char := v_rto || '-RTOM';
ELSIF v_Sec_Hand LIKE 'SALES-RAM-%' Then
p_ret_char := v_rto || '-RTOM';
ELSE 
p_ret_char := v_Sec_Hand||'-ACCM'; 
END IF;

p_ret_msg := '';

EXCEPTION
WHEN OTHERS THEN
  
p_ret_msg  := 'Failed to change workgroup:
Please check the Section Handle Attribute ' 
|| TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

END CENTREX_WG_CHANGE;
--- Jayan Liyanage  24 / 07 / 2015

---- 02/09/2015  Jayan Liyanage
PROCEDURE D_VALUE_VPN_EXT_SER (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_extso_no         varchar2 (100);
v_extso_type       varchar2 (100);
v_sodno              varchar2 (100);
v_sodType          varchar2 (100);
v_sodLink_Type   varchar2 (100);
v_sodOrd_type     varchar2 (100);
v_ext_sod               varchar2 (100);

BEGIN
select distinct  soa.seoa_defaultvalue into v_extso_no from  service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE SO NO' and soa.seoa_sero_id = p_sero_id;
select distinct  soa.seoa_defaultvalue into v_extso_type  from service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sodLink_Type               
from service_order_attributes soa where soa.seoa_name = 'VALUE VPN LINK TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct so.sero_id, so.sero_sert_abbreviation,so.sero_ordt_type into v_sodno,v_sodType,v_sodOrd_type 
from service_orders so where so.sero_id = p_sero_id;

if  v_extso_no is not null then
select distinct so.sero_id into v_ext_sod from service_orders so--,circuits ci
--where so.sero_cirt_name = ci.cirt_name
where so.sero_stas_abbreviation <> 'CANCELLED'
--and (ci.cirt_status <> 'CANCELLED' or ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = v_extso_no and so.sero_sert_abbreviation = v_extso_type;
IF v_sodType = 'D-VALUE VPN' AND (v_sodOrd_type = 'CREATE' or v_sodOrd_type = 'CREATE-OR' ) AND
  v_sodLink_Type = 'BACKHAUL SERVICE' THEN
UPDATE service_order_attributes soa SET SOA.SEOA_DEFAULTVALUE = v_sodno
WHERE SOA.SEOA_NAME = 'VALUE VPN LINK SO' AND SOA.SEOA_SERO_ID = v_extso_no;END IF; end if;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in "D-Value VPN" to "Smart Dial Plus" Products :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END D_VALUE_VPN_EXT_SER;
--  02 /09 /2015 Jayan Liyanage

--- Jayan Liyanage  02/09/2015
 PROCEDURE D_VALUE_VPN_EXT_SER_SMART_DIAL (
 p_serv_id IN services.serv_id%TYPE,
 p_sero_id IN service_orders.sero_id%TYPE,
 p_seit_id IN service_implementation_tasks.seit_id%TYPE,
 p_impt_taskname IN implementation_tasks.impt_taskname%TYPE,
 p_woro_id IN work_order.woro_id%TYPE,
 p_ret_char OUT VARCHAR2,
 p_ret_number OUT NUMBER,
 p_ret_msg OUT VARCHAR2
)
IS

v_extso_no          varchar2 (100);
v_extso_type        varchar2 (100);
v_sodno             varchar2 (100);
v_sodType           varchar2 (100);
v_sodLink_Type      varchar2 (100);
v_sodOrd_type       varchar2 (100);
v_Cir_Nos           varchar2 (100);
v_ext_sod           varchar2 (100);
v_Cir_No             varchar2 (100);

BEGIN
select distinct  soa.seoa_defaultvalue into v_extso_no from  service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE SO NO' and soa.seoa_sero_id = p_sero_id;
select distinct  soa.seoa_defaultvalue into v_extso_type  from service_order_attributes soa 
where soa.seoa_name = 'EXT. SERVICE TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sodLink_Type               
from service_order_attributes soa where soa.seoa_name = 'VALUE VPN LINK TYPE' and soa.seoa_sero_id = p_sero_id;
select distinct so.sero_id, so.sero_sert_abbreviation,so.sero_ordt_type into v_sodno,v_sodType,v_sodOrd_type 
from service_orders so where so.sero_id = p_sero_id;

if v_extso_no is not null then
select distinct so.sero_id into v_ext_sod
from service_orders so where so.sero_stas_abbreviation <> 'CANCELLED'
and so.sero_id = v_extso_no and so.sero_sert_abbreviation = v_extso_type; end if;
SELECT distinct ci.cirt_displayname into v_Cir_No    
FROM service_orders so, circuits ci
where so.sero_cirt_name = ci.cirt_name
and (ci.cirt_status <> 'CANCELLED' OR ci.cirt_status <> 'PENDINGDELETE')
and so.sero_id = p_sero_id;

IF v_sodType = 'D-VALUE VPN' AND (v_sodOrd_type = 'CREATE' or v_sodOrd_type = 'CREATE-OR') AND
  v_sodLink_Type = 'BACKHAUL SERVICE' THEN
  
UPDATE service_implementation_tasks sit set sit.seit_stas_abbreviation = 'COMPLETED'
WHERE sit.seit_taskname = 'WAIT FOR VALUE VPN' AND sit.seit_sero_id = v_ext_sod;

UPDATE service_order_attributes soa SET SOA.SEOA_DEFAULTVALUE = v_Cir_No
WHERE SOA.SEOA_NAME = 'D_VALUE_VPN CIRCUIT ID' AND SOA.SEOA_SERO_ID = v_extso_no;END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Mapping Attributes in "D-Value VPN" to "Smart Dial Plus" :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END D_VALUE_VPN_EXT_SER_SMART_DIAL;
--- Jayan Liyanage  02/09/2015

---Danushka Fenando 05/10/2015

PROCEDURE SET_PSTN_PROV_STATUS(

      p_serv_id                IN     Services.serv_id%TYPE,
      p_sero_id                IN     Service_Orders.sero_id%TYPE,
      p_seit_id                IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname          IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                IN     work_order.woro_id%TYPE,
      p_ret_char                  OUT    VARCHAR2,
      p_ret_number                OUT    NUMBER,
      p_ret_msg                   OUT    VARCHAR2) IS
      
    SO_ID                 SERVICE_ORDERS.SERO_ID%TYPE;
    FEATURE_ID        SERVICE_ORDER_FEATURES.SOFE_ID%TYPE;
    VAL                     VARCHAR2(5);
    PRE_VAL              VARCHAR2(5);

      
      CURSOR PSTN_FEATURES (PKG SERVICE_ORDER_FEATURES.SOFE_SERO_ID%TYPE) IS
               SELECT DISTINCT  SOFE_ID , NVL(SOFE_DEFAULTVALUE,'N'), NVL(SOFE_PREV_VALUE,'N')  FROM SERVICE_ORDER_FEATURES  
               WHERE SOFE_SERO_ID = PKG
               AND SOFE_FEATURE_NAME IN  (SELECT  FEATURE_NAME FROM OSSRPT.PSTN_FEATURES );
    

BEGIN

SELECT  TB1.SEIT_SERO_ID  INTO SO_ID FROM SERVICE_IMPLEMENTATION_TASKS TB1 WHERE TB1.SEIT_ID = p_seit_id;


   OPEN PSTN_FEATURES(SO_ID);
     LOOP
     
     FETCH PSTN_FEATURES INTO FEATURE_ID,VAL,PRE_VAL;
     EXIT WHEN PSTN_FEATURES%NOTFOUND;
     
     
        IF VAL != PRE_VAL
        THEN 
        UPDATE  SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y' , SOFE_PROVISION_TIME = TO_DATE( TO_CHAR (SYSDATE,'mm/dd/yyyy hh:mi:ss PM') , 'mm/dd/yyyy hh:mi:ss PM') ,
        SOFE_PROVISION_USERNAME = 'CLARITY_ADMIN'
        WHERE SOFE_SERO_ID = SO_ID AND SOFE_ID = FEATURE_ID;
        
        COMMIT;
        
        END IF;
     
     END LOOP;
     CLOSE PSTN_FEATURES;
     
     
EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;


END SET_PSTN_PROV_STATUS;


---Danushka Fenando 05/10/2015


----Dinesh Perera  2015/10/02  -----
PROCEDURE FTTH_CLOSE_CHILD_LAST_TASK (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

  
CURSOR GET_DEPNDET_CHID_STAT (IN_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
SELECT SEIT_SERO_ID, SEIT_STAS_ABBREVIATION 
FROM SERVICE_IMPLEMENTATION_TASKS 
WHERE SEIT_TASKNAME = 'WAIT COMPLETE FAB'
AND SEIT_SERO_ID IN 
(SELECT SERO_ID FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE IN_OEID||'%' AND SERO_SERT_ABBREVIATION <> 'AB-FTTH');

CURSOR GET_CHILD_TASK_ID ( IN_CHILD_SO SERVICE_ORDERS.SERO_ID%TYPE ) IS
SELECT  SEIT_ID,SEIT_SERO_ID 
FROM SERVICE_IMPLEMENTATION_TASKS 
WHERE SEIT_SERO_ID = IN_CHILD_SO  AND SEIT_TASKNAME = 'WAIT COMPLETE FAB' AND SEIT_STAS_ABBREVIATION = 'INPROGRESS' ;

PARENT_SERO_ID SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
COMMON_OEID SERVICE_ORDERS.SERO_OEID%TYPE;
GET_DEPNDET_CHID_STAT_R GET_DEPNDET_CHID_STAT%ROWTYPE;
GET_CHILD_TASK_ID_R GET_CHILD_TASK_ID%ROWTYPE;

BEGIN

SELECT SUBSTR(SERO_OEID,1,9) INTO COMMON_OEID  FROM SERVICE_ORDERS WHERE SERO_ID = PARENT_SERO_ID;

OPEN GET_DEPNDET_CHID_STAT (COMMON_OEID);
LOOP
FETCH GET_DEPNDET_CHID_STAT INTO GET_DEPNDET_CHID_STAT_R;
EXIT WHEN GET_DEPNDET_CHID_STAT%NOTFOUND;
IF GET_DEPNDET_CHID_STAT_R.SEIT_STAS_ABBREVIATION = 'INPROGRESS' THEN
OPEN GET_CHILD_TASK_ID (GET_DEPNDET_CHID_STAT_R.SEIT_SERO_ID);
FETCH GET_CHILD_TASK_ID INTO GET_CHILD_TASK_ID_R;
p_implementation_tasks.update_task_status_byid(GET_CHILD_TASK_ID_R.SEIT_SERO_ID,0, GET_CHILD_TASK_ID_R.SEIT_ID,'COMPLETED'); 
CLOSE GET_CHILD_TASK_ID;
END IF;
END LOOP;
CLOSE GET_DEPNDET_CHID_STAT; 
 
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );
     
EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );      
      
END FTTH_CLOSE_CHILD_LAST_TASK;
----Dinesh Perera  2015/10/02  -----

-- Jayan Liyanage 14/10/2015

PROCEDURE D_PREMI_MODIFY_EQUI_SET_ATT (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_accbear_sts    varchar2(100);
v_reloc_end       varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue into v_accbear_sts FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS BEARER STATUS' and soa.seoa_sero_id = p_sero_id;

select so.sero_sert_abbreviation  into v_service_type 
from service_orders so where so.sero_id = p_sero_id;
select so.sero_ordt_type  into v_service_order 
from service_orders so where so.sero_id = p_sero_id;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_accbear_sts  = 'TO BE MODIFIED'
THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID' 
And soa.seoa_sero_id = p_sero_id; 
/*ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-A ND';*/ END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-EQUIPMENT' AND  
  v_accbear_sts  = 'TO BE MODIFIED' THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION 
  WHEN OTHERS 
    THEN p_ret_msg :=
'Failed to Change D-Premium Modify-Equip Set  Attribute  function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_PREMI_MODIFY_EQUI_SET_ATT;

-- Jayan Liyanage 14/10/2015

-- Jayan Liyanage 13/10/2015

PROCEDURE D_DAB_MODI_EQP_WG (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_service_type   VARCHAR2 (100);
   v_ser_od_type    VARCHAR2 (100);
   v_ntu_class      VARCHAR2 (100);
   v_acc_medi       VARCHAR2 (100);
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation, so.sero_ordt_type
              INTO v_service_type, v_ser_od_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT soa.seoa_defaultvalue
              INTO v_ntu_class
              FROM service_order_attributes soa
             WHERE soa.seoa_name = 'NTU CLASS' AND soa.seoa_sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_acc_medi
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

   IF     v_service_type = 'D-DAB'
      AND v_ser_od_type = 'MODIFY-EQUIPMENT'
      AND v_ntu_class = 'SLT'
      AND v_acc_medi = 'COPPER'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ASSIGN NEW NTU';
   ELSIF     v_service_type = 'D-DAB'
         AND v_ser_od_type = 'MODIFY-EQUIPMENT'
         AND v_ntu_class = 'SLT'
         AND v_acc_medi = 'FIBER'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ASSIGN NEW NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ASSIGN NEW NTU';
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Workgroup Mapping Please check the ACCESS MEDIUM and NTU CLASS Attribue Values :  - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_DAB_MODI_EQP_WG;
-- Jayan Liyanage 13/10/2015

-- Jayan Liyanage 13/10/2015

PROCEDURE D_DAB_MODIFY_EQ_NOTIFY(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
BEGIN
     p_ret_char := 'Pls Eneter the New NTU Model...!' ;                                      
EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_DAB_MODIFY_EQ_NOTIFY;


-- Jayan Liyanage 13/10/2015

-- Jayan Liyanage 2015/10/16

PROCEDURE D_ACC_BEARER_STS_CHG (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )IS



v_net_aggri_1     VARCHAR2(100);
v_net_aggri_2     VARCHAR2(100);
v_service_type    VARCHAR2(100);
v_service_order   VARCHAR2(100);
v_acc_nw          VARCHAR2(100);

BEGIN


UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = 'INSERVICE'
WHERE  soa.seoa_name = 'ACCESS BEARER STATUS'
AND SOA.SEOA_SERO_ID IN (
SELECT DISTINCT S.SERO_ID
FROM service_orders S
WHERE S.SERO_ID = p_sero_id);


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Premium VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_ACC_BEARER_STS_CHG;

-- Jayan Liyanage 2012/10/16

--- Jayan Liyanage 2012/03/12 updated on 03/08/2015  --- 08/10/2015


PROCEDURE D_ETHERNET_VPN_MODIFY_EQUIP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class_cur        VARCHAR2 (100);
v_ntu_class_pre        VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_ntu_model_cur        VARCHAR2 (100);
v_ntu_model_pre        VARCHAR2 (100);
v_work_group_nw        VARCHAR2 (100);
v_acc_nw_intf          VARCHAR2 (100);
v_Cur_Vlan_Tag         VARCHAR2 (100);
v_Pre_Vlan_Tag         VARCHAR2 (100);
v_cpe_class_cur        VARCHAR2 (100);
v_cpe_class_pre        VARCHAR2 (100);
v_cpe_mod_cur          VARCHAR2 (100);
v_cpe_mod_pre          VARCHAR2 (100);



BEGIN


SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes, ar.area_code INTO v_rtom_code, v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';



SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name = v_rtom_code  || '-CPE-NC';

SELECT wg.worg_name
INTO v_work_group_nw
FROM work_groups wg
WHERE worg_name = v_rtom_code || '-ENG-NW';

SELECT wg.worg_name INTO v_work_group FROM work_groups wg 
WHERE worg_name = v_rtom_code || '-' || v_lea_code || '-OSP-NC';


SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_class_cur, v_ntu_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_model_cur, v_ntu_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';

SELECT soa.seoa_defaultvalue
INTO v_acc_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_acc_nw_intf
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue,SOA.SEOA_PREV_VALUE
INTO v_Cur_Vlan_Tag,v_Pre_Vlan_Tag
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE INTO v_cpe_class_cur, v_cpe_class_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE INTO v_cpe_mod_cur, v_cpe_mod_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';



IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) <> NVL(v_ntu_model_pre,0) and v_acc_medium = 'COPPER'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;

/*IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEA')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
END IF;*/

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UPDATE ACC. BEARER';
END IF;


-- Modification Start 30/09/2015



IF     v_service_type = 'D-ETHERNET VPN' AND
   v_service_order = 'MODIFY-EQUIPMENT' AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) <> NVL(v_ntu_model_pre,0)
 and v_acc_medium = 'FIBER'
THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY NTU FO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY NTU FO'; END IF;


IF     v_service_type = 'D-ETHERNET VPN' 
  AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) = NVL(v_ntu_model_pre,0)
 and v_acc_medium = 'COPPER'
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU'; END IF;


IF     v_service_type = 'D-ETHERNET VPN' 
  AND v_service_order = 'MODIFY-EQUIPMENT' AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) = NVL(v_ntu_model_pre,0) 
and v_acc_medium = 'FIBER'
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU FO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG NTU FO'; END IF;
 
IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  v_acc_nw_intf = 'MEN PORT' and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG MEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG MEN PORT'; END IF;
   
IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  v_acc_nw_intf = 'CEN PORT' and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG CEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG CEN PORT'; END IF;
 
 IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_acc_nw_intf = 'MSAN PORT' OR v_acc_nw_intf = 'DSLAM PORT') and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG SHDSL PORT'; END IF;
  
IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre = 'SLT') and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'MODIFY CPE'; END IF;
 
 IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre = 'SLT') and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'MODIFY CPE'; END IF;
 
  IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_cpe_class_cur = 'SLT' and NVL(v_cpe_mod_cur,0) = NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG CPE'; END IF;
 
   IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre <> 'SLT') --and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'INSTALL CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'INSTALL CPE'; END IF;
 
   IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND ( v_cpe_class_cur <> 'SLT' and  v_cpe_class_pre = 'SLT') --and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'COLLECT CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'COLLECT CPE'; END IF;





-- End 30/09/2015

p_implementation_tasks.update_task_status_byid (p_sero_id,
               0,
               p_seit_id,
               'COMPLETED'
              );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Modify - Equipment Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                  0,
                  p_seit_id,
                  'ERROR'
                 );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_MODIFY_EQUIP;

--- Jayan Liyanage 2012/03/20

--  Jayan Liyanage 08/10/2015 

PROCEDURE D_ETHER_MODIFY_EQUI_SET_ATT (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_accbear_sts    varchar2(100);
v_reloc_end       varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue into v_accbear_sts FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS BEARER STATUS' and soa.seoa_sero_id = p_sero_id;

select so.sero_sert_abbreviation  into v_service_type 
from service_orders so where so.sero_id = p_sero_id;
select so.sero_ordt_type  into v_service_order 
from service_orders so where so.sero_id = p_sero_id;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_accbear_sts  = 'TO BE MODIFIED'
THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID' 
And soa.seoa_sero_id = p_sero_id; END IF;
IF     v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-EQUIPMENT' AND  
  v_accbear_sts  = 'TO BE MODIFIED' THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION 
  WHEN OTHERS 
    THEN p_ret_msg :=
'Failed to Change D-EtherNet Modify-Equip Set  Attribute  function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_ETHER_MODIFY_EQUI_SET_ATT;
-- Jayan Liyanage 08/10/2015

-- Jayan Liyanage 2015/10/23
PROCEDURE D_BIL_MODIFY_EQUI_SET_ATT (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_accbear_sts    varchar2(100);
v_reloc_end       varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);

begin
  
SELECT distinct soa.seoa_defaultvalue into v_accbear_sts FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS BEARER STATUS' and soa.seoa_sero_id = p_sero_id;

select so.sero_sert_abbreviation  into v_service_type 
from service_orders so where so.sero_id = p_sero_id;
select so.sero_ordt_type  into v_service_order 
from service_orders so where so.sero_id = p_sero_id;

IF     v_service_type = 'D-BIL' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_accbear_sts  = 'TO BE MODIFIED'
THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID' 
And soa.seoa_sero_id = p_sero_id; 
/*ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-A ND';*/ END IF;
IF     v_service_type = 'D-BIL'  AND v_service_order = 'MODIFY-EQUIPMENT' AND  
  v_accbear_sts  = 'TO BE MODIFIED' THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION 
  WHEN OTHERS 
    THEN p_ret_msg :=
'Failed to Change D-BIL Modify-Equip Set  Attribute  function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_BIL_MODIFY_EQUI_SET_ATT;
-- Jayan Liyanage 2015/10/23

--ICT-- 28/10/205
PROCEDURE  ICT_SOLU_WGCH_FUNCTION (

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                      IN     Service_Orders.sero_id%TYPE,
      p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                      IN     work_order.woro_id%TYPE,
      p_ret_char                     OUT    VARCHAR2,
      p_ret_number                   OUT    NUMBER,
      p_ret_msg                      OUT    VARCHAR2) IS

v_solu_handel_by    VARCHAR2(100) := null;

                     CURSOR seoa_cur IS
                     SELECT SEOA_DEFAULTVALUE
                     FROM service_order_attributes
                     WHERE seoa_sero_id = p_sero_id
                     AND seoa_name = 'SOLUTION HANDLED BY';                     
                     
BEGIN
       p_ret_char := '';
       
       
                     OPEN seoa_cur;
                     FETCH seoa_cur INTO v_solu_handel_by;
                     CLOSE seoa_cur;
                     
                     IF v_solu_handel_by is null THEN
                     p_ret_char := 'CORP-SSU';
                     
                     ELSE
                     p_ret_char := v_solu_handel_by;
                     END IF;p_ret_msg := '';
                     EXCEPTION
                     WHEN OTHERS THEN
                     p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
                     END ICT_SOLU_WGCH_FUNCTION;                   
--ICT---  28/10/2015

--- Jayan Liyanage 2015/04/17
PROCEDURE  BTL_SOD_ATR_BK(
p_serv_id                      IN     Services.serv_id%TYPE,
p_sero_id                      IN     Service_Orders.sero_id%TYPE,
p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id                      IN     work_order.woro_id%TYPE,
p_ret_char                     OUT    VARCHAR2,
p_ret_number                   OUT    NUMBER,
p_ret_msg                      OUT    VARCHAR2) IS


begin
  
update service_order_attributes soa set soa.seoa_defaultvalue = ''
where soa.seoa_name = 'NEW NUMBER LEVEL (Y/N)?'  and soa.seoa_sero_id  = p_sero_id;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   

EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update attribute in Modify-Number Process Function, Please check the Condition' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);

END BTL_SOD_ATR_BK;
--- Jayan Liyanage  2015/04/17

--- Jayan  Liyanage 2014 / 09 / 17
PROCEDURE D_BTL_MODIFY_NUMBER_1 (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_ser_type   varchar2(100);
v_oder_type  varchar2(100);
v_new_num_level  varchar2(100);

BEGIN

select s.sero_sert_abbreviation,s.sero_ordt_type into v_ser_type,v_oder_type 
from service_orders s where s.sero_id = p_sero_id;

select distinct soa.seoa_defaultvalue into v_new_num_level from service_order_attributes soa 
where soa.seoa_name =  'NEW NUMBER LEVEL (Y/N)?' and soa.seoa_sero_id = p_sero_id;

IF    v_ser_type = 'D-BTL'AND v_oder_type = 'MODIFY-NUMBER'  AND v_new_num_level = 'YES' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TRF'
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'ACTIVATE ROUTES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE ROUTES'; END IF;  


p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-BTL Modify-Number SOD function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_BTL_MODIFY_NUMBER_1;
--- Jayan  Liyanage 2014 / 09 / 17

--- Jayan Liyanage 2015/04/17
PROCEDURE D_BTL_MODIFY_NUMBER (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )
IS 


v_cur_no_pstn# number;
v_pre_no_pstn#  Number;
v_sw_Code      varchar2(100);
v_ser_type     varchar2(100);
v_oder_type    varchar2(100);
v_sec_handle   varchar2(100);

Begin
  
select s.sero_sert_abbreviation,s.sero_ordt_type into v_ser_type,v_oder_type from service_orders s where s.sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue,soa.seoa_prev_value into v_cur_no_pstn#,v_pre_no_pstn# from service_order_attributes soa 
where soa.seoa_name =  'SA_NO_OF_PSTN NUMBERS' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sw_Code from service_order_attributes soa 
where soa.seoa_name =  'SW CODE' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_sec_handle from service_order_attributes soa 
where soa.seoa_name =  'SECTION HANDLED BY' and soa.seoa_sero_id = p_sero_id;

IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and NVL(v_cur_no_pstn#,'0') = NVL(v_pre_no_pstn#,'1') Then  
update service_implementation_tasks sit
set sit.seit_worg_name = 'CEN-SWPL' where sit.seit_taskname = 'MODIFY NUMBERS'and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'MODIFY NUMBERS'
and sit.seit_sero_id = p_sero_id; end if;
IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and NVL(v_cur_no_pstn#,'0') > NVL(v_pre_no_pstn#,'1') Then  
update service_implementation_tasks sit
set sit.seit_worg_name = 'CEN-SWPL' where sit.seit_taskname = 'RESERVE NUMBERS'and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'RESERVE NUMBERS'
and sit.seit_sero_id = p_sero_id;end if;

IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and NVL(v_cur_no_pstn#,'0') < NVL(v_pre_no_pstn#,'1') Then  
update service_implementation_tasks sit
set sit.seit_worg_name = 'CEN-SWPL' where sit.seit_taskname = 'REMOVE NUMBERS'and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'REMOVE NUMBERS'
and sit.seit_sero_id = p_sero_id;end if;

IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and (NVL(v_cur_no_pstn#,'0') > NVL(v_pre_no_pstn#,'1') or
NVL(v_cur_no_pstn#,'0') =  NVL(v_pre_no_pstn#,'1'))  Then  
update service_implementation_tasks sit
set sit.seit_worg_name = v_sec_handle||'-ACCM' where sit.seit_taskname = 'CONFIRM BTL NUMBERS'and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'CONFIRM BTL NUMBERS'
and sit.seit_sero_id = p_sero_id;end if;
IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and (v_sw_Code = 'S-SH' or v_sw_Code = 'S-SZ') and
  (NVL( v_cur_no_pstn#,'0') > NVL(v_pre_no_pstn#,'1') or  NVL( v_cur_no_pstn#,'0') = NVL(v_pre_no_pstn#,'1')) then
  update service_implementation_tasks sit
set sit.seit_worg_name = 'BSS-IMM-ENG' where sit.seit_taskname = 'UPDATE MEDIATION'and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'UPDATE MEDIATION'
and sit.seit_sero_id = p_sero_id; end if;
  
IF v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' and
   NVL( v_cur_no_pstn#,'0') > NVL(v_pre_no_pstn#,'1') then
update service_implementation_tasks sit
set sit.seit_worg_name = 'CEN-CSM' where sit.seit_taskname = 'NOTIFY TO CSM'
and sit.seit_sero_id = p_sero_id;
elsif v_ser_type = 'D-BTL' and v_oder_type = 'MODIFY-NUMBER' then
delete service_implementation_tasks sit where sit.seit_taskname = 'NOTIFY TO CSM'
and sit.seit_sero_id = p_sero_id; end if;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Change D-BTL Modify-Number Process function. Please check mapping condition :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg);
  
END D_BTL_MODIFY_NUMBER;
--- Jayan Liyanage 2015/04/17

----Dinesh Perera  2015/11/06  -----
PROCEDURE FTTH_CLOSE_CHILD_WAIT_FB (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

CURSOR GET_DEPNDET_PARENT_STAT (IN_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
SELECT SERO_ID,SERO_STAS_ABBREVIATION FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE IN_OEID||'%' AND SERO_SERT_ABBREVIATION = 'AB-FTTH' AND SERO_ID <> p_sero_id ;

CHLD_SERO SERVICE_ORDERS.SERO_ID%TYPE := p_sero_id;
COMMON_OEID SERVICE_ORDERS.SERO_OEID%TYPE;
GET_DEPNDET_CHID_STAT_R    GET_DEPNDET_PARENT_STAT%ROWTYPE;
PARENT_SEIT_STAT SERVICE_IMPLEMENTATION_TASKS.SEIT_STAS_ABBREVIATION%TYPE;
INCOMPLE_TASK_COUNT NUMBER := 0;

PARENT_SERO_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE;
PARENT_SEIT_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE;
PARENT_SO_TYPE SERVICE_ORDERS.SERO_ORDT_TYPE%TYPE;

BEGIN

SELECT SUBSTR(SERO_OEID,1,9) INTO COMMON_OEID FROM SERVICE_ORDERS WHERE SERO_ID = CHLD_SERO;

SELECT SERO_ORDT_TYPE INTO PARENT_SO_TYPE FROM SERVICE_ORDERS 
WHERE SERO_OEID LIKE COMMON_OEID||'%' AND SERO_SERT_ABBREVIATION = 'AB-FTTH';

   IF PARENT_SO_TYPE = 'CREATE' THEN

    OPEN GET_DEPNDET_PARENT_STAT (COMMON_OEID);

    FETCH GET_DEPNDET_PARENT_STAT INTO GET_DEPNDET_CHID_STAT_R;


    SELECT SEIT_STAS_ABBREVIATION INTO PARENT_SEIT_STAT 
    FROM SERVICE_IMPLEMENTATION_TASKS 
    WHERE SEIT_SERO_ID = GET_DEPNDET_CHID_STAT_R.SERO_ID
    AND SEIT_TASKNAME = 'WAIT COMPLETE CHILD';

        IF PARENT_SEIT_STAT <> 'COMPLETED' THEN 
        p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'INPROGRESS');
        ELSE
        p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'COMPLETED');
        END IF;

    CLOSE GET_DEPNDET_PARENT_STAT; 

   ELSIF PARENT_SO_TYPE != 'CREATE' THEN 

    p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'COMPLETED');
    
   ELSE 

    p_implementation_tasks.update_task_status_byid(p_sero_id,0,p_seit_id,'COMPLETED'); 

    END IF;

EXCEPTION
WHEN OTHERS THEN
 
-----p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

END FTTH_CLOSE_CHILD_WAIT_FB ;
----Dinesh Perera  2015/11/06  -----

---Indika de Silva 11/02/2015
PROCEDURE D_BIL__FOX_BEA_ATT_CP (

p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   service_orders so, 
           service_order_attributes soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR) IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue, 
                    c.cirt_status 
    FROM   service_orders so, 
           service_order_attributes soa, 
           circuits c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT Max (s.sero_id) 
                              FROM   service_orders s, 
                                     circuits ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname like replace(v_new_bearer_id,'(N)')||'%'); 
  v_so_attr_name     VARCHAR2 (100); 
  v_so_attr_val      VARCHAR2 (100); 
  v_bearer_id        VARCHAR2 (100); 
  v_cir_status       VARCHAR2 (100); 
  v_new_bearer_id    VARCHAR2 (100); 
  v_service_type     VARCHAR2 (100); 
  v_service_order    VARCHAR2 (100); 
  v_new_service_type VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    OPEN so_copyattr (v_bearer_id); 

    LOOP 
        FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 

        EXIT WHEN so_copyattr%NOTFOUND; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-FOX' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-FOX' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';                     
        END IF;                
        
    END LOOP; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-FOX' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 
   
      

    CLOSE so_copyattr; 

    CLOSE bearer; 

    p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 
'Failed to Change D_BIL__FOX_BEA_ATT_CP Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| To_char (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO service_task_comments 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg); 
END D_BIL__FOX_BEA_ATT_CP;
---Indika de Silva 11/02/2015

--update 10/29/2015 Kalana--

PROCEDURE PSTN_CREDIT_SUSPEND_RESUME_N2Y (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

CURSOR suspend_status_cur  IS
SELECT SOA.SEOA_DEFAULTVALUE 
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'CREDIT CONTROL SUSPEND STATUS';

v_suspend_status VARCHAR2(25);
v_order_type     VARCHAR2(25);


BEGIN

OPEN suspend_status_cur;
FETCH suspend_status_cur INTO v_suspend_status;
CLOSE suspend_status_cur;

select so.SERO_ORDT_TYPE
into v_order_type
from service_orders so
where so.SERO_ID = p_sero_id;



      IF v_suspend_status = 'OGB' and v_order_type = 'CREDIT-SUSPEND' THEN


        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-SUSPEND' THEN
      
      
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';
        
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'OGB' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL'; 
      
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';  
       
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';    
        

      END IF;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    p_ret_msg  := 'Failed to Set features Y.' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );

END PSTN_CREDIT_SUSPEND_RESUME_N2Y;

-- 29-09-2013 Samankula Owitipana
--update 10/29/2015 Kalana--

-- 29-09-2013 Samankula Owitipana
--update 10/29/2015 Kalana--
-- PSTN ICB OGB to Y

PROCEDURE PSTN_CREDIT_SUSPEND_RESUME_2N (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

CURSOR suspend_status_cur  IS
SELECT SOA.SEOA_DEFAULTVALUE 
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'CREDIT CONTROL SUSPEND STATUS';

v_suspend_status VARCHAR2(25);
v_order_type     VARCHAR2(25);


BEGIN

OPEN suspend_status_cur;
FETCH suspend_status_cur INTO v_suspend_status;
CLOSE suspend_status_cur;

select so.SERO_ORDT_TYPE
into v_order_type
from service_orders so
where so.SERO_ID = p_sero_id;



      IF v_suspend_status = 'OGB' and v_order_type = 'CREDIT-SUSPEND' THEN


        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-SUSPEND' THEN
      
      
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';
        
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'OGB' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL'; 
      
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';  
       
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';    
        

      END IF;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    p_ret_msg  := 'Failed to Set features Y.' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );

END PSTN_CREDIT_SUSPEND_RESUME_2N;

-- 29-09-2013 Samankula Owitipana
--update 10/29/2015 Kalana--


PROCEDURE PSTN_CREDIT_RESUME_N2Y (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

CURSOR suspend_status_cur  IS
SELECT SOA.SEOA_DEFAULTVALUE 
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'CREDIT CONTROL RESUME STATUS';

v_suspend_status VARCHAR2(25);
v_order_type     VARCHAR2(25);


BEGIN

OPEN suspend_status_cur;
FETCH suspend_status_cur INTO v_suspend_status;
CLOSE suspend_status_cur;

select so.SERO_ORDT_TYPE
into v_order_type
from service_orders so
where so.SERO_ID = p_sero_id;



      IF v_suspend_status = 'OGB' and v_order_type = 'CREDIT-SUSPEND' THEN


        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-SUSPEND' THEN
      
      
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';
        
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'Y'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'OGB' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL'; 
      
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';  
       
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'Y'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';    
        

      END IF;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    p_ret_msg  := 'Failed to Set features Y.' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );

END PSTN_CREDIT_RESUME_N2Y;

-- 29-09-2013 Samankula Owitipana
--update 10/29/2015 Kalana--

-- 29-09-2013 Samankula Owitipana
--update 10/29/2015 Kalana--
-- PSTN ICB OGB to Y

PROCEDURE PSTN_CREDIT_RESUME_2N (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

CURSOR suspend_status_cur  IS
SELECT SOA.SEOA_DEFAULTVALUE 
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'CREDIT CONTROL RESUME STATUS';

v_suspend_status VARCHAR2(25);
v_order_type     VARCHAR2(25);


BEGIN

OPEN suspend_status_cur;
FETCH suspend_status_cur INTO v_suspend_status;
CLOSE suspend_status_cur;

select so.SERO_ORDT_TYPE
into v_order_type
from service_orders so
where so.SERO_ID = p_sero_id;



      IF v_suspend_status = 'OGB' and v_order_type = 'CREDIT-SUSPEND' THEN


        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-SUSPEND' THEN
      
      
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';
        
        UPDATE SERVICE_ORDER_FEATURES sof
        SET sof.sofe_defaultvalue = 'N'
        WHERE sof.sofe_sero_id= p_sero_id
        AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';
        
      ELSIF  v_suspend_status = 'OGB' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL'; 
      
      ELSIF  v_suspend_status = 'TOS' and v_order_type = 'CREDIT-RESUME' THEN
      
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_OUTGOING_CALL';  
       
       UPDATE SERVICE_ORDER_FEATURES sof
       SET sof.SOFE_PREV_VALUE = 'N'
       WHERE sof.sofe_sero_id= p_sero_id
       AND sof.sofe_feature_name = 'SF_BAR_INCOMING_CALL';    
        

      END IF;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    p_ret_msg  := 'Failed to Set features Y.' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );

END PSTN_CREDIT_RESUME_2N;


-- Samitha Sagara 17112015
-- Dhanushka

PROCEDURE CREDIT_RESPONSE (
      p_serv_id        IN      services.serv_id%TYPE
    , p_sero_id        IN      service_orders.sero_id%TYPE
    , p_seit_id        IN      service_implementation_tasks.seit_id%TYPE
    , p_impt_taskname  IN      implementation_tasks.impt_taskname%TYPE
    , p_woro_id        IN      work_order.woro_id%TYPE
    , p_ret_char       OUT     VARCHAR2
    , p_ret_number     OUT     NUMBER
    , p_ret_msg        OUT     VARCHAR2
   ) is
   
  
   v_status   sop_reply_data.sord_value%TYPE;
   tempseit_id      service_implementation_tasks.seit_id%TYPE;
   
   

   CURSOR get_vstatus
   IS
      SELECT   sord_value
      FROM     sop_queue, sop_reply_data
      WHERE    sopq_seit_id = tempseit_id AND sopq_requestid = sord_sopq_requestid AND sord_value IS NOT NULL AND sord_name = 'CREDIT_CONTROL_RESPONSE'
      ORDER BY sord_id DESC;
      
BEGIN
  
  SELECT SIT1.SEIT_ID into tempseit_id  FROM SERVICE_IMPLEMENTATION_TASKS SIT1 ,SERVICE_IMPLEMENTATION_TASKS SIT2 
    WHERE SIT1.SEIT_SERO_ID = SIT2.SEIT_SERO_ID AND SIT1.SEIT_TASKNAME in('SOP PROV IMS','SOP PROVISION ZTE')
    AND SIT2.SEIT_ID = p_seit_id;


   OPEN get_vstatus;

   FETCH get_vstatus
   INTO  v_status;
   
   CLOSE get_vstatus;

   cprg.p_sm_util_lib.setserviceorderattribute (p_serviceorderid => p_sero_id, p_attribute_name => 'CREDIT_CONTROL_RESPONSE', p_attribute_value => v_status);

   p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');    
     
   p_ret_char := 'OK';
   p_ret_msg := NULL;     

EXCEPTION
WHEN OTHERS THEN

    p_ret_msg  := 'Failed to update the lte inventory. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITY',  SYSDATE
, p_ret_msg );

END CREDIT_RESPONSE;

-- Samitha Sagara 17112015
--  Dhanushka


----Dinesh Perera  2015/11/12  -----
PROCEDURE UPDATE_DNR_EMAIL_DATA (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

      v_sero_id       service_orders.SERO_ID%TYPE;
      v_cus_name      customer.CUSR_NAME%TYPE;
      v_acc_no        service_orders.SERO_ACCT_NUMBER%TYPE;
      v_cirt_name     circuits.CIRT_DISPLAYNAME%TYPE;
      v_cus_email     service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
      v_cus_contact   service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
      v_domain_name   service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
      v_renew_date    varchar2(200);
      v_issued_date   varchar2(200);
    
    CURSOR C_DATA IS
        SELECT 
        SERO_ID,
        CUSR_NAME,
        SERO_ACCT_NUMBER,
        CIRT_DISPLAYNAME,
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'CUSTOMER EMAIL ADDRESS'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'SA_TECHNICAL_CONTACT'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'DOMAIN_NAME'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'RENEWAL REMINDER DATE'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'ACTUAL_DSP_DATE')
        FROM SERVICE_ORDERS, CIRCUITS, CUSTOMER
        WHERE SERO_CIRT_NAME = CIRT_NAME
        AND SERO_CUSR_ABBREVIATION = CUSR_ABBREVIATION
        AND SERO_SERT_ABBREVIATION = 'I-DNR'
        AND SERO_ID = p_sero_id;


BEGIN

    OPEN C_DATA;
    FETCH C_DATA INTO v_sero_id,v_cus_name,v_acc_no,v_cirt_name,v_cus_email,v_cus_contact,v_domain_name,v_renew_date,v_issued_date; 
    CLOSE C_DATA; 

    INSERT INTO CLARITY_ADMIN.DNR_MAIL_LOG 
                (DNR_SO_ID,
                 DNR_CUSTOMER_NAME,
                 DNR_ACCOUNT_NO,
                 DNR_PRODUCT_LABLE,
                 DNR_CUS_EMAIL,
                 DNR_CUS_CONTACT,
                 DNR_DOMAIN_NAME,
                 DNR_RENEWAL_DATE,
                 DNR_ISSUED_DATE,
                 DNR_REMARKS) 
    VALUES      (v_sero_id, 
                 v_cus_name, 
                 v_acc_no,
                 v_cirt_name,
                 v_cus_email,
                 v_cus_contact,
                 v_domain_name,
                to_date(v_renew_date,'DD-MON-YY'),            
                TO_DATE(SUBSTR(trim(v_issued_date),1,11),'DD-MON-YYYY'),                
                 'INSERTED'); 

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END UPDATE_DNR_EMAIL_DATA ;
----Dinesh Perera  2015/11/12  -----

--- Jayan Liyanage 16/09/2015

PROCEDURE D_ENT_WIFI_WG_CHANGE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_service_type    varchar2(100);
v_service_order   varchar2(100);
v_cur_no_acc_po   varchar2(100);
v_pre_no_acc_po   varchar2(100);
v_Cur_no_sw#      varchar2(100);
v_Pre_no_sw#      varchar2(100);
v_exchange_area   varchar2(100);
v_rtom_code       varchar2(100);
v_lea_code        varchar2(100);
v_work_group_os   varchar2(100);

BEGIN
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue,soa.seoa_prev_value into v_cur_no_acc_po,v_pre_no_acc_po
from service_order_attributes soa where soa.seoa_name = 'NO OF ACCESS POINTS' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue,soa.seoa_prev_value into v_Cur_no_sw#,v_Pre_no_sw#
from service_order_attributes soa where soa.seoa_name = 'NO OF SWITCHES' and soa.seoa_sero_id = p_sero_id;
select distinct soa.seoa_defaultvalue into v_exchange_area
from service_order_attributes soa where soa.seoa_name = 'EXCHANGE_AREA_CODE' and soa.seoa_sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_exchange_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_os FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';   

IF v_service_type = 'D-ENT WIFI' and v_service_order = 'MODIFY-PACKAGE' and ( NVL(v_cur_no_acc_po,'1') > NVL(v_pre_no_acc_po,'1')) or
  ( NVL(v_Cur_no_sw#,'1') > NVL(v_Pre_no_sw#,'1'))Then
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'WIFI-PROJECT' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INSTALL APS/SWITCHES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INSTALL APS/SWITCHES'; END IF;

IF v_service_type = 'D-ENT WIFI' and v_service_order = 'MODIFY-PACKAGE' and ( NVL(v_cur_no_acc_po,'1') < NVL(v_pre_no_acc_po,'1')) or
  ( NVL(v_Cur_no_sw#,'1') < NVL(v_Pre_no_sw#,'1'))Then
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'COLLECT APS/SWITCHES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'COLLECT APS/SWITCHES'; END IF;

IF v_service_type = 'D-ENT WIFI' and v_service_order = 'MODIFY-CPE' and ( NVL(v_cur_no_acc_po,'1') > NVL(v_pre_no_acc_po,'1')) or
  ( NVL(v_Cur_no_sw#,'1') > NVL(v_Pre_no_sw#,'1')) Then
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'WIFI-PROJECT' 
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'INSTALL APS/SWITCHES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INSTALL APS/SWITCHES'; END IF;

IF v_service_type = 'D-ENT WIFI' and v_service_order = 'MODIFY-CPE' and ( NVL(v_cur_no_acc_po,'1') < NVL(v_pre_no_acc_po,'1')) or
  ( NVL(v_Cur_no_sw#,'1') < NVL(v_Pre_no_sw#,'1')) Then
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_os
WHERE sit.seit_sero_id =  p_sero_id
AND sit.seit_taskname = 'COLLECT APS/SWITCHES'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'COLLECT APS/SWITCHES'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION WHEN 
  OTHERS THEN 
  p_ret_msg := 'Failed to Change D-ENT WIFI '||' '||v_service_order ||' ' ||'function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| 

SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, 

setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
END D_ENT_WIFI_WG_CHANGE;


--- Jayan Liyanage 16/09/2015

--- 26-11-2015  SUPPORT TEAM

PROCEDURE TASK_DELAY_FIVE_SECONDS ( 
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


 DELAY_SECOND NUMBER := 5;


BEGIN

 DBMS_LOCK.SLEEP (DELAY_SECOND);


 P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID(p_sero_id,0, p_seit_id,'COMPLETED');

END;

--- 26-11-2015  SUPPORT TEAM
--- 26-11-2015  SUPPORT TEAM
PROCEDURE TASK_DELAY_FIVE_MINUTE ( 
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


 DELAY_SECOND NUMBER := 120;


BEGIN

 DBMS_LOCK.SLEEP (DELAY_SECOND);


 P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID(p_sero_id,0, p_seit_id,'COMPLETED');

END;
--- 26-11-2015  SUPPORT TEAM

--- 26-11-2015  SUPPORT TEAM
PROCEDURE TEST_HCV_CIRT_UPDATE ( 
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR GET_PORT ( IN_CIRT_NAME VARCHAR2 ) IS
SELECT
POLP_PORT_ID,POLP_PORL_ID
FROM 
CIRCUITS,
PORT_LINKS,
PORT_LINK_PORTS,
PORTS,
EQUIPMENT,
CARDS
WHERE 
CIRT_NAME = IN_CIRT_NAME
AND PORL_CIRT_NAME = CIRT_NAME
AND PORL_ID = POLP_PORL_ID
AND POLP_PORT_ID = PORT_ID
AND PORT_EQUP_ID = EQUP_ID
AND PORT_CARD_SLOT = CARD_SLOT
AND CARD_EQUP_ID = EQUP_ID
AND EQUP_EQUT_ABBREVIATION LIKE '%MSAN%';

TEMP_DISPLAY_NAME VARCHAR2(500) := '0332220511';

TEMP_CIRT_NAME VARCHAR2(500); 

GET_PORT_R GET_PORT%ROWTYPE;

BEGIN

SELECT CIRT_NAME INTO TEMP_CIRT_NAME FROM CIRCUITS WHERE CIRT_DISPLAYNAME = TEMP_DISPLAY_NAME ;

OPEN GET_PORT (TEMP_CIRT_NAME);
FETCH GET_PORT INTO GET_PORT_R;
CLOSE GET_PORT;

DELETE PORT_LINK_PORTS WHERE POLP_PORL_ID = GET_PORT_R.POLP_PORL_ID;

UPDATE CIRCUITS SET CIRT_STATUS = 'CANCELLED' WHERE CIRT_NAME = TEMP_CIRT_NAME;

P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID(p_sero_id,0, p_seit_id,'COMPLETED');

END;
--- 26-11-2015  SUPPORT TEAM

--- 30-12-2015  Dhanushka
PROCEDURE PROCESS_UPDATE_MANS_NAME (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2) IS
      
            
        PSTN_NO               SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
      V_NUMB_ID         NUMBERS.NUMB_ID%TYPE;
      V_SERO_ATTR       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE; 
      V_MANS_NAME       SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
      
      CURSOR NUMB_ID  IS
    SELECT  NUMB_ID
    FROM    NUMBERS NU
    WHERE      NU.NUMB_NUCC_CODE = SUBSTR(PSTN_NO,0,3)
    AND NU.NUMB_NUMBER = SUBSTR(PSTN_NO,4,8);
      


    CURSOR C_NO_MANS_NAME (T_NUMB_ID NUMBERS.NUMB_ID%TYPE) IS
        SELECT  NIDE_VALUE
        FROM    NUMBER_INSTANCE_DETAILS
        WHERE   NIDE_NUMB_ID=T_NUMB_ID
        AND     NIDE_NAME='MANS_NAME';

BEGIN

SELECT soa.SEOA_DEFAULTVALUE INTO PSTN_NO
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE  soa.SEOA_NAME  = 'SA_PSTN_NUMBER'
AND soa.SEOA_SERO_ID = p_sero_id;

    OPEN NUMB_ID;
    FETCH NUMB_ID INTO V_NUMB_ID;
    CLOSE NUMB_ID;

    
    OPEN C_NO_MANS_NAME(V_NUMB_ID);
    FETCH C_NO_MANS_NAME INTO V_MANS_NAME;
    CLOSE C_NO_MANS_NAME;



    IF V_MANS_NAME IS NOT NULL THEN
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_MANS_NAME
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    ELSE
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = 'NA'
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'MANS_NAME';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    
    END IF;
    

EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'UPDATE SW ATTR PROCESS FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

       p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);


END PROCESS_UPDATE_MANS_NAME;        
--- 30-12-2015  Dhanushka

---- Dinesh Perera 15-12-2015 ---- 
PROCEDURE ADSL_BEARER_NAME_MODIFY (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 
      
CURSOR GET_ADSL_CIRT ( IN_SERO_ID IN VARCHAR2 ) IS
SELECT 
SERO_CIRT_NAME,
CIRT_DISPLAYNAME 
FROM 
SERVICE_ORDERS,
CIRCUITS
WHERE 
    SERO_CIRT_NAME = CIRT_NAME
AND SERO_ID = IN_SERO_ID;

CURSOR GET_BEARER ( IN_ADSL_CIRT_ID IN VARCHAR2 ) IS
SELECT 
CIRT_NAME,
CIRT_DISPLAYNAME
FROM 
CIRCUIT_HIERARCHY,
CIRCUITS
WHERE 
    CIRH_PARENT = CIRT_NAME
AND CIRH_CHILD = IN_ADSL_CIRT_ID
AND CIRT_TYPE = 'BEARER';

CURSOR GET_PSTN_DSP_NAME  ( INN_SERO_ID IN VARCHAR2 ) IS
SELECT TRIM(SOA.SEOA_DEFAULTVALUE) AS SA_PSTN
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = INN_SERO_ID
AND SOA.SEOA_NAME = 'SA_PSTN_NUMBER';

GET_ADSL_CIRT_R     GET_ADSL_CIRT%ROWTYPE; 
GET_BEARER_R        GET_BEARER%ROWTYPE;
GET_PSTN_DSP_NAME_R GET_PSTN_DSP_NAME%ROWTYPE;
BEARER_DSP_NAME_LAST_TEN_D VARCHAR2(100);
NEW_BEARER_DSP_NAME VARCHAR2(500);
 
BEGIN

-- GET RELATED ADSL CIRCUIT
OPEN GET_ADSL_CIRT (p_sero_id);
FETCH GET_ADSL_CIRT INTO GET_ADSL_CIRT_R ;
CLOSE GET_ADSL_CIRT;
-- CHECK FOR BEARER
OPEN GET_BEARER (GET_ADSL_CIRT_R.SERO_CIRT_NAME);
FETCH GET_BEARER INTO GET_BEARER_R;
CLOSE GET_BEARER;
-- GET RELATED PSTN CIRCUIT
OPEN GET_PSTN_DSP_NAME (p_sero_id);
FETCH GET_PSTN_DSP_NAME INTO GET_PSTN_DSP_NAME_R;
CLOSE GET_PSTN_DSP_NAME;
-- CHECK THAT THIS IS A FULLY REARRANGED SCENARIO
    IF GET_ADSL_CIRT_R.SERO_CIRT_NAME IS NOT NULL AND GET_BEARER_R.CIRT_NAME IS NOT NULL AND GET_PSTN_DSP_NAME_R.SA_PSTN IS NOT NULL THEN
     -- GET BEARER DISPLAY NAME LAST TEN DIGIT
     BEARER_DSP_NAME_LAST_TEN_D := SUBSTR(GET_BEARER_R.CIRT_DISPLAYNAME,-10,10);
     -- CHECK BEARER DISPLAY NAME LAST TEN DIGIT AND PSTN DISPLAY NAME ARE EQUAL 
     IF BEARER_DSP_NAME_LAST_TEN_D = GET_PSTN_DSP_NAME_R.SA_PSTN THEN
      -- POPULATE NEW BEARER DISPLAY NAME
      NEW_BEARER_DSP_NAME :=  REPLACE(GET_BEARER_R.CIRT_DISPLAYNAME, SUBSTR(GET_BEARER_R.CIRT_DISPLAYNAME,-15,15),'ADSL '||REPLACE(GET_ADSL_CIRT_R.CIRT_DISPLAYNAME,'(N)',''));
      -- UPDATE BEARER DISPLAY NMAE
      UPDATE CIRCUITS SET CIRT_DISPLAYNAME = NEW_BEARER_DSP_NAME WHERE CIRT_NAME = GET_BEARER_R.CIRT_NAME;
     
     END IF;

    END IF;
    
    P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID(p_sero_id,0, p_seit_id,'COMPLETED');
    
EXCEPTION
WHEN OTHERS THEN

    p_ret_msg  := 'ADSL CREATE BEARER RENAME FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
    
    P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID(p_sero_id,0, p_seit_id,'ERROR');
    
END ADSL_BEARER_NAME_MODIFY;
---- Dinesh Perera 15-12-2015 ----   

---- Dinesh Perera 05-01-2016 ----
PROCEDURE SOP_PROVISION_STATUS (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
   
   v_seit_id        Service_Implementation_Tasks.seit_id%TYPE;
   l_sopq_status    VARCHAR2(200);
   
   TEMP_MAX_VALUE NUMBER;
   
  CURSOR GET_MAX_VALUE IS 
  SELECT MAX(SEIT_ID)
  FROM  SERVICE_IMPLEMENTATION_TASKS
  WHERE SEIT_SERO_ID = (SELECT SEIT_SERO_ID FROM SERVICE_IMPLEMENTATION_TASKS WHERE seit_id = p_seit_id)
  AND   SEIT_TASKNAME IN ('QUERY DSLAM VLAN ID','QUERY VLAN ID','SOP_PROVISION_ZTE','SOP PROVISION ZTE','SOP PROV IMS');
  
   CURSOR c_status ( IN_MAX_VALUE NUMBER) IS
   SELECT SORD_VALUE
   FROM  service_implementation_tasks,
         sop_queue,
         sop_reply_data
   WHERE seit_id = IN_MAX_VALUE
   AND sopq_seit_id = seit_id 
   AND sord_name = 'completion_code'
   AND sopq_sopc_command IN ('ADSL_ZTE_CREATE_USERID','IPTV_ZTE_CREATE_USERID','ADSL_ZTE_CONFIGURE_PROFILE',
                                    'ADSL_ZTE_CONFIGURE_PROFILE','IPTV_ZTE_CONF_DELETE_USERID','ADSL_ZTE_CONF_DELETE_USERID',
                                    'IPTV_ZTE_BIND_SET_MAX_PROGRAM','ADSL_ZTE_BIND_SVLAN','IMS_USER_MOD_ATS',
                                    'ZTE_SS_MODIFY_SUB_ATTR_ENTAG','ZTE_SS_MODIFY_SUB_ATTR_RMODEL','ZTE_SS_CREDIT_OGB',
                                    'ZTE_SS_CREDIT_OGBR','ZTE_SS_CREDIT_TOS','ZTE_SS_CREDIT_TOSR')
   AND sord_sopq_requestid = sopq_requestid;   
  
  BEGIN
  
   OPEN GET_MAX_VALUE;
   FETCH GET_MAX_VALUE INTO TEMP_MAX_VALUE;
   CLOSE GET_MAX_VALUE;
   
   OPEN c_status(TEMP_MAX_VALUE);
   FETCH c_status  INTO l_sopq_status;
   CLOSE c_status;
   
      UPDATE SERVICE_ORDER_ATTRIBUTES SOA
      SET SOA.SEOA_DEFAULTVALUE = l_sopq_status
      WHERE SOA.SEOA_SERO_ID = p_sero_id
      AND SOA.SEOA_NAME = 'CREDIT_CONTROL_RESPONSE';
      
   p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id,'COMPLETED');
    p_ret_msg := '';
   
      EXCEPTION
      WHEN OTHERS
      THEN
        UPDATE SERVICE_ORDER_ATTRIBUTES SOA
        SET SOA.SEOA_DEFAULTVALUE = 'NA'
        WHERE SOA.SEOA_SERO_ID = p_sero_id
        AND SOA.SEOA_NAME = 'CREDIT_CONTROL_RESPONSE';
        
   p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id,'COMPLETED');
    p_ret_msg := '';
  
  END SOP_PROVISION_STATUS;
---- Dinesh Perera 05-01-2016 ----

---- Ruwan Ranasinghe 07-01-2016 ----
PROCEDURE FUNCTION_HOLD_BY_FORCE (
p_serv_id            IN     Services.serv_id%TYPE,
p_sero_id            IN     Service_Orders.sero_id%TYPE,
p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id            IN     work_order.woro_id%TYPE,
p_ret_char              OUT VARCHAR2,
p_ret_number            OUT NUMBER,
p_ret_msg               OUT VARCHAR2)   IS

DELAY_SECONDS NUMBER := 4;

BEGIN

    dbms_lock.sleep(DELAY_SECONDS);

    p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id,'COMPLETED');
    p_ret_msg := '';
    
    exception
    when others then
    p_ret_msg  := 'error_1 is:' || to_char(sqlcode) ||'-'|| sqlerrm;

END FUNCTION_HOLD_BY_FORCE;
---- Ruwan Ranasinghe 07-01-2016 ----

---Jayan Liyanage 2015 / 05 / 20
PROCEDURE EDL_WO_ACTIVITY_CWG (
   P_SERV_ID         IN       SERVICES.SERV_ID%TYPE,
   P_SERO_ID         IN       SERVICE_ORDERS.SERO_ID%TYPE,
   P_SEIT_ID         IN       SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
   P_IMPT_TASKNAME   IN       IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
   P_WORO_ID         IN       WORK_ORDER.WORO_ID%TYPE,
   P_RET_CHAR        OUT      VARCHAR2,
   P_RET_NUMBER      OUT      NUMBER,
   P_RET_MSG         OUT      VARCHAR2
)
IS


    CURSOR C_SO_NO IS 
    SELECT SEIT_SERO_ID,SEIT_ID
    FROM SERVICE_IMPLEMENTATION_TASKS
    WHERE SEIT_ID = P_SEIT_ID;
     
    CURSOR C_WO_WG (T_sero_id SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE,
    T_SEIT_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%type)IS 
    SELECT WORO_WORG_NAME,WORO_ID
    FROM WORK_ORDER
    WHERE WORO_SERO_ID=T_sero_id
    and WORO_SEIT_ID=T_SEIT_ID;

    V_WORK_ORDER_WG   WORK_ORDER.WORO_WORG_NAME%TYPE;
    V_SEIT_ID         SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE;
    V_SEIT_SERO_ID     SERVICE_ORDERS.SERO_ID%TYPE;
    V_WORO_ID          WORK_ORDER.WORO_ID%TYPE;

BEGIN

OPEN C_SO_NO;
FETCH C_SO_NO INTO V_SEIT_SERO_ID,V_SEIT_ID;
CLOSE  C_SO_NO;
        BEGIN 

            P_DYNAMIC_PROCEDURE.PROCESS_ISSUE_WORK_ORDER (
             P_SERV_ID         ,
             P_SERO_ID         ,
             P_SEIT_ID         ,
             P_IMPT_TASKNAME   ,
             P_WORO_ID         ,
             P_RET_CHAR        ,
             P_RET_NUMBER      ,
             P_RET_MSG         );    
        END ;


OPEN C_WO_WG (V_SEIT_SERO_ID,V_SEIT_ID);

FETCH C_WO_WG INTO V_WORK_ORDER_WG,V_WORO_ID;

CLOSE C_WO_WG ;
    


BEGIN

   UPDATE WORK_ORDER_ACTIVITIES WOA
      SET WOA.WOOA_WORG_NAME = V_WORK_ORDER_WG
    WHERE WOOA_ACTIVITYNAME = 'INSTALL NTU-A END' AND WOOA_WORO_ID = V_WORO_ID;
    
       UPDATE WORK_ORDER_ACTIVITIES WOA
      SET WOA.WOOA_WORG_NAME = V_WORK_ORDER_WG
    WHERE WOOA_ACTIVITYNAME = 'INSTALL NTU-B END' AND WOOA_WORO_ID = V_WORO_ID;
    
    commit; 
END ;                                      
EXCEPTION
   WHEN OTHERS
   THEN
      P_RET_MSG :=
            'Failed to Change CH_WO_ACTIVITY_WG. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      P_IMPLEMENTATION_TASKS.UPDATE_TASK_STATUS_BYID (P_SERO_ID,
                                                      0,
                                                      P_SEIT_ID,
                                                      'ERROR'
                                                     );

      INSERT INTO SERVICE_TASK_COMMENTS
                  (SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
                   SETC_TEXT
                  )
           VALUES (P_SEIT_ID, SETC_ID_SEQ.NEXTVAL, 'CLARITYB', SYSDATE,
                   P_RET_MSG
                  );
END EDL_WO_ACTIVITY_CWG;

--- Jayan Liyanage 2015 / 05 / 20

--- Jayan Liyanage 2015 / 05 / 20

PROCEDURE D_EDL_MODIFY_LOCATION (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2)
   IS  

   
v_service_type                      varchar2(100);
v_service_order                     varchar2(100);
v_reloc_id                             varchar2(100);
v_acc_link_ty_a                     varchar2(100);
v_acc_link_ty_b                      varchar2(100);
v_acc_med_a                         varchar2(100);
v_acc_med_b                         varchar2(100);
v_service_order_area_a          varchar2(100);
v_rtom_code_aa                      varchar2(100);
v_lea_code_aa                       varchar2(100);
v_work_group_a_os               varchar2(100);
v_work_group_a_nw               varchar2(100);

v_service_order_area_b           varchar2(100);
v_rtom_code_bb                  varchar2(100);
v_lea_code_bb                    varchar2(100);
v_work_group_b_os             varchar2(100);
v_work_group_b_nw             varchar2(100);
v_acc_fib_avil_a                 varchar2(100);
v_acc_fib_avil_b              varchar2(100);
v_ac_nw_inter_a               varchar2(100);
v_ac_nw_inter_b               varchar2(100);
v_acc_node_chg_a              varchar2(100);
v_acc_node_chg_b              varchar2(100);
v_acc_bearer_st_a             varchar2(100);
v_acc_bearer_st_b             varchar2(100);
V_ntu_Class_a                 varchar2(100);
V_ntu_Class_b                 varchar2(100);
v_cpe_mod_Cur_a               varchar2(100);
v_cpe_mod_Pre_a               varchar2(100);
v_cpe_mod_Cur_b               varchar2(100);
v_cpe_mod_Pre_b               varchar2(100);
v_acc_id_A                    varchar2(100);
v_acc_id_B                    varchar2(100);
v_new_Cir_Name                varchar2(100);
v_a_cir_name                  varchar2(100);
v_a_cir_status                varchar2(100);
v_b_cir_name                  varchar2(100);
v_b_cir_status                varchar2(100);
v_ac_nw_inter_a_pre         varchar2(100);
v_agg_nw_a                  varchar2(100);
v_agg_nw_b                  varchar2(100);
v_ac_nw_inter_b_pre     varchar2(100);
v_mig_end                   varchar2(100);
v_cpe_cls_a                 varchar2(100);
v_cpe_cls_b                varchar2(100);   
v_cpe_chg_a                 varchar2(100);   
v_cpe_chg_b                 varchar2(100);       
v_sec_handle                varchar2(100);   
v_mig_type_a                varchar2(100);   
v_mig_type_b                varchar2(100);  

CURSOR cur_tributer (parent_name VARCHAR2,order_Cir  VARCHAR2)IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%' OR ci.cirt_status NOT LIKE 'PENDING%' )
AND ci.CIRT_DISPLAYNAME <> order_Cir AND c.cirt_displayname = replace(parent_name,'(N)');
CURSOR cur_tributer_(parent_name_b VARCHAR2,order_Cir_b  VARCHAR2)IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%' OR ci.cirt_status NOT LIKE 'PENDING%' )
AND ci.CIRT_DISPLAYNAME <> order_Cir_b AND c.cirt_displayname = replace(parent_name_b,'(N)');


Begin
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so
WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so 
WHERE so.sero_id = p_sero_id;


SELECT DISTINCT SOA.SEOA_DEFAULTVALUE INTO v_reloc_id FROM SERVICE_ORDER_ATTRIBUTES SOA 
WHERE SOA.SEOA_NAME = 'RELOCATED END' AND SOA.SEOA_SERO_ID = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_med_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_med_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-B END';
SELECT soa.seoa_defaultvalue INTO v_service_order_area_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE AREA CODE-A END';
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_aa,v_lea_code_aa FROM areas ar WHERE ar.area_code = v_service_order_area_a AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_a_os FROM work_groups wg 
WHERE worg_name = v_rtom_code_aa || '-' || v_lea_code_aa || '-OSP-NC';               
SELECT wg.worg_name INTO v_work_group_a_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code_aa || '-' || 'ENG-NW';
SELECT soa.seoa_defaultvalue INTO v_service_order_area_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code_bb,v_lea_code_bb FROM areas ar WHERE ar.area_code = v_service_order_area_b AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group_b_os FROM work_groups wg 
WHERE worg_name = v_rtom_code_bb || '-' || v_lea_code_bb || '-OSP-NC';              
SELECT wg.worg_name INTO v_work_group_b_nw FROM work_groups wg 
WHERE worg_name = v_rtom_code_bb || '-' || 'ENG-NW';

SELECT soa.seoa_defaultvalue INTO v_acc_fib_avil_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_fib_avil_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?-B END';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_ac_nw_inter_a,v_ac_nw_inter_a_pre FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-A END';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_ac_nw_inter_b,v_ac_nw_inter_b_pre FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_node_chg_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_node_chg_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_bearer_st_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. BEARER STATUS-A END';
SELECT soa.seoa_defaultvalue INTO v_acc_bearer_st_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACC. BEARER STATUS-B END';
SELECT soa.seoa_defaultvalue INTO v_agg_nw_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGG. NETWORK-A END';
SELECT soa.seoa_defaultvalue INTO v_agg_nw_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGG. NETWORK-B END';
SELECT soa.seoa_defaultvalue INTO v_mig_end FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATED END';

SELECT soa.seoa_defaultvalue INTO v_mig_end FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATED END';
SELECT soa.seoa_defaultvalue INTO v_cpe_cls_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-A END';
SELECT soa.seoa_defaultvalue INTO v_cpe_cls_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-B END';
SELECT soa.seoa_defaultvalue INTO v_cpe_chg_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-A END';
SELECT soa.seoa_defaultvalue INTO v_cpe_chg_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?-B END';
SELECT soa.seoa_defaultvalue INTO v_sec_handle FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';

/*SELECT soa.seoa_defaultvalue INTO v_sec_handle FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATED TYPE';*/

SELECT soa.seoa_defaultvalue INTO v_mig_type_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-A END';
SELECT soa.seoa_defaultvalue INTO v_mig_type_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END';
SELECT soa.seoa_defaultvalue INTO v_acc_link_ty_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END';


SELECT soa.seoa_defaultvalue INTO V_ntu_Class_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-A END';
SELECT soa.seoa_defaultvalue INTO V_ntu_Class_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-B END';
SELECT soa.seoa_defaultvalue INTO V_ntu_Class_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-B END';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_cpe_mod_Cur_a,v_cpe_mod_Pre_a FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-A END';
SELECT soa.seoa_defaultvalue,soa.Seoa_Prev_Value INTO v_cpe_mod_Cur_b,v_cpe_mod_pre_b FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-B END';
select soa.seoa_defaultvalue into v_acc_id_A  from service_order_attributes soa 
where soa.seoa_name = 'ACCESS_ID-A END'and soa.seoa_sero_id = p_sero_id;
select soa.seoa_defaultvalue into v_acc_id_B from service_order_attributes soa 
where soa.seoa_name = 'ACCESS_ID-A END'and soa.seoa_sero_id = p_sero_id;
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c 
where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;


IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_reloc_id = 'B-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'IDENTIFY FACILITY-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'IDENTIFY FACILITY-B'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_reloc_id = 'A-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'IDENTIFY FACILITY-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'IDENTIFY FACILITY-A'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_a = 'DEDICATED LINE'  and v_acc_med_a = 'FIBER' and v_reloc_id = 'A-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESV ACC.FIBER-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESV ACC.FIBER-A END'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_b = 'DEDICATED LINE'  and v_acc_med_b = 'FIBER' and v_reloc_id = 'B-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESV ACC.FIBER-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESV ACC.FIBER-B END'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_a = 'DEDICATED LINE'  and v_acc_med_a = 'FIBER' and v_reloc_id = 'A-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE ACC FIBER-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE ACC FIBER-A'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_b = 'DEDICATED LINE'  and v_acc_med_b = 'FIBER' and v_reloc_id = 'B-END' and 
   (v_acc_fib_avil_b = 'NO'or v_acc_fib_avil_b = 'INCOMPLETE') THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE ACC FIBER-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE ACC FIBER-B'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_b = 'DEDICATED LINE'  and v_acc_med_b = 'FIBER' and v_reloc_id = 'B-END' and 
   (v_acc_fib_avil_b = 'NO'or v_acc_fib_avil_b = 'INCOMPLETE') THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'START FIBER LAYING-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING-B'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION'
   and v_acc_link_ty_a = 'DEDICATED LINE'  and v_acc_med_a = 'FIBER' and v_reloc_id = 'A-END' and 
   (v_acc_fib_avil_a = 'NO'or v_acc_fib_avil_a = 'INCOMPLETE') THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'START FIBER LAYING-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'START FIBER LAYING-A'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION' and
   v_ac_nw_inter_a = 'MLLN PORT' and v_acc_node_chg_a = 'YES' and  v_reloc_id = 'A-END' THEN     ---&&&&&&&&&&&&&&&&&&
   
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MLLN PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MLLN PORT-A'; END IF;

IF v_service_type =  'D-EDL' and v_service_order = 'MODIFY-LOCATION' and
   v_ac_nw_inter_b = 'MLLN PORT' and v_acc_node_chg_b = 'YES' and  v_reloc_id = 'B-END' THEN
   
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MLLN PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MLLN PORT-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and
  ( (v_ac_nw_inter_b = 'SDH PORT' and v_acc_link_ty_b = 'DAB') OR 
    (v_ac_nw_inter_a = 'SDH PORT' and v_acc_link_ty_a = 'DAB') ) then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE TX PATH'; END IF;

/*IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'MEN PORT' and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END'

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'OPR-NETMGT-TX'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RESERVE TX PATH'; END IF;
*/
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'MEN PORT' and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN PORT-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT-A ND'; END IF; 
 -- CONFIG MEN PORT-B ND

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'MEN PORT' and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN PORT-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT-B ND'; END IF; 


IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_b = 'MEN PORT' and
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFG MEN SUB PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFG MEN SUB PORT-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'CEN PORT' and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN PORT-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT-A ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_b = 'CEN PORT' and
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN PORT-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT-B ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'MEN PORT' and
  v_acc_bearer_st_a = 'INSERVICE' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFG MEN SUB PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFG MEN SUB PORT-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_b = 'MEN PORT' and
  v_acc_bearer_st_b = 'INSERVICE' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFG MEN SUB PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFG MEN SUB PORT-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'CEN PORT' and
  v_acc_bearer_st_a = 'INSERVICE' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFG CEN SUB PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFG CEN SUB PORT-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_ac_nw_inter_a = 'CEN PORT' and
  v_acc_bearer_st_b = 'INSERVICE' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFG CEN SUB PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFG CEN SUB PORT-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'MSAN PORT' OR 
  v_ac_nw_inter_a = 'DSLAM PORT' ) and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_b = 'MSAN PORT' OR 
  v_ac_nw_inter_b = 'DSLAM PORT' ) and
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'MSAN PORT' OR 
  v_ac_nw_inter_a = 'DSLAM PORT' ) and
  v_acc_bearer_st_a = 'INSERVICE' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. TRIB. PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. TRIB. PORT-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_b = 'MSAN PORT' OR 
  v_ac_nw_inter_b = 'DSLAM PORT' ) and
  v_acc_bearer_st_b = 'INSERVICE' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. TRIB. PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. TRIB. PORT-B'; END IF;

/*IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'MSAN PORT' OR 
  v_ac_nw_inter_a = 'DSLAM PORT' ) and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END'
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-A'; END IF;


IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_b = 'MSAN PORT' OR 
  v_ac_nw_inter_b = 'DSLAM PORT' ) and
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'A-END'
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV. SHDSL PORT-B'; END IF;
*/

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'MSAN PORT' OR 
  v_ac_nw_inter_a = 'DSLAM PORT' ) and
  v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV.TX PORT-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV.TX PORT-A END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_b = 'SDH PORT' OR 
  v_ac_nw_inter_b = 'DSLAM PORT' ) and
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIV.TX PORT-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIV.TX PORT-B END'; END IF;


IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_a = 'FIBER' and
 ( v_acc_fib_avil_a = 'NO' or v_acc_fib_avil_a = 'INCOMPLETE')  and v_acc_bearer_st_a = 'COMMISSIONED' and 
 v_reloc_id = 'A-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER-A END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_b = 'FIBER' and
 ( v_acc_fib_avil_b = 'NO' or v_acc_fib_avil_b = 'INCOMPLETE')  and v_acc_bearer_st_b = 'COMMISSIONED' and 
 v_reloc_id = 'B-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER-B END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_a = 'P2P RADIO' 
and v_acc_bearer_st_a = 'COMMISSIONED' and v_reloc_id = 'A-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTAL SLT-END NTU-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTAL SLT-END NTU-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_b = 'P2P RADIO' and
v_acc_bearer_st_b = 'COMMISSIONED' and  v_reloc_id = 'B-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTAL SLT-END NTU-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTAL SLT-END NTU-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_a = 'P2P RADIO' 
and v_acc_bearer_st_a = 'COMMISSIONED' and v_reloc_id = 'A-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_b = 'P2P RADIO' 
and v_acc_bearer_st_b = 'COMMISSIONED' and v_reloc_id = 'B-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_a = 'FIBER' and
 v_acc_link_ty_a = 'DEDICATED LINE' and v_acc_bearer_st_a = 'COMMISSIONED' and 
 v_reloc_id = 'A-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_b = 'FIBER' and
 v_acc_link_ty_b = 'DEDICATED LINE' and v_acc_bearer_st_b = 'COMMISSIONED' and 
 v_reloc_id = 'B-END' THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_os
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  (v_acc_med_a = 'FIBER' or 
  v_acc_med_a = 'COPPER-UTP') and ( v_acc_bearer_st_a = 'COMMISSIONED' or v_acc_link_ty_a = 'DEDICATED LINE') and
 v_reloc_id = 'A-END' and v_acc_node_chg_a = 'YES' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTAB. ACC.LINK-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTAB. ACC.LINK-A ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  (v_acc_med_b = 'FIBER' or 
  v_acc_med_b = 'COPPER-UTP') and ( v_acc_bearer_st_b = 'COMMISSIONED' or v_acc_link_ty_b = 'DEDICATED LINE') and
 v_reloc_id = 'B-END' and v_acc_node_chg_b = 'YES' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTAB. ACC.LINK-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTAB. ACC.LINK-B ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  (v_acc_med_a = 'FIBER' or 
  v_acc_med_a = 'COPPER-UTP') and ( v_acc_bearer_st_a = 'COMMISSIONED' or v_acc_link_ty_a = 'DEDICATED LINE') and
 v_reloc_id = 'A-END' and v_acc_node_chg_a = 'NO' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP ACC LINK-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP ACC LINK-A END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  (v_acc_med_b = 'FIBER' or 
  v_acc_med_b = 'COPPER-UTP') and ( v_acc_bearer_st_b = 'COMMISSIONED' or v_acc_link_ty_b = 'DEDICATED LINE') and
 v_reloc_id = 'B-END' and v_acc_node_chg_b = 'NO' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP ACC LINK-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP ACC LINK-B END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_a = 'CUSTOMER-OWN' and
    v_acc_bearer_st_a = 'COMMISSIONED' and v_acc_node_chg_a = 'YES' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'PATCH CUST.LINK-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PATCH CUST.LINK-A ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_acc_med_b = 'CUSTOMER-OWN' AND 
  v_acc_bearer_st_b = 'COMMISSIONED' and v_acc_node_chg_b = 'YES' THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'PATCH CUST.LINK-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PATCH CUST.LINK-B ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  (v_ac_nw_inter_a = 'MSAN PORT' OR v_ac_nw_inter_a = 'DSLAM PORT')
   and v_acc_bearer_st_a = 'INSERVICE' and V_ntu_Class_a = 'SLT' and 
   v_reloc_id = 'A-END'  THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU OF-A ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU OF-A ND'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  (v_ac_nw_inter_b = 'MSAN PORT' OR v_ac_nw_inter_b = 'DSLAM PORT')
   and v_acc_bearer_st_b = 'INSERVICE' and V_ntu_Class_b = 'SLT' and 
   v_reloc_id = 'B-END'  THEN 
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU OF-B ND';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU OF-B ND'; END IF;

-- install CPE A End 
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_a = 'SLT' and
 ( v_acc_bearer_st_a = 'COMMISSIONED' or  v_acc_link_ty_a = 'DEDICATED LINE') and v_reloc_id = 'A-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE-A END'; END IF;
-- install CPE B End 

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_a = 'SLT' and
 ( v_acc_bearer_st_b = 'COMMISSIONED' or  v_acc_link_ty_b = 'DEDICATED LINE') and v_reloc_id = 'B-END' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE-B END'; END IF;

-- Modify CPE A End.
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_a = 'SLT' and
  ( Nvl(v_cpe_mod_Cur_a,'0') <> NVL(v_cpe_mod_Pre_a,'0') ) and  v_acc_bearer_st_a = 'INSERVICE' and
  v_reloc_id = 'A-END' THEN
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE-A END'; END IF;
  
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_b = 'SLT' and
  ( Nvl(v_cpe_mod_Cur_b,'0') <> NVL(v_cpe_mod_Pre_b,'0') ) and  v_acc_bearer_st_b = 'INSERVICE' and
  v_reloc_id = 'B-END' THEN
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE-B END'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_a = 'SLT' and
  ( Nvl(v_cpe_mod_Cur_a,'0') = NVL(v_cpe_mod_pre_a,'0') ) and  v_acc_bearer_st_a = 'INSERVICE' and
  v_reloc_id = 'A-END' THEN
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE-A END'; END IF;
  
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_cpe_cls_b = 'SLT' and
  ( Nvl(v_cpe_mod_Cur_b,'0') <> NVL(v_cpe_mod_Pre_b,'0') ) and  v_acc_bearer_st_b = 'INSERVICE' and
  v_reloc_id = 'B-END' THEN
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE-B END'; END IF;



IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
   ((v_agg_nw_a = 'MEN' or v_ac_nw_inter_a = 'MEN PORT') and v_acc_node_chg_a = 'YES') or
   ((v_agg_nw_b = 'MEN' or v_ac_nw_inter_b = 'MEN PORT') and v_acc_node_chg_b = 'YES') then
   
    UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SWITCH MEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWITCH MEN VLAN'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
   ((v_agg_nw_a = 'CEN' or v_ac_nw_inter_a = 'CEN PORT') and v_acc_node_chg_a = 'YES') or
   ((v_agg_nw_b = 'CEN' or v_ac_nw_inter_b = 'CEN PORT') and v_acc_node_chg_b = 'YES') then
   
    UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SWITCH CEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWITCH CEN VLAN'; END IF;

/*IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
   ((v_agg_nw_a = 'CEN' or v_ac_nw_inter_a = 'CEN PORT') and v_acc_node_chg_a = 'YES') or
   ((v_agg_nw_b = 'CEN' or v_ac_nw_inter_b = 'CEN PORT') and v_acc_node_chg_b = 'YES')
   
    UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SWITCH CEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWITCH CEN VLAN'; END IF;
*/

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
   ( v_ac_nw_inter_a = 'SDH PORT' and v_acc_node_chg_a = 'YES') or
   ( v_ac_nw_inter_b = 'SDH PORT' and v_acc_node_chg_b = 'YES') then

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-TX-DOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SWITCH TX PATH';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWITCH TX PATH'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
   ( v_ac_nw_inter_a = 'MLLN PORT' and v_acc_node_chg_a = 'YES') or
   ( v_ac_nw_inter_b = 'MLLN PORT' and v_acc_node_chg_b = 'YES') then

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SWITCH MLLN LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWITCH MLLN LINK'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  ( v_acc_med_a = 'FIBER' or v_acc_med_a = 'CUSTOMER OWN') and (v_acc_bearer_st_a = 'COMMISSIONED' or 
  v_acc_link_ty_a = 'DEDICATED LINE') and v_acc_node_chg_a = 'NO' and v_reloc_id = 'A-END' then 
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CHANGE ODF X CONNE-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CHANGE ODF X CONNE-A'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  ( v_acc_med_b = 'FIBER' or v_acc_med_b = 'CUSTOMER OWN') and (v_acc_bearer_st_b = 'COMMISSIONED' or 
  v_acc_link_ty_b = 'DEDICATED LINE') and v_acc_node_chg_b = 'NO' and v_reloc_id = 'B-END' then 
  
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CHANGE ODF X CONNE-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CHANGE ODF X CONNE-B'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
 (( v_ac_nw_inter_a = 'MSAN PORT' or v_ac_nw_inter_a = 'DSLAM PORT' or v_ac_nw_inter_a = 'MLLN PORT')
 and v_reloc_id = 'A-END') or  (( v_ac_nw_inter_b = 'MSAN PORT' or v_ac_nw_inter_b = 'DSLAM PORT' or v_ac_nw_inter_b = 'MLLN PORT')
 and v_reloc_id = 'B-END') then
 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';

ELSIF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'MEN PORT'
  and v_reloc_id = 'A-END') or (v_ac_nw_inter_b = 'MEN PORT' and v_reloc_id = 'B-END') then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';

ELSIF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and (v_ac_nw_inter_a = 'CEN PORT'
  and v_reloc_id = 'A-END') or (v_ac_nw_inter_b = 'CEN PORT' and v_reloc_id = 'B-END') then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';

ELSIF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' 
  and v_ac_nw_inter_a = 'SDH PORT' and v_reloc_id = 'A-END' then
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_a_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';

ELSIF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' 
  and v_ac_nw_inter_b = 'SDH PORT' and v_reloc_id = 'B-END' then
  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_b_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  v_acc_bearer_st_a = 'COMMISSIONED' and  v_reloc_id = 'A-END'    then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT.ACC BEARER-A END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT.ACC BEARER-A END'; END IF;  
  
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  
  v_acc_bearer_st_b = 'COMMISSIONED' and  v_reloc_id = 'B-END'    then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT.ACC BEARER-B END';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT.ACC BEARER-B END'; END IF;  
  
open cur_tributer ( v_acc_id_A,v_new_Cir_Name); fetch cur_tributer into  v_a_cir_name,v_a_cir_status;
close cur_tributer;
open cur_tributer_ ( v_acc_id_B,v_new_Cir_Name); fetch cur_tributer_ into  v_b_cir_name,v_b_cir_status;
close cur_tributer_;
IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_a_pre = 'MEN PORT' and
 v_acc_node_chg_a = 'YES' and v_a_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD MEN SUB PT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MEN SUB PT-A'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_b_pre = 'MEN PORT' and
 v_acc_node_chg_b = 'YES' and v_b_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD MEN SUB PT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MEN SUB PT-B'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_a_pre = 'CEN PORT' and
 v_acc_node_chg_a = 'YES' and v_a_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD CEN SUB PT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD CEN SUB PT-A'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_b_pre = 'CEN PORT' and
 v_acc_node_chg_b = 'YES' and v_b_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD CEN SUB PT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD CEN SUB PT-B'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_a_pre = 'MSAN PORT' and
 v_acc_node_chg_a = 'YES' and v_a_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD TRIB PORT- A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD TRIB PORT- A'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_b_pre = 'MSAN PORT' and
 v_acc_node_chg_b = 'YES' and v_b_cir_name is not null then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD TRIB PORT- B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD TRIB PORT- B'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_a_pre = 'MSAN PORT' and
 v_acc_node_chg_a = 'YES'  then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD MLLN PT-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT OLD MLLN PT-A'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and  v_ac_nw_inter_b_pre = 'MSAN PORT' and
 v_acc_node_chg_b = 'YES' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD MLLN PT-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT OLD MLLN PT-B'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_acc_med_a = 'COPPER'  and 
  v_acc_link_ty_a = 'DEDICATED LINE' and v_reloc_id = 'A-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' ---------- WG is Null
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOV OLD OSP LINE-A';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOV OLD OSP LINE-A'; END IF;  

IF v_service_type = 'D-EDL' and v_service_order  = 'MODIFY-LOCATION' and v_acc_med_b = 'COPPER'  and 
  v_acc_link_ty_b = 'DEDICATED LINE' and v_reloc_id = 'B-END' then
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' ---------- WG is Null
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOV OLD OSP LINE-B';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOV OLD OSP LINE-B'; END IF;  

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg := 'Failed to Change D-EDL Modify Loc. function. Please check the conditions:'||
   ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_EDL_MODIFY_LOCATION;

--- Jayan Liyanage 2015 / 05 / 20

--- Jayan Liyanage 2015 / 05 / 20
PROCEDURE D_EDL_MODIFY_LOC_SET_ATT (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_accbear_stsa    varchar2(100);
v_accbear_stsb    varchar2(100);
v_linkTy_a        varchar2(100);
v_linkTy_b        varchar2(100);
v_reloc_end       varchar2(100);
v_service_type    varchar2(100);
v_service_order   varchar2(100);


begin
  

SELECT distinct soa.seoa_defaultvalue into v_accbear_stsa FROM service_order_attributes soa 
where soa.seoa_name = 'ACC. BEARER STATUS-A END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_accbear_stsb FROM service_order_attributes soa 
where soa.seoa_name = 'ACC. BEARER STATUS-B END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_linkTy_a FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS LINK TYPE-A END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_linkTy_b FROM service_order_attributes soa 
where soa.seoa_name = 'ACCESS LINK TYPE-B END' and soa.seoa_sero_id = p_sero_id;

SELECT distinct soa.seoa_defaultvalue into v_reloc_end FROM service_order_attributes soa 
where soa.seoa_name = 'RELOCATED END' and soa.seoa_sero_id = p_sero_id;


select so.sero_sert_abbreviation  into v_service_type 
from service_orders so where so.sero_id = p_sero_id;
select so.sero_ordt_type  into v_service_order 
from service_orders so where so.sero_id = p_sero_id;

IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND ( v_accbear_stsa  = 'NEW' OR v_accbear_stsa  = 'TO BE MODIFIED')
  AND v_linkTy_a = 'DAB' AND v_reloc_end = 'A-END'  THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID-A END' 
And soa.seoa_sero_id = p_sero_id;   END IF;/*
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-A ND'; END IF;*/

IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND (v_accbear_stsb  = 'NEW' 
  OR v_accbear_stsb  = 'TO BE MODIFIED')
  AND v_linkTy_b = 'DAB' AND v_reloc_end = 'B-END'  THEN
update service_order_attributes soa
set soa.seoa_defaultvalue = '' where  soa.seoa_name = 'ACCESS BEARER ID-B END' 
And soa.seoa_sero_id = p_sero_id;  END IF;
/*
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SET BEARER ATTR-B ND'; END IF;*/

IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND ( v_accbear_stsa  = 'NEW'   
  OR v_accbear_stsa  = 'TO BE MODIFIED')
  AND v_linkTy_a = 'DAB' AND v_reloc_end = 'A-END' THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB-A END'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB-A END'; END IF;

IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND ( v_accbear_stsb  = 'NEW'   
  OR v_accbear_stsb  = 'TO BE MODIFIED') AND v_linkTy_b = 'DAB' AND  v_reloc_end = 'B-END'  THEN
  UPDATE service_implementation_tasks  sit
  set sit.seit_worg_name = 'SFC-SOM-DATA'
  where sit.seit_taskname = 'WAIT FOR DAB-B END'
  and sit.seit_sero_id = p_sero_id;
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR DAB-B END'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );

EXCEPTION 
  WHEN OTHERS 
    THEN p_ret_msg :=
'Failed to Change D-EDL Create Tansfer Set  Attribute  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, 

setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_EDL_MODIFY_LOC_SET_ATT;

--- Jayan Liyanage 2015 / 05 / 20

--- Jayan Liyanage 2015 / 05 / 20

PROCEDURE D_EDL_MODIFY_LOC_ATT_CP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR bearer_c IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID-B END'AND so.sero_id = p_sero_id;
CURSOR bearer_d IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID-A END'AND so.sero_id = p_sero_id;
CURSOR so_copyattr (v_new_bearer_id VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
and soa.seoa_name in (
'ACCESS N/W INTF','CPE CLASS','CPE TYPE','CPE MODEL','NTU MODEL','NTU TYPE','NTU CLASS'
,'NTU ROUTING MODE','ACCESS MEDIUM','NO OF COPPER PAIRS','ACCESS INTF PORT BW','DATA RADIO MODEL'
,'CUSTOMER INTF TYPE','BACKBONE CORE NO','ACCESS LINK DISTANCE','VLAN TAGGED/UNTAGGED ?',
'ACCESS FIBER AVAILABLE ?','ACCESS FIBER PROJ SO#','ACCESS NODE CHANGE?'
)AND so.sero_stas_abbreviation <> 'CANCELLED'
AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id);

CURSOR so_copyattr_c (v_new_bearer_id_b VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
and soa.seoa_name in (
'ACCESS N/W INTF','CPE CLASS','CPE TYPE','CPE MODEL','NTU MODEL','NTU TYPE','NTU CLASS'
,'NTU ROUTING MODE','ADDITIONAL NTU MODEL','ACCESS MEDIUM','NO OF COPPER PAIRS','ACCESS INTF PORT BW','DATA RADIO MODEL'
,'CUSTOMER INTF TYPE','BACKBONE CORE NO','ACCESS LINK DISTANCE','VLAN TAGGED/UNTAGGED ?',
'ACCESS FIBER AVAILABLE ?','ACCESS FIBER PROJ SO#','ACCESS NODE CHANGE?'
)
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')AND so.sero_stas_abbreviation <> 'CANCELLED'
AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id_b);

v_so_attr_name     VARCHAR2 (100);
v_so_attr_val      VARCHAR2 (100);
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100);
v_new_bearer_id    VARCHAR2 (100);
v_service_type     VARCHAR2 (100);
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);
v_new_bearer_id_b  VARCHAR2 (100);
v_bearer_id_b      VARCHAR2 (100);
v_so_attr_name_c     VARCHAR2 (100);
v_so_attr_val_c      VARCHAR2 (100);
v_cir_status_c      VARCHAR2 (100);
v_acc_lin_type_A      varchar2(100);
v_acc_lin_type_B     varchar2(100);

BEGIN
  
SELECT DISTINCT soa.seoa_defaultvalue INTO v_acc_lin_type_A  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-B END'AND so.sero_id = p_sero_id;
SELECT DISTINCT soa.seoa_defaultvalue INTO v_acc_lin_type_B  FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE-A END'AND so.sero_id = p_sero_id;
OPEN bearer_c;FETCH bearer_c INTO v_bearer_id;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);LOOP FETCH so_copyattr
INTO v_so_attr_name, v_so_attr_val, v_cir_status; EXIT WHEN so_copyattr%NOTFOUND;

if (v_acc_lin_type_B = 'DAB' ) THEN
IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS N/W INTF-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE CLASS' THEN  UPDATE service_order_attributes soa  
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE TYPE-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-B END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE-B END'; 
ELSIF     v_service_type = 'D-EDL' 
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-B END';
ELSIF     v_service_type = 'D-EDL'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-B END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NO OF COPPER PAIRS-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW-B END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL-B END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE-B END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAG/UNTAG?-B END'; 
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'BACKBONE CORE NO' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO-B END';  
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE-B END';  
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?-B END';  
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS FIBER PROJ SO#' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER PROJ SO#-B END';  
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS NODE CHANGE?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?-B END';  
end if; end if; END LOOP; 

IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACC. BEARER STATUS-B END';

END IF;
 CLOSE so_copyattr;CLOSE bearer_c;OPEN bearer_d;FETCH bearer_d INTO v_bearer_id_b;OPEN so_copyattr_c (v_bearer_id_b);LOOP FETCH so_copyattr_c
INTO v_so_attr_name_c, v_so_attr_val_c, v_cir_status_c; EXIT WHEN so_copyattr_c%NOTFOUND;

if (v_acc_lin_type_A = 'DAB'  )THEN
IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS N/W INTF-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name_c = 'CPE CLASS' THEN  UPDATE service_order_attributes soa  
SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE TYPE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name_c = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL-A END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU MODEL-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name_c = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE-A END'; 
ELSIF     v_service_type = 'D-EDL' 
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name_c = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL-A END';
ELSIF     v_service_type = 'D-EDL'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM-A END';
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NO OF COPPER PAIRS-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name_c = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW-A END'; 
ELSIF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name_c = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'BACKBONE CORE NO' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val_c 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAG/UNTAG?-A END'; 
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS FIBER AVAILABLE ?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS FIBER PROJ SO#' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER PROJ SO#-A END';
ELSIF     v_service_type = 'D-EDL'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name_c = 'ACCESS NODE CHANGE?' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?-A END';

END IF; END IF;

END LOOP; 
IF     v_service_type = 'D-EDL' AND v_service_order = 'MODIFY-LOCATION'
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_cir_status_c WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACC. BEARER STATUS-A END'; end if;
CLOSE so_copyattr_c;CLOSE bearer_d;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-EDL Modify Location SOD Copy Attribute  function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, 

setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_EDL_MODIFY_LOC_ATT_CP;

--- Jayan Liyanage 2015 / 05 / 20

---Prabodha Chathuranga  2015/12/10
PROCEDURE D_BTL_NTU_MODCHG (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
    
  b_service_type      VARCHAR2 (100);
  b_service_order     VARCHAR2 (100);    
  b_ntu_chng          VARCHAR2 (100);
  b_tx_wg             VARCHAR2 (100);
  b_tx_wg_bend        VARCHAR2 (100);
  b_aggr_nw           VARCHAR2 (100);
  b_work_group_a      VARCHAR2 (100);
  b_exc_area          VARCHAR2 (100);
  b_exc_rt_area       VARCHAR2 (100);
   b_acc_nw            VARCHAR2 (100);
  
BEGIN

SELECT DISTINCT so.sero_sert_abbreviation INTO b_service_type FROM service_orders so WHERE so.sero_id =  p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO b_service_order FROM service_orders so WHERE so.sero_id =  p_sero_id;  
  
SELECT soa.seoa_defaultvalue INTO b_ntu_chng FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';

SELECT soa.seoa_defaultvalue INTO b_tx_wg FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TX WORK GROUP-MGW';
  
SELECT soa.seoa_defaultvalue INTO b_tx_wg_bend FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TX WORK GROUP-B END';

SELECT soa.seoa_defaultvalue INTO b_aggr_nw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';

SELECT soa.seoa_defaultvalue INTO b_exc_area FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';

SELECT soa.seoa_defaultvalue INTO b_acc_nw FROM service_order_attributes soa
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
  
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes INTO b_exc_rt_area
  FROM areas ar WHERE ar.area_code = b_exc_area AND ar.area_aret_code = 'LEA';
  
 b_work_group_a := b_exc_rt_area || '-' || b_exc_area || '-' || 'OSP-NC'; 
 
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_ntu_chng ='YES' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_work_group_a
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'INSTALL  NTU';
  ELSIF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_ntu_chng ='NO' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_work_group_a
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MODIFY NTU LABEL';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND(b_aggr_nw ='SDH' OR  b_aggr_nw = 'MLLN')THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_tx_wg
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT MGW';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT MGW';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_aggr_nw ='SDH' AND b_acc_nw <> 'SDH PORT' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_tx_wg_bend
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT TX NODE';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'X CONNECT AT TX NODE';
  END IF;
  
   p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
  EXCEPTION
  WHEN OTHERS
  THEN
  p_ret_msg :='Failed to Change D-BTL Create Add-Transfer Process function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
  INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
  VALUES(p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
  
END D_BTL_NTU_MODCHG;  
---Prabodha Chathuranga  2015/12/10

---Prabodha Chathuranga  2015/07/23
PROCEDURE D_BTL_CREATE_ADDTRANSFER (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

  b_acc_link          VARCHAR2 (100);
  b_service_type      VARCHAR2 (100);
  b_service_order     VARCHAR2 (100);
  b_acc_medium        VARCHAR2 (100);
  b_no_pstn           VARCHAR2 (100);
  b_acc_nw            VARCHAR2 (100);
  b_acc_fib_a         VARCHAR2 (100);
  b_old_service_typ   VARCHAR2 (100);
  b_mig_type          VARCHAR2 (100);
  b_acc_bearer_a_sta  VARCHAR2 (100);
  b_new_num_level     VARCHAR2 (100);
  b_sw_code           VARCHAR2 (100);
  b_exc_area          VARCHAR2 (100);
  b_exc_rt_area       VARCHAR2 (100);
  b_work_group_nw     VARCHAR2 (100);
  b_work_group_os     VARCHAR2 (100);
  b_aggr_nw           VARCHAR2 (100);
  b_eq_loc            VARCHAR2 (100);
  b_node_type         VARCHAR2 (100);
  b_eq_type           VARCHAR2 (100);
  b_acc_port          VARCHAR2 (100);
  b_work_group_b      VARCHAR2 (100);
  b_work_group_a      VARCHAR2 (100);
  
  
  
BEGIN
  
  SELECT distinct soa.seoa_defaultvalue INTO b_acc_link FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS LINK TYPE';
  
  SELECT DISTINCT so.sero_sert_abbreviation INTO b_service_type FROM service_orders so WHERE so.sero_id =  p_sero_id;
  SELECT DISTINCT so.sero_ordt_type INTO b_service_order FROM service_orders so WHERE so.sero_id =  p_sero_id;
  
  SELECT soa.seoa_defaultvalue INTO b_acc_medium FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
  
  IF b_acc_medium = 'COPPER' THEN
  select distinct e.equp_equt_abbreviation,e.equp_locn_ttname INTO b_eq_type, b_eq_loc
   FROM equipment e 
   where E.EQUP_ID in (
   select P.PORT_EQUP_ID  from PORT_LINKS pl ,PORT_LINK_PORTS plp,service_orders so,ports p
   where PL.PORL_ID = PLP.POLP_PORL_ID
  and PLP.POLP_PORT_ID = P.PORT_ID
  and PL.PORL_CIRT_NAME = so.sero_cirt_name
  and SO.SERO_ID =p_sero_id);

  SELECT LENGTH(b_eq_loc) - LENGTH(REPLACE(b_eq_loc,'-',null))as node_tpe INTO b_node_type FROM dual;
  END IF;

  SELECT soa.seoa_defaultvalue INTO b_no_pstn FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SA_NO_OF_PSTN NUMBERS';
  
  SELECT soa.seoa_defaultvalue INTO b_acc_nw FROM service_order_attributes soa
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
  
  SELECT soa.seoa_defaultvalue INTO b_acc_port FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT CHANGE?';
  
  SELECT soa.seoa_defaultvalue INTO b_acc_fib_a FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';

  SELECT soa.seoa_defaultvalue INTO b_old_service_typ FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'OLD SERVCICE TYPE';
 
  SELECT soa.seoa_defaultvalue INTO b_mig_type FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
  
  SELECT soa.seoa_defaultvalue INTO b_acc_bearer_a_sta FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';

  SELECT soa.seoa_defaultvalue INTO b_new_num_level FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'NEW NUMBER LEVEL (Y/N)?';
 
  SELECT soa.seoa_defaultvalue INTO b_exc_area FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'EXCHANGE_AREA_CODE';

  SELECT soa.seoa_defaultvalue INTO b_sw_code  FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id =  p_sero_id AND soa.seoa_name = 'SW CODE';
  
  SELECT soa.seoa_defaultvalue INTO b_aggr_nw FROM service_order_attributes soa 
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK';

  select distinct aw.arwg_worg_name into b_work_group_nw  from area_workgroups aw
  where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = b_exc_area
  and aw.arwg_grouptype = 'ENG';

  select distinct aw.arwg_worg_name into b_work_group_os  from area_workgroups aw
  where aw.arwg_sert_abbreviation = 'D-BTL' and aw.arwg_area_code  = b_exc_area
  and aw.arwg_grouptype = 'OSP';
  
  SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes INTO b_exc_rt_area
  FROM areas ar WHERE ar.area_code = b_exc_area AND ar.area_aret_code = 'LEA';
   
  b_work_group_a := b_exc_rt_area || '-' || b_exc_area || '-' || 'OSP-NC'; 
  b_work_group_b := b_exc_rt_area || '-' || b_exc_area || '-' || 'MDF'; 
  
  IF b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_acc_nw = 'MLLN PORT' 
  AND b_acc_link = 'DEDICATED LINE' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MLLN PORT';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MLLN PORT';
  END IF;

  
  IF  b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND (b_acc_nw = 'MSAN PORT' 
  OR b_acc_nw = 'DSLAM PORT') 
  AND b_acc_link = 'DEDICATED LINE' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MSAN PORT';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MSAN PORT';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-TRANSFER' AND b_acc_nw = 'SDH PORT'   
  AND b_acc_link = 'DEDICATED LINE' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PORTS';
  END IF;
  
  IF   b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_acc_nw = 'MEN PORT'  
  AND b_acc_link = 'DEDICATED LINE' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MEN PORT';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE MEN PORT';
  END IF;
  
  IF   b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_aggr_nw = 'SDH' 
  THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'OPR-NETMGT-TX'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'RESERVE TX PATH';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_aggr_nw <> 'MEN PORT'  
  AND b_aggr_nw = 'MEN' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_aggr_nw <> 'CEN PORT'  
  AND b_aggr_nw = 'CEN' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN';
  END IF;
  
  IF  b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND (b_acc_nw = 'MSAN PORT' 
  OR b_acc_nw = 'DSLAM PORT') THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVE SHDSL PORT';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVE SHDSL PORT';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND(b_acc_nw ='SDH PORT' 
  OR  b_aggr_nw = 'SDH')THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-TX-DOM'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'ACTIVATE TX LINK';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_mig_type='LEGACY TO NGN' THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_work_group_a
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'TEST AGGREGATE LINK';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'TEST AGGREGATE LINK';
  END IF;
  
  IF    b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND  b_mig_type = 'LEGACY TO NGN'  THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK'
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'PLAN SVC MIGRATION';
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'PLAN SVC MIGRATION';
  END IF;
  
  IF  b_node_type = 1 THEN
  IF  b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_acc_medium = 'COPPER'  
  AND b_acc_port = 'YES' AND (b_eq_type LIKE 'MSAN%' OR b_eq_type LIKE 'DSLAM%' OR b_eq_type LIKE 'TELLABS%')   THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_work_group_b
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CON';
  END IF;
  ELSIF  b_node_type = 2 THEN 
  IF b_service_type = 'D-BTL' AND b_service_order = 'CREATE-ADDTRANSFER' AND b_acc_medium = 'COPPER' 
  AND b_acc_port = 'YES' AND (b_eq_type LIKE 'MSAN%' OR b_eq_type LIKE 'DSLAM%' OR b_eq_type LIKE 'TELLABS%')  THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = b_work_group_a
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CON';
  END IF;
  ELSE DELETE      service_implementation_tasks sit
  WHERE sit.seit_sero_id =  p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CON';
  END IF; 
  
  
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
  EXCEPTION
  WHEN OTHERS
  THEN
  p_ret_msg :='Failed to Change D-BTL Create Add-Transfer Process function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
  INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
  VALUES(p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
  
END D_BTL_CREATE_ADDTRANSFER;  
---Prabodha Chathuranga  2015/07/23

----Dinesh Perera  19-01-2016  -----
PROCEDURE UPDATE_M3VPN_EMAIL_DATA (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

      v_sero_id       service_orders.SERO_ID%TYPE;
      v_order_type    service_orders.SERO_ORDT_TYPE%TYPE;
      v_cus_name      customer.CUSR_NAME%TYPE;
      v_cirt_name     circuits.CIRT_DISPLAYNAME%TYPE;
      v_cus_contact   service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
      v_issued_date   varchar2(200);
    
    CURSOR C_DATA IS
        SELECT 
        SERO_ORDT_TYPE,
        SERO_ID,
        CUSR_NAME,
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'DATA CIRCUIT ID'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'MOBILE NUMBER'),
        (SELECT SEOA_DEFAULTVALUE
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = SERO_ID
        AND SEOA_NAME = 'ACTUAL_DSP_DATE')
        FROM SERVICE_ORDERS, CIRCUITS, CUSTOMER
        WHERE SERO_CIRT_NAME = CIRT_NAME
        AND SERO_CUSR_ABBREVIATION = CUSR_ABBREVIATION
        AND SERO_SERT_ABBREVIATION = 'D-M3VPN'
        AND SERO_ID = p_sero_id;


BEGIN

    OPEN C_DATA;
    FETCH C_DATA INTO v_order_type,v_sero_id,v_cus_name,v_cirt_name,v_cus_contact,v_issued_date; 
    CLOSE C_DATA; 

    INSERT INTO CLARITY_ADMIN.M3VPN_MAIL_LOG 
                (M3VPN_ORDER_TYPE,
                 M3VPN_SO_ID,
                 M3VPN_CUSTOMER_NAME,
                 M3VPN_CCT_NAME,
                 M3VPN_MOBILE_NUMBER,
                 M3VPN_DSP_DATE,
                 M3VPN_REMARKS) 
    VALUES      (v_order_type,
                 v_sero_id, 
                 v_cus_name, 
                 v_cirt_name,
                 v_cus_contact,           
                 TO_DATE(SUBSTR(trim(v_issued_date),1,11),'DD-MON-YYYY'),                
                 'INSERTED');
                 
    IF v_order_type = 'CREATE' THEN
    
    CLARITY_ADMIN.M3VPN_SEND_MAIL;
    
    ELSIF v_order_type = 'DELETE' THEN
    
    CLARITY_ADMIN.M3VPN_SEND_MAIL_DELETE;
    
    END IF;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END UPDATE_M3VPN_EMAIL_DATA ;
----Dinesh Perera  19-01-2016  -----

--- Jayan Liyanage 05 / 02 / 2016
PROCEDURE ICT_ATTRIBUTE_UPDATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

Cursor Cur_Agree IS
SELECT DISTINCT SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_NAME = 'AGREEMENT ID'
AND SOA.SEOA_SERO_ID = p_sero_id;

Cursor Cur_Nam_Pro IS
SELECT DISTINCT SOA.SEOA_DEFAULTVALUE  
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_NAME = 'NAME IN PRODUCT LABEL'
AND SOA.SEOA_SERO_ID = p_sero_id;

V_AgreeId         varchar2(100);
V_NameInProdLbl   varchar2(200);
v_prdlble         varchar2(250);          

BEGIN
  
V_AgreeId := '';
V_NameInProdLbl := '';
  
Open Cur_Agree; fetch Cur_Agree into V_AgreeId;
Close Cur_Agree;

Open Cur_Nam_Pro; fetch Cur_Nam_Pro into V_NameInProdLbl;
Close Cur_Nam_Pro;

v_prdlble :=   V_NameInProdLbl||' '||V_AgreeId;

update service_order_attributes soa
set soa.seoa_defaultvalue = v_prdlble
where soa.seoa_name = 'PRODUCT_LABEL'
and soa.seoa_sero_id = p_sero_id;

IF V_AgreeId is null then
  p_ret_msg := 'Failed to Update Product Label Attribute, "AGREEMENT ID" Attribute is Null:'
   || TO_CHAR(SQLCODE);
ELSIF V_NameInProdLbl is null then
    p_ret_msg := 'Failed to Update Product Label Attribute, "NAME IN PRODUCT LABEL" Attribute is Null:'
   || TO_CHAR(SQLCODE);
END IF;

IF p_ret_msg IS NULL THEN
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
  ELSE
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
  SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
  , p_ret_msg);
  END IF;
 
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Update Product Label Attributes :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;  

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,SETC_TEXT ) 
VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE, p_ret_msg);   
END ICT_ATTRIBUTE_UPDATE;
--- Jayan Liyanage 05 / 02 / 2016

--- Jayan Liyanage 09 / 02 / 2016
PROCEDURE D_BDL_BANDWIDTH_UPDATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )

IS


V_Qos_Tempte         varchar2(100);
v_AggNwA             varchar2(100);           
v_AggNwB             varchar2(100);
v_AccNwInF_A         varchar2(100);           
v_AccNwInf_B         varchar2(100);
v_Service_Type       varchar2(100);
v_ServiceOdType      varchar2(100);
v_SerSpeed           varchar2(100);
  
BEGIN
  
Select distinct so.sero_sert_abbreviation,so.sero_ordt_type,so.sero_sped_abbreviation into 
v_Service_Type,v_ServiceOdType,v_SerSpeed from Service_orders so where so.sero_id = p_sero_id;

SELECT SOA.SEOA_DEFAULTVALUE INTO v_AggNwA FROM SERVICE_ORDER_ATTRIBUTES SOA 
WHERE SOA.SEOA_NAME = 'AGG. NETWORK-A END' AND SOA.SEOA_SERO_ID = p_sero_id;

SELECT SOA.SEOA_DEFAULTVALUE INTO v_AggNwB FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_NAME = 'AGG. NETWORK-B END' AND SOA.SEOA_SERO_ID = p_sero_id;

SELECT SOA.SEOA_DEFAULTVALUE INTO v_AccNwInF_A FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_NAME = 'ACCESS N/W INTF-A END' AND SOA.SEOA_SERO_ID = p_sero_id;

SELECT SOA.SEOA_DEFAULTVALUE INTO v_AccNwInf_B FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_NAME = 'ACCESS N/W INTF-B END' AND SOA.SEOA_SERO_ID = p_sero_id;

IF v_Service_Type = 'D-BDL' And (v_AggNwA = 'CEN' or v_AggNwB = 'CEN') Then
  
Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '4 MBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-AGG NW' and SOA.SEOA_SERO_ID = p_sero_id; End If;

IF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '64 KBPS' Then
   
Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '512 KBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id;

ELSIF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '128 KBPS' Then 
   
Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '512 KBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id;

ELSIF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '256 KBPS' Then 

Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '512 KBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id;

ELSIF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '512 KBPS' Then 
   
Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '1 MBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id;

ELSIF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '1 MBPS' Then 
   
Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '2 MBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id;

ELSIF v_Service_Type = 'D-BDL' And (v_AccNwInF_A = 'MSAN PORT' or
   v_AccNwInf_B = 'MSAN PORT') and v_SerSpeed = '2 MBPS' Then 

Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = '3 MBPS'
where SOA.SEOA_NAME = 'OPERATIONAL BW-ACC NW' and SOA.SEOA_SERO_ID = p_sero_id; END IF;

Update Service_Order_Attributes SOA set SOA.SEOA_DEFAULTVALUE = 'PLATINUM PLUS T2'
where SOA.SEOA_NAME = 'QOS TEMPLATE' and SOA.SEOA_SERO_ID = p_sero_id;


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-BTL Operational BW update in Aggregate & Access NW. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_BDL_BANDWIDTH_UPDATE;
--- Jayan Liyanage 09 / 02 / 2016

--- Jayan Liyanage 2016/01/11
PROCEDURE D_PREMIUM_VPN_MODIFY_FEATURE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_service_type    VARCHAR2(100);
v_service_order   VARCHAR2(100);
v_ntu_class       VARCHAR2(100);
v_acc_medium      VARCHAR2(100);
v_acc_nw          VARCHAR2(100);
v_ntu_type        VARCHAR2(100);

BEGIN

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_type FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';

SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-FEATURE' AND
v_ntu_class = 'SLT' AND v_acc_medium = 'COPPER' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';END IF;
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order ='MODIFY-FEATURE' 
  AND v_ntu_class = 'SLT' AND
v_acc_medium = 'FIBER' AND v_ntu_type <> 'UM_MEDIA_CONVERTOR' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU FO';
ELSE DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU FO';END IF;
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-FEATURE' AND
  (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'OLT PORT') THEN
  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG SHDSL PORT';END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Premium  VPN MOdify-Feature Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_PREMIUM_VPN_MODIFY_FEATURE;
--- Jayan Liyanage 2016/01/11

--- Jayan Liyanage 05/ 02 / 2016
PROCEDURE D_PRE_VPN_NOTIFY(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
      
      V_l3_VAL                  VARCHAR2(100);
BEGIN
  
SELECT DISTINCT SOF.SOFE_DEFAULTVALUE INTO V_l3_VAL
FROM SERVICE_ORDER_FEATURES SOF
WHERE SOF.SOFE_FEATURE_NAME = 'SF_L3 IP MULTICASTING'
AND SOF.SOFE_SERO_ID = p_sero_id;

IF V_l3_VAL = 'Y' THEN
     p_ret_char := 'Check & Configure Service Features..!' ;   
END IF;
                                 EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_PRE_VPN_NOTIFY;
--- Jayan Liyanage 15 / 02 /2016

--- Jayan Liyanage 05/11/2015
PROCEDURE FTTH_IPTV_NUMBER_VALIDATE (
p_serv_id            IN     Services.serv_id%TYPE,
p_sero_id            IN     Service_Orders.sero_id%TYPE,
p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
p_woro_id            IN     work_order.woro_id%TYPE,
p_ret_char              OUT VARCHAR2,
p_ret_number            OUT NUMBER,
p_ret_msg               OUT VARCHAR2)   IS

      
Cursor Cur_Reg_id IS
select distinct soa.seoa_defaultvalue
from service_order_attributes soa
where soa.seoa_name = 'REGISTRATION ID'
and soa.seoa_sero_id = p_sero_id;


Cursor Cur_Dis_name IS
select distinct soa.seoa_defaultvalue
from service_order_attributes soa
where soa.seoa_name = 'CIRCUIT ID'
and soa.seoa_sero_id = p_sero_id;

v_reg_id             service_order_attributes.seoa_defaultvalue%TYPE;
v_Cir_name           circuits.cirt_displayname%TYPE;
v_ser_Type           circuits.cirt_sert_abbreviation%TYPE;
v_Service_OD_Type    service_orders.sero_ordt_type%TYPE;
v_Cir_nums           circuits.cirt_displayname%TYPE;
v_no_of_lines        number;
v_no_of_lines_1     number;
v_no_of_lines_2     number;

Begin
        
OPEN  Cur_Reg_id;
FETCH  Cur_Reg_id INTO v_reg_id;
IF Cur_Reg_id%NOTFOUND THEN
  
v_reg_id := '';

END IF; 
CLOSE  Cur_Reg_id;

OPEN  Cur_Dis_name;
FETCH  Cur_Dis_name INTO v_Cir_name;
IF Cur_Dis_name%NOTFOUND THEN
v_Cir_name := '';
END IF; 
CLOSE  Cur_Dis_name;
select substr(substr(v_Cir_name,1,
instr(v_Cir_name,'_',1,1)-1),5) into v_Cir_nums
from dual;  
select substr(substr(v_Cir_name,1,instr(v_Cir_name,'_',1,1)+1),16) 
into v_no_of_lines from dual;

v_no_of_lines_1 := 3;
v_no_of_lines_2 := 2;

IF  v_reg_id IS NULL  THEN    
p_ret_msg  := 'Failed to IPTV Registration Num Validate,Registration number Blank or invalid:';
elsif v_Cir_name is null then
p_ret_msg  := 'Failed to IPTV Registration Num Validate,Circuits  number Blank or invalid:';  
ELSE if trim (v_reg_id) <>  trim (v_Cir_nums) then
p_ret_msg  := 'Failed to IPTV Registration Num Validate PF ,
"IPTV CIRCUIT ID does not match REGISTRATION ID " ';     
END IF;
if  v_no_of_lines >  v_no_of_lines_1  then 
  p_ret_msg  := 'Maximum IPTV Circuit ID suffix value exceeded, Please cancel and reinitiate'; 
End if;      
if  v_no_of_lines <  v_no_of_lines_2  then 
  p_ret_msg  := 'Minimum IPTV Circuit ID suffix value exceeded, Please cancel and reinitiate'; 
End if;     

end if;
  IF p_ret_msg IS NULL THEN
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
  else
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
  SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
  , p_ret_msg);
  end if;


    EXCEPTION
        WHEN OTHERS THEN
          p_ret_msg  := 'Failed to IPTV Registration Num Validate PF ' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;  

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

     INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
     SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
     , p_ret_msg);
    
END FTTH_IPTV_NUMBER_VALIDATE;
--- Jayan Liyanage 05/11/2015


--- Proboda Chaturanga 12032016
PROCEDURE LTE_UPDATE_CREATE_SIM (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_msisdn_no      varchar2(100);
v_imsi_no         varchar2(100);

cursor c_msisdn_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'MSISDN NO';

cursor c_imsi_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'IMSI NO';

BEGIN
    
open c_msisdn_no;
fetch c_msisdn_no into v_msisdn_no;
close c_msisdn_no;

open c_imsi_no;
fetch c_imsi_no into v_imsi_no;
close c_imsi_no;

UPDATE ossrpt.LTE_SIM LP
set lp.SIM_STATUS = 'INSERVICE', lp.LTE_CUS = v_msisdn_no ,lp.ISSUE_DATE = sysdate, lp.SM_ST = 1
WHERE LP.SIM_IMSI = v_imsi_no;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');         

EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update the lte inventory. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END LTE_UPDATE_CREATE_SIM;

--- Proboda Chaturanga 12032016

--- Proboda Chaturanga 12032016
PROCEDURE LTE_UPDATE_DEL_SIM (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_msisdn_no      varchar2(100);
v_imsi_no         varchar2(100);

cursor c_msisdn_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'MSISDN NO';

cursor c_imsi_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'IMSI NO';

BEGIN
    
open c_msisdn_no;
fetch c_msisdn_no into v_msisdn_no;
close c_msisdn_no;

open c_imsi_no;
fetch c_imsi_no into v_imsi_no;
close c_imsi_no;

UPDATE ossrpt.LTE_SIM LP
set lp.SIM_STATUS = 'DELETED', lp.DEL_CIRCUIT = v_msisdn_no ,lp.DELETE_DATE = sysdate, lp.SM_ST = 2
WHERE LP.SIM_IMSI = v_imsi_no;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');         

EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update the lte inventory. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END LTE_UPDATE_DEL_SIM;
--- Proboda Chaturanga 12032016

--- Proboda Chaturanga 12032016
PROCEDURE LTE_UPDATE_MOD_EQUIP_SIM (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_msisdn_no      varchar2(100);
v_imsi_no         varchar2(100);
v_imsiprev_no    varchar2(100);


cursor c_msisdn_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'MSISDN NO';

cursor c_imsi_no is
SELECT trim(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'IMSI NO';

cursor c_imsiprev_no is
SELECT trim(SOA.SEOA_PREV_VALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'IMSI NO';


BEGIN
    
open c_msisdn_no;
fetch c_msisdn_no into v_msisdn_no;
close c_msisdn_no;

open c_imsi_no;
fetch c_imsi_no into v_imsi_no;
close c_imsi_no;

open c_imsiprev_no;
fetch c_imsiprev_no into v_imsiprev_no;
close c_imsiprev_no;

IF v_imsi_no <> v_imsiprev_no THEN

UPDATE ossrpt.LTE_SIM LP
set lp.SIM_STATUS = 'FAULTY',lp.SIM_CHG_DATE = sysdate, lp.SM_ST = 3
WHERE LP.SIM_IMSI = v_imsiprev_no;

UPDATE ossrpt.LTE_SIM LP
set lp.SIM_STATUS = 'INSERVICE', lp.LTE_CUS = v_msisdn_no ,lp.ISSUE_DATE = sysdate, lp.SM_ST = 1
WHERE LP.SIM_IMSI = v_imsi_no;

END IF;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');         

EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to update the lte inventory. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END LTE_UPDATE_MOD_EQUIP_SIM;

--- Proboda Chaturanga 12032016

--- Samitha Sagara 20032016
PROCEDURE SLTCC_NEMS_SOFTSWITCH_CHECK (
      p_serv_id            IN     Services.serv_id%type,
      p_sero_id            IN     Service_Orders.sero_id%type,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%type,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%type,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              out varchar2,
      p_ret_number            OUT number,
      p_ret_msg               OUT Varchar2)   IS


      CURSOR C_SERV_ID  IS
            
            SELECT DISTINCT(SERO_CIRT_NAME),SERO_SERT_ABBREVIATION
            FROM SERVICE_ORDERS
            WHERE SERO_ID=p_sero_id;
                        
      CURSOR C_GET_P_NUMBER (T_CRT_ID SERVICE_ORDERS.SERO_CIRT_NAME%TYPE) IS
      
            SELECT  MAX(CIRT_NAME)
            FROM    CIRCUITS
            WHERE   CIRT_NAME  =T_CRT_ID
            AND     CIRT_STATUS !='PENDINGDELETE';





      CURSOR C_GET_CIRCUITNO (T_CRT_ID SERVICE_ORDERS.SERO_CIRT_NAME%TYPE) IS
      
            SELECT  MAX(PO.PORT_EQUP_ID)
            FROM    PORTS PO,PORT_LINKS PL,PORT_LINK_PORTS PLP
            WHERE   PO.PORT_ID=PLP.POLP_PORT_ID
            AND     PL.PORL_ID=PLP.POLP_PORL_ID
            AND     PL.PORL_CIRT_NAME= T_CRT_ID
            AND     PO.PORT_USAGE='SERVICE_SWITCHING_POINT';


      CURSOR C_GET_CIRCUITNO_PSTN (T_CRT_ID SERVICE_ORDERS.SERO_CIRT_NAME%TYPE) IS
      
            SELECT  MAX(PO.PORT_EQUP_ID)
            FROM    PORTS PO,PORT_LINKS PL,PORT_LINK_PORTS PLP
            WHERE   PO.PORT_ID=PLP.POLP_PORT_ID
            AND     PL.PORL_ID=PLP.POLP_PORL_ID
            AND     PL.PORL_CIRT_NAME= T_CRT_ID
            AND     PO.PORT_USAGE='SERVICE_SWITCHING_POINT'
            AND     SUBSTR(PO.PORT_NAME,1,7)='POTS-IN';

      CURSOR C_MANS_NAME (T_EQP_ID EQUIPMENT.EQUP_ID%TYPE) IS
      
            SELECT  MAX(NENO_EQUP_ID)
            FROM    NE_NODES
            WHERE   NENO_EQUP_ID=T_EQP_ID
            AND     NENO_MANS_NAME='PSTN%1%ZTE_SOFTSWITCH';
            
      CURSOR ATTR_MANS_NAME IS
      
            SELECT soa.seoa_defaultvalue
            FROM service_order_attributes soa
            WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'MANS_NAME'; 
    
        V_SEIT_SERO_ID      SERVICE_ORDERS.SERO_ID%TYPE;
        V_CRT_ID            SERVICE_ORDERS.SERO_SERV_ID%TYPE;
        V_SERO_TYPE         SERVICE_ORDERS.SERO_SERT_ABBREVIATION%TYPE;
        V_CIRCUIT_ID        CIRCUITS.CIRT_NAME%TYPE;
        V_PORT_EQUP_ID      PORTS.PORT_EQUP_ID%TYPE;
        V_MANS_NAME         service_order_attributes.seoa_defaultvalue%TYPE;        

        L_TEMP_CODE         VARCHAR2(20);

  BEGIN
 
    p_ret_msg := '';


          
      OPEN C_SERV_ID;       
      FETCH C_SERV_ID     INTO V_CRT_ID,V_SERO_TYPE;
      CLOSE C_SERV_ID;     
           
      OPEN C_GET_P_NUMBER (V_CRT_ID);       
      FETCH C_GET_P_NUMBER INTO V_CIRCUIT_ID;
      CLOSE C_GET_P_NUMBER;
      
      IF V_SERO_TYPE='PSTN' THEN

          OPEN C_GET_CIRCUITNO_PSTN (V_CRT_ID);       
          FETCH C_GET_CIRCUITNO_PSTN INTO V_PORT_EQUP_ID;
          CLOSE C_GET_CIRCUITNO_PSTN;      
      
      ELSE

          OPEN C_GET_CIRCUITNO (V_CRT_ID);       
          FETCH C_GET_CIRCUITNO INTO V_PORT_EQUP_ID;
          CLOSE C_GET_CIRCUITNO; 
      
      END IF;     

      OPEN C_MANS_NAME (V_PORT_EQUP_ID);       
      FETCH C_MANS_NAME INTO L_TEMP_CODE;
      CLOSE C_MANS_NAME;      
      
      IF L_TEMP_CODE IS NOT NULL  THEN
      
      p_ret_msg := '';
      
      ELSE
       




      p_ret_msg := 'FALSE';
      
      END IF;

      OPEN ATTR_MANS_NAME;       
      FETCH ATTR_MANS_NAME INTO V_MANS_NAME;
      CLOSE ATTR_MANS_NAME; 

      IF V_MANS_NAME = 'ZTE'  THEN
      
      p_ret_msg := '';
      
      ELSE
       
      p_ret_msg := 'FALSE';
      
      END IF;  

EXCEPTION

WHEN OTHERS THEN

      p_ret_msg  := 'Failed SLT_NEMS_SOFTSWITCH_CHECK:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

     INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
     SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
     , p_ret_msg);


END SLTCC_NEMS_SOFTSWITCH_CHECK;
--- Samitha Sagara 20032016

--- Samitha Sagara 20032016
PROCEDURE CREDIT_UPDATE_ZTE_MSAN_NODEID (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS





    CURSOR C_SERO_ID IS
      SELECT SEIT_SERO_ID, SEIT_SERO_REVISION
      FROM   SERVICE_IMPLEMENTATION_TASKS
      WHERE  SEIT_ID = p_seit_id;
      
      
    CURSOR C_SEIT_ID (T_SERO_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE, T_SERO_REVISION SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_REVISION%TYPE) IS
      SELECT SEIT_ID
      FROM   SERVICE_IMPLEMENTATION_TASKS
      WHERE  SEIT_SERO_ID = T_SERO_ID
      AND    SEIT_SERO_REVISION = T_SERO_REVISION
      AND    SEIT_TASKNAME = 'QUERY_MSAN_NODEID';
      
   CURSOR C_CHK_SOP_ERR (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
    SELECT SUBSTR(MAX(SOPQ_STATUS||' - ' ||SOPQ_SOPC_COMMAND||' - ' ||SOPQ_ERRORMESSAGE),1,450) MSG
    FROM SOP_QUEUE
    WHERE SOPQ_SEIT_ID=T_SEIT_ID
    AND SOPQ_STATUS='ERROR';
      
    CURSOR C_SORD_VALUE (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS



      SELECT DISTINCT(SORD_VALUE) FROM SOP_REPLY_DATA, SOP_QUEUE
      WHERE SORD_SOPQ_REQUESTID = SOPQ_REQUESTID
      AND SOPQ_SOPC_COMMAND = 'ZTE_SS_SELECT_NODE_ATTR'
      AND SORD_NAME='description'
      AND SOPQ_SEIT_ID = T_SEIT_ID;
     

      V_SERO_ID         SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE;
      V_SERO_REVISION   SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_REVISION%TYPE;  
      V_SEIT_ID         SOP_QUEUE.SOPQ_SEIT_ID%TYPE;
      V_SORD_VALUE      SOP_REPLY_DATA.SORD_VALUE%TYPE;

       V_MSG               VARCHAR2(500);
      
      V_REPLY               VARCHAR2(300);
      V_RETN                VARCHAR2(100);
      V_VALUE               VARCHAR2(300);
      V_RESULT              VARCHAR2(100);
      V_NODEID              VARCHAR2(100);

BEGIN


    OPEN C_SERO_ID;
    FETCH C_SERO_ID INTO V_SERO_ID, V_SERO_REVISION;
    CLOSE C_SERO_ID;

      
    OPEN C_SEIT_ID(V_SERO_ID, V_SERO_REVISION);
    FETCH C_SEIT_ID INTO V_SEIT_ID;
    CLOSE C_SEIT_ID;

    
    OPEN C_SORD_VALUE(V_SEIT_ID);
    FETCH C_SORD_VALUE INTO V_SORD_VALUE;
    CLOSE C_SORD_VALUE;      
     
    ---CHECK SOP ERROR AND UPDATE-----
    
    OPEN C_CHK_SOP_ERR(V_SEIT_ID);
    FETCH C_CHK_SOP_ERR INTO V_MSG;
    CLOSE C_CHK_SOP_ERR;
       
    
    IF  V_MSG IS NOT NULL THEN
    
    INSERT INTO CLARITY.SERVICE_ORDER_COMMENTS 
    (SEOC_SERO_ID,SEOC_SERO_REVISION,SEOC_ID,SEOC_USERID,SEOC_TIMESTAMP,SEOC_TEXT,SEOC_INDICATOR)
    VALUES
    (V_SERO_ID, V_SERO_REVISION,SEOC_ID_SEQ.NEXTVAL,USER,SYSDATE,V_MSG,'N');
    
    END IF;

        V_REPLY:=SUBSTR(V_SORD_VALUE,INSTR(V_SORD_VALUE,'RETN='));
       
        V_RETN:=TRIM(TRANSLATE(SUBSTR(V_REPLY,1,INSTR(V_REPLY,',',1)),'RETN=,',' ')); 
        
        IF V_RETN='0' THEN
        
            V_VALUE:=SUBSTR(V_REPLY,INSTR(V_REPLY,'RESULT='));
            
            V_RESULT:=TRIM(TRANSLATE(SUBSTR(V_VALUE,1,INSTR(V_VALUE,',',1)),'RESULT=,',' '));
            
           IF V_RESULT IS NOT NULL THEN
           
            V_NODEID :=V_RESULT;
           
           ELSE
           
            V_NODEID:=NULL;
           
           END IF;
        
        ELSE
        
            V_NODEID:='NA';
        
        END IF;      
    
 

    IF V_NODEID IS NOT NULL THEN
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_NODEID
        where soa.SEOA_SERO_ID = V_SERO_ID
        and soa.SEOA_NAME = 'SA_ZTE_MSAN_NODEID';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    ELSE
    
        p_ret_msg  := 'SS NODEID IS NULL' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
        
                p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);
    
    END IF;
    

 EXCEPTION
 WHEN OTHERS THEN


        p_ret_msg  := 'SS NODEID UPDATE FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);


END CREDIT_UPDATE_ZTE_MSAN_NODEID;
--- Samitha Sagara 20032016


--- Samitha Sagara 20032016
PROCEDURE CREDIT_UPDATE_NUMBER_TYPE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS





    CURSOR C_SERO_ID IS
      SELECT SEIT_SERO_ID, SEIT_SERO_REVISION
      FROM   SERVICE_IMPLEMENTATION_TASKS
      WHERE  SEIT_ID = P_SEIT_ID;
      
    CURSOR C_ORDER_TYPE (T_SERO_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE, T_SERO_REVISION SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_REVISION%TYPE) IS
        SELECT  SERO_ORDT_TYPE
        FROM    SERVICE_ORDERS
        WHERE   SERO_ID=T_SERO_ID
        AND     SERO_REVISION=T_SERO_REVISION;
      
    CURSOR C_SEIT_ID (T_SERO_ID SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE, T_SERO_REVISION SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_REVISION%TYPE) IS
      SELECT SEIT_ID
      FROM   SERVICE_IMPLEMENTATION_TASKS
      WHERE  SEIT_SERO_ID = T_SERO_ID
      AND    SEIT_SERO_REVISION = T_SERO_REVISION
      AND    SEIT_TASKNAME = 'QUERY_NUMBER_TYPE';
    
    CURSOR C_CHK_SOP_ERR (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
    SELECT SUBSTR(MAX(SOPQ_STATUS||' - ' ||SOPQ_SOPC_COMMAND||' - ' ||SOPQ_ERRORMESSAGE),1,450) MSG
    FROM SOP_QUEUE
    WHERE SOPQ_SEIT_ID=T_SEIT_ID
    AND SOPQ_STATUS='ERROR';
      
    CURSOR C_SORD_VALUE_ATTR (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
      SELECT DISTINCT(SORD_VALUE) FROM SOP_REPLY_DATA, SOP_QUEUE



      WHERE SORD_SOPQ_REQUESTID = SOPQ_REQUESTID
      AND SOPQ_SOPC_COMMAND = 'ZTE_SS_SHOW_NOC_ATTR'
      AND SORD_NAME='description'
      AND SOPQ_SEIT_ID = T_SEIT_ID;


    CURSOR C_SORD_VALUE_SDN (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
      SELECT DISTINCT(replace(replace((SORD_VALUE),CHR(13),''),CHR(10),' ') ) FROM SOP_REPLY_DATA, SOP_QUEUE



      WHERE SORD_SOPQ_REQUESTID = SOPQ_REQUESTID
      AND SOPQ_SOPC_COMMAND = 'ZTE_SS_SHOW_SDN'
      AND SORD_NAME='description'
      AND SOPQ_SEIT_ID = T_SEIT_ID;      

    CURSOR C_SORD_VALUE_SDN_NEW (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
      SELECT DISTINCT(replace(replace((SORD_VALUE),CHR(13),''),CHR(10),' ') ) FROM SOP_REPLY_DATA, SOP_QUEUE



      WHERE SORD_SOPQ_REQUESTID = SOPQ_REQUESTID
      AND SOPQ_SOPC_COMMAND = 'ZTE_SS_SHOW_SDN_NEW'
      AND SORD_NAME='description'
      AND SOPQ_SEIT_ID = T_SEIT_ID;          

    CURSOR C_ZTE_SS_SHOW_MOD_NUM (T_SEIT_ID SOP_QUEUE.SOPQ_SEIT_ID%TYPE) IS
      SELECT DISTINCT(SORD_VALUE) FROM SOP_REPLY_DATA, SOP_QUEUE



      WHERE SORD_SOPQ_REQUESTID = SOPQ_REQUESTID
      AND SOPQ_SOPC_COMMAND = 'ZTE_SS_SHOW_MOD_NUM'
      AND SORD_NAME='description'
      AND SOPQ_SEIT_ID = T_SEIT_ID;       
       
       
      CURSOR C_GET_FEATURES_NEW (T_SERO_ID SERVICE_ORDER_FEATURES.SOFE_SERO_ID%TYPE) IS
      
            SELECT  COUNT(SOFE_FEATURE_NAME) CURR_COUNT
            FROM    SERVICE_ORDER_FEATURES
            WHERE   SOFE_SERO_ID=T_SERO_ID
            AND        SOFE_FEATURE_NAME NOT IN ('SF_BAR_INCOMING_CALL','SF_BAR_OUTGOING_CALL','SF_IDD')
            AND     NVL(SOFE_DEFAULTVALUE,'N') ='Y'
            AND     NVL(SOFE_PREV_VALUE,'N')   ='N'
            ORDER BY SOFE_FEATURE_NAME;
      
      CURSOR C_GET_FEATURES_DEL (T_SERO_ID SERVICE_ORDER_FEATURES.SOFE_SERO_ID%TYPE) IS
      
            SELECT  COUNT(SOFE_FEATURE_NAME) OLD_COUNT
            FROM    SERVICE_ORDER_FEATURES
            WHERE   SOFE_SERO_ID=T_SERO_ID
            AND        SOFE_FEATURE_NAME NOT IN ('SF_BAR_INCOMING_CALL','SF_BAR_OUTGOING_CALL','SF_IDD')
            AND     NVL(SOFE_DEFAULTVALUE,'N') ='N'
            AND     NVL(SOFE_PREV_VALUE,'N')   ='Y'
            ORDER BY SOFE_FEATURE_NAME; 

            
      CURSOR C_GET_FEATURES (T_SERO_ID SERVICE_ORDER_FEATURES.SOFE_SERO_ID%TYPE) IS
      
            SELECT  COUNT(SOFE_FEATURE_NAME) FEATURE_COUNT
            FROM    SERVICE_ORDER_FEATURES
            WHERE   SOFE_SERO_ID=T_SERO_ID
            AND     SOFE_FEATURE_NAME IN ('SF_BAR_INCOMING_CALL','SF_BAR_OUTGOING_CALL','SF_IDD')
            AND        NVL(SOFE_DEFAULTVALUE,'N') <> NVL(SOFE_PREV_VALUE,'N')
            ORDER BY SOFE_FEATURE_NAME;
            
            
      V_SERO_ID         SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_ID%TYPE;
      V_SERO_REVISION   SERVICE_IMPLEMENTATION_TASKS.SEIT_SERO_REVISION%TYPE;
      V_ORDER_TYPE      SERVICE_ORDERS.SERO_ORDT_TYPE%TYPE;      
      V_SEIT_ID         SOP_QUEUE.SOPQ_SEIT_ID%TYPE;
      V_SORD_VALUE      SOP_REPLY_DATA.SORD_VALUE%TYPE;
      V_SORD_VALUE_NEW      SOP_REPLY_DATA.SORD_VALUE%TYPE;
      V_SORD_VALUE_OLD      SOP_REPLY_DATA.SORD_VALUE%TYPE;
      
      V_MSG               VARCHAR2(500);

      
      V_REPLY               VARCHAR2(300);
      V_RETN                VARCHAR2(100);
      V_VALUE               VARCHAR2(100);
      V_LENGT               VARCHAR2(100);
      V_FNR                 VARCHAR2(100);
      V_REPLY_NEW               VARCHAR2(300);
      V_RETN_NEW                VARCHAR2(100);
      V_VALUE_NEW               VARCHAR2(100);
      V_LENGT_NEW               VARCHAR2(100);
      V_FNR_NEW                 VARCHAR2(100);
      V_REPLY_OLD               VARCHAR2(300);
      V_RETN_OLD                VARCHAR2(100);
      V_VALUE_OLD               VARCHAR2(100);
      V_LENGT_OLD               VARCHAR2(100);
      V_FNR_OLD                 VARCHAR2(100);
      CURR_COUNT               VARCHAR2(10);
      OLD_COUNT                VARCHAR2(10);
      FEATURE_COUNT            VARCHAR2(10);
BEGIN


    OPEN C_SERO_ID;
    FETCH C_SERO_ID INTO V_SERO_ID, V_SERO_REVISION;
    CLOSE C_SERO_ID;

    OPEN C_ORDER_TYPE(V_SERO_ID, V_SERO_REVISION);
    FETCH C_ORDER_TYPE INTO V_ORDER_TYPE;
    CLOSE C_ORDER_TYPE;
      
      
    OPEN C_SEIT_ID(V_SERO_ID, V_SERO_REVISION);
    FETCH C_SEIT_ID INTO V_SEIT_ID;
    CLOSE C_SEIT_ID;
    
    
    OPEN C_GET_FEATURES_NEW(V_SERO_ID);
    FETCH C_GET_FEATURES_NEW INTO CURR_COUNT;
    CLOSE C_GET_FEATURES_NEW;

    
    OPEN C_GET_FEATURES_DEL(V_SERO_ID);
    FETCH C_GET_FEATURES_DEL INTO OLD_COUNT;
    CLOSE C_GET_FEATURES_DEL;   

    OPEN C_GET_FEATURES(V_SERO_ID);
    FETCH C_GET_FEATURES INTO FEATURE_COUNT;
    CLOSE C_GET_FEATURES;   
 
    ---CHECK SOP ERROR AND UPDATE-----
    
    OPEN C_CHK_SOP_ERR(V_SEIT_ID);
    FETCH C_CHK_SOP_ERR INTO V_MSG;
    CLOSE C_CHK_SOP_ERR;
       
    
    IF  V_MSG IS NOT NULL THEN
    
    INSERT INTO CLARITY.SERVICE_ORDER_COMMENTS 
    (SEOC_SERO_ID,SEOC_SERO_REVISION,SEOC_ID,SEOC_USERID,SEOC_TIMESTAMP,SEOC_TEXT,SEOC_INDICATOR)
    VALUES
    (V_SERO_ID, V_SERO_REVISION,SEOC_ID_SEQ.NEXTVAL,USER,SYSDATE,V_MSG,'N');
    
    END IF;
    --- Check features and update attributes----------   
           
         IF CURR_COUNT >0 THEN
         
            update SERVICE_ORDER_ATTRIBUTES SOA
            set soa.SEOA_DEFAULTVALUE = 'Y'
            where soa.SEOA_SERO_ID = V_SERO_ID
            and soa.SEOA_NAME = 'ZTE_SS_ACT_FEATURES';
            
         ELSE
         
                update SERVICE_ORDER_ATTRIBUTES SOA
                set soa.SEOA_DEFAULTVALUE = 'N'
                where soa.SEOA_SERO_ID = V_SERO_ID
                and soa.SEOA_NAME = 'ZTE_SS_ACT_FEATURES';   
         
         
         END IF;
         
          IF OLD_COUNT >0 THEN
         
            update SERVICE_ORDER_ATTRIBUTES SOA
            set soa.SEOA_DEFAULTVALUE = 'Y'
            where soa.SEOA_SERO_ID = V_SERO_ID
            and soa.SEOA_NAME = 'ZTE_SS_DEACT_FEATURES';         
         
         ELSE
         
            update SERVICE_ORDER_ATTRIBUTES SOA
            set soa.SEOA_DEFAULTVALUE = 'N'
            where soa.SEOA_SERO_ID = V_SERO_ID
            and soa.SEOA_NAME = 'ZTE_SS_DEACT_FEATURES';
            
                     
         END IF;   

-------    FETHURES CHECK ('SF_BAR_INCOMING_CALL','SF_BAR_OUTGOING_CALL','SF_IDD') ---------------------


          IF FEATURE_COUNT >0 THEN
         
            update SERVICE_ORDER_ATTRIBUTES SOA
            set soa.SEOA_DEFAULTVALUE = 'Y'
            where soa.SEOA_SERO_ID = V_SERO_ID
            and soa.SEOA_NAME = 'ZTE_SS_PROV_FEATURES';         
         
         ELSE
         
            update SERVICE_ORDER_ATTRIBUTES SOA
            set soa.SEOA_DEFAULTVALUE = 'N'
            where soa.SEOA_SERO_ID = V_SERO_ID
            and soa.SEOA_NAME = 'ZTE_SS_PROV_FEATURES';
            
                     
         END IF;   

     
              
----------------------------------------------------

    IF V_ORDER_TYPE LIKE 'CREATE%' THEN
    
        OPEN C_SORD_VALUE_ATTR(V_SEIT_ID);
        FETCH C_SORD_VALUE_ATTR INTO V_SORD_VALUE;
        CLOSE C_SORD_VALUE_ATTR;

        V_REPLY:=SUBSTR(V_SORD_VALUE,INSTR(V_SORD_VALUE,'RETN='));
       
        V_RETN:=TRIM(TRANSLATE(SUBSTR(V_REPLY,1,INSTR(V_REPLY,',',1)),'RETN=,',' '));
        
        IF V_RETN='0' THEN
        
            V_VALUE:=TRIM(TRANSLATE(SUBSTR(V_REPLY,INSTRC(V_REPLY,',',1,7),INSTRC(V_REPLY,',',1,8)-INSTRC(V_REPLY,',',1,7)),',"',' '));
            
            V_LENGT:=LENGTH(V_VALUE);
            
            IF V_LENGT <=4 THEN
            
                V_FNR:='NON-FNR';
            
            ELSIF V_LENGT >4 THEN
            
                V_FNR:='FNR';
            
            ELSE            
            
                V_FNR:=NULL;
            
            END IF;
        
        ELSE
        
            V_FNR:='NA';
        
        END IF;      
    
    ELSE
        ------  ZTE_SS_SHOW_SDN-------  
        OPEN C_SORD_VALUE_SDN(V_SEIT_ID);
        FETCH C_SORD_VALUE_SDN INTO V_SORD_VALUE;
        CLOSE C_SORD_VALUE_SDN;
    
        V_REPLY:=SUBSTR(V_SORD_VALUE,INSTR(V_SORD_VALUE,'RETN='));     
         
        V_RETN:=TRIM(TRANSLATE(SUBSTR(V_REPLY,1,INSTR(V_REPLY,',',1)),'RETN=,',' '));

        IF V_RETN='0' THEN
        
            V_VALUE:=TRIM(TRANSLATE(SUBSTR(V_REPLY,INSTRC(V_REPLY,',',-1,1)),'," NMSI>',' '));
            
            V_LENGT:=LENGTH(V_VALUE);
            
            IF V_LENGT =7 THEN
            
                V_FNR:='NON-FNR';
            
            ELSIF V_LENGT >7 THEN
            
                V_FNR:='FNR';
            
            ELSE            
            
                V_FNR:=NULL;
            
            END IF;
        
        ELSE
        
            V_FNR:='NA';
        
        END IF; 

        ------  ZTE_SS_SHOW_SDN_NEW-------  
        OPEN C_SORD_VALUE_SDN_NEW(V_SEIT_ID);
        FETCH C_SORD_VALUE_SDN_NEW INTO V_SORD_VALUE_NEW;
        CLOSE C_SORD_VALUE_SDN_NEW;
    
        V_REPLY_NEW:=SUBSTR(V_SORD_VALUE_NEW,INSTR(V_SORD_VALUE_NEW,'RETN='));     
         
        V_RETN_NEW:=TRIM(TRANSLATE(SUBSTR(V_REPLY_NEW,1,INSTR(V_REPLY_NEW,',',1)),'RETN=,',' '));

        IF V_RETN_NEW='0' THEN
        
            V_VALUE_NEW:=TRIM(TRANSLATE(SUBSTR(V_REPLY_NEW,INSTRC(V_REPLY_NEW,',',-1,1)),'," NMSI>',' '));
            
            V_LENGT_NEW:=LENGTH(V_VALUE_NEW);
            
            IF V_LENGT_NEW =7 THEN
            
                V_FNR_NEW:='NON-FNR';
            
            ELSIF V_LENGT_NEW >7 THEN
            
                V_FNR_NEW:='FNR';
            
            ELSE            
            
                V_FNR_NEW:=NULL;
            
            END IF;
        
        ELSE
        
            V_FNR_NEW:='NA';
        
        END IF; 

    -------------ZTE_SS_SHOW_MOD_NUM-----------  
    OPEN C_ZTE_SS_SHOW_MOD_NUM(V_SEIT_ID);
        FETCH C_ZTE_SS_SHOW_MOD_NUM INTO V_SORD_VALUE_OLD;
        CLOSE C_ZTE_SS_SHOW_MOD_NUM;

        V_REPLY_OLD:=SUBSTR(V_SORD_VALUE_OLD,INSTR(V_SORD_VALUE_OLD,'RETN='));
       
        V_RETN_OLD:=TRIM(TRANSLATE(SUBSTR(V_REPLY_OLD,1,INSTR(V_REPLY_OLD,',',1)),'RETN=,',' '));
        
        IF V_RETN_OLD='0' THEN
        
            V_VALUE_OLD:=TRIM(TRANSLATE(SUBSTR(V_REPLY_OLD,INSTRC(V_REPLY_OLD,',',1,7),INSTRC(V_REPLY_OLD,',',1,8)-INSTRC(V_REPLY_OLD,',',1,7)),',"',' '));
            
            V_LENGT_OLD:=LENGTH(V_VALUE_OLD);
            
            IF V_LENGT_OLD <=4 THEN
            
                V_FNR_OLD:='NON-FNR';
            
            ELSIF V_LENGT_OLD >4 THEN
            
                V_FNR_OLD:='FNR';
            
            ELSE            
            
                V_FNR_OLD:=NULL;
            
            END IF;
        
        ELSE
        
            V_FNR_OLD:='NA';
        
        END IF; 
      
    END IF;

    IF V_FNR IS NOT NULL THEN
    
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_FNR
        where soa.SEOA_SERO_ID = V_SERO_ID
        and soa.SEOA_NAME = 'SA_NUMBER_TYPE';

        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_FNR_NEW
        where soa.SEOA_SERO_ID = V_SERO_ID
        and soa.SEOA_NAME = 'SA_NUMBER_TYPE_NEW';

        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = V_FNR_OLD
        where soa.SEOA_SERO_ID = V_SERO_ID
        and soa.SEOA_NAME = 'SA_NUMBER_TYPE_OLD';
        
        p_ret_char := 'OK';
        p_ret_msg := NULL;
        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    ELSE
    
        p_ret_msg  := 'SS FNR IS NULL' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
        
                p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);
    
    END IF;
    

 EXCEPTION
 WHEN OTHERS THEN


        p_ret_msg  := 'SS FNR UPDATE FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);


END CREDIT_UPDATE_NUMBER_TYPE;
--- Samitha Sagara 20032016

---- Dinesh Perera 2016-03-01 ----
PROCEDURE PLANNED_EVENTS_AUTO_INPROGRESS
(     p_serv_id                IN     Services.serv_id%TYPE,
      p_sero_id                IN     Service_Orders.sero_id%TYPE,
      p_seit_id                IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname          IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                IN     work_order.woro_id%TYPE,
      p_ret_char              OUT     VARCHAR2,
      p_ret_number            OUT     NUMBER,
      p_ret_msg               OUT     VARCHAR2) IS

    CURSOR C_PE_query  IS
        
    SELECT  SERO_OEID
    FROM    SERVICE_ORDERS SO,SERVICE_IMPLEMENTATION_TASKS SI
    WHERE   SERO_ID = SEIT_SERO_ID
    AND     SEIT_ID = p_seit_id;
          
    l_PE_OEID          SERVICE_ORDERS.SERO_OEID%TYPE;

    BEGIN
         OPEN C_PE_query;
         FETCH C_PE_query 
         INTO l_PE_OEID;
         CLOSE C_PE_query;
         
             IF l_PE_OEID IS NOT NULL
             THEN
                    UPDATE PLANNED_EVENTS 
                    SET PLAE_STATE = 'INPROGRESS'
                    WHERE PLAE_NUMBER = l_PE_OEID;                                      
             END IF;
                
            p_ret_char  := 'PLANNED EVENT STATUS CHANGED TO INPROGRESS';
            p_ret_msg   := NULL;
            p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id, 'COMPLETED'); 

     EXCEPTION
     WHEN OTHERS THEN
           p_ret_msg  := 'Failed to PLANNED EVENTS ATTRIBUTES:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
           
                   p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg);

    END PLANNED_EVENTS_AUTO_INPROGRESS;
---- Dinesh Perera 2016-03-01 ----

--Dulip Fernando 2015-05-05
-- Up date ACCESS BEARER STATUS based on berare ID 
--Version 1.0

PROCEDURE D_IP_TRK_LIN_ACC_BEA_STA (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR bearer
   IS
      SELECT DISTINCT soa.seoa_defaultvalue
                 FROM service_orders so, service_order_attributes soa
                WHERE so.sero_id = soa.seoa_sero_id
                  AND soa.seoa_name = 'ACCESS BEARER ID'
                  AND so.sero_id = p_sero_id;

   CURSOR so_copyattr (v_new_bearer_id VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
                 FROM service_orders so,
                      service_order_attributes soa,
                      circuits c
                WHERE so.sero_id = soa.seoa_sero_id
                  AND so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'CANCELLED'
                       AND c.cirt_status <> 'PENDINGDELETE'
                      )
                  AND so.sero_stas_abbreviation <> 'CANCELLED'
                  AND so.sero_id IN (
                         SELECT MAX (s.sero_id)
                           FROM service_orders s, circuits ci
                          WHERE s.sero_cirt_name = ci.cirt_name
                            AND s.sero_stas_abbreviation <> 'CANCELLED'
                            AND ci.cirt_displayname = v_new_bearer_id);

   v_so_attr_name       VARCHAR2 (100);
   v_so_attr_val        VARCHAR2 (100);
   v_bearer_id          VARCHAR2 (100);
   v_cir_status         VARCHAR2 (100);
   v_new_bearer_id      VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);
   v_service_order      VARCHAR2 (100);
   v_new_service_type   VARCHAR2 (100);
   
   
BEGIN

   OPEN bearer;

   FETCH bearer INTO v_bearer_id;

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   OPEN so_copyattr (v_bearer_id);

  LOOP
      FETCH so_copyattr
       INTO v_so_attr_name, v_so_attr_val, v_cir_status;
       
      EXIT WHEN so_copyattr%NOTFOUND;
   
    END LOOP;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;
   
   /* To be up date with other service order types 

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE-TRANSFER'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE-OR'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF        v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_cir_status = 'COMMISSIONED'
      OR v_cir_status = 'INSERVICE'
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF        v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_cir_status = 'COMMISSIONED'
      OR v_cir_status = 'INSERVICE'
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

    */

   CLOSE so_copyattr;

   CLOSE bearer;

 p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D_IP_TRK_LIN_ACC_BEA_STA Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_IP_TRK_LIN_ACC_BEA_STA;

---Dulip Fernando  2015-11-05

--Dulip Fernando 2015-08-31 
-- *****************************************************************

-- Description: D-IP TRUNK LINE 
--<RTOM AREA>-<LEA>-OSP-NC  if ACCESS MEDIUM='COPPER'  
--and ACCESS BEARER STATUS= 'COMMISSIONED" and  MSAN/DSLAM  location is a sub node 

--<RTOM AREA>-<LEA>-MDF  
--if ACCESS MEDIUM='COPPER'  and ACCESS BEARER STATUS= 'COMMISSIONED" and  MSAN/DSLAM  location is a main node 

-- Error Conditions Raised:

--

-- Author:      <your name>

--Dulip Fernando 

-- Revision History

-- Date            Author         Reason for Change

-- ----------------------------------------------------------------

-- 2015 05 11    Dulip Fernando   Created.

-- *****************************************************************
--2015-08-31 following order types are covered .

--D_IP_TRUNK_X_CONN_WG_CHG
--CREATE
--CREATE-UPGRADE 
--CREATE-OR 
--CREATE-TRANSFER 
--MODIFY-SPEED 
--DELETE 
--DELETE-OR 
--MODIFY-LOCATION 

PROCEDURE D_IP_TRUNK_X_CONN_WG_CHG (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_equip_type            VARCHAR2 (100); 
  v_eq_loc_name           VARCHAR2 (100); 
  v_service_type          VARCHAR2 (100); 
  v_service_order         VARCHAR2 (100); 
  v_service_order_area    VARCHAR2 (100); 
  v_rtom_code             VARCHAR2 (100); 
  v_lea_code              VARCHAR2 (100); 
  v_work_group            VARCHAR2 (100); 
  v_work_group_mdf        VARCHAR2 (100); 
  v_location              VARCHAR2 (100); 
  v_main_node             VARCHAR2 (100); 
  v_sub_node              VARCHAR2 (100); 
  v_acc_nw                VARCHAR2 (100); 
  v_acc_bearer_status     VARCHAR2 (100); 
  v_mig_type              VARCHAR2 (100); 
  v_access_bear_id        VARCHAR2 (100); 
  v_ch_dis                VARCHAR2 (100); 
  v_access_id             VARCHAR2 (100); 
  v_cir_trib_status       VARCHAR2 (100); 
  v_cur_nof_copper        VARCHAR2 (100); 
  v_pre_nof_copper        VARCHAR2 (100); 
  v_access_node_chg       VARCHAR2 (100); 
  v_no_of_copper_pair_cur VARCHAR2 (100); 
  v_no_of_copper_pair_pre VARCHAR2 (100); 
  v_new_cir_id            VARCHAR2 (100); 
  v_new_cir_name          VARCHAR2 (100); 
  v_acc_medium            VARCHAR2 (100); 
  v_acc_medium_pre        VARCHAR2 (100); 
  v_ch_dis_p              VARCHAR2 (100); 
  v_cir_trib_status_p     VARCHAR2 (100); 
  v_pre_eq                VARCHAR2 (100); 
  v_pre_location          VARCHAR2 (100); 
  v_location_pre          VARCHAR2 (100); 
  v_pre_main_node         VARCHAR2 (100); 
  v_pre_sub_node          VARCHAR2 (100); 
  CURSOR cur_equi_type IS 
    SELECT DISTINCT e.equp_equt_abbreviation, 
                    e.equp_locn_ttname 
    FROM   service_orders so, 
           ports p, 
           equipment e 
    WHERE  so.sero_cirt_name = p.port_cirt_name 
           AND ( e.equp_equt_abbreviation LIKE 'MSAN%' 
                  OR e.equp_equt_abbreviation LIKE 'DSLAM%' 
                  OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%' 
                  OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%' ) 
           AND p.port_equp_id = e.equp_id 
           AND so.sero_id = p_sero_id; 
  CURSOR cur_tributer ( 
    parent_name  VARCHAR2, 
    v_new_cir_id VARCHAR2) IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   circuits c, 
           circuit_hierarchy ch, 
           circuits ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname NOT LIKE REPLACE (v_new_cir_id,'(N)')||'%' 
           AND c.cirt_displayname like replace(parent_name,'(N)')||'%'; 
  CURSOR cur_tributer_p ( 
    parent_pre_name  VARCHAR2, 
    v_parent_cir_old VARCHAR2) IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   circuits c, 
           circuit_hierarchy ch, 
           circuits ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname NOT LIKE REPLACE (v_parent_cir_old,'(N)')||'%' 
           AND c.cirt_displayname like replace(parent_pre_name,'(N)')||'%'; 
  CURSOR cur_eq_pre ( 
    parent_i VARCHAR2) IS 
    SELECT DISTINCT e.equp_equt_abbreviation, 
                    e.equp_locn_ttname 
    FROM   ports p, 
           equipment e, 
           circuits ci 
    WHERE  ci.cirt_name = p.port_cirt_name 
           AND ( e.equp_equt_abbreviation LIKE 'MSAN%' 
                  OR e.equp_equt_abbreviation LIKE 'DSLAM%' 
                  OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%' 
                  OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%' ) 
           AND p.port_equp_id = e.equp_id 
           AND ci.cirt_displayname = parent_i; 
BEGIN 
    OPEN cur_equi_type; 

    FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name; 

    CLOSE cur_equi_type; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_mig_type 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'MIGRATION TYPE'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_bearer_status 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER STATUS'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_cur_nof_copper, v_pre_nof_copper 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NO OF COPPER PAIRS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_bear_id 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID'; 

    SELECT soa.seoa_prev_value 
    INTO   v_access_id 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS_ID'; 

    SELECT DISTINCT c.cirt_displayname 
    INTO   v_new_cir_name 
    FROM   service_orders so, 
           circuits c 
    WHERE  so.sero_cirt_name = c.cirt_name 
           AND so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_node_chg 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS NODE CHANGE?'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_acc_medium, v_acc_medium_pre 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_no_of_copper_pair_cur, v_no_of_copper_pair_pre 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NO OF COPPER PAIRS'; 

    SELECT Substr (ar.area_area_code, 3, Instr (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   areas ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   work_groups wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_mdf 
    FROM   work_groups wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'MDF' 
                          || '%'; 

    SELECT Substr (v_eq_loc_name, 1, Instr (v_eq_loc_name, '-NODE', '1') - 1) AS 
           node 
    INTO   v_location 
    FROM   dual; 

    SELECT Trim (Substr (v_location, 1, Instr (v_location, '-', '1', 1) - 1)) AS 
           main_node, 
           Trim (Substr (v_location, Instr (v_location, '-') + 1))            AS 
           sub_node 
    INTO   v_main_node, v_sub_node 
    FROM   dual; 

    -- Pre Location Details Start 
    OPEN cur_tributer (v_access_bear_id, v_new_cir_name); 

    FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status; 

    CLOSE cur_tributer; 

    OPEN cur_tributer_p (v_access_id, v_new_cir_name); 

    FETCH cur_tributer_p INTO v_ch_dis_p, v_cir_trib_status_p; 

    CLOSE cur_tributer_p; 

    OPEN cur_eq_pre (v_access_id); 

    FETCH cur_eq_pre INTO v_pre_eq, v_pre_location; 

    CLOSE cur_eq_pre; 

    SELECT Substr (v_pre_location, 1, Instr (v_pre_location, '-NODE', '1') - 1) 
           AS 
           node 
    INTO   v_location_pre 
    FROM   dual; 

    SELECT Trim (Substr (v_location_pre, 1, Instr (v_location_pre, '-', '1', 1) 
                                            - 1) 
           ) AS 
           main_node, 
           Trim (Substr (v_location_pre, Instr (v_location_pre, '-') + 1)) 
           AS sub_node 
    INTO   v_pre_main_node, v_pre_sub_node 
    FROM   dual; 

     
    IF v_main_node IS NOT NULL THEN
       
     --CREATE    
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      
      --CREATE-UPGRADE 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-UPGRADE' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-UPGRADE' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%%DSLM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-UPGRADE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
     
         
      --CREATE-OR 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-OR' 
         AND v_main_node = v_sub_node 
         and v_acc_medium = 'COPPER'
         --AND ( v_equip_type LIKE '%MSAN%' 
               -- OR v_equip_type LIKE '%DSLAM%' ) 
         --AND ( v_acc_nw = 'DSLAM PORT' 
                --OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-OR' 
            AND v_main_node = v_sub_node 
            --AND ( v_equip_type LIKE '%MSAN%' 
                  -- OR v_equip_type LIKE '%DSLAM%' ) 
            --AND ( v_acc_nw = 'DSLAM PORT' 
                  -- OR v_acc_nw = 'MSAN PORT' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      --CREATE-TRANSFER 
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-TRANSFER' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-TRANSFER' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-TRANSFER' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF;
      
      --MODIFY-SPEED 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND v_main_node <> v_sub_node
         AND v_acc_medium = 'COPPER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-SPEED' 
            AND v_main_node = v_sub_node
            AND v_acc_medium = 'COPPER' 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_nw = 'DSLAM PORT' 
                   OR v_acc_nw = 'MSAN PORT' ) 
            AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      END IF; 

        /*

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      END IF; 
      */ 

      --DELETE 
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'DELETE' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF; 

      --DELETE-OR 
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'DELETE-OR' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE-OR' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_nw = 'DSLAM PORT' 
                   OR v_acc_nw = 'MSAN PORT' ) 
            AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF; 

      --MODIFY-LOCATION 
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_medium = 'COPPER' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' 
            AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_medium = 'COPPER' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' 
            AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF; 
    END IF; 

    IF v_main_node IS NULL THEN
    
     --CREATE 
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CCREATE-UPGRADE   
     IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-UPGRADE' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-UPGRADE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      -- CREATE-OR 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-OR' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CREATE-TRANSFER 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'CREATE-TRANSFER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_mig_type = 'LEGACY TO NGN' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'CREATE-TRANSFER' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF;
      
      --MODIFY-SPEED  -- MAKE ADD. X CONNECTS

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND v_acc_medium = 'COPPER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      END IF;
      
      
      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      END IF;
      
      --DELETE 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'DELETE' 
         AND v_equip_type LIKE '%MSAN%' 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF;
      
      --DELETE-OR 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'DELETE-OR' 
         AND v_equip_type LIKE '%MSAN%' 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'DELETE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF;
      
      --MODIFY-LOCATION 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      IF v_service_type = 'D-IP TRUNK LINE' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-IP TRUNK LINE' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF; 
    END IF; 

     

    p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 'Failed to Workgroup Mapping Please check the Cross Connection Equip Type  :  - Erro  is:' 
                          || To_char (SQLCODE) 
                          || '-' 
                          || SQLERRM; 

             p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, 
             p_seit_id, 
             'ERROR' 
             ); 

             INSERT INTO service_task_comments 
                         (setc_seit_id, 
                          setc_id, 
                          setc_userid, 
                          setc_timestamp, 
                          setc_text) 
             VALUES      (p_seit_id, 
                          setc_id_seq.NEXTVAL, 
                          'CLARITYB', 
                          SYSDATE, 
                          p_ret_msg); 
END D_IP_TRUNK_X_CONN_WG_CHG;
--Dulip Fernando 2015-08-31

--Dulip Fernando  2015-08-05
--Version 1.2
--IP TRUNK 
-- 2015-Apr-28 
--Edit 2015-05-05
--blank ACCESS BEARER ID based on ACCESS BEARER STATUS = 'NEW

PROCEDURE  D_IP_TR_ACC_BEA_ID_BLANK(
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_ACC_BEARER_STATUS varchar2(100);
v_ACC_BEARER_ID     varchar2(100);


begin

select soa.seoa_defaultvalue INTO v_ACC_BEARER_STATUS
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';

    IF       
    
        v_ACC_BEARER_STATUS='NEW'
        
        THEN

        UPDATE service_order_attributes soa
        SET SOA.SEOA_DEFAULTVALUE = NULL
        WHERE soa.seoa_name = 'ACCESS BEARER ID' and  soa.seoa_sero_id = p_sero_id;


    END IF ;

   

p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed D_IP_TR_ACC_BEA_ID_BLANK Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_IP_TR_ACC_BEA_ID_BLANK;

-- *****************************************************************
-- Description: 
-- SERVICE TYPE : D-IP TRUNK LINE .
-- COPY ATTRIBUTES FROM BEARERE  FOR ALL ORDER TYPES .     

-- Error Conditions Raised:

-- Author: Dulip Fernando 

-- Revision History

-- Date            Author              Reason for Change

-- ----------------------------------------------------------------

-- 07 May 2015     Dulip Fernando      D_IP_TR_CP_ATT_BEA_TO_SER   PF Created.
-- 2015-05-15      Dulip Fernando      D_IP_TR_CP_ATT_BEA_TO_SER   review  version 1.02 
-- 2015-08-24      Dulip Fernando      D_IP_TR_CP_ATT_BEA_TO_SER   Complied in to CLTY_UAT
-- *****************************************************************

PROCEDURE D_IP_TR_CP_ATT_BEA_TO_SER (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR bearer
   IS
      SELECT DISTINCT soa.seoa_defaultvalue
                 FROM service_orders so, service_order_attributes soa
                WHERE so.sero_id = soa.seoa_sero_id
                  AND soa.seoa_name = 'ACCESS_ID'
                  AND so.sero_id = p_sero_id;

   CURSOR so_copyattr (v_new_bearer_id VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
                 FROM service_orders so,
                      service_order_attributes soa,
                      circuits c
                WHERE so.sero_id = soa.seoa_sero_id
                  AND so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'CANCELLED'
                       AND c.cirt_status <> 'PENDINGDELETE'
                      )
                  AND so.sero_stas_abbreviation <> 'CANCELLED'
                  AND so.sero_id IN (
                         SELECT MAX (s.sero_id)
                           FROM service_orders s, circuits ci
                          WHERE s.sero_cirt_name = ci.cirt_name
                            AND s.sero_stas_abbreviation <> 'CANCELLED'
                            AND ci.cirt_displayname LIKE
                                        REPLACE (v_new_bearer_id, '(N)')
                                        || '%');

   v_so_attr_name       VARCHAR2 (100);
   v_so_attr_val        VARCHAR2 (100);
   v_bearer_id          VARCHAR2 (100);
   v_cir_status         VARCHAR2 (100);
   v_new_bearer_id      VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);
   v_service_order      VARCHAR2 (100);
   v_new_service_type   VARCHAR2 (100);
BEGIN
   OPEN bearer;

   FETCH bearer
    INTO v_bearer_id;

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   OPEN so_copyattr (v_bearer_id);

   LOOP
      FETCH so_copyattr
       INTO v_so_attr_name, v_so_attr_val, v_cir_status;

      EXIT WHEN so_copyattr%NOTFOUND;

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'CREATE'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
     
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
   
   
       ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';                       
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';        
            
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      
      /*
            ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
    */ 
    
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';    
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'ACCESS LINK PLAN REF#'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK PLAN REF#';             
        
          
                         
      END IF;
      
      -- CREATE-UPGRADE 
      
         IF  v_service_type = 'D-IP TRUNK LINE'
             AND v_service_order = 'CREATE-UPGRADE'
             AND v_so_attr_name = 'ACCESS N/W INTF'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ACCESS N/W INTF';

           ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'CPE CLASS'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'CPE TYPE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'CPE MODEL'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'NTU MODEL'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
          
          
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'NTU TYPE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';                       
          
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'NTU CLASS'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';        
                
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'NTU ROUTING MODE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'NTU ROUTING MODE';
          
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'ACCESS MEDIUM'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ACCESS MEDIUM';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'NO OF COPPER PAIRS'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'NO OF COPPER PAIRS';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'ACCESS INTF PORT BW'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ACCESS INTF PORT BW';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'DATA RADIO MODEL'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'DATA RADIO MODEL';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'CUSTOMER INTF TYPE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'CUSTOMER INTF TYPE';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'BACKBONE CORE NO'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'BACKBONE CORE NO';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'ACCESS LINK DISTANCE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ACCESS LINK DISTANCE';
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';

          ELSIF     v_service_type = 'D-IP TRUNK LINE'
                AND v_service_order = 'CREATE-UPGRADE'
                AND v_so_attr_name = 'ACCES LINK DISTANCE'
          THEN
             UPDATE service_order_attributes soa
                SET soa.seoa_defaultvalue = v_so_attr_val
              WHERE soa.seoa_sero_id = p_sero_id
                AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';              
        END IF;
      
     -- CREATE-TRANSFER 


      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'CREATE-TRANSFER'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
            */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';            
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';   
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU CLASS'
            
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU MODEL CHANGE?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU MODEL CHANGE?';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE MODEL CHANGE?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CPE MODEL CHANGE?';
      
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE CHANGE?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CPE CHANGE?';
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'OLD CIRCUIT ID'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'OLD CIRCUIT ID';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'MIGRATION TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'MIGRATION TYPE';
      /*
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE CHANGE?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?';
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;
      
      
      
      -- CREATE-OR

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'CREATE-OR'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
      
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
     

      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
          
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
            
       */     
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';   
         
          -- ACCESS LINK PLAN REF#  = ACCESS LINK PLAN REF# ????? 
                    
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'ACCESS LINK PLAN REF#'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK PLAN REF#';      
                                 
                         
      END IF;

        --MODIFY-SPEED


      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
                  
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
      
           
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;

            --DELETE 


      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'DELETE'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      /*
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
            ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
      
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
      

      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;

        --DELETE-OR


      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'DELETE-OR'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
          
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';  
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'DELETE-OR'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;

        --MODIFY-LOCATION

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      */
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
          
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
          
          
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
          
          
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';

      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';

      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';
      
      -- CUSTOMER INTF TYPE 
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
-- Modified 2014 / 11 / 20
      /*
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
      */      
       
           
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';              
      END IF;

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = ''
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'AGGREGATE NETWORK 1';
      END IF;

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = ''
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'AGGREGATE NETWORK 2';
      END IF;
      
      /*

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = ''
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS NODE CHANGE?';
       
      END IF;
      
      */
      
      --MODIFY-EQUIPMENT 

      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-EQUIPMENT'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
       */     
            
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
           
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';      
      
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';  
            
          --CUSTOMER INTF TYPE 

      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
      END IF;

        --MODIFY-CPE 


      IF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-CPE'
         AND v_so_attr_name = 'ACCESS N/W INTF'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS N/W INTF';
      
      /*
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'SECTION_HANDLED_BY'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'SECTION HANDLED BY';
      */     
            
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CPE CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CPE TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CPE MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';           
      
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU CLASS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
            
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU ROUTING MODE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NTU ROUTING MODE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'ACCESS MEDIUM'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS MEDIUM';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NO OF COPPER PAIRS'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'NO OF COPPER PAIRS';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'ACCESS INTF PORT BW'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS INTF PORT BW';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'DATA RADIO MODEL'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'DATA RADIO MODEL';     
            
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CUSTOMER INTF TYPE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'CUSTOMER INTF TYPE';
                        
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'BACKBONE CORE NO'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'BACKBONE CORE NO';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'ACCESS LINK DISTANCE'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'ACCESS LINK DISTANCE';
      ELSIF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
      THEN
         UPDATE service_order_attributes soa
            SET soa.seoa_defaultvalue = v_so_attr_val
          WHERE soa.seoa_sero_id = p_sero_id
            AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';

      END IF;
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

   /*IF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS N/W INTF'
   /*
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE CLASS'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU CLASS' THEN
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
  AND soa.seoa_name = 'NTU ROUTING MODE';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
  AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS INTF PORT BW'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-IP TRUNK LINE'
AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
ELSIF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'AGGREGATE NETWORK 1'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';
ELSIF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'AGGREGATE NETWORK 2'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
ELSIF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS NODE CHANGE?'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
END IF; */
  
  END LOOP;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE-TRANSFER'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE-OR'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_cir_status
       WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
         AND soa.seoa_sero_id = p_sero_id;
   END IF;

   CLOSE so_copyattr;

   CLOSE bearer;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D_IP_TR_LI_BE_ATT_CP function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_IP_TR_CP_ATT_BEA_TO_SER;

-- *****************************************************************

-- Description: Copy attributes (* which were copied from bearere ) from D-IP TRUNK LINE  to bearer at the end of the close SO
-- D_IP_TR_CP_ATT_BEA_TO_SER_v2
-- Error Conditions Raised:
-- Author:      <your name>

--

-- Revision History

-- Date            Author       Reason for Change

-- ----------------------------------------------------------------

-- 2015-05-05    Dulip Fernando     Created. 
-- 2015-05-06 
-- 2015-05-07 
-- 2015-05-19   Dulip Fernando      Reviev 
-- 2015-08-24   Complied in to CLTY_UAT

-- *****************************************************************

PROCEDURE D_IP_TR_CP_ATT_SER_TO_BER (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR bearer
   IS
      SELECT DISTINCT soa.seoa_defaultvalue
                 FROM service_orders so, service_order_attributes soa
                WHERE so.sero_id = soa.seoa_sero_id
                  AND soa.seoa_name = 'ACCESS BEARER ID'
                  AND so.sero_id = p_sero_id;

   CURSOR so_copyattr (v_new_bearer_id VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_sero_id, c.cirt_status, c.cirt_serv_id
                 FROM service_orders so,
                      service_order_attributes soa,
                      circuits c
                WHERE so.sero_id = soa.seoa_sero_id
                  AND so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'CANCELLED'
                       AND c.cirt_status <> 'PENDINGDELETE'
                      )
                  AND so.sero_stas_abbreviation <> 'CANCELLED'
                  AND so.sero_id IN (
                         SELECT MAX (s.sero_id)
                           FROM service_orders s, circuits ci
                          WHERE s.sero_cirt_name = ci.cirt_name
                            AND s.sero_stas_abbreviation <> 'CANCELLED'
                            AND ci.cirt_displayname LIKE
                                        REPLACE (v_new_bearer_id, '(N)')
                                        || '%');

   CURSOR so_att_mapping
   IS
      SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue
                 FROM service_orders so, service_order_attributes soa
                WHERE so.sero_id = soa.seoa_sero_id AND so.sero_id = p_sero_id;

   v_cir_status      VARCHAR2 (100);
   v_bearer_so_id    VARCHAR2 (100);
   v_so_attr_name    VARCHAR2 (100);
   v_so_att_val      VARCHAR2 (100);
   v_new_bearer_id   VARCHAR2 (100);
   v_bearer_id       VARCHAR2 (100);
   v_service_type    VARCHAR2 (100);
   v_service_order   VARCHAR2 (100);
   v_new_service     VARCHAR2 (100);
   v_cir_id          VARCHAR2 (100);
BEGIN
   OPEN bearer;

   FETCH bearer
    INTO v_bearer_id;

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   OPEN so_copyattr (v_bearer_id);

   FETCH so_copyattr
    INTO v_bearer_so_id, v_cir_status, v_cir_id;

   CLOSE bearer;

   OPEN so_att_mapping;

   LOOP
      FETCH so_att_mapping
       INTO v_so_attr_name, v_so_att_val;

      EXIT WHEN so_att_mapping%NOTFOUND;

      IF v_cir_status = 'COMMISSIONED'
      THEN
         
        -- CREATE 
         
         IF     v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';
         
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
         
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER';
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER';              
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCES LINK DISTANCE';
                      
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';      
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS';        
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';     
          
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';   
             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO'; 
          
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC.FIBER PROJ SO #';     
               

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE')
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;
         
          -- CREATE-UPGRADE 
 
         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
            
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE'; 
               
            
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';
            
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';
       
         ELSIF 
                v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-UPGRADE'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS'; 
             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';             
                  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         

          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
           ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';

               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';                
                            
               
                
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';          
               
             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO';               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCES LINK DISTANCE';       
               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';       
               
           
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC.FIBER PROJ SO #';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER';
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER'; 
    
            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE')
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;
         
         
         -- CREATE-OR



         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
             
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS'; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE'; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';   
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO'; 
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';                             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID';  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC.FIBER PROJ SO #';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER';

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;

        -- CREATE-TRANSFER
        

         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';    
               

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';       
            
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';                
            
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS';        
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';                
              
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU MODEL CHANGED?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL CHANGED?';      
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE CHANGE?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CHANGE?';      
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'OLD CIRCUIT ID'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'OLD CIRCUIT ID';       
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'MIGRATION TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'MIGRATION TYPE';   
            
           ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
            
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER'; 
         
         

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;

        --MODIFY-SPEED 

         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
         
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';    
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';       

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';                
            
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE'; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS'; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';                
              
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';      
         
       
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';   

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO'; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS LINK DISTANCE';         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
              AND soa.seoa_name = 'NTU SERIAL NUMBER';  
          
          /*    
          IF 
           TEST to PERMANENT
          
          
          END IF; 
          
          */
         
         END IF; 

          -- MODIFY-LOCATION 
       
        IF         v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';    
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';       
  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';                
 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS';               

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';                
              
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
       
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO';               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCES LINK DISTANCE';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC.FIBER PROJ SO #';             
             
           /*  
             
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU MODEL CHANGED?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL CHANGED?';      
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE CHANGE?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CHANGE?';      
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'OLD CIRCUIT ID'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'OLD CIRCUIT ID';       
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'MIGRATION TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'MIGRATION TYPE';   
            
        */
            
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER'; 
         
         

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         
        END IF;
           

       
           -- MODIFY-CPE


        IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
                        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE CLASS' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE TYPE' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';    
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE MODEL' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';       
  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU MODEL' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';                
 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU TYPE' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS';               

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';                
              
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
       
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'BACKBONE CORE NO' 
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO';                
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCES LINK DISTANCE';

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ADDITIONAL NTU S/N'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU S/N'; 
         /*
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACC.FIBER PROJ SO #';             
             
           /*  
             
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU MODEL CHANGED?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL CHANGED?';      
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE CHANGE?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CHANGE?';      
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'OLD CIRCUIT ID'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'OLD CIRCUIT ID';       
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'MIGRATION TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'MIGRATION TYPE';   
          
         /*

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
            
            */
         
         END IF;
            
         -- MODIFY-EQUIPMENT
        IF              v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS N/W INTF';
         
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE CLASS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE TYPE';    
               

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE MODEL';       

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU MODEL';                
            
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU TYPE';  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU CLASS'; 
           
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU MODEL';  
        
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU ROUTING MODE';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS MEDIUM';                
              
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NO OF COPPER PAIRS';
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS INTF PORT BW';
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'DATA RADIO MODEL';      
         
       
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CUSTOMER INTF TYPE';   
        
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'BACKBONE CORE NO'; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS LINK DISTANCE'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ACCESS LINK DISTANCE';         
                   ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';


        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'CPE SERIAL NUMBER'; 

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'NTU SERIAL NUMBER';  
           
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ADDITIONAL NTU S/N'
         THEN
            UPDATE service_order_attributes soa
               SET soa.seoa_defaultvalue = v_so_att_val
             WHERE soa.seoa_sero_id = v_bearer_so_id
               AND soa.seoa_name = 'ADDITIONAL NTU S/N'; 
            
         END IF;

               

         -- END  COMMISSIONED 
 
        -- SERVICES ATTRIBUTES UPDATE .


         --ELSIF v_cir_status = 'INSERVICE'
     
      
   ----------------------------------CREATE LIST  services_attributes--
      
         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;       

  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACCESS LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACC.FIBER PROJ SO # '
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;

           ----------------------------------CREATE LIST  services_attributes--



            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;

            --- CREATE-UPGRADE:
         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-UPGRADE'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-UPGRADE'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-UPGRADE'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-UPGRADE'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;       

  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACC.FIBER PROJ SO # '
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;

           ----------------------------------CREATE-UPGRADE LIST  services_attributes--



            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-UPGRADE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF;  
   
            -- CREATE-OR 


         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CPE CLASS'
          
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-OR'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;       

  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;  
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACC. LINK PLAN EVENT ID'
               AND sa.satt_serv_id = v_cir_id;                 

          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACC.FIBER PROJ SO # '
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;

           ----------------------------------CREATE-OR LIST  services_attributes--

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-OR'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF; 
         
         --CREATE-TRANSFER 

         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'CREATE-TRANSFER'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  
               
                             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU MODEL CHANGED?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL CHANGED?'
               AND sa.satt_serv_id = v_cir_id;               

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE CHANGE?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CHANGE?'
               AND sa.satt_serv_id = v_cir_id;               
           
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'OLD CIRCUIT ID'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'OLD CIRCUIT ID'
               AND sa.satt_serv_id = v_cir_id;
               
             
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'MIGRATION TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'MIGRATION TYPE'
               AND sa.satt_serv_id = v_cir_id;
               
                       
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;

           ----------------------------------CREATE-TRANSFER LIST  services_attributes--
           IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'CREATE-TRANSFER'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
            
         END IF; 
         
            --- MODIFY-SPEED:
         IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-SPEED'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id; 
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id; 
         
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
                             
          
           ----------------------------------MODIFY-SPEED LIST  services_attributes--



            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-SPEED'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
            
         END IF;          
         --- MODIFY-CPE  
        IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-CPE'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  
               
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;
               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id; 
         
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND v_so_attr_name = 'ADDITIONAL NTU S/N'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'
               AND sa.satt_serv_id = v_cir_id;               
               

           ----------------------------------MODIFY-CPE LIST  services_attributes--



            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-CPE'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF; 
         
         --MODIFY-EQUIPMENT 
        IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-EQUIPMENT'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  
               
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;
               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id; 
         
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND v_so_attr_name = 'ADDITIONAL NTU S/N'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'
               AND sa.satt_serv_id = v_cir_id;               
               

           ----------------------------------MODIFY-EQUIPMENT LIST  services_attributes--

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-EQUIPMENT'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF; 
         
         
         ---MODIFY-LOCATION 
       
 
        IF        v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS N/W INTF'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS N/W INTF';

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CPE CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE CLASS'
               AND sa.satt_serv_id = v_cir_id;   

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'CPE TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE TYPE'
               AND sa.satt_serv_id = v_cir_id;


         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU TYPE'
               AND sa.satt_serv_id = v_cir_id;

         ELSIF  v_service_type = 'D-IP TRUNK LINE'
            AND v_service_order = 'MODIFY-LOCATION'
            AND v_so_attr_name = 'NTU CLASS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU CLASS'
               AND sa.satt_serv_id = v_cir_id; 
        
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
               AND sa.satt_serv_id = v_cir_id;
              
   
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU ROUTING MODE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU ROUTING MODE'
               AND sa.satt_serv_id = v_cir_id;
                  
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS MEDIUM'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS MEDIUM'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NO OF COPPER PAIRS'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
               AND sa.satt_serv_id = v_cir_id;
 
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCESS INTF PORT BW'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCESS INTF PORT BW'
               AND sa.satt_serv_id = v_cir_id;  
               
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'DATA RADIO MODEL'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'DATA RADIO MODEL'
               AND sa.satt_serv_id = v_cir_id;
               
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CUSTOMER INTF TYPE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CUSTOMER INTF TYPE'
               AND sa.satt_serv_id = v_cir_id; 
         
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'BACKBONE CORE NO'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'BACKBONE CORE NO'
               AND sa.satt_serv_id = v_cir_id;
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACCES LINK DISTANCE'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACCES LINK DISTANCE'
               AND sa.satt_serv_id = v_cir_id; 
               
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'VLAN TAGGED/UNTAGGED ?'
               AND sa.satt_serv_id = v_cir_id;
               
        ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'CPE SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
         ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'NTU SERIAL NUMBER'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
               AND sa.satt_serv_id = v_cir_id;
           
               
          ELSIF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND v_so_attr_name = 'ACC.FIBER PROJ SO #'
         THEN
            UPDATE services_attributes sa
               SET sa.satt_defaultvalue = v_so_att_val
             WHERE sa.satt_attribute_name = 'ACC.FIBER PROJ SO # '
               AND sa.satt_serv_id = v_cir_id; 

           ----------------------------------MODIFY-LOCATION LIST  services_attributes--

            IF     v_service_type = 'D-IP TRUNK LINE'
               AND v_service_order = 'MODIFY-LOCATION'
               AND (v_cir_status = 'COMMISSIONED'
                    OR v_cir_status = 'INSERVICE'
                   )
            THEN
               UPDATE service_order_attributes soa
                  SET soa.seoa_defaultvalue = v_cir_status
                WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
                  AND soa.seoa_sero_id = p_sero_id;
            END IF;
         END IF; 
         
         
/*
 IF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
 AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'AND sa.satt_serv_id = v_cir_id;END IF;
IF     v_service_type = 'D-IP TRUNK LINE'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N' AND sa.satt_serv_id = v_cir_id;END IF;*/
      END IF;
   END LOOP;

   CLOSE so_att_mapping;

   CLOSE so_copyattr;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D_IP_TR_CP_ATT_SER_TO_BER Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_IP_TR_CP_ATT_SER_TO_BER;

-----------------------------------2015-12-10 ----------------------------------------------

--Dulip Fernando 2015-08-31

--Dulip Fernando  2015-08-05
-- Dulip Fernando 2015-05-05 
-- D_IP_TR_CON_CREA 
-- CREATE MAIN WORK FLOW OF TASKS FOR ALL ORDER TYPES .
-- D_IP_TR_WORK_FLOW_01 
--2015-05-05  BUILD MAIN SRTUNCTURE AND ADD   CREATE  
--2015-05-12 Add    CREATE-UPGRADE   CONDITIONS TO CODE 
--2015-05-   Add    CREATE-OR        CONDITIONS TO CODE 
--2015-05-   Add    CREATE-TRANSFER  CONDITIONS TO CODE 
--2015-05-13 Add    MODIFY-SPEED     CONDITIONS TO CODE 
--2015-05-13 ADD    MODIFY-LOCATION AND TO BE CONTINUE FROM  CONFIG CEN PORT
--2015-05-14        MODIFY-LOCATION AND TO BE CONTINUE FROM  CONFIG CEN PORT
-- Note clarification expected from after DEACT. OLD MEN VLAN  from Sakisan .
--2015-05-15  Add   MODIFY-CPE  CONDITIONS TO CODE 
--2015-05-15  Add   MODIFY-IPS  CONDITIONS TO CODE 
--2015-05-15  Add   MODIFY-EQUIPMENT  CONDITIONS TO CODE 
--2015-12-08        remove v_fib_avalable
-- 2015-12-10  deployee into CLTY_UAT
-- 2016-03-03 Add WAIT FOR FIBER rasks reuqsted by Eng Indika De Silve -OSS .

PROCEDURE D_IP_TR_WORK_FLOW_01 (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_cir_status            VARCHAR2 (100);
   v_new_bearer_id         VARCHAR2 (100);
   v_section_hndle         VARCHAR2 (100);
   v_service_type          VARCHAR2 (100);
   v_service_order         VARCHAR2 (100);
   v_service_order_area    VARCHAR2 (100);
   v_rtom_code             VARCHAR2 (100);
   v_lea_code              VARCHAR2 (100);
   v_acc_bear_status       VARCHAR2 (100);
   v_core_network          VARCHAR2 (100);
   v_acc_medium            VARCHAR2 (100);
   v_work_group            VARCHAR2 (100);
   v_acc_nw                VARCHAR2 (100);
   v_ntu_class             VARCHAR2 (100);
   v_ntu_model_changed     VARCHAR2 (100);
   v_work_group_cpe        VARCHAR2 (100);
   v_ser_ctg               VARCHAR2 (100);
   v_so_attr_name          VARCHAR2 (100);
   v_so_attr_val           VARCHAR2 (100);
   v_bearer_id             VARCHAR2 (100);
   v_eng_net               VARCHAR2 (100);
   v_cpe_class             VARCHAR2 (100);
   v_cur_cpe_model         VARCHAR2 (100);
   v_pre_cpe_model         VARCHAR2 (100);
   v_net_ari               VARCHAR2 (100);
   v_fib_avalable          VARCHAR2 (100);
   v_net_aggri_2           VARCHAR2 (100);
   v_net_aggri_1           VARCHAR2 (100);
   v_migra_type            VARCHAR2 (100);
   v_cpe_change            VARCHAR2 (100);
   v_acc_net_po_bw_new     VARCHAR2 (100);
   v_acc_net_po_bw_pv      VARCHAR2 (100);
   v_no_of_cop_pairs_new   VARCHAR2 (100);
   v_no_of_cop_pairs_pv    VARCHAR2 (100);
   v_ntu_model_new         VARCHAR2 (100);
   v_ntu_model_pv          VARCHAR2 (100);
   v_cpe_class_pv          VARCHAR2 (100);
   v_acc_node_change_new   VARCHAR2 (100);
   v_acc_node_change_pv    VARCHAR2 (100);
   v_cus_lan_ip_new        VARCHAR2 (100);
   v_cus_lan_ip_pv         VARCHAR2 (100);
   v_wait_for_fiber_new    VARCHAR2 (100);
   v_acc_fiber_availalbe   VARCHAR2 (100);
   v_operational_region    VARCHAR2 (100);
--v_acc_nw='ACCESS N/W INTF'
--v_acc_medium='ACCESS MEDIUM'
--v_acc_bear_status=ACCESS BEARER STATUS
--v_ser_ctg=
--v_net_aggri_1=AGGREGATE NETWORK 1
--v_net_aggri_2=AGGREGATE NETWORK 2
--NTU MODEL CHANGE?
--ACCESS INTF PORT BW
--v_acc_net_po_bw_new - CURRENT VALUE OF ACC PORT BANDWITH
--v_acc_net_po_bw_pv -  PRIVIOUS VALUE OF ACC PORT BANDWITH
-- v_no_of_cop_pairs_new no if copper paires current value
--v_no_of_cop_pairs_pv no of copper paires privious value
--v_ntu_model_new
--v_ntu_model_pv
--v_acc_node_change_pv  -- > ACCESS NODE CHANGE? privious value
--v_acc_node_change_new -- > ACCESS NODE CHANGE? current value
--v_cus_lan_ip_new current CUSTOMER LAN IP
--v_cus_lan_ip_pv  privious  CUSTOMER LAN IP
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_area_code
              INTO v_service_order_area
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                                                     AS codes,
          ar.area_code
     INTO v_rtom_code,
          v_lea_code
     FROM areas ar
    WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

--INSTALL SLT-END-NTU tasks work group
   SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                                                     AS codes,
          ar.area_code
     INTO v_rtom_code,
          v_lea_code
     FROM areas ar
    WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

   SELECT wg.worg_name
     INTO v_work_group
     FROM work_groups wg
    WHERE worg_name LIKE
                    v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

   SELECT wg.worg_name
     INTO v_work_group_cpe
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';

   SELECT wg.worg_name
     INTO v_eng_net
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';

   SELECT soa.seoa_defaultvalue
     INTO v_section_hndle
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'SECTION HANDLED BY';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_bear_status
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS BEARER STATUS';

---SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE

   --soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';
   SELECT soa.seoa_defaultvalue
     INTO v_acc_medium
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

   SELECT soa.seoa_defaultvalue
     INTO v_ntu_class
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

   SELECT soa.seoa_defaultvalue
     INTO v_ser_ctg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cpe_class, v_cpe_class_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_cpe_model, v_pre_cpe_model
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

   SELECT soa.seoa_defaultvalue
     INTO v_net_aggri_1
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'AGGREGATE NETWORK 1';

   SELECT soa.seoa_defaultvalue
     INTO v_net_aggri_2
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'AGGREGATE NETWORK 2';

   SELECT soa.seoa_defaultvalue
     INTO v_ntu_model_changed
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';

   /*
   SELECT DISTINCT soa.seoa_defaultvalue   INTO v_fib_avalable
              FROM service_order_attributes soa
             WHERE soa.seoa_name = 'ACCESS FIBER AVAILABLE ?'
               AND soa.seoa_sero_id = p_sero_id;  */
   SELECT soa.seoa_defaultvalue
     INTO v_migra_type
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';

   -- CPE CHANGE?
   SELECT soa.seoa_defaultvalue
     INTO v_cpe_change
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?';

   -- v_acc_net_po_bw_new
   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_acc_net_po_bw_new, v_acc_net_po_bw_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS INTF PORT BW';

   -- NO OF COPPER PAIRS
   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_no_of_cop_pairs_new, v_no_of_cop_pairs_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'NO OF COPPER PAIRS';

   --NTU MODEL
   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_ntu_model_new, v_ntu_model_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';

   --ACCESS NODE CHANGE?
   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_acc_node_change_new, v_acc_node_change_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS NODE CHANGE?';

   --CUSTOMER LAN IP
   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cus_lan_ip_new, v_cus_lan_ip_pv
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER LAN IP';

   -- ACC. FIBER AVAILABLE?
   SELECT soa.seoa_defaultvalue
     INTO v_acc_fiber_availalbe
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACC. FIBER AVAILABLE?';

   --OPERATIONAL REGION
   SELECT soa.seoa_defaultvalue
     INTO v_operational_region
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'OPERATIONAL REGION';

--------------------------------------------------------------------------------------------------------------------------
    -- START IP-TRUNK CONFIGURATION

   --VERIFY NTU - CREATE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'VERIFY NTU';
   END IF;

   -- CONFIRM NUMBER LEVEL
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           --OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'CREATE-TRANSFER'
          )
      AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%')
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-ACCM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM NUMBER LEVEL';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'CREATE'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-PSM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM NUMBER LEVEL';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM NUMBER LEVEL';
   END IF;

   --ISSUE INVOICE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE INVOICE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ISSUE INVOICE';
   END IF;

   -- CONFIG IPVPN PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE')
      AND v_acc_nw <> 'MPLS PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG IPVPN PORT';
   END IF;

   -- CONFIG MPLS PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-TRANSFER'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_acc_nw = 'MPLS PORT'
         AND v_acc_bear_status = 'COMMISSIONED'
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS PORT';
   END IF;

   --CONFIG MPLS SUB PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-TRANSFER'
          )
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   END IF;

   --CONFIG CEN PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_acc_nw = 'CEN PORT'
         AND (v_acc_net_po_bw_new <> v_acc_net_po_bw_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_acc_nw = 'CEN PORT'
         AND v_acc_bear_status = 'COMMISSIONED'
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN PORT';
   END IF;

   -- ACTIVATE SHDSL PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'CREATE-TRANSFER')
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_migra_type = 'LEGACY TO NGN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   END IF;

   -- ACTIVATE TRIB. PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'CREATE-TRANSFER')
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_migra_type = 'NGN to NGN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   END IF;

   --COMM. FIBER LINK
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND v_acc_medium = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COMM. FIBER LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COMM. FIBER LINK';
   END IF;

-- WAIT FOR FIBER  


   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE')
      AND v_acc_medium = 'FIBER'
      AND (v_acc_fiber_availalbe = 'NO' OR v_acc_fiber_availalbe ='INCOMPLETE')
      AND v_operational_region = 'METRO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'NET-PROJ-ACC-CABLES'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'WAIT FOR FIBER';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'CREATE')
         AND v_acc_medium = 'FIBER'
         AND (v_acc_fiber_availalbe = 'NO' OR v_acc_fiber_availalbe='INCOMPLETE')
         AND v_operational_region = 'REGION'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_eng_net
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'WAIT FOR FIBER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'WAIT FOR FIBER';
   END IF;

   -- ESTABLISH ACC. LINK  <RTOM AREA>-ENG-NW
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND (v_acc_medium = 'FIBER' OR v_acc_medium = 'COPPER-UTP')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_eng_net
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ESTABLISH ACC. LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ESTABLISH ACC. LINK';
   END IF;

   --INSTALL SLT-END NTU
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND v_acc_medium = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   END IF;

   --SETUP RADIO LINK
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND v_acc_medium = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'SETUP RADIO LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'SETUP RADIO LINK';
   END IF;

   --CONSTRUCT OSP LINE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND v_acc_medium = 'COPPER'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   END IF;

   --MAKE MDF X CONNECT  -- if ACCESS MEDIUM='COPPER'  and ACCESS BEARER STATUS= 'COMMISSIONED" and
      -- MSAN/DSLAM  location is a sub node
      -- TO BE DISCUSS WITH INDIKA

   -- MODIFY NTU  if ACCESS N/W INTF='MSAN PORT' or 'DSLAM PORT'
   --and  [ACCESS BEARER STATUS= 'INSERVICE"  and NTU CLASS='SLT' and NTU MODEL CHANGE?='YES']  <RTOM AREA>-<LEA>-OSP-NC

   --MODIFY NTU
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
      AND v_ntu_class = 'SLT'
      AND v_ntu_model_changed = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'MODIFY-SPEED'
              OR v_service_order = 'MODIFY-EQUIPMENT'
              OR v_service_order = 'MODIFY-CPE'
             )
         AND v_ntu_class = 'SLT'
         AND (v_ntu_model_new <> v_ntu_model_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY NTU';
   END IF;

   --RECONFIG NTU
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
      AND v_ntu_class = 'SLT'
      AND v_ntu_model_changed = 'NO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG NTU';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'MODIFY-SPEED'
              OR v_service_order = 'MODIFY-CPE'
             )
         AND v_ntu_class = 'SLT'
         AND (v_ntu_model_new = v_ntu_model_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG NTU';
   END IF;

   --INSTALL CPE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'MODIFY-LOCATION'
          )
      AND v_cpe_class = 'SLT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL CPE';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'MODIFY-SPEED'
              OR v_service_order = 'MODIFY-CPE'
             )
         AND (v_cpe_class = 'SLT' AND v_cpe_class_pv <> 'SLT')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL CPE';
   END IF;

   -- MODIFY CPE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_cpe_class = 'SLT'
      AND v_cur_cpe_model <> v_pre_cpe_model
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'MODIFY-SPEED'
              OR v_service_order = 'MODIFY-CPE'
             )
         AND (v_cpe_class = 'SLT' AND v_cpe_class_pv = 'SLT')
         AND (v_cur_cpe_model <> v_pre_cpe_model)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY CPE';
   END IF;

   -- RECONFIG CPE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_cpe_class = 'SLT'
      AND v_cur_cpe_model = v_pre_cpe_model
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'CREATE-TRANSFER')
         AND v_cpe_class = 'SLT'
         AND v_cpe_change = 'NO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'MODIFY-SPEED'
              OR v_service_order = 'MODIFY-CPE'
             )
         AND (v_cpe_class = 'SLT' AND (v_cur_cpe_model = v_pre_cpe_model))
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-IPS'
         AND v_cpe_class = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG CPE';
   END IF;

   -- CONFIRM TEST SERVICE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_ser_ctg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-ACCM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
   ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
   END IF;

   -- ACTIVATE ACC BEARER
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'CREATE-OR')
         AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (   v_service_order = 'CREATE'
              OR v_service_order = 'CREATE-UPGRADE'
              OR v_service_order = 'CREATE-OR'
             )
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
   END IF;

--------------------------------------------------------------------------------------------------------------------------

   --VERIFY NTU  CREATE-TRANSFER
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-TRANSFER')
      AND v_migra_type = 'NGN to NGN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'VERIFY NTU';
   END IF;

   /* -- APPROVE SO
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE' OR v_service_order = 'CREATE-OR'
      OR v_service_order = 'CREATE-TRANSFER')
      AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%')
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'CREATE'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-PSM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   */

   -- CONFIG MPLS PORT - 'MODIFY-LOCATION'
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'MODIFY-LOCATION')
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MENV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS PORT';
   END IF;

   -- MODIFY-SPEED   MODIFY MPLS SUB PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_acc_nw = 'MPLS PORT'
      AND (v_acc_net_po_bw_new = v_acc_net_po_bw_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MPLS SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY MPLS SUB PORT';
   END IF;

   --CONFIG. MEN VLAN
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'CREATE-TRANSFER'
          )
      AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN')
      AND v_acc_nw <> 'MEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MEN VLAN';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN')
         AND (v_acc_nw <> 'MEN PORT' AND v_acc_node_change_new = 'SLT')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MEN VLAN';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. MEN VLAN';
   END IF;

   --DEACT OLD MEN VLAN  MODIFY-LOCATION

   --MODIFY-SPEED   -- MODIFY MEN VLAN
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'MODIFY-SPEED')
      AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN')
      AND v_acc_nw <> 'MEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MEN VLAN';
   ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY MEN VLAN';
   END IF;

   --CONFIG. CEN VLAN
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
           OR v_service_order = 'CREATE-TRANSFER'
          )
      AND ((v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN'))
      AND v_acc_nw <> 'CEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND (v_service_order = 'MODIFY-SPEED')
         AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN')
         AND v_acc_nw <> 'CEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN')
         AND (v_acc_nw <> 'CEN PORT' AND v_acc_node_change_new = 'SLT')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   END IF;

   -- MODIFY-SPEED   .   MODIFY CEN VLAN

   --CONFIG MEN PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (   v_service_order = 'CREATE'
           OR v_service_order = 'CREATE-UPGRADE'
           OR v_service_order = 'CREATE-OR'
          )
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_acc_nw = 'MEN PORT'
         AND v_acc_net_po_bw_new <> v_acc_net_po_bw_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_acc_nw = 'MEN PORT'
         AND v_acc_bear_status = 'COMMISSIONED'
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MEN PORT';
   END IF;

   -- CONFIG MEN SUB PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-OR')
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_acc_nw = 'MEN PORT'
         AND (v_acc_net_po_bw_new = v_acc_net_po_bw_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_acc_nw = 'MEN PORT'
         AND v_acc_bear_status = 'INSERVICE'
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   END IF;

   --CONFIG MEN SUB PORT --MODIFY-SPEED
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_acc_nw = 'MEN PORT'
      AND (v_acc_net_po_bw_new = v_acc_net_po_bw_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   END IF;

   -- MODIFY MEN SUB PORT   MODIFY-LOCATION
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
   END IF;

   -- CONFIG CEN SUB PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-OR')
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_acc_nw = 'CEN PORT'
         AND v_acc_bear_status = 'INSERVICE'
         AND v_acc_node_change_new = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   END IF;

   -- MODIFY-SPEED   MODIFY CEN SUB PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_acc_nw = 'CEN PORT'
      AND (v_acc_net_po_bw_new = v_acc_net_po_bw_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY CEN SUB PORT';
   END IF;

   -- CONFIG IPVPN PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-OR')
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG IPVPN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG IPVPN PORT';
   END IF;

   -- CONFIG IPVPN PORT CREATE-TRANSFER
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-TRANSFER')
      AND v_acc_nw <> 'MPLS PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG IPVPN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG IPVPN PORT';
   END IF;

   --DEACT ADD.SHDSL PORT  -- MODIFY-SPEED
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'MODIFY-SPEED')
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_no_of_cop_pairs_new < v_no_of_cop_pairs_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';
   END IF;

   -- MODIFY-SPEED   ACT. ADD. SHDSL PORT  ( ACTIVATE ADD. SHDSL PORT)
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'MODIFY-SPEED')
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_no_of_cop_pairs_new > v_no_of_cop_pairs_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT ';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT';
   END IF;

   --  MODIFY-SPEED   MODIFY TRIB. PORT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND (v_no_of_cop_pairs_new = v_no_of_cop_pairs_pv)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY TRIB. PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY TRIB. PORT';
   END IF;

   -- COLLECT CPE   -- MODIFY-SPEED
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND (v_cpe_class <> 'SLT' AND v_cpe_class_pv = 'SLT')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT CPE ';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT CPE';
   END IF;

   -- MODIFY CPE  CREATE-TRANSFER
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND (v_service_order = 'CREATE-TRANSFER')
      AND v_cpe_class = 'SLT'
      AND v_cpe_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY CPE';
   END IF;

   -- MODIFY-SPEED

   -- CONDUCT FIELD TRIAL  If ACCESS MEDIUM='P2P RADIO' and ACCESS INTF PORT BW <new value> < ><old value>
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_acc_medium = 'P2P RADIO'
      AND v_acc_net_po_bw_new <> v_acc_net_po_bw_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONDUCT FIELD TRIAL';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONDUCT FIELD TRIAL';
   END IF;

   --REDESIGN CIRCUIT
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND (   v_acc_net_po_bw_new <> v_acc_net_po_bw_pv
           OR v_no_of_cop_pairs_new <> v_no_of_cop_pairs_pv
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REDESIGN CIRCUIT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REDESIGN CIRCUIT';
   END IF;

   -- CONST. ADD. OSP LINE  --  CONSTRUCT ADD. OSP LINE
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_no_of_cop_pairs_new > v_no_of_cop_pairs_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONST. ADD. OSP LINE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONST. ADD. OSP LINE';
   END IF;

   -- UPDATE ACC. BEARER  -- MODIFY-CPE order type
   IF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'MODIFY-CPE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UPDATE ACC. BEARER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'UPDATE ACC. BEARER';
   END IF;

   -- MODIFY WAN IP   -- MODIFY-IPS service type
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-IPS'
      AND v_cus_lan_ip_new = v_cus_lan_ip_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY WAN IP';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY WAN IP';
   END IF;

   --MODIFY LAN IP
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'MODIFY-IPS'
      AND v_cus_lan_ip_new <> v_cus_lan_ip_pv
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY LAN IP';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY LAN IP';
   END IF;

     -- END OF IP -TRUNK CONFIGURATION FOR CREATE  SERVICE TYPE.
-----------------------------------------------------------------------------------

   /*
   IF


   v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND v_section_hndle LIKE 'SALES-SME-%'

   THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND

   sit.seit_taskname = 'VERIFY PRICING';


   ELSE

   DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname

   = 'VERIFY PRICING';

   END IF;
   */

   /*


   IF

   v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   AND v_core_network = 'MEN' AND v_acc_nw <> 'MEN PORT' THEN
   UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-MEN'
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'CONFIG VPLS PORT';


   ELSIF

   (v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND v_core_network = 'CEN' AND v_acc_nw

   <> 'CEN PORT') OR (v_service_type = 'D-IP TRUNK LINE'

   AND v_service_order = 'CREATE' AND v_core_network = 'MPLS' AND v_acc_nw <> 'MPLS PORT')

   THEN
   UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
   WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
   ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' THEN
   DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname

   = 'CONFIG VPLS PORT';
   END IF;*/

   /*

    IF     v_service_type = 'D-IP TRUNK LINE'
       AND v_service_order = 'CREATE'
       AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
       AND v_acc_bear_status = 'COMMISSIONED'
    THEN
       UPDATE service_implementation_tasks sit
          SET sit.seit_worg_name = 'DS-OPR-NM'
        WHERE sit.seit_sero_id = p_sero_id
          AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
    ELSE
       DELETE      service_implementation_tasks sit
             WHERE sit.seit_sero_id = p_sero_id
               AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
    END IF;  */

   /*ACT. SERVICE PORT
IF

 v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw ='DSLAM PORT') AND

v_acc_bear_status = 'INSERVICE'

THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT';

ELSE

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT';

END IF;

*/

   /*
   IF

   v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
   AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class = 'SLT'

   THEN

   UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = v_work_group_cpe
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'INSTALL NTU';


   ELSE

   DELETE      service_implementation_tasks sit
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'INSTALL NTU';
   END IF;

   */

   /*IF     v_service_type = 'D-IP TRUNK LINE'
   AND v_service_order = 'CREATE'
   AND v_core_network = 'MEN'
   THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-MEN'
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSIF     v_service_type = 'D-IP TRUNK LINE'
   AND v_service_order = 'CREATE'
   AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
   THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSE DELETE      service_implementation_tasks sit
   WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   END IF; */

   /*


   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. MEN PORT';
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. CEN PORT';
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. MPLS PORT';
   END IF;  */

   /*

--CONSTRUCT FIBER LINK

 IF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status =

'COMMISSIONED'

THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';


ELSE DELETE   service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
END IF;

*/
  /*

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. MEN SUB PORT';
   END IF;

   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. CEN SUB PORT';
   END IF;  */

   /*
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE'
      AND v_acc_medium = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND (v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SFC-SOM-DATA'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'WAIT FOR FIBER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'WAIT FOR FIBER';
   END IF;

/*

IF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND  v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED'

THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_eng_net
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW';

ELSE

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INTEGRATE AGG NW';

END IF;

*/

   /*
   IF  v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND  (v_acc_nw = 'MSAN PORT' or

   v_acc_nw = 'DSLAM PORT')
   AND v_acc_bear_status = 'INSERVICE'

   THEN

   UPDATE service_implementation_tasks sit

   SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';

   ELSE

   DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
   AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';

   END IF;

   */

   --RECONFIG CPE

   /*IF     v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'MEN' OR

v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN

PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id

= p_sero_id AND sit.seit_taskname =

'CONFIGURE VLAN';
ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'CEN' OR

v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'MEN PORT'

THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE

sit.seit_sero_id = p_sero_id AND sit.seit_taskname =

'CONFIGURE VLAN';
ELSE DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND

sit.seit_taskname = 'CONFIGURE VLAN'; END IF;*/

   -----------------------------------------------------CREATE UPGRADE-----------
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D_IP_TR_WORK_FLOW_01 Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_IP_TR_WORK_FLOW_01;
---- Dulip Fernando 2015-08-05

-- Dulip Fernando  2015-Aug-24 
--2015-05-05 
--D_IP_TR_CON_CREA 
--This function handle 
--v_net_aggri_1=AGGREGATE NETWORK 1
--v_net_aggri_2=AGGREGATE NETWORK 2
-- 2015-08-24  Complied in to CLTY_UAT

PROCEDURE D_IP_TR_AGG_NTW_WORK_FLOW1(
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_cir_status           VARCHAR2 (100);
   v_new_bearer_id        VARCHAR2 (100);
   v_section_hndle        VARCHAR2 (100);
   v_service_type         VARCHAR2 (100);
   v_service_order        VARCHAR2 (100);
   v_service_order_area   VARCHAR2 (100);
   v_rtom_code            VARCHAR2 (100);
   v_lea_code             VARCHAR2 (100);
   v_acc_bear_status      VARCHAR2 (100);
   v_core_network         VARCHAR2 (100);
   v_acc_medium           VARCHAR2 (100);
   v_work_group           VARCHAR2 (100);
   v_acc_nw               VARCHAR2 (100);
   v_ntu_class            VARCHAR2 (100);
   v_ntu_model_changed    VARCHAR2 (100);
   v_work_group_cpe       VARCHAR2 (100);
   v_ser_ctg              VARCHAR2 (100);
   v_so_attr_name         VARCHAR2 (100);
   v_so_attr_val          VARCHAR2 (100);
   v_bearer_id            VARCHAR2 (100);
   v_eng_net              VARCHAR2 (100);
   v_cpe_class            VARCHAR2 (100);
   v_cur_cpe_model        VARCHAR2 (100);
   v_pre_cpe_model        VARCHAR2 (100);
   v_net_aggri            VARCHAR2 (100);
   v_fib_avalable         VARCHAR2 (100);
   v_net_aggri_2          VARCHAR2 (100);
   v_net_aggri_1          VARCHAR2 (100);
--v_acc_nw='ACCESS N/W INTF'
--v_acc_medium='ACCESS MEDIUM'
--v_acc_bear_status=ACCESS BEARER STATUS
--v_ser_ctg=
--v_net_aggri_1=AGGREGATE NETWORK 1
--v_net_aggri_2=AGGREGATE NETWORK 2
--NTU MODEL CHANGE?

BEGIN

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;


   SELECT soa.seoa_defaultvalue
     INTO v_acc_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

   SELECT soa.seoa_defaultvalue
     INTO v_net_aggri_1
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';

   SELECT soa.seoa_defaultvalue
     INTO v_net_aggri_2
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'AGGREGATE NETWORK 2';


   ---------------------------------------------------------------------------------
 
  --CONFIG. MEN VLAN
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE'
      AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN')
      AND v_acc_nw <> 'MEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. MEN VLAN';
   ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. MEN VLAN';
   END IF;

   --CONFIG. CEN VLAN  if 'AGGREGATE NETWORK 1'='CEN' or 'AGGREGATE NETWORK 2 '='CEN' and   ACCESS N/W INTF' < >CEN PORT'
   IF     v_service_type = 'D-IP TRUNK LINE'
      AND v_service_order = 'CREATE' OR v_service_order = 'CREATE-UPGRADE'
      AND ((v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN'))
      AND v_acc_nw <> 'CEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   ELSIF v_service_type = 'D-IP TRUNK LINE' AND v_service_order = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG. CEN VLAN';
   END IF;
   
 

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-IP TRUNK LINE Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_IP_TR_AGG_NTW_WORK_FLOW1;

-- Dulip Fernando  2015-Aug-24

--- Jayan Liyanage 15/03/2016
PROCEDURE I_DNR_SERVICE_DATE_CALC (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

   v_fine_chrg   VARCHAR2 (100);
   v_ser_type    VARCHAR2 (100);
   v_serv_rene   Date;
   Ser_Rene_DateNew       Date;
   v_ser_remDT            Date;

BEGIN
  
   SELECT soa.seoa_defaultvalue
     INTO v_fine_chrg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'RGP FINE CHARGED?';

   SELECT soa.seoa_defaultvalue
     INTO v_serv_rene
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE RENEWAL DATE';
    
    select distinct s.sero_sert_abbreviation into v_ser_type from service_orders s
    where s.sero_id = p_sero_id;
  
IF v_ser_type = 'I-DNR' and v_fine_chrg = 'YES' THEN

select add_months(v_serv_rene,12) into Ser_Rene_DateNew from dual;
v_serv_rene := Ser_Rene_DateNew;
update service_order_attributes soa set soa.seoa_defaultvalue = v_serv_rene
where soa.seoa_name = 'SERVICE RENEWAL DATE' and soa.seoa_sero_id = p_sero_id;

select add_months(v_serv_rene,-2) into v_ser_remDT from dual;
   v_ser_remDT := v_ser_remDT;
 update service_order_attributes soa set soa.seoa_defaultvalue = v_ser_remDT
where soa.seoa_name = 'RENEWAL REMINDER DATE' and soa.seoa_sero_id = p_sero_id;

END IF;
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Calculate Service Renewal Date. Please Check the Conditions '
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END I_DNR_SERVICE_DATE_CALC;
   
--- Jayan Liyanage 15/03/2016

---- Dinesh Perera 25-04-2016 ----
PROCEDURE PROV_FTTH_IPTV_TASK_LOAD (
   p_serv_id         IN     services.serv_id%TYPE,
   p_sero_id         IN     service_orders.sero_id%TYPE,
   p_seit_id         IN     service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN     implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN     work_order.woro_id%TYPE,
   p_ret_char           OUT VARCHAR2,
   p_ret_number         OUT NUMBER,
   p_ret_msg            OUT VARCHAR2)
   
IS
   v_iptv_no            NUMBER:=0;
   
BEGIN

        SELECT SUBSTR(SEOA_DEFAULTVALUE,16)
        INTO v_iptv_no
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'CIRCUIT ID';
         
        IF v_iptv_no >= '2' THEN          
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP PROVISION ZTE';
                                
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP PROVISION HUAWEI';              
        END IF;
        
        
        IF (v_iptv_no <> '2') OR (v_iptv_no IS NULL) THEN          
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP_PROV_ZTE_ONT';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'SOP_PROV_HUAWEI_ONT';
            
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'WAIT_FOR_IPTV_CLOSE';                   
        END IF;
        
        
        IF v_iptv_no IS NOT NULL THEN          
            DELETE service_implementation_tasks sit
            WHERE     sit.seit_sero_id = p_sero_id
            AND sit.seit_taskname = 'IPTV WAIT TASK CLOSE';
                  
        END IF;
            
   p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to delete BB Provisioning Tasks. Please check the conditions:'
         || ' - Erro is:' || TO_CHAR (SQLCODE) || '-' || SQLERRM;
         
      p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');

      INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text)
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE, p_ret_msg);
           
END PROV_FTTH_IPTV_TASK_LOAD;
---- Dinesh Perera 25-04-2016 ----

--- Prabodha Chathuranga 27/04/2016
PROCEDURE D_WIFI_BCKHAUL_DSP_DELETE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
  
  b_deleteor_so   VARCHAR2 (100);
  b_dsp_date   VARCHAR2 (100);
BEGIN

  
  SELECT DISTINCT trim(soa.seoa_defaultvalue) INTO b_deleteor_so
  FROM service_order_attributes soa
  WHERE soa.seoa_name = 'DELETE-OR SO #'
  AND soa.seoa_sero_id = p_sero_id;
  
  SELECT DISTINCT trim(soa.seoa_defaultvalue) INTO b_dsp_date
  FROM service_order_attributes soa
  WHERE soa.seoa_name = 'ACTUAL_DSP_DATE'
  AND soa.seoa_sero_id = p_sero_id;

  UPDATE service_order_attributes soa 
  SET soa.seoa_defaultvalue = b_dsp_date
  WHERE soa.seoa_name = 'ACTUAL_DSP_DATE'
  AND soa.seoa_sero_id = b_deleteor_so;
  
  UPDATE service_implementation_tasks sit
  SET sit.seit_stas_abbreviation ='COMPLETED'
  WHERE sit.seit_taskname = 'WAIT FOR NEW SERVICE' 
  AND sit.seit_sero_id = b_deleteor_so;
  
  UPDATE service_implementation_tasks sit
  SET sit.seit_stas_abbreviation ='COMPLETED'
  WHERE sit.seit_taskname = 'PROCEED DELETE-OR SO' 
  AND sit.seit_sero_id = p_sero_id;
  
  
  
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
  
  EXCEPTION
  WHEN OTHERS
  THEN
  p_ret_msg :='Failed to Change D_WIFI_BCKHAUL_AUTO_DSP_DELETE_OR. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
  p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
  INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)
  VALUES(p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_WIFI_BCKHAUL_DSP_DELETE_OR;

--- Prabodha Chathuranga 27/04/2016

-----Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_CREATE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw       VARCHAR2 (100);
v_rtom_code              VARCHAR2 (100);
v_lea_code                 VARCHAR2 (100);
V_node                      VARCHAR2 (100);
V_acc_medium           VARCHAR2 (100);
v_equip_type              VARCHAR2 (100);
v_eq_loc_name           VARCHAR2 (100);
v_service_order_area    VARCHAR2 (100);
v_work_group             VARCHAR2 (100);
v_work_group_mdf    VARCHAR2 (100);


CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';

CURSOR cur_acc_medium IS 
SELECT soa.seoa_defaultvalue
INTO V_acc_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM';

BEGIN

OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;

OPEN cur_acc_medium; FETCH cur_acc_medium INTO V_acc_medium;
CLOSE cur_acc_medium;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;


SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;



SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; 






select length(v_eq_loc_name) - length(replace(v_eq_loc_name,'-',null)) 
INTO V_node
from dual;

IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'CONFIGURE VPLS PORT';                 
                    
END IF;
END IF;



 
IF V_node = 1 AND  V_acc_medium IS NOT NULL THEN  

    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_acc_medium ='COPPER'
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'MAKE MDF X CONNECT';
    
    ELSE
    
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'MAKE MDF X CONNECT';   
    
    END IF; 
  END IF; 
 
IF V_node <> 1 AND  V_acc_medium IS NOT NULL THEN   

   IF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'    AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_acc_medium ='COPPER'
        THEN

       UPDATE service_implementation_tasks sit 
       SET sit.seit_worg_name = v_work_group 
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
        
        ELSE
        
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'MAKE MDF X CONNECT';      

        END IF;  
END IF;




IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'ACTIVATE VPLS PORT';                 
                    
END IF;
END IF;

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'CREATE-OR'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';                 
                    
END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D_WIFI_BACK_CREATE_OR Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_CREATE_OR;


-----Dilupa Alahakoon  26/04/2016

-----Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_DELETE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);
v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
v_service_order_area    VARCHAR2 (100);
v_lea_code                  VARCHAR2 (100);
v_location                     VARCHAR2 (100);
v_main_node                 VARCHAR2 (100);
v_sub_node                  VARCHAR2 (100);
v_rtom_code                  VARCHAR2 (100);
v_work_group_mdf         VARCHAR2 (100);
v_work_group                VARCHAR2 (100);

CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;



CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;



SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;


SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;



SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; 

SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1)
AS node INTO v_location FROM DUAL; 

SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1))AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node,
v_sub_node FROM DUAL;


IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';                 
                    
END IF;
END IF;
 
IF v_main_node IS NOT NULL THEN  

    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE' AND  v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'REMOVE MDF WIRING';
    
    ELSE
    
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE MDF WIRING';   
    
    END IF; 
    
END IF; 
  
    
IF v_main_node IS  NULL THEN   

   IF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE'    AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') 
        THEN

       UPDATE service_implementation_tasks sit 
       SET sit.seit_worg_name = v_work_group 
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE MDF WIRING';
        
        ELSE
        
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE MDF WIRING';      

        END IF;  
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_DELETE;

---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_DELETE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);
v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
V_agg_nw                  VARCHAR2 (100);
v_main_node             VARCHAR2 (100);
v_sub_node              VARCHAR2 (100);
v_work_group            VARCHAR2 (100);
 v_work_group_mdf    VARCHAR2 (100);


CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

CURSOR cur_agg_nw IS 
SELECT soa.seoa_defaultvalue
INTO V_agg_nw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NW';

CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;


OPEN cur_agg_nw; FETCH cur_agg_nw INTO V_agg_nw;
CLOSE cur_agg_nw;




SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;


IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';                 
                    
END IF;
END IF;
 
IF v_main_node IS NOT NULL THEN  

    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR' AND  v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'REMOVE MDF WIRING';
    
    ELSE
    
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE MDF WIRING';   
    
    END IF; 
END IF;  
 
   
IF v_main_node IS  NULL THEN   

   IF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR'    AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') 
        THEN

       UPDATE service_implementation_tasks sit 
       SET sit.seit_worg_name = v_work_group 
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE MDF WIRING';
        
        ELSE
        
        DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE MDF WIRING';      

        END IF;  
END IF;


IF V_agg_nw IS NOT NULL AND V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR'  AND V_vpls_core_netw <> 'CEN' AND V_agg_nw ='CEN'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE CEN VLAN';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-OR'  AND V_vpls_core_netw <> 'MEN' AND V_agg_nw ='CEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE CEN VLAN';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACTIVATE CEN VLAN';                 
                    
END IF;
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_DELETE_OR;

---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_DELETE_TRANSFER (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);


CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;



IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-TRANSFER'  AND ( V_vpls_core_netw = 'CEN' OR V_vpls_core_netw = 'MPLS')
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'DELETE-TRANSFER'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';                 
                    
END IF;


END IF;



p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_DELETE_TRANSFER;
---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_MODIFY_EQUIPMENT (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);
V_ntu_class               VARCHAR2 (100);
V_ntu_type_new            VARCHAR2 (100);
V_ntu_type_old            VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_work_group            VARCHAR2 (100);

CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


CURSOR cur_ntuclass IS 
SELECT soa.seoa_defaultvalue
INTO V_ntu_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU CLASS';

CURSOR cur_ntutype IS 
SELECT soa.seoa_defaultvalue,SOA.SEOA_PREV_VALUE
INTO V_ntu_type_new,V_ntu_type_old
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU TYPE';


BEGIN 
OPEN cur_ntutype; FETCH cur_ntutype INTO V_ntu_type_new,V_ntu_type_old;
CLOSE cur_ntutype;

 
OPEN cur_ntuclass; FETCH cur_ntuclass INTO V_ntu_class;
CLOSE cur_ntuclass;

 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;


SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;



SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 



IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-EQUIPMENT'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM WITH CUSTOMER';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-EQUIPMENT'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM WITH CUSTOMER';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'CONFIRM WITH CUSTOMER';                 
                    
END IF;
END IF;

 
IF V_ntu_class IS NOT NULL AND V_ntu_type_new IS NOT NULL AND v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-EQUIPMENT'  AND V_ntu_class = 'SLT' and V_ntu_type_new = 'ADSL ROUTER'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = v_work_group
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY DSL NTU';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'MODIFY DSL NTU';                 
                    
END IF;
 
IF V_ntu_class IS NOT NULL AND V_ntu_type_new IS NOT NULL AND v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-EQUIPMENT'  AND V_ntu_class = 'SLT' and 
V_ntu_type_new <> V_ntu_type_old
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = v_work_group
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'RECONFIG NTU';                 
                    
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_MODIFY_EQUIPMENT;

---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_MODIFY_SPEED (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);
V_agg_nw                  VARCHAR2 (100);


CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';

CURSOR cur_agg_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_agg_nw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NW';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

OPEN cur_agg_netw; FETCH cur_agg_netw INTO V_agg_nw;
CLOSE cur_agg_netw;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;



IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-SPEED'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-SPEED'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'MODIFY VPLS PORT';                 
                    
END IF;
END IF;

IF   V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw ='CEN'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION' AND V_vpls_core_netw ='MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';                 
                    
END IF;

END IF;

IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-SPEED'  AND V_vpls_core_netw <> 'CEN' AND V_agg_nw = 'CEN'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEN VLAN';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-SPEED'  AND V_vpls_core_netw <> 'MEN' AND V_agg_nw = 'MEN'
THEN


                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEN VLAN';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'MODIFY CEN VLAN';                 
                    
END IF;
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_MODIFY_SPEED;


---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_RESUME (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);


CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;



IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'RESUME'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'RESUME'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'REACTIVATE VPLS PORT';                 
                    
END IF;

 END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_RESUME;


---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_BACK_SUSPEND (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);

CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_vpls_core_netw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw;
CLOSE cur_vpls_core_netw;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;





IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'SUSPEND'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'SUSPEND'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';                 
                    
END IF;

END IF;
 


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_BACK_SUSPEND;

---Dilupa Alahakoon  26/04/2016

---Dilupa Alahakoon  26/04/2016
PROCEDURE D_WIFI_MODIFY_LOCATION  (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type            VARCHAR2 (100);
v_oredr_type              VARCHAR2 (100);
V_vpls_core_netw          VARCHAR2 (100);
v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
V_access_node_change      VARCHAR2 (100);
V_agg_nw                  VARCHAR2 (100);
V_node                    VARCHAR2 (100);
v_service_order_area     VARCHAR2 (100);
v_lea_code                   VARCHAR2 (100);
v_work_group_mdf         VARCHAR2 (100);  
v_rtom_code                 VARCHAR2 (100);  
 v_work_group                VARCHAR2 (100);
 V_vpls_core_netw_pre     VARCHAR2 (100);


CURSOR cur_equi_type IS 
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e 
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;



CURSOR cur_vpls_core_netw IS 
SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO V_vpls_core_netw, V_vpls_core_netw_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'VPLS CORE NETWORK';


CURSOR cur_acc_node_ch IS 
SELECT soa.seoa_defaultvalue
INTO V_access_node_change
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS NODE CHANGE?';

CURSOR cur_agg_netw IS 
SELECT soa.seoa_defaultvalue
INTO V_agg_nw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NW';


BEGIN 
OPEN cur_vpls_core_netw; FETCH cur_vpls_core_netw INTO V_vpls_core_netw,V_vpls_core_netw_pre;
CLOSE cur_vpls_core_netw;

OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;

OPEN cur_acc_node_ch; FETCH cur_acc_node_ch INTO V_access_node_change;
CLOSE cur_acc_node_ch;

OPEN cur_agg_netw; FETCH cur_agg_netw INTO V_agg_nw;
CLOSE cur_agg_netw;

select length(v_eq_loc_name) - length(replace(v_eq_loc_name,'-',null)) 
INTO V_node
from dual;



SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_oredr_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes_a,ar.area_code 
INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; 

SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; 






            IF V_access_node_change IS NOT NULL THEN 

            IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw = 'CEN' AND V_access_node_change = 'YES'  
            THEN
              
                               UPDATE service_implementation_tasks sit
                               SET sit.seit_worg_name = 'IPNET-PROV'
                               WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
                               
            ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw = 'MEN' AND V_access_node_change = 'YES'
            THEN

                               UPDATE service_implementation_tasks sit
                               SET sit.seit_worg_name = 'DS-MEN'
                               WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VPLS PORT';
              
            ELSE

                               DELETE service_implementation_tasks sit
                               WHERE sit.seit_sero_id = p_sero_id
                               AND sit.seit_taskname = 'CONFIGURE VPLS PORT';                 
                                
            END IF;
            
      END IF;


            IF V_access_node_change IS NOT NULL AND V_vpls_core_netw IS NOT NULL AND V_agg_nw IS NOT NULL THEN 

            IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw <> 'CEN' AND V_access_node_change = 'YES' AND  V_agg_nw = 'CEN' 
            THEN
              
                               UPDATE service_implementation_tasks sit
                               SET sit.seit_worg_name = 'IPNET-PROV'
                               WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
                               
            ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw <> 'MEN' AND V_access_node_change = 'YES' AND V_agg_nw = 'MEN'
            THEN

                               UPDATE service_implementation_tasks sit
                               SET sit.seit_worg_name = 'DS-MEN'
                               WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
              
            ELSE

                               DELETE service_implementation_tasks sit
                               WHERE sit.seit_sero_id = p_sero_id
                               AND sit.seit_taskname = 'CONFIG CEN VLAN';                 
                                
            END IF;
            END IF;

IF V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw = 'CEN' 
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw = 'MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'ACTIVATE VPLS PORT';                 
                    
END IF;
END IF;
 
IF V_node is not null THEN  

    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =1 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'NO'
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'MODIFY MDF X CONNECT';
    
    ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =2 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'NO'
    THEN
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group
    where sit.seit_taskname = 'MODIFY MDF X CONNECT';

    
    ELSE
            DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'MODIFY MDF X CONNECT';   
    END IF; 
  
    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =1 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'YES'
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'MAKE MDF X CONNECT';
    
    ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =2 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'YES'
    THEN
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group
    where sit.seit_taskname = 'MAKE MDF X CONNECT';

    
    ELSE
            DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'MAKE MDF X CONNECT';   
    END IF; 
  
END IF;

IF   V_vpls_core_netw IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_vpls_core_netw ='CEN'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION' AND V_vpls_core_netw ='MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';                 
                    
END IF;

END IF;

IF   V_vpls_core_netw_pre IS NOT NULL THEN 

IF  v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_access_node_change = 'YES'   AND V_vpls_core_netw_pre ='CEN'
THEN
  
                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'IPNET-PROV'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';
                   
ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND   v_oredr_type = 'MODIFY-LOCATION'  AND V_access_node_change = 'YES'   AND V_vpls_core_netw_pre ='MEN'
THEN

                   UPDATE service_implementation_tasks sit
                   SET sit.seit_worg_name = 'DS-MEN'
                   WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';
  
ELSE

                   DELETE service_implementation_tasks sit
                   WHERE sit.seit_sero_id = p_sero_id
                   AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';                 
                    
END IF;

END IF;
     

IF V_node is not null THEN  

    IF  v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =1 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'YES'
    THEN
  
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_mdf
    where sit.seit_taskname = 'REMOVE OLD  X CONNEC';
    
    ELSIF v_service_type  = 'D-WI-FI BACKHAULING' AND V_node =2 AND  v_oredr_type = 'MODIFY-LOCATION' AND  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND V_access_node_change = 'YES'
    THEN
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group
    where sit.seit_taskname = 'REMOVE OLD  X CONNEC';

    
    ELSE
            DELETE service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE OLD  X CONNEC';   
    END IF; 
  
      
END IF;      

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );

EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in D-WI-FI BACKHAULING Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END D_WIFI_MODIFY_LOCATION;
---Dilupa Alahakoon  26/04/2016

---kalana Bandara 28/04/2016
PROCEDURE ADDITIONAL_PEOTV_EVENT_UPDATE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS



v_iptvcct_id     varchar2(100);
v_iptvprifix   varchar2(100);


BEGIN


SELECT SUBSTR (TRIM(SOA.SEOA_DEFAULTVALUE), 5, 12)
INTO v_iptvcct_id
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'CIRCUIT ID';


SELECT SOA.SEOA_DEFAULTVALUE
INTO v_iptvprifix
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ADDITIONAL PEOTV SERVICE';

IF v_iptvprifix = 'Y' THEN

UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_iptvcct_id
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ADDITIONAL PEOTV EVENT SOURCE';


END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed update ADDITIONAL PEOTV EVENT SOURCE:'  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
     p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
    
END ADDITIONAL_PEOTV_EVENT_UPDATE;
---kalana Bandara 28/04/2016

---- Dinesh Perera 29-04-2016 ----
PROCEDURE FTTH_PW_GENERATION_MULTI_IPTV (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_voice_no      varchar2(100);
v_voice_no_1    varchar2(100);
v_broadband_no  varchar2(100);
v_pass_val      varchar2(100);
c_number_type   varchar2(100);

        cursor c_voice_1 is
        SELECT trim(SOA.SEOA_DEFAULTVALUE)
        FROM SERVICE_ORDER_ATTRIBUTES SOA
        WHERE SOA.SEOA_SERO_ID = p_sero_id
        AND SOA.SEOA_NAME = 'REGISTRATION ID';

        CURSOR c_bb_no is
        SELECT REPLACE(SUBSTR(SEOA_DEFAULTVALUE,1,1),'0', '94')||SUBSTR(SEOA_DEFAULTVALUE,2,9)
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'REGISTRATION ID';


BEGIN

    OPEN c_voice_1;
    FETCH c_voice_1 INTO v_voice_no;
    CLOSE c_voice_1;

    OPEN c_bb_no;
    FETCH c_bb_no INTO v_broadband_no;
    CLOSE c_bb_no;

SELECT trim(TO_CHAR(SUBSTR(v_voice_no,6,1)+1))
|| TO_CHAR(SUBSTR(v_voice_no,8,1)+1)
|| trim(TO_CHAR(substr(v_voice_no,-2,2)+9,'XXXXXXXX'))
|| to_CHAR(nvl(SUBSTR(v_voice_no,11,1),'0')+1)
|| to_CHAR(SUBSTR(v_voice_no,5,1)+1)
|| to_CHAR(SUBSTR(v_voice_no,9,1)+1)
|| to_CHAR(SUBSTR(v_voice_no,7,1)+1)
|| to_CHAR(SUBSTR(v_voice_no,4,1)+1)
|| to_CHAR(SUBSTR(v_voice_no,10,1)+1)
INTO v_pass_val
FROM DUAL;

UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_pass_val
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'VOICE_PASSWORD';

UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = v_broadband_no
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ADSL_CIRCUIT_ID';

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');         


EXCEPTION
WHEN OTHERS THEN

p_ret_msg  := 'Failed to generate or match FTTH PASS WORD. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );

END FTTH_PW_GENERATION_MULTI_IPTV;
---- Dinesh Perera 29-04-2016 ----

 -- Dhanushka Fernando    05-05-2016
 
  PROCEDURE MSAN_EQUIP_MODEL (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
CURSOR cur_equip_model IS
SELECT  NVL(eq.EQUP_EQUM_MODEL,'') EQ_MODEL
FROM circuits ci,port_links pl,port_link_ports plp,ports p,
cards ca,service_orders so, equipment eq 
WHERE ci.cirt_name = pl.porl_cirt_name 
AND pl.porl_id = plp.polp_porl_id
AND so.sero_cirt_name = ci.cirt_name 
AND (plp.polp_commonport = 'T' or plp.polp_commonport = 'F') 
AND plp.polp_port_id = p.port_id
AND eq.equp_equt_abbreviation not like '%SPLITTER%'
AND p.port_equp_id = ca.card_equp_id 
AND p.port_equp_id = eq.equp_id 
AND p.port_card_slot = ca.card_slot
AND so.sero_id = p_sero_id;
 
v_equi_model    VARCHAR2 (100);
 
BEGIN 
 
OPEN cur_equip_model; 
FETCH cur_equip_model INTO v_equi_model;
CLOSE cur_equip_model; 
 
IF v_equi_model IS NOT NULL THEN 
 
    UPDATE service_order_attributes soa 
    SET soa.seoa_defaultvalue = v_equi_model
    WHERE soa.seoa_name = 'MSAN_EQIP_MODEL' 
    AND soa.seoa_sero_id = p_sero_id; 
    
ELSE  
    UPDATE service_order_attributes soa 
    SET soa.seoa_defaultvalue = 'NA'
    WHERE soa.seoa_name = 'MSAN_EQIP_MODEL' 
    AND soa.seoa_sero_id = p_sero_id; 
 
END IF; 
 
p_implementation_tasks.update_task_status_byid (p_sero_id,0, p_seit_id, 'COMPLETED');
 
EXCEPTION WHEN OTHERS THEN 
p_ret_msg := 'Failed to update MSAN_EQIP_MODEL Attribute  '  || ' - Erro is:'  || TO_CHAR (SQLCODE) || '-' || SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'ERROR' );
INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,'Failed to update MSAN_EQIP_MODEL Attribute' || p_sero_id
                  );
 
END MSAN_EQUIP_MODEL;

 
  -- Dhanushka Fernando


----Dinesh Perera  29-04-2016  -----
PROCEDURE FTTH_SEC_IPTV_CLOSE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 


     CURSOR GET_IPTV_VALUE IS
        SELECT SUBSTR(SEOA_DEFAULTVALUE,16)
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'CIRCUIT ID';
        
     CURSOR GET_OEID_VALUE IS
        SELECT SUBSTR(SERO_OEID,1,9)
        FROM SERVICE_ORDERS
        WHERE SERO_ID = p_sero_id;
 
     CURSOR GET_DEPNDET_CHID (V_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
        SELECT SEIT_SERO_ID, SEIT_STAS_ABBREVIATION, SEIT_ID 
        FROM SERVICE_IMPLEMENTATION_TASKS 
        WHERE SEIT_TASKNAME = 'WAIT_FOR_IPTV_CLOSE'
        AND SEIT_SERO_ID IN 
        (SELECT SERO_ID FROM SERVICE_ORDERS 
        WHERE SERO_OEID LIKE V_OEID||'%' AND SERO_SERT_ABBREVIATION = 'E-IPTV FTTH');


    V_IPTV    VARCHAR2(100);
    V_OEID    VARCHAR2(100);
    V_SO_NO   VARCHAR2(100);
    V_STATS   VARCHAR2(100);
    V_SITID   VARCHAR2(100);

BEGIN

    OPEN GET_IPTV_VALUE;
    FETCH GET_IPTV_VALUE INTO V_IPTV;
    CLOSE GET_IPTV_VALUE;

    OPEN GET_OEID_VALUE;
    FETCH GET_OEID_VALUE INTO V_OEID;
    CLOSE GET_OEID_VALUE;
    
    OPEN GET_DEPNDET_CHID (V_OEID);
    FETCH GET_DEPNDET_CHID INTO V_SO_NO, V_STATS, V_SITID;
    CLOSE GET_DEPNDET_CHID;
    

    IF (V_IPTV <> '2') OR (V_IPTV IS NULL) THEN
    
    update service_implementation_tasks sit
    set sit.seit_stas_abbreviation = 'COMPLETED'
    where sit.seit_sero_id = V_SO_NO
    and sit.seit_id = V_SITID;
    
   -- p_implementation_tasks.update_task_status_byid(V_SO_NO,0, V_SITID,'COMPLETED');
    
    END IF;
    
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
  
  
            
      EXCEPTION
      WHEN OTHERS THEN
       
      p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
       
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
       
      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
      SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
      , p_ret_msg ); 

           
      
END FTTH_SEC_IPTV_CLOSE;
----Dinesh Perera  29-04-2016  -----


----Dinesh Perera  29-04-2016  -----
PROCEDURE FTTH_SEC_WAIT_IPTV (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS 

     CURSOR GET_IPTV_VALUE IS
        SELECT SUBSTR(SEOA_DEFAULTVALUE,16)
        FROM SERVICE_ORDER_ATTRIBUTES
        WHERE SEOA_SERO_ID = p_sero_id
        AND SEOA_NAME = 'CIRCUIT ID';
        
     CURSOR GET_OEID_VALUE IS
        SELECT SUBSTR(SERO_OEID,1,9)
        FROM SERVICE_ORDERS
        WHERE SERO_ID = p_sero_id;
 
     CURSOR GET_DEPNDET_CHID (V_OEID SERVICE_ORDERS.SERO_OEID%TYPE) IS
        SELECT SEIT_SERO_ID, SEIT_STAS_ABBREVIATION, SEIT_ID 
        FROM SERVICE_IMPLEMENTATION_TASKS 
        WHERE SEIT_TASKNAME IN ('SOP PROVISION ZTE','SOP PROVISION HUAWEI')
        AND SEIT_SERO_ID IN 
        (SELECT SERO_ID FROM SERVICE_ORDERS 
        WHERE SERO_OEID LIKE (V_OEID||'%') AND SERO_SERT_ABBREVIATION = 'E-IPTV FTTH');

    V_IPTV    VARCHAR2(100);
    V_OEID    VARCHAR2(100);
    V_SO_NO   VARCHAR2(100);
    V_STATS   VARCHAR2(100);
    V_SITID   VARCHAR2(100);

BEGIN

    OPEN GET_IPTV_VALUE;
    FETCH GET_IPTV_VALUE INTO V_IPTV;
    CLOSE GET_IPTV_VALUE;

    OPEN GET_OEID_VALUE;
    FETCH GET_OEID_VALUE INTO V_OEID;
    CLOSE GET_OEID_VALUE;
    
    OPEN GET_DEPNDET_CHID (V_OEID);
    FETCH GET_DEPNDET_CHID INTO V_SO_NO, V_STATS, V_SITID;
    CLOSE GET_DEPNDET_CHID;
    

    IF V_IPTV = '2' THEN
    
        IF V_STATS = 'COMPLETED' THEN
        p_implementation_tasks.update_task_status_byid(V_SO_NO,0, V_SITID,'COMPLETED');
        
        ELSE 
        p_implementation_tasks.update_task_status_byid(V_SO_NO,0, V_SITID,'INPROGRESS');
        END IF;
        
    ELSIF V_IPTV <> '2' THEN
    p_implementation_tasks.update_task_status_byid(V_SO_NO,0, V_SITID,'INPROGRESS');
    
    END IF;
    
      
EXCEPTION
WHEN OTHERS THEN
 
p_ret_msg  := 'Failed to complete task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );      
      
END FTTH_SEC_WAIT_IPTV;
----Dinesh Perera  29-04-2016  -----

---kalana 15/03/2016

PROCEDURE MNG_MS_PROV_STATUS(

      p_serv_id                IN     Services.serv_id%TYPE,
      p_sero_id                IN     Service_Orders.sero_id%TYPE,
      p_seit_id                IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname          IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                IN     work_order.woro_id%TYPE,
      p_ret_char                  OUT    VARCHAR2,
      p_ret_number                OUT    NUMBER,
      p_ret_msg                   OUT    VARCHAR2) IS
      
    
    SFE_ID                     VARCHAR2(20);
    NEW_VAL                     VARCHAR2(10);
    PRE_VAL              VARCHAR2(10);

      
CURSOR SET_FEATURES IS
               SELECT DISTINCT  SOFE_ID , NVL(SOFE_DEFAULTVALUE,'N'), NVL(SOFE_PREV_VALUE,'N')  FROM SERVICE_ORDER_FEATURES  
               WHERE SOFE_SERO_ID = p_sero_id;-- AND SOFE_FEATURE_NAME like 'INTERNET%';
    
BEGIN


   OPEN SET_FEATURES;
     LOOP
     
     FETCH SET_FEATURES INTO SFE_ID,NEW_VAL,PRE_VAL;
     EXIT WHEN SET_FEATURES%NOTFOUND;
     
     
        IF NEW_VAL <> PRE_VAL
        THEN 
        UPDATE  SERVICE_ORDER_FEATURES SET SOFE_PROVISION_STATUS = 'Y' , SOFE_PROVISION_TIME = TO_DATE( TO_CHAR (SYSDATE,'mm/dd/yyyy hh:mi:ss PM') , 'mm/dd/yyyy 

hh:mi:ss PM') ,
        SOFE_PROVISION_USERNAME = 'CLARITY_ADMIN'
        WHERE SOFE_SERO_ID = p_sero_id 
        AND SOFE_ID = SFE_ID;
        
        COMMIT;
        
        END IF;
     
     END LOOP;
     CLOSE SET_FEATURES;
    p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED'); 
     
EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Erro is:Provision update error' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
       p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');


END MNG_MS_PROV_STATUS;
---kalana 15/03/2016

PROCEDURE MS_MODIFY_ISP_VLAN2 (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

v_aggs_network varchar2(50);
v_new_val VARCHAR2(10);
v_pre_val VARCHAR2(10);

CURSOR c_aggs_network IS        
SELECT SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES soa
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'AGGREGATE NETWORK';


CURSOR c_new_val IS 
select sof.SOFE_DEFAULTVALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='MANAGED FIREWALL';

CURSOR c_pre_val IS 
select sof.SOFE_PREV_VALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='MANAGED FIREWALL';


BEGIN


OPEN c_aggs_network;
FETCH c_aggs_network INTO v_aggs_network;
CLOSE c_aggs_network;

OPEN c_new_val;
FETCH c_new_val INTO v_new_val;
CLOSE c_new_val;

OPEN c_pre_val;
FETCH c_pre_val INTO v_pre_val;
CLOSE c_pre_val;

         IF v_new_val <> v_pre_val and v_aggs_network='MEN' THEN
         

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'DS-MEN'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY ISP VLAN' ;
         

         ELSIF v_new_val <> v_pre_val and v_aggs_network='CEN' THEN

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'IPNET-PROV'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY ISP VLAN' ;
         
         
         ELSIF v_new_val = v_pre_val THEN
         
         DELETE  SERVICE_IMPLEMENTATION_TASKS SIT
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY ISP VLAN';
         
         
         END IF;
         
         
        
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'Failed to Change WG. Please check the Aggregate Network Attributes:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );


 END MS_MODIFY_ISP_VLAN2;



--21/01/2016 KALANA---
PROCEDURE MS_UPDATE_NO_ACTION (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


v_dnew_val VARCHAR2(10);
v_dpew_val VARCHAR2(10);
v_fnew_val VARCHAR2(10);
v_fpew_val VARCHAR2(10);

CURSOR c_dnew_val IS 
select sof.SOFE_DEFAULTVALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='DDOS PROTECTION';

CURSOR c_dpew_val IS 
select sof.SOFE_PREV_VALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='DDOS PROTECTION';

CURSOR c_fnew_val IS 
select sof.SOFE_DEFAULTVALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='MANAGED FIREWALL';

CURSOR c_fpew_val IS 
select sof.SOFE_PREV_VALUE
from SERVICE_ORDER_FEATURES sof
where sof.SOFE_SERO_ID = p_sero_id
and sof.SOFE_FEATURE_NAME ='MANAGED FIREWALL';

BEGIN


OPEN c_dnew_val;
FETCH c_dnew_val INTO v_dnew_val;
CLOSE c_dnew_val;

OPEN c_dpew_val;
FETCH c_dpew_val INTO v_dpew_val;
CLOSE c_dpew_val;

OPEN c_fnew_val;
FETCH c_fnew_val INTO v_fnew_val;
CLOSE c_fnew_val;

OPEN c_fpew_val;
FETCH c_fpew_val INTO v_fpew_val;
CLOSE c_fpew_val;

         IF v_dnew_val <> v_dpew_val or v_fnew_val <> v_fpew_val THEN
                  
         DELETE  SERVICE_IMPLEMENTATION_TASKS SIT
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'NO ACTION ACTIVITY';

         ELSIF v_dnew_val = v_dpew_val or v_fnew_val = v_fpew_val THEN
         
         DELETE  SERVICE_IMPLEMENTATION_TASKS SIT
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'UPDATE VAS PRICE';

         END IF;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'Failed to Change WG. Please check the Feature:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );


 END MS_UPDATE_NO_ACTION;

END P_SLT_FUNCTIONS_V4;
/
