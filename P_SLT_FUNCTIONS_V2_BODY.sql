CREATE OR REPLACE PACKAGE BODY GCI_MIG.P_SLT_FUNCTIONS_V2 is
  /******************************************************************************
   NAME:       P_SLT_FUNCTIONS_V2
   PURPOSE: Clarity Product Enhancement

   REVISIONS:
   Ver        Date        Author           Description
   ---------  ----------  ---------------  ------------------------------------
   1.0        11/1/2011             1. Created this package.
******************************************************************************/

-- Jayan Liyanage  2011/11/01(modified on 29-03-2014)
PROCEDURE SIP_TRUNK_CREATE_SO (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS v_customer_type          VARCHAR2 (100);
v_service_order          VARCHAR2 (100);
v_service_categ          VARCHAR2 (100);
v_service_type           VARCHAR2 (100);
v_service_categry        VARCHAR2 (100);
v_sig_rece_node          VARCHAR2 (100);
v_work_group             VARCHAR2 (100);
v_rtom_code              VARCHAR2 (100);
v_lea_code               VARCHAR2 (100);
v_access_medium          VARCHAR2 (100);
v_exc_area_code_a_end    VARCHAR2 (100);
Trans_nw_1               VARCHAR2 (100);   
V_SO_ARE                 VARCHAR2 (100);       
v_rtom_code_A            VARCHAR2 (100);
v_lea_code_A             VARCHAR2 (100);
v_work_group_A           VARCHAR2 (100);

BEGIN  SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; SELECT DISTINCT so.sero_ordt_type
INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id; SELECT DISTINCT cu.cusr_cutp_type INTO v_customer_type FROM service_orders so, customer cu
WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation AND so.sero_id = p_sero_id;SELECT soa.seoa_defaultvalue INTO v_service_categry
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY'; SELECT soa.seoa_defaultvalue
INTO v_access_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT SO.SERO_AREA_CODE INTO V_SO_ARE FROM SERVICE_ORDERS SO WHERE SO.SERO_ID = p_sero_id;
SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code INTO v_rtom_code_A,v_lea_code_A FROM areas ar
WHERE ar.area_code= V_SO_ARE AND ar.area_aret_code = 'LEA';
SELECT WG.WORG_NAME INTO v_work_group_A FROM WORK_GROUPS wg WHERE WORG_NAME LIKE v_rtom_code_A||'-'||v_lea_code_A||'%'||'OSP-NC'||'%';

SELECT soa.seoa_defaultvalue INTO v_exc_area_code_a_end FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'EXCHANGE AREA CODE A END';
SELECT soa.seoa_defaultvalue INTO Trans_nw_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TRANSPORT NETWORK1';

IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' AND v_access_medium = 'WIRELESS TDM' AND v_exc_area_code_a_end IS NOT NULL THEN

SELECT soa.seoa_defaultvalue INTO v_sig_rece_node FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SIGNAL RECEIVING NODE';

SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar
WHERE ar.area_code= v_sig_rece_node AND ar.area_aret_code = 'LEA';

SELECT WG.WORG_NAME INTO v_work_group FROM WORK_GROUPS wg WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'OSP-NC'||'%';
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INST SLT END OSP/DSU'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INST SLT END OSP/DSU';END IF;
IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_customer_type = 'CORPORATE-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_customer_type = 'CORPORATE-WHOLESALE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';

ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_customer_type = 'REGIONAL-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SMER-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';
END IF;

-- Confirm Test Link
/*IF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_service_categry = 'TEST'
AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST LINK';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_service_categry = 'TEST'
AND v_customer_type = 'CORPORATE-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST LINK';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_service_categry = 'TEST'
AND v_customer_type = 'CORPORATE-WHOLESALE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST LINK';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'CREATE'
AND v_service_categry = 'TEST'
AND v_customer_type = 'REGIONAL-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SMER-ACCT'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST LINK';
END IF;
*/



/* End  Start Create SO */



/* Start Create-OR SO
IF     v_service_type = 'SIP-TRUNK'
AND v_service_order = 'CREATE-OR'
AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

ELSIF     v_service_type = 'SIP-TRUNK'
AND v_service_order = 'CREATE-OR'
AND v_customer_type = 'CORPORATE-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

ELSIF     v_service_type = 'SIP-TRUNK'
AND v_service_order = 'CREATE-OR'
AND v_customer_type = 'CORPORATE-WHOLESALE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

ELSIF     v_service_type = 'SIP-TRUNK'
AND v_service_order = 'CREATE-OR'
AND v_customer_type = 'REGIONAL-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SMER-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
END IF;*/

/* End  Create-OR SO */

/* Start  Delete-OR SO */
IF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'DELETE-OR'
AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'DELETE-OR'
AND v_customer_type = 'CORPORATE-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'DELETE-OR'
AND v_customer_type = 'CORPORATE-WHOLESALE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-SIP TRUNK'
AND v_service_order = 'DELETE-OR'
AND v_customer_type = 'REGIONAL-SME'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
END IF;


if v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' and
   (Trans_nw_1 = 'DSL' or Trans_nw_1 = 'G.SHDSL') and v_access_medium = 'COPPER'  THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_A
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CON. DSL/SHDSL ACC';
ELSE DELETE service_implementation_tasks sit
  WHERE SIT.seit_taskname = 'CON. DSL/SHDSL ACC'
  AND sit.seit_sero_id = p_sero_id; END IF;





/* End   Delete-OR SO */
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change WG. Please check the Attributes:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END SIP_TRUNK_CREATE_SO;

-- Jayan Liyanage  2011/11/01

-- Jayan Liyanage  2011/11/01
PROCEDURE SIP_TRUNK_MODIFY_SO (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_customer_type        VARCHAR2 (100);
   v_service_order        VARCHAR2 (100);
   v_service_type         VARCHAR2 (100);
   v_cur_cpe_model        VARCHAR2 (100);
   v_pre_cpe_model        VARCHAR2 (100);
   v_cur_trans_network1   VARCHAR2 (100);
   v_pre_trans_network1   VARCHAR2 (100);
   v_cur_trans_network2   VARCHAR2 (100);
   v_pre_trans_network2   VARCHAR2 (100);
   v_cur_trans_network3   VARCHAR2 (100);
   v_pre_trans_network3   VARCHAR2 (100);
   v_cur_acce_medium      VARCHAR2 (100);
   v_pre_acce_medium      VARCHAR2 (100);
   v_cur_nte_model        VARCHAR2 (100);
   v_pre_nte_model        VARCHAR2 (100);
   v_sevice_cteg          VARCHAR2 (100);

   v_service_order_area   VARCHAR2 (100);
   v_rtom_code            VARCHAR2 (100);
   v_lea_code             VARCHAR2 (100);
   v_work_group           VARCHAR2 (100);
   v_cur_cpe_class        VARCHAR2 (100);
   v_pre_cpe_class        VARCHAR2 (100);
   v_work_group_mdf       VARCHAR2 (100);


BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT cu.cusr_cutp_type
              INTO v_customer_type
              FROM service_orders so, customer cu
             WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation
               AND so.sero_id = p_sero_id;


  SELECT DISTINCT so.sero_area_code
            INTO v_service_order_area
            FROM service_orders so
           WHERE so.sero_id = p_sero_id;


   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_cpe_model,v_pre_cpe_model
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_cpe_class,v_Pre_cpe_class
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_trans_network1, v_pre_trans_network1
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK1';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_trans_network2, v_pre_trans_network2
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK2';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_trans_network3, v_pre_trans_network3
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK3';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_acce_medium, v_pre_acce_medium
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_nte_model, v_pre_nte_model
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTE MODEL';

   SELECT soa.seoa_defaultvalue
     INTO v_sevice_cteg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

   SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code
    INTO v_rtom_code,v_lea_code
    FROM areas ar
   WHERE ar.area_code= v_service_order_area AND ar.area_aret_code = 'LEA';

   SELECT WG.WORG_NAME
    INTO v_work_group
   FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'OSP-NC'||'%';


  SELECT WG.WORG_NAME
    INTO v_work_group_mdf
    FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'MDF'||'%';

   /* Start  Modify CPE  */
   IF     v_service_type = 'SIP-TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND v_cur_cpe_model <> v_pre_cpe_model
      AND v_Pre_cpe_class IS NOT NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-CPE'
         AND v_customer_type = 'CORPORATE-SME'
         AND v_cur_cpe_model <> v_pre_cpe_model
         AND v_Pre_cpe_class IS NOT NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-CPE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND v_cur_cpe_model <> v_pre_cpe_model
         AND v_Pre_cpe_class IS NOT NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-CPE'
         AND v_customer_type = 'REGIONAL-SME'
         AND v_cur_cpe_model <> v_pre_cpe_model
         AND v_Pre_cpe_class IS NOT NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   END IF;

   -- New Requirmrnt 12_02_29 ---
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_cur_cpe_class = 'SLT'
      AND v_cur_cpe_class <> v_Pre_cpe_class
      AND v_Pre_cpe_class IS NOT NULL
    THEN

        UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY CPE';
  END IF;
  ----------------------- Confirm Test Link -----------------------------------
/*   IF     v_service_type  = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_sevice_cteg   = 'TEST'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';

   ELSIF     v_service_type  = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_sevice_cteg   = 'TEST'
      AND v_customer_type = 'CORPORATE-SME'

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';

   ELSIF     v_service_type  = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_sevice_cteg   = 'TEST'
      AND v_customer_type = 'CORPORATE-WHOLESALE'

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WHOSALES-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';

   ELSIF    v_service_type  = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-CPE'
      AND v_sevice_cteg   = 'TEST'
      AND v_customer_type = 'REGIONAL-SME'

    THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';

   END IF;*/
   ----------------------- Confirm Test Link -----------------------------------
 -- End Requirmrnt

 -- Install CPE Task..
   IF  v_cur_cpe_class = 'SLT' AND v_Pre_cpe_class = 'CUSTOMER' THEN

      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL CPE';

   ELSE
       DELETE      service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
       AND sit.seit_taskname = 'INSTALL CPE';

   END IF;
 -- End Install CPE Task..

 -- Collect CPE Task..
   IF  v_cur_cpe_class = 'CUSTOMER' AND v_Pre_cpe_class = 'SLT' THEN

      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT CPE';

   ELSE
       DELETE      service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
       AND sit.seit_taskname = 'COLLECT CPE';

   END IF;

 -- End Collect CPE Task..




   /* End  Modify CPE  */

   /* Start Modify Speed */

   -- Modify OSP/NTE
   IF        v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND (    (    v_cur_trans_network1 = 'MLLN'
                   AND v_cur_acce_medium = 'COPPER'
                  )
              AND (v_cur_acce_medium <> v_pre_acce_medium)
             )
      OR (v_pre_nte_model <> v_cur_nte_model)
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group ---
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY OSP/NTE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY OSP/NTE';
   END IF;

   -- Activate Ether Link
   IF        v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND (    v_cur_trans_network1 = 'MEN'
              AND v_cur_trans_network1 <> v_pre_trans_network1
             )
      OR (    v_cur_trans_network2 = 'MEN'
          AND v_cur_trans_network2 <> v_pre_trans_network2
         )
      OR (    v_cur_trans_network3 = 'MEN'
          AND v_cur_trans_network3 <> v_pre_trans_network3
         )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIV. ETHERNET LINK';
   ELSIF        v_service_type = 'D-SIP TRUNK'
            AND v_service_order = 'MODIFY-SPEED'
            AND (    v_cur_trans_network1 = 'CEA'
                 AND v_cur_trans_network1 <> v_pre_trans_network1
                )
         OR (    v_cur_trans_network2 = 'CEA'
             AND v_cur_trans_network2 <> v_pre_trans_network2
            )
         OR (    v_cur_trans_network3 = 'CEA'
             AND v_cur_trans_network3 <> v_pre_trans_network3
            )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIV. ETHERNET LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIV. ETHERNET LINK';
   END IF;

   -- Modify Price Plan  2012 03 01
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'REGIONAL-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   END IF;

   -- End Modify Price Plan 2012 03 01




   -- Confirm Test Link
/*   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND v_sevice_cteg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'CORPORATE-SME'
         AND v_sevice_cteg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND v_sevice_cteg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-SPEED'
         AND v_customer_type = 'REGIONAL-SME'
         AND v_sevice_cteg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST LINK';
   END IF;*/

   --- Remove DSL Acess
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (    v_pre_trans_network1 = 'DSL'
           AND v_pre_trans_network1 <> v_cur_trans_network1
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE DSL ACCESS';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE DSL ACCESS';
   END IF;

   --- Remove OLD OSP/NTE
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (v_pre_trans_network1 = 'MLLN' AND v_pre_acce_medium = 'COPPER')
      AND v_pre_trans_network1 <> v_cur_trans_network1
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE OLD OSP/NTE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE OLD OSP/NTE';
   END IF;

   -- Remove SLT end OLD OSP/DSU
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (    v_pre_acce_medium = 'WIRELESS TDM'
           AND v_pre_acce_medium <> v_cur_acce_medium
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REM.SLT END OSP/DSU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REM.SLT END OSP/DSU';
   END IF;

   -- Collect OLD Radio
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (    v_pre_acce_medium = 'WIRELESS TDM'
           AND v_pre_acce_medium <> v_cur_acce_medium
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD RADIO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD RADIO';
   END IF;

   --DeActivate Old TX Ports
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (    v_pre_trans_network1 = 'TDM TX'
           AND v_pre_trans_network1 <> v_cur_trans_network1
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'OPR-NETMGT-TX'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD TX PORTS';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT. OLD TX PORTS';
   END IF;

   -- Collect  OLD DSL NTE
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (    v_pre_trans_network1 = 'DSL'
           AND v_pre_trans_network1 <> v_cur_trans_network1
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD DSL NTE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD DSL NTE';
   END IF;
------ New Modifications 12_03_01-----
 -- CPE Collect OLD CPE
    IF     v_service_type = 'D-SIP TRUNK'
       AND v_service_order = 'MODIFY-SPEED'
       AND v_cur_cpe_class = 'SLT'
       AND v_cur_cpe_model <> v_pre_cpe_model

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD CPE';
   END IF;

------  End New Modifications 12_03_01-----
   /* End  Modify Speed */


   ---  Remove Old MLLN Access  12_03_02

   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (v_pre_trans_network1 = 'MLLN' AND v_pre_acce_medium = 'COPPER')
      AND v_pre_trans_network1 <> v_cur_trans_network1
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RE. OLD MLLN ACCESS';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RE. OLD MLLN ACCESS';
   END IF;

   ---- End Remove Old MLLN Access


      IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-SPEED'
      AND (v_pre_trans_network1 = 'MLLN')
      AND v_pre_trans_network1 <> v_cur_trans_network1
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_mdf
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE MDF X CONNECT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE MDF X CONNECT';
   END IF;
  ------------  12_03_02 ----------------------------------------------
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_MODIFY_SO;

-- Jayan Liyanage  2011/11/01

-- Jayan Liyanage  2011/11/01

PROCEDURE SIP_TRUNK_MODIFY_LO (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_network_1             VARCHAR2 (100);
   v_network_2             VARCHAR2 (100);
   v_network_3             VARCHAR2 (100);
   v_access_node_chg       VARCHAR2 (100);
   v_pre_network_1         VARCHAR2 (100);
   v_pre_network_2         VARCHAR2 (100);
   v_pre_network_3         VARCHAR2 (100);
   v_pre_access_node_chg   VARCHAR2 (100);
   v_service_type          VARCHAR2 (100);
   v_service_order         VARCHAR2 (100);

   v_service_order_area    VARCHAR2 (100);
   v_rtom_code             VARCHAR2 (100);
   v_lea_code              VARCHAR2 (100);
   v_work_group            VARCHAR2 (100);
   v_cur_access_medium     VARCHAR2 (100);
   v_pre_access_medium     VARCHAR2 (100);
   v_pre_Cpe_Class         VARCHAR2 (100);
   v_pre_core_network      VARCHAR2 (100);
   v_router_chg            VARCHAR2 (100);
   v_work_group_cpe        VARCHAR2 (100);
   v_work_group_mdf        VARCHAR2 (100);

   v_sig_rece_node         VARCHAR2 (100);
   v_rtom_code_sig         VARCHAR2 (100);
   v_lea_code_sig          VARCHAR2 (100);
   v_work_group_sig        VARCHAR2 (100);

BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_area_code
              INTO v_service_order_area
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_network_1, v_pre_network_1
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK1';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_network_2, v_pre_network_2
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK2';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_network_3, v_pre_network_3
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'TRANSPORT NETWORK3';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_access_node_chg, v_pre_access_node_chg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'ACCESS NODE CHANGE';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_access_medium, v_pre_access_medium
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'ACCESS MEDIUM';

   SELECT soa.seoa_prev_value
     INTO v_pre_core_network
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'CORE NETWORK';

   SELECT soa.seoa_defaultvalue
     INTO v_router_chg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'PE ROUTER CHANGE';


   SELECT soa.seoa_prev_value
     INTO v_pre_Cpe_Class
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'CPE CLASS';

   SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code
    INTO v_rtom_code,v_lea_code
    FROM areas ar
   WHERE ar.area_code= v_service_order_area
          AND ar.area_aret_code = 'LEA';

   SELECT WG.WORG_NAME
    INTO v_work_group
   FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'OSP-NC'||'%';

  SELECT WG.WORG_NAME
    INTO v_work_group_cpe
   FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code||'-'||'%'||'CPE-NC'||'%';

  SELECT WG.WORG_NAME
    INTO v_work_group_mdf
    FROM WORK_GROUPS wg
WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'MDF'||'%';


   /* Start Modify Loc */

   -- Recerve MEN Facility
   IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_network_1 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_network_2 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_network_3 = 'MEN' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RESERVE MEN FACILITY';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RESERVE MEN FACILITY';
   END IF;

   -- Recerve CEA Facility
   IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_network_1 = 'CEA' AND v_access_node_chg = 'YES')
      OR (v_network_2 = 'CEA' AND v_access_node_chg = 'YES')
      OR (v_network_3 = 'CEA' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RESERVE CEA FACILITY';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RESERVE CEA FACILITY';
   END IF;

 -- Modified Functions 2012_03_01

   -- Activate Ethernet Link
   IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_network_1 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_network_2 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_network_3 = 'MEN' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIV ETHERNET LINK';
   ELSE
      DELETE      service_implementation_tasks sit
       WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'ACTIV ETHERNET LINK';

   END IF;

   --  End Activate Ethernet Link

   --- Activate Ethernet link CEA --

   IF    v_service_type = 'SIP-TRUNK'
            AND v_service_order = 'MODIFY-LOCATION'
            AND (v_network_1 = 'CEA' AND v_access_node_chg = 'YES')
         OR (v_network_2 = 'CEA' AND v_access_node_chg = 'YES')
         OR (v_network_3 = 'CEA' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIV ETH. LINK CEA';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIV ETH. LINK CEA';
   END IF;

   --- End  Activate Ethernet link CEA --
/* Based on previous value */

    IF v_pre_network_1 = 'MLLN' AND v_pre_access_medium = 'COPPER' THEN

       UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE OLD OSP/NTE';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE OLD OSP/NTE';
    END IF;

   IF v_pre_access_medium = 'WIRELESS TDM' THEN

    UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = v_work_group
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REM.SLT END OSP/DSU';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REM.SLT END OSP/DSU';
    END IF;

  IF v_pre_access_medium = 'FIBER' THEN

    UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'CORP-SSU'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE OLD LOCAL LIN';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE OLD LOCAL LIN';
    END IF;

   IF v_pre_access_medium = 'WIRELESS TDM' THEN

    UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'TX-RADIO-LAB'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'COLLECT OLD RADIO';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD RADIO';
    END IF;

    IF v_pre_network_1 = 'CEA' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'IPNET-PROV'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE CEA OLD ACCES';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE CEA OLD ACCES';
    END IF;

    IF v_pre_network_1 = 'DSL' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = v_work_group
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE DSL ACCESS';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE DSL ACCESS';
    END IF;

     IF v_pre_network_1 = 'MEN' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'DS-MEN'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'REMOVE MEN OLD ACCES';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE MEN OLD ACCES';
    END IF;

    IF v_pre_network_1 = 'DSL' AND v_access_node_chg = 'YES' THEN

         UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'CEN-ADSL'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'DEACT OLD BB LINK';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT OLD BB LINK';
    END IF;

    IF v_pre_network_1 = 'TDM TX' AND v_access_node_chg = 'YES' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'OPR-NETMGT-TX'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'DEACT OLD TX PORTS';
    ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT OLD TX PORTS';
    END IF;

    IF v_pre_network_1 = 'DSL' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = v_work_group_cpe
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'COLLECT OLD DSL NTE';
    ELSE
      DELETE      service_implementation_tasks sit
       WHERE sit.seit_sero_id = p_sero_id
          AND sit.seit_taskname = 'COLLECT OLD DSL NTE';
    END IF;

    IF v_pre_Cpe_Class = 'SLT' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'DS-CPEI'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'COLLECT OLD CPE';
    ELSE
      DELETE      service_implementation_tasks sit
       WHERE sit.seit_sero_id = p_sero_id
          AND sit.seit_taskname = 'COLLECT OLD CPE';
    END IF;


     IF v_pre_core_network = 'MPLS' AND v_router_chg = 'YES' THEN

      UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'IPNET-PROV'
      WHERE sit.seit_sero_id = p_sero_id
        AND sit.seit_taskname = 'DEACT OLD VPN ACCESS';
    ELSE
      DELETE      service_implementation_tasks sit
       WHERE sit.seit_sero_id = p_sero_id
          AND sit.seit_taskname = 'DEACT OLD VPN ACCESS';
    END IF;

   -- DeActivate OLD Ethernet Link
   IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_pre_network_1 = 'CEA' AND v_access_node_chg = 'YES')
      OR (v_pre_network_2 = 'CEA' AND v_access_node_chg = 'YES')
      OR (v_pre_network_3 = 'CEA' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT ETHERNET LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT ETHERNET LINK';
   END IF;

   -- De Active Old Ethernet link
   IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_pre_network_1 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_pre_network_2 = 'MEN' AND v_access_node_chg = 'YES')
      OR (v_pre_network_3 = 'MEN' AND v_access_node_chg = 'YES')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT.OLD ETHER LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT.OLD ETHER LINK';
   END IF;

/* Based on previous value Closed  */

 ---  New Modification 2012_03_01

    IF        v_service_type = 'SIP-TRUNK'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_pre_network_1 = 'MLLN'
         AND v_access_node_chg = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_mdf
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE MDF X CONNECT';
   ELSE
      DELETE      service_implementation_tasks sit
        WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE MDF X CONNECT';

   END IF;
   ---- Signal Rece Node Mapping -- 2012 03 01

  SELECT soa.seoa_defaultvalue
     INTO v_sig_rece_node
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SIGNAL RECEIVING NODE';
    if v_sig_rece_node is not null then
   SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code
    INTO v_rtom_code_sig,v_lea_code_sig
    FROM areas ar
   WHERE ar.area_code= v_sig_rece_node AND ar.area_aret_code = 'LEA';

   SELECT WG.WORG_NAME
    INTO v_work_group_sig
   FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code_sig||'-'||v_lea_code_sig||'%'||'OSP-NC'||'%'; end if;

     IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-LOCATION'
     THEN
        UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_sig
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INST SLT END OSP/DSU';

     END IF;

 ----End  Signal Rece Node Mapping -- 2012 03 01


 ---  End New Modification 2012_03_01

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_MODIFY_LO;
-- Jayan Liyanage  2011/11/01


-- Jayan Liyanage  2011/11/16

PROCEDURE SIP_TRUNK_DEL(
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)IS

   v_service_type          VARCHAR2 (100);
   v_service_order         VARCHAR2 (100);
   v_customer_type         VARCHAR2 (100);


BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT cu.cusr_cutp_type
              INTO v_customer_type
              FROM service_orders so, customer cu
             WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation
               AND so.sero_id = p_sero_id;

   /* Start Suspend */

   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'SUSPEND'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'SUSPEND'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'SUSPEND'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'SUSPEND'
         AND v_customer_type = 'REGIONAL-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';
   END IF;

/* End  Suspend */

/* Start Resume */

   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'RESUME'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'RESUME'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'RESUME'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'RESUME'
         AND v_customer_type = 'REGIONAL-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';
   END IF;

/* End  Resume */


/* Start Delete */

   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'DELETE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'DELETE'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'DELETE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'DELETE'
         AND v_customer_type = 'REGIONAL-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'APPROVE SO';
   END IF;

/* End  Delete */



   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_DEL;


-- Jayan Liyanage  2011/11/16 Updated on 28-09-2014


PROCEDURE SIP_TRUNK_CREATE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_customer_type     VARCHAR2 (100);
   v_service_order     VARCHAR2 (100);
   v_service_categ     VARCHAR2 (100);
   v_service_type      VARCHAR2 (100);
   v_service_categry   VARCHAR2 (100);

   v_sig_rece_node     VARCHAR2 (100);
   v_rtom_code_sig     VARCHAR2 (100);
   v_lea_code_sig      VARCHAR2 (100);
    v_work_group_sig   VARCHAR2 (100);
   v_access_medium     VARCHAR2 (100);
   v_work_group_OSP    VARCHAR2 (100);
   v_area_code         VARCHAR2 (100);
   v_trans_nw_1        VARCHAR2 (100);
   
   
   
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT cu.cusr_cutp_type
              INTO v_customer_type
              FROM service_orders so, customer cu
             WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation
               AND so.sero_id = p_sero_id;

    SELECT soa.seoa_defaultvalue
     INTO v_access_medium
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
 

    SELECT soa.seoa_defaultvalue
     INTO v_trans_nw_1 FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TRANSPORT NETWORK1';



select distinct so.sero_area_code into v_area_code  
from service_orders so where so.sero_id = p_sero_id;

select distinct aw.arwg_worg_name into v_work_group_OSP from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-SIP TRUNK' and aw.arwg_area_code  = v_area_code
 and aw.arwg_grouptype = 'OSP';

   -- Start Create-OR SO
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'CREATE-OR'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'CREATE-OR'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'CREATE-OR'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE DELETE-OR SO';

   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'CREATE-OR'
         AND v_customer_type = 'REGIONAL-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
   END IF;

   /* End  Create-OR SO */


  ---- Signal Rece Node Mapping -- 2012 03 01

  IF     v_service_type = 'D-SIP TRUNK'
    AND v_service_order = 'CREATE-OR'
    AND v_access_medium = 'WIRELESS TDM'
  THEN

  SELECT soa.seoa_defaultvalue
     INTO v_sig_rece_node
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SIGNAL RECEIVING NODE';


   SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code
    INTO v_rtom_code_sig,v_lea_code_sig
    FROM areas ar
   WHERE ar.area_code= v_sig_rece_node AND ar.area_aret_code = 'LEA';

/*   SELECT WG.WORG_NAME
    INTO v_work_group_sig
   FROM WORK_GROUPS wg
  WHERE WORG_NAME LIKE v_rtom_code_sig||'-'||v_lea_code_sig||'%'||'OSP-NC'||'%';
 */
 
select distinct aw.arwg_worg_name into v_work_group_sig  from area_workgroups aw
where aw.arwg_sert_abbreviation = 'D-SIP TRUNK' and aw.arwg_area_code  = v_lea_code_sig
and aw.arwg_grouptype = 'OSP';
 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_sig
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INST SLT END OSP/DSU';

ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INST SLT END OSP/DSU'; END IF;
     


IF     v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-OR' AND ( v_trans_nw_1 = 'DSL' OR v_trans_nw_1 = 'G.SHDSL') AND 
  v_access_medium = 'COPPER'  THEN
     
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_sig 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONST. DSL/SHDSL ACC';

ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE-OR'  THEN
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONST. DSL/SHDSL ACC';
END IF;

 ----End  Signal Rece Node Mapping -- 2012 03 01


   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_CREATE_OR;

--- Jayan Liyanage 2011 12 15

PROCEDURE SIP_TRUNK_MODIFY_MSAN_SUB_CHG (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR Cur_Equi_Type is
SELECT DISTINCT E.EQUP_EQUT_ABBREVIATION
FROM SERVICE_ORDERS SO,PORTS P,EQUIPMENT E
WHERE SO.SERO_CIRT_NAME = P.PORT_CIRT_NAME
AND P.PORT_EQUP_ID = E.EQUP_ID
AND SO.SERO_ID = p_sero_id;


v_equip_Type         varchar2(100);
v_Cur_Transport_ntw  varchar2(100);
v_Pre_Transport_ntw  varchar2(100);
v_access_node_chg    varchar2(100);
v_service_order_area varchar2(100);
v_rtom_code          varchar2(100);
v_lea_code           varchar2(100);
v_work_group         varchar2(100);
v_work_group_mdf     varchar2(100);
v_service_type       varchar2(100);
v_service_order      varchar2(100);

BEGIN


OPEN Cur_Equi_Type;
FETCH Cur_Equi_Type INTO v_equip_Type;
CLOSE Cur_Equi_Type;


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;


SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
INTO v_Cur_Transport_ntw, v_Pre_Transport_ntw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'TRANSPORT NETWORK1';


SELECT soa.seoa_defaultvalue
INTO v_access_node_chg
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS NODE CHANGE';


SELECT SUBSTR(ar.area_area_code,3,INSTR(ar.area_area_code,'-',1)+1) as codes,ar.area_code
INTO v_rtom_code,v_lea_code
FROM areas ar
WHERE ar.area_code= v_service_order_area
AND ar.area_aret_code = 'LEA';

SELECT WG.WORG_NAME
INTO v_work_group
FROM WORK_GROUPS wg
WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'OSP-NC'||'%';

SELECT WG.WORG_NAME
INTO v_work_group_mdf
FROM WORK_GROUPS wg
WHERE WORG_NAME LIKE v_rtom_code||'-'||v_lea_code||'%'||'MDF'||'%';


IF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' AND v_Cur_Transport_ntw = 'DSL' AND v_access_node_chg ='YES' AND
(v_equip_Type = 'MSAN-IG' OR v_equip_Type = 'MSAN-IW'OR v_equip_Type = 'MSAN-OW'
OR v_equip_Type = 'MSAN-OG'OR v_equip_Type = 'MSAN-OP') THEN

      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name = v_work_group
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE X CON';

ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' AND v_Cur_Transport_ntw = 'DSL' AND v_access_node_chg ='YES' AND
(v_equip_Type <> 'MSAN-IG' OR v_equip_Type <> 'MSAN-IW'OR v_equip_Type <> 'MSAN-OW'
OR v_equip_Type <> 'MSAN-OG'OR v_equip_Type <> 'MSAN-OP') THEN


      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name = v_work_group_mdf
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE X CON';

ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' and  v_equip_Type is not null THEN

      DELETE      service_implementation_tasks sit
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE X CON';

END IF;




IF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_Transport_ntw = 'MLLN' AND v_access_node_chg = 'YES' THEN

      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name = v_work_group_mdf
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE MDF X CONNECT';

ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'MODIFY-LOCATION' THEN

      DELETE  service_implementation_tasks sit
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'REMOVE MDF X CONNECT';

END IF;


IF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' AND v_Cur_Transport_ntw = 'DSL' AND
(v_equip_Type = 'MSAN-IG' OR v_equip_Type = 'MSAN-IW'OR v_equip_Type = 'MSAN-OW'
OR v_equip_Type = 'MSAN-OG'OR v_equip_Type = 'MSAN-OP') THEN


      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name = v_work_group
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'MAKE X CONNECTIONS';

ELSIF v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' AND v_Cur_Transport_ntw = 'DSL' AND
(v_equip_Type <> 'MSAN-IG' OR v_equip_Type <> 'MSAN-IW'OR v_equip_Type <> 'MSAN-OW'
OR v_equip_Type <> 'MSAN-OG'OR v_equip_Type <> 'MSAN-OP') THEN

      UPDATE service_implementation_tasks sit
      SET sit.seit_worg_name = v_work_group_mdf
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'MAKE X CONNECTIONS';

ELSIF (v_service_type = 'D-SIP TRUNK' AND v_service_order = 'CREATE' and v_Cur_Transport_ntw = 'DSL') and v_equip_Type is  null THEN

       UPDATE service_implementation_tasks sit
       SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
       AND sit.seit_taskname = 'MAKE X CONNECTIONS';

ELSE
      DELETE  service_implementation_tasks sit
      WHERE sit.seit_sero_id = p_sero_id
      AND sit.seit_taskname = 'MAKE X CONNECTIONS';
END IF;


   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );


END SIP_TRUNK_MODIFY_MSAN_SUB_CHG;

--- Jayan Liyanage 2011 12 15

--- Jayan Liyanage 2011 12 16
PROCEDURE SIP_TRUNK_BANDWITH_SET (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_codec_value      VARCHAR2 (100);
   v_no_of_sessions   VARCHAR2 (100);
   v_codec_g71        VARCHAR2 (100);
   v_codec_g72        VARCHAR2 (100);
BEGIN
   SELECT soa.seoa_defaultvalue
     INTO v_codec_value
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CODEC';

   SELECT soa.seoa_defaultvalue
     INTO v_no_of_sessions
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'NO: OF SIMULTANEOUS SIP SESSIONS';

   IF ((v_codec_value = 'G.711'or v_codec_value = 'BOTH'))
   THEN
      SELECT DISTINCT sb.codec_g71
                 INTO v_codec_g71
                 FROM clarity.sip_trunck_bandwidth sb
                WHERE sb.no_of_sessions = v_no_of_sessions;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_codec_g71
       WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE_SPEED';

      UPDATE service_orders so
         SET so.sero_sped_abbreviation = v_codec_g71
       WHERE so.sero_id = p_sero_id;
 
      update circuits ci
             set ci.cirt_sped_abbreviation = v_codec_g71
             where ci.cirt_name = (select so.sero_cirt_name
            from service_orders so,circuits ci
            where so.sero_cirt_name = ci.cirt_name
            and so.sero_id = p_sero_id);
       
   ELSIF v_codec_value = 'G.729'
   THEN
      SELECT DISTINCT sb.codec_g72
                 INTO v_codec_g72
                 FROM clarity.sip_trunck_bandwidth sb
                WHERE sb.no_of_sessions = v_no_of_sessions;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_codec_g72
       WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE_SPEED';

      UPDATE service_orders so
         SET so.sero_sped_abbreviation = v_codec_g72
       WHERE so.sero_id = p_sero_id;
       
      update circuits ci
       set ci.cirt_sped_abbreviation = v_codec_g72
       where ci.cirt_name = (select so.sero_cirt_name
      from service_orders so,circuits ci
      where so.sero_cirt_name = ci.cirt_name
      and so.sero_id = p_sero_id);
       
       
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_BANDWITH_SET;
--- Jayan Liyanage 2011 12 16

--- 20-03-2013 Modify
-- 12-11-2011 Samankula Owitipana

PROCEDURE ADSL_LINE_PROFILE_TO_SPEED (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS





    v_ADSL_LINE_PROFILE     SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
    v_ADSL_SPEED            varchar(80);
    v_ADSL_SPEED_OLD        varchar(80);
    v_ADSL_PKG_NAME         varchar(80);
    LF_SPEED_NEW     VARCHAR2(50);
    LF_SPEED_OLD     VARCHAR2(50);

             

CURSOR c_adsl_speed  IS
SELECT SOA.SEOA_DEFAULTVALUE,SOA.SEOA_PREV_VALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'SERVICE_SPEED'
AND soa.SEOA_SOFE_ID IS NULL;

CURSOR c_adsl_pkg  IS
SELECT SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'SA_PACKAGE_NAME';

CURSOR C_ADSL_LF_PKG IS
SELECT  ADSL_SPEED_NEW,ADSL_SPEED_OLD 
FROM    clarity.SPEED_LINE_PROF
WHERE   STATUS='ACTIVE'
AND     ADSL_PKG_NAME=v_ADSL_PKG_NAME
AND     ADSL_SPEED=v_ADSL_SPEED;


CURSOR C_ADSL_LF_SPD IS
SELECT  ADSL_SPEED_NEW,ADSL_SPEED_OLD 
FROM    clarity.SPEED_LINE_PROF
WHERE   STATUS='ACTIVE'
AND     ADSL_SPEED=v_ADSL_SPEED
AND     ADSL_PKG_NAME IS NULL;

    BEGIN

    OPEN c_adsl_speed;
    FETCH c_adsl_speed INTO v_ADSL_SPEED,v_ADSL_SPEED_OLD ;
    CLOSE c_adsl_speed;

    OPEN c_adsl_pkg;
    FETCH c_adsl_pkg INTO v_ADSL_PKG_NAME ;
    CLOSE c_adsl_pkg;


        IF v_ADSL_PKG_NAME = 'HOME EXPRESS'  THEN
        
            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        
        ELSIF v_ADSL_PKG_NAME = 'HOME' THEN
        
            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        
        ELSIF v_ADSL_PKG_NAME = 'OFFICE EXPRESS' THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;

        ELSIF v_ADSL_PKG_NAME = 'OFFICE PLUS' THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        ELSIF v_ADSL_PKG_NAME = 'XCITE'  THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        ELSIF v_ADSL_PKG_NAME = 'XCITE'  THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        ELSIF v_ADSL_PKG_NAME = 'XCEL'  THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
        
        ELSIF v_ADSL_PKG_NAME = 'XCEL'  THEN

            BEGIN
            OPEN C_ADSL_LF_PKG;
            FETCH C_ADSL_LF_PKG INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_PKG;
            END;
            
        ELSE
        
            BEGIN
            OPEN C_ADSL_LF_SPD;
            FETCH C_ADSL_LF_SPD INTO LF_SPEED_NEW,LF_SPEED_OLD ;
            CLOSE C_ADSL_LF_SPD;
            END;
        
        END IF;

        
        update SERVICE_ORDER_ATTRIBUTES SOA
        set soa.SEOA_DEFAULTVALUE = LF_SPEED_NEW,soa.SEOA_PREV_VALUE = LF_SPEED_OLD
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'LINE_PROFILE';



    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');





     EXCEPTION
     WHEN OTHERS THEN


            p_ret_msg  := 'SET PKG SPEED FAILED' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

            p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

            INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
              SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
              , p_ret_msg);


    END ADSL_LINE_PROFILE_TO_SPEED;

-- 05-01-2012 Samankula Owitipana
--- 20-03-2013 Modify


--- 30-01-2012  Samankula Owitipana

PROCEDURE ADSL_MODSPEED_FUP_N (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS



v_fup_value     varchar2(20);


CURSOR CUR_FUP_VALUE IS
SELECT TRIM(UPPER(A.SEOA_DEFAULTVALUE))
FROM CLARITY.SERVICE_ORDER_ATTRIBUTES A
WHERE A.SEOA_SERO_ID= p_sero_id
AND A.SEOA_NAME='FUP';


BEGIN



OPEN CUR_FUP_VALUE;
FETCH CUR_FUP_VALUE INTO v_fup_value;
CLOSE CUR_FUP_VALUE;



IF v_fup_value = 'Y' THEN


UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET soa.SEOA_DEFAULTVALUE = 'N'
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'FUP';


END IF;



p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'Failed to set FUP attribut Y. ' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg );


END ADSL_MODSPEED_FUP_N;

--- 30-01-2012  Samankula Owitipana



-- Dulip Frenando  2012/01/30

PROCEDURE PE_TITLE_TO_SO_COMMENTS (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2) IS


v_PE_NO VARCHAR2(20);
v_PE_TI VARCHAR2(100);
v_So_Id VARCHAR2(100);



CURSOR PE_NUMBER_CUR IS
select s.SERO_OEID,s.SERO_ID
from service_orders s
where s.SERO_ID=p_sero_id;


BEGIN

OPEN PE_NUMBER_CUR;
FETCH PE_NUMBER_CUR INTO v_PE_NO,v_So_Id;
CLOSE PE_NUMBER_CUR;



select PE.PLAE_TITLE
into v_PE_TI
from planned_events PE
where PLAE_NUMBER=v_PE_NO;


Insert into SERVICE_ORDER_COMMENTS
   (SEOC_SERO_ID, SEOC_SERO_REVISION, SEOC_ID, SEOC_USERID, SEOC_TIMESTAMP, SEOC_TEXT)
 Values
   (v_So_Id, '0', SEOC_ID_SEQ.NEXTVAL, 'PE-COMMENTS', SYSDATE, v_PE_TI);


EXCEPTION
WHEN OTHERS THEN


      p_ret_msg  := 'Failed to Update . Please check the Attributes:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( v_So_Id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , 'Check Service Order Id ');


END PE_TITLE_TO_SO_COMMENTS;

-- Dulip Frenando  2012/01/30

-- 10-02-2012 Samankula Owitipan
-- Completion rule

PROCEDURE DIDO_PROVISION_DETAIL_EMAIL (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


SENDER          constant VARCHAR2(80) := 'oss@slt.com.lk';MAILHOST        constant VARCHAR2(80) := '172.25.2.205';
mail_conn utl_smtp.connection;V_CL            constant VARCHAR2(2) := CHR(13)||CHR(10);
l_rcpt           VARCHAR2(80) := 'ayodhya@slt.com.lk';l_cc_recipient   VARCHAR2(80) := 'ilmi@slt.com.lk';
l_bcc_recipient  VARCHAR2(80) := 'cdinesh@slt.com.lk';l_subject        VARCHAR2(80) := 'DIDO Service Order Provision Details';
l_mesg           VARCHAR2(9900);l_body           VARCHAR2(9000);v_servic_type varchar2(100);
v_order_type varchar2(100);v_cr_no varchar2(100);v_ac_no varchar2(100);v_cus_name varchar2(300);
v_cct_name varchar2(100);v_so_id varchar2(100);v_attr_table_html varchar2(1000);v_error_1 varchar2(4000);
v_error_2 varchar2(4000);CURSOR c_so_customer_data is
SELECT so.sero_id,so.SERO_SERT_ABBREVIATION,so.SERO_ORDT_TYPE,so.SERO_CUSR_ABBREVIATION,so.SERO_ACCT_NUMBER,cu.CUSR_NAME,
ci.CIRT_DISPLAYNAME FROM SERVICE_ORDERS SO,customer cu,circuits ci
WHERE so.SERO_CUSR_ABBREVIATION = cu.CUSR_ABBREVIATION
and so.SERO_CIRT_NAME = ci.CIRT_NAME(+) AND so.SERO_ID = p_sero_id;
CURSOR c_so_attribute_data is SELECT SOA.SEOA_NAME,SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME IN
( 'NETWORK CODE','DATA CIRCUIT ID','ACTUAL_DSP_DATE','SA_EXCHANGE_CODE','PILOT NUMBER','NUMBER_RANGE');BEGIN
open c_so_customer_data; fetch c_so_customer_data into v_so_id,v_servic_type,v_order_type,v_cr_no,v_ac_no,v_cus_name,v_cct_name;
close c_so_customer_data;FOR d_so_attribute_data IN c_so_attribute_data LOOP
v_attr_table_html := v_attr_table_html || '<tr><td>' || d_so_attribute_data.seoa_name || '</td><td>'|| d_so_attribute_data.seoa_defaultvalue ||'</td></tr>';
END LOOP;mail_conn := utl_smtp.open_connection(mailhost, 25) ;utl_smtp.helo(mail_conn, MAILHOST) ;
--dbms_output.put_line('Sending Email to : ' || d_contractor.email ) ;
l_body :=  '<html><head><title>DIDO Service Order Provision Details</title></head><body>'||v_cl||v_cl||
 '<table width="100%" cellpadding="10" cellspacing="0">'||v_cl||v_cl||
 '<tr>'||v_cl||v_cl||
 '<span style=''color:Blue;font-family:Calibri,Arial,Helvetica,sans-serif''>'||v_cl||v_cl||
 '<p>Dear '|| 'Sir' ||'/'|| 'Madam' ||','||v_cl||v_cl||
 '<br><br><b>' || v_so_id || '</b>' || ' Service order details shown below.' || v_cl||v_cl ||
 '<span style=''color:black''>'||v_cl||v_cl||
 '<ul><u>Customer details</u>'||v_cl||v_cl||
 '<li>Customer Name: ' || v_cus_name ||v_cl||v_cl||
 '<li>CR No: ' || v_cr_no ||v_cl||v_cl||
 '<li>Account No: ' || v_ac_no ||v_cl||v_cl||
 '</ul></span><span style=''font-weight:bold; color:Red; font-family:Cambria,Calibri,Arial,Helvetica,sans-serif''>'||v_cl||v_cl||
 '<p>Service Order Details</span>'||v_cl||v_cl||
 ' <table cellpadding="10" cellspacing="1" border="1">' ||v_cl||v_cl||
 '<tr><td>SERVICE TYPE</td> <td>' || v_servic_type ||'</td></tr>'||v_cl||v_cl||
 '<tr><td>ORDER TYPE</td><td>'|| v_order_type ||'</td></tr>' ||v_cl||v_cl||
 '<tr><td>DISPLAY NAME</td><td>'|| v_cct_name ||'</td></tr>' || v_attr_table_html ||v_cl||v_cl||
 '</table>'||v_cl||v_cl||
 '<br><br><i>Best wishes'||v_cl||v_cl||
 '<br><br>Operation Support System Division'||v_cl||v_cl||
 '</i></p></span></table></body></html>' ;l_mesg := 'Date: '||TO_CHAR(sysdate,'dd Mon yy hh24:mi:ss')||V_CL||
'From: OSS < '||SENDER||'>'||V_CL||
'Subject: '||l_subject||V_CL||
'To: '|| l_rcpt ||v_cl||
'Cc: ' || l_cc_recipient || v_cl ||
--              'Bcc: ' || l_bcc_recipient || v_cl ||
'MIME-Version: 1.0'||V_CL||
'Content-type:text/html;charset=iso-8859-1'||V_CL||
''||v_cl||l_body ;utl_smtp.mail(mail_conn, SENDER) ;utl_smtp.rcpt(mail_conn, l_rcpt) ;utl_smtp.rcpt(mail_conn, l_cc_recipient);
--          utl_smtp.rcpt(mail_conn, l_bcc_recipient);
utl_smtp.data(mail_conn, l_mesg) ;utl_smtp.quit(mail_conn) ;
EXCEPTION
WHEN utl_smtp.transient_error OR utl_smtp.permanent_error THEN
p_ret_msg := 'SMTP Transient or permanent error'; WHEN OTHERS THEN
p_ret_msg := ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END DIDO_PROVISION_DETAIL_EMAIL;


-- 10-02-2012 Samankula Owitipan

-- 01-03-2012 jayan Liyanage

PROCEDURE SIP_TRUNK_MODIFY_NUM_SO (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_customer_type      VARCHAR2 (100);
   v_service_order      VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);
   v_number_leval_chg   VARCHAR2 (100);
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT cu.cusr_cutp_type
              INTO v_customer_type
              FROM service_orders so, customer cu
             WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation
               AND so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_number_leval_chg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'NUMBER LEVEL CHANGE';

   -- Modify Price Plan  2012 03 01
   IF     v_service_type = 'D-SIP TRUNK'
      AND v_service_order = 'MODIFY-NUMBER'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND (   v_number_leval_chg = 'INCREASE'
           OR v_number_leval_chg = 'DECREASE'
           OR v_number_leval_chg = 'CHANGE'
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UPDATE CUSTOMER';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-NUMBER'
         AND v_customer_type = 'CORPORATE-SME'
         AND (   v_number_leval_chg = 'INCREASE'
              OR v_number_leval_chg = 'DECREASE'
              OR v_number_leval_chg = 'CHANGE'
             )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UPDATE CUSTOMER';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-NUMBER'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND (   v_number_leval_chg = 'INCREASE'
              OR v_number_leval_chg = 'DECREASE'
              OR v_number_leval_chg = 'CHANGE'
             )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UPDATE CUSTOMER';
   ELSIF     v_service_type = 'D-SIP TRUNK'
         AND v_service_order = 'MODIFY-NUMBER'
         AND v_customer_type = 'REGIONAL-SME'
         AND (   v_number_leval_chg = 'INCREASE'
              OR v_number_leval_chg = 'DECREASE'
              OR v_number_leval_chg = 'CHANGE'
             )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UPDATE CUSTOMER';
   END IF;

   -- End Modify Price Plan 2012 03 01
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIP_TRUNK_MODIFY_NUM_SO;

-- 01-03-2012 jayan Liyanage


--- 2012-02-02 Jayan Liyanage  

PROCEDURE SIM_CALL_FWD_WO_CHANGE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR cust_type_cur
   IS
      SELECT cu.cusr_cutp_type
        FROM service_orders so, customer cu
       WHERE so.sero_cusr_abbreviation = cu.cusr_abbreviation
         AND so.sero_id = p_sero_id;

   CURSOR so_type
   IS
      SELECT DISTINCT so.sero_ordt_type
                 FROM service_orders so
                WHERE so.sero_id = p_sero_id;

   v_customer_type   VARCHAR2 (100);
   v_order_type      VARCHAR2 (100);
   v_service_order   VARCHAR2 (100);
   v_total_free      VARCHAR2 (100);
   v_pre_total_free  VARCHAR2 (100);
BEGIN
   OPEN cust_type_cur;

   FETCH cust_type_cur
    INTO v_customer_type;

   CLOSE cust_type_cur;

   OPEN so_type;

   FETCH so_type
    INTO v_order_type;

   CLOSE so_type;

   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_total_free, v_pre_total_free
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'TOLL FREE ?';

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'DELETE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'DELETE'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'DELETE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'DELETE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'SUSPEND'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'SUSPEND'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'SUSPEND'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'SUSPEND'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'RESUME'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'RESUME'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'RESUME'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'RESUME'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'MODIFY-SERVICE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'MODIFY-SERVICE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'CREATE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM LOCAL NUMBER';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM LOCAL NUMBER';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM LOCAL NUMBER';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM LOCAL NUMBER';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'CREATE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE INVOICE';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE INVOICE';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE INVOICE';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ISSUE INVOICE';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'CREATE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND v_total_free = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-SME'
         AND v_total_free = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'CREATE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND v_total_free = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'CREATE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'MODIFY-SERVICE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-SME'
         AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'MODIFY-SERVICE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   END IF;

   IF     v_service_order = 'SIM-CALL-FWD'
      AND v_order_type = 'MODIFY-SERVICE'
      AND v_customer_type LIKE 'CORPORATE-LARGE%VERY LARGE'
      AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-CORP-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-SME'
         AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SME-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF     v_service_order = 'SIM-CALL-FWD'
         AND v_order_type = 'MODIFY-SERVICE'
         AND v_customer_type = 'CORPORATE-WHOLESALE'
         AND v_total_free <> v_pre_total_free
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-WSALE-ACCT'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   ELSIF v_service_order = 'SIM-CALL-FWD' AND v_order_type = 'MODIFY-SERVICE'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM TOLL FREE CR';
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to change WG. Please check customer type :'
         || v_customer_type
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END SIM_CALL_FWD_WO_CHANGE;
--- 2012-02-02 Jayan Liyanage

-- 31-05-2012 Samankula Owitipana

PROCEDURE MS_VIDEO_SET_PRODUCT_LABLE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

        
v_vcon_id varchar2(50);   
cursor c_so_vcon_id is    
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VCON ID';
BEGIN
open c_so_vcon_id;
fetch c_so_vcon_id into v_vcon_id;
close c_so_vcon_id;
IF v_vcon_id is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_vcon_id
WHERE SA.SEOA_NAME = 'PRODUCT_LABLE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Blank ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END MS_VIDEO_SET_PRODUCT_LABLE;

-- 31-05-2012 Samankula Owitipana

-- 24-05-2012 Samankula Owitipana
PROCEDURE MS_VIDEO_SET_VCON_ID (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

        
v_vcon_id varchar2(50);   
cursor c_so_vcon_id is    
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER ID';
BEGIN
open c_so_vcon_id;
fetch c_so_vcon_id into v_vcon_id;
close c_so_vcon_id;
IF v_vcon_id is not null THEN
UPDATE service_orders so
set so.SERO_SERV_DISPLAYNAME = v_vcon_id
where so.SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to Blank ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END MS_VIDEO_SET_VCON_ID;

-- 24-05-2012 Samankula Owitipana


-- 23-05-2012 jayan Liyanage 

PROCEDURE MS_VIDEO_MET (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_service_type    VARCHAR2 (100);
   v_section_hndle   VARCHAR2 (100);
   v_oredr_type      VARCHAR2 (100);
   v_lice_mode       VARCHAR2 (100);
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_oredr_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_section_hndle
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'SECTION HANDLED BY';

   SELECT soa.seoa_defaultvalue
     INTO v_lice_mode
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'LICENSE MODE';

   IF     v_oredr_type = 'CREATE'
      AND v_service_type = 'MS-VIDEO MEET'
      AND (   v_section_hndle LIKE 'SALES-ENT-%'
           OR v_section_hndle LIKE 'SALES-WSALE-%'
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_oredr_type = 'CREATE'
         AND v_service_type = 'MS-VIDEO MEET'
         AND v_section_hndle LIKE 'SALES-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_oredr_type = 'CREATE' AND v_service_type = 'MS-VIDEO MEET'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_oredr_type = 'MODIFY-SERVICE'
      AND v_service_type = 'MS-VIDEO MEET'
      AND (   v_section_hndle LIKE 'SALES-ENT-%'
           OR v_section_hndle LIKE 'SALES-WSALE-%'
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_oredr_type = 'MODIFY-SERVICE'
         AND v_service_type = 'MS-VIDEO MEET'
         AND v_section_hndle LIKE 'SALES-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_oredr_type = 'MODIFY-SERVICE' AND v_service_type = 'MS-VIDEO MEET'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF v_oredr_type = 'MODIFY-SERVICE' AND v_service_type = 'MS-VIDEO MEET'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF v_oredr_type = 'MODIFY-SERVICE' AND v_service_type = 'MS-VIDEO MEET'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   END IF;

   IF v_lice_mode <> 'Monthly' AND v_service_type = 'MS-VIDEO MEET' and v_oredr_type = 'DELETE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     (v_oredr_type = 'DELETE' or v_oredr_type = 'SUSPEND' or v_oredr_type = 'RESUME')
         AND v_service_type = 'MS-VIDEO MEET'
         AND v_lice_mode = 'Monthly'
         AND (   v_section_hndle LIKE 'SALES-ENT-%'
              OR v_section_hndle LIKE 'SALES-WSALE-%'
             )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF   (v_oredr_type = 'DELETE' or v_oredr_type = 'SUSPEND' or v_oredr_type = 'RESUME')
         AND v_service_type = 'MS-VIDEO MEET'
         AND v_lice_mode = 'Monthly'
         AND v_section_hndle LIKE 'SALES-SME'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF v_oredr_type = 'DELETE' AND v_service_type = 'MS-VIDEO MEET'
   THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG in I_MYWEB Process function. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END MS_VIDEO_MET;

-- 23-05-2012 jayan Liyanage 


-- 16-02-2012 Jayan Liyanage 

PROCEDURE VIDEO_CONFE_EN_DATE_MAPPING (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_lic_mode             VARCHAR2 (100);
   v_lic_strt_date        VARCHAR2 (100);
   v_addi_lic_mode        VARCHAR2 (100);
   v_addi_lic_strt_date   VARCHAR2 (100);
   v_order_type              VARCHAR2 (100);
   
   v_lic_end_date         VARCHAR2 (100);
   v_new_end_date         VARCHAR2 (100);
   new_lice_strt         VARCHAR2 (100);
   v_addi_lic_end_date         VARCHAR2 (100);
   v_addi_new_end_date         VARCHAR2 (100);
   new_addi_lice_strt         VARCHAR2 (100);
   v_dat_chk                  number;
   v_dat_chk2                  number;

   CURSOR cur_license_mode
   IS
      SELECT soa.seoa_defaultvalue
        FROM service_order_attributes soa
       WHERE soa.seoa_name = 'LICENSE MODE' AND soa.seoa_sero_id = p_sero_id;

   CURSOR cur_license_strt_date
   IS
      SELECT soa.seoa_defaultvalue
        FROM service_order_attributes soa
       WHERE soa.seoa_name = 'LICENSE START DATE'
         AND soa.seoa_sero_id = p_sero_id;
         
   CURSOR cur_addi_license_mode
   IS
      SELECT soa.seoa_defaultvalue
        FROM service_order_attributes soa
       WHERE soa.seoa_name = 'ADDITIONAL LICENSE MODE' AND soa.seoa_sero_id = p_sero_id;

   CURSOR cur_addi_license_strt_date
   IS
      SELECT soa.seoa_defaultvalue
        FROM service_order_attributes soa
       WHERE soa.seoa_name = 'ADDITIONAL LICENSE START DATE'
         AND soa.seoa_sero_id = p_sero_id;
                  
BEGIN
   OPEN cur_license_mode;
   FETCH cur_license_mode
    INTO v_lic_mode;
   CLOSE cur_license_mode;

   OPEN cur_license_strt_date;
   FETCH cur_license_strt_date
    INTO v_lic_strt_date;
   CLOSE cur_license_strt_date;
   
   OPEN cur_addi_license_mode;
   FETCH cur_addi_license_mode
    INTO v_addi_lic_mode;
   CLOSE cur_addi_license_mode;

   OPEN cur_addi_license_strt_date;
   FETCH cur_addi_license_strt_date
    INTO v_addi_lic_strt_date;
   CLOSE cur_addi_license_strt_date;   
   
  select so.SERO_ORDT_TYPE 
  into v_order_type
  from service_orders so
  where so.SERO_ID = p_sero_id;
   
   
   v_dat_chk := instr(v_lic_strt_date,'-');
   v_dat_chk2 := instr(v_addi_lic_strt_date,'-');
   

   IF v_lic_mode = 'One week' and v_dat_chk = 0
   THEN
      SELECT to_char(to_date(v_lic_strt_date,'yyyy/mm/dd')+7,'DD-MON-YYYY') end_date
        INTO v_new_end_date
        FROM DUAL;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_new_end_date
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE END DATE';
         
      new_lice_strt := to_char(to_date(v_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE START DATE';     
             
   END IF;
   
   
------------additional   
   IF v_addi_lic_mode = 'One week' and v_dat_chk2 = 0
   THEN
      SELECT to_char(to_date(v_addi_lic_strt_date,'yyyy/mm/dd')+7,'DD-MON-YYYY') end_date
        INTO v_addi_new_end_date
        FROM DUAL;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_addi_new_end_date
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE END DATE';
         
      new_addi_lice_strt := to_char(to_date(v_addi_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_addi_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE START DATE';     
             
   END IF;   
   
   
   
      IF v_lic_mode = 'One day' and v_dat_chk = 0
   THEN
      SELECT to_char(to_date(v_lic_strt_date,'yyyy/mm/dd')+1,'DD-MON-YYYY') end_date
        INTO v_new_end_date
        FROM DUAL;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_new_end_date
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE END DATE';
         
      new_lice_strt := to_char(to_date(v_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE START DATE';     
             
   END IF;
----------additional
      IF v_addi_lic_mode = 'One day' and v_dat_chk2 = 0
   THEN
      SELECT to_char(to_date(v_addi_lic_strt_date,'yyyy/mm/dd')+1,'DD-MON-YYYY') end_date
        INTO v_addi_new_end_date
        FROM DUAL;

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_addi_new_end_date
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE END DATE';
         
      new_addi_lice_strt := to_char(to_date(v_addi_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_addi_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE START DATE';     
             
   END IF;   
   
   
   
   IF v_lic_mode = 'Monthly' and v_dat_chk = 0
   THEN
      

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue =''
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE END DATE';
         
      new_lice_strt := to_char(to_date(v_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'LICENSE START DATE';     
             
   END IF;
 ------ additional
    IF v_addi_lic_mode = 'Monthly' and v_dat_chk2 = 0
   THEN
      

      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue =''
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE END DATE';
         
      new_addi_lice_strt := to_char(to_date(v_addi_lic_strt_date,'yyyy/mm/dd'),'DD-MON-YYYY');
  
       UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = new_addi_lice_strt
       WHERE soa.seoa_sero_id = p_sero_id
         AND soa.seoa_name = 'ADDITIONAL LICENSE START DATE';     
             
   END IF;  
  
   

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change WG. Please check the Attributes:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END VIDEO_CONFE_EN_DATE_MAPPING;

-- 16-02-2012 Jayan Liyanage 
   

-- 26-03-2012 Samankula Owitipana--- Update Dinesh 23-04-2013----

PROCEDURE MS_DSP_SET_NULL (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      
v_service_cat varchar2(50);    
v_dsp_date      varchar2(50);  
cursor c_so_service_cat is      
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
BEGIN
open c_so_service_cat;
fetch c_so_service_cat into v_service_cat;
close c_so_service_cat;
IF v_service_cat = 'TEST' THEN
SELECT upper(soa.seoa_defaultvalue) 
INTO v_dsp_date
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACTUAL_DSP_DATE';
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_date
WHERE SA.SEOA_NAME = 'TEST_SERVICE_DSP'
AND SA.SEOA_SERO_ID = p_sero_id;
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = null
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;p_ret_msg := '';

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    
EXCEPTION
WHEN OTHERS THEN
      p_ret_msg  := 'Failed to Blank ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
END MS_DSP_SET_NULL;

-- 26-03-2012 Samankula Owitipana --- Update Dinesh 23-04-2013----

-- 25-05-2012 Samankula Owitipana

PROCEDURE slt_ms_resu_feature_mapping (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2)
IS
CURSOR max_sus_so IS
SELECT so.sero_id
FROM service_orders so
WHERE so.sero_sert_abbreviation = 'MS-BIZAPP'
AND so.sero_stas_abbreviation = 'CLOSED'
AND so.sero_ordt_type LIKE 'SUSP%'
AND so.sero_serv_id = p_serv_id
AND so.sero_statusdate IN (
SELECT MAX (s.sero_statusdate)
FROM service_orders s
WHERE s.sero_sert_abbreviation = 'MS-BIZAPP'
AND s.sero_stas_abbreviation = 'CLOSED'
AND s.sero_ordt_type LIKE 'SUSP%'
AND s.sero_serv_id = p_serv_id);

v_max_sus_so_id   VARCHAR2 (100);
BEGIN
OPEN max_sus_so;
FETCH max_sus_so INTO v_max_sus_so_id;
CLOSE max_sus_so;
DECLARE
CURSOR cur_service_feat IS
SELECT soa.sofe_feature_name, soa.sofe_prev_value
FROM service_order_features soa
WHERE soa.sofe_sero_id = v_max_sus_so_id;

v_pre_so_feat_name   VARCHAR2 (100);
v_pre_so_value       VARCHAR2 (100);
BEGIN OPEN cur_service_feat;

LOOP
FETCH cur_service_feat
INTO v_pre_so_feat_name, v_pre_so_value;
EXIT WHEN cur_service_feat%NOTFOUND;

UPDATE service_order_features sof
SET sof.sofe_defaultvalue = v_pre_so_value
WHERE sof.sofe_feature_name = v_pre_so_feat_name
AND sof.sofe_sero_id = p_sero_id;
END LOOP;
CLOSE cur_service_feat;
END;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Suspend Feature Mapping Failed.'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   'Suspend Feature Mapping Failed.' || v_max_sus_so_id
                  );
END slt_ms_resu_feature_mapping;

-- 31-05-2012 Samankula Owitipana


-- 08-06-2012 Samankula Owitipana

PROCEDURE MS_BIZAPP_SET_CCT_ID (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      
v_cct_id varchar2(50);      
cursor c_so_cct_id is      
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CIRCUIT ID';
BEGIN
open c_so_cct_id;
fetch c_so_cct_id into v_cct_id;
close c_so_cct_id;
IF v_cct_id is not null THEN
UPDATE service_orders so
set so.SERO_SERV_DISPLAYNAME = v_cct_id
where so.SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set bizapp display name. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END MS_BIZAPP_SET_CCT_ID;

-- 08-06-2012 Samankula Owitipana


-- 08-06-2012 Samankula Owitipana

PROCEDURE  MS_BIZAPP_WGCH_FUNCTION (
      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                                     IN     Service_Orders.sero_id%TYPE,
      p_seit_id                                       IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                     IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                                    IN     work_order.woro_id%TYPE,
      p_ret_char                                   OUT    VARCHAR2,
      p_ret_number                            OUT    NUMBER,
      p_ret_msg                                    OUT    VARCHAR2) IS

v_sec_handel_by    VARCHAR2(100);
v_order_type       VARCHAR2(100);
v_rtom               VARCHAR2(100);
CURSOR c_seoa_cur IS
SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes
WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION HANDLED BY';
CURSOR c_rtom_area IS
select replace(ar.AREA_AREA_CODE,'R-','')
from service_orders so,areas ar
where so.SERO_AREA_CODE = ar.AREA_CODE
and so.SERO_ID = p_sero_id;
BEGIN
p_ret_char := '';
OPEN c_seoa_cur;
FETCH c_seoa_cur INTO v_sec_handel_by;
CLOSE c_seoa_cur;
OPEN c_rtom_area;
FETCH c_rtom_area INTO v_rtom;
CLOSE c_rtom_area;
select so.SERO_ORDT_TYPE
into v_order_type 
from service_orders so
where so.SERO_ID = p_sero_id;
IF p_impt_taskname = 'APPROVE SO' 
and (v_order_type = 'CREATE' or v_order_type = 'MODIFY-SERVICE') THEN
IF v_sec_handel_by like 'SALES-SME%' THEN
p_ret_char := v_rtom || '-RTOM';
ELSIF v_sec_handel_by like 'SALES-ENT-%' THEN
p_ret_char := 'SALES-SIU-MGR';END IF;
ELSIF p_impt_taskname = 'APPROVE SO' 
and (v_order_type = 'DELETE' or v_order_type = 'SUSPEND'or v_order_type = 'RESUME') THEN
IF v_sec_handel_by like 'SALES-SME%' THEN
p_ret_char := v_sec_handel_by || '-PSM';
ELSIF v_sec_handel_by like 'SALES-ENT-%' THEN
p_ret_char := v_sec_handel_by || '-MGR';END IF;
ELSIF p_impt_taskname = 'CONFIRM TEST SERVICE' 
and (v_order_type = 'CREATE') THEN
p_ret_char := v_sec_handel_by || '-ACCM';
END IF;p_ret_msg := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END MS_BIZAPP_WGCH_FUNCTION;

-- 18-05-2012 Samankula Owitipana


-- Samankula Owitipana 2012/04/30 


PROCEDURE M3VPN_WG_CHANGE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);
v_ORDER_TYPE        VARCHAR2(100);


BEGIN

select so.SERO_ORDT_TYPE INTO v_ORDER_TYPE
from service_orders so
where so.SERO_ID = p_sero_id;

select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION HANDLED BY'
AND SEOA_SERO_ID = p_sero_id;




         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-FO'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'ISSUE INVOICE' ;
         
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-ACCM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'HAND OVER TOKEN' ;
         

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-FO'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY PRICE PLAN' ;
         

          IF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%'  THEN



         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'VERIFY PRICING' ;
         
         ELSE
         
         DELETE service_implementation_tasks sit
         WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'VERIFY PRICING';
         
         
         END IF;
         
         
         IF  v_ORDER_TYPE = 'CREATE' or v_ORDER_TYPE = 'MODIFY-OTHERS' THEN
          
               IF (v_SECTION_HANDLE_WG LIKE 'SALES-ENT-%') OR (v_SECTION_HANDLE_WG  LIKE 'SALES-WSALE-%' ) THEN
        

              UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
              SET sit.SEIT_WORG_NAME = 'SALES-SIU-MGR'
              WHERE SIT.SEIT_SERO_ID =  p_sero_id
              AND SIT.SEIT_TASKNAME = 'APPROVE SO';
             
             END IF;
             
         ELSE
         
              IF (v_SECTION_HANDLE_WG LIKE 'SALES-ENT-%') OR (v_SECTION_HANDLE_WG  LIKE 'SALES-WSALE-%' ) THEN
        

              UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
              SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG || '-MGR'
              WHERE SIT.SEIT_SERO_ID =  p_sero_id
              AND SIT.SEIT_TASKNAME = 'APPROVE SO';
             
             ELSIF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%'  THEN
             
             UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
              SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG || '-PSM'
              WHERE SIT.SEIT_SERO_ID =  p_sero_id
              AND SIT.SEIT_TASKNAME = 'APPROVE SO';
             
             
             END IF;         
         
         

          END IF;
         
         
 
 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
 
 

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change workgroups. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END M3VPN_WG_CHANGE;


-- Samankula Owitipana 2012/04/30 

-- 30-04-2012 Samankula Owitipana(Modified on 7-8-2013)

PROCEDURE M3VPN_SET_SERVICE_IDENTIFIER (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_mobile_no varchar2(100);
BEGIN
SELECT soa.seoa_defaultvalue
INTO v_mobile_no FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'MOBILE NUMBER';
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = 'M' || v_mobile_no || '@m3vpn.lk'
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'DATA CIRCUIT ID';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed to set DATA CIRCUIT ID attribute. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        ,p_ret_msg );    
END M3VPN_SET_SERVICE_IDENTIFIER;

-- 30-04-2012 Samankula Owitipana


-- 11-05-2012 Samankula Owitipana

PROCEDURE M3VPN_NEW_TOKEN_ATTR_NULL (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS





BEGIN



         UPDATE service_order_attributes soa
         SET SOA.SEOA_DEFAULTVALUE = NULL
         WHERE soa.SEOA_SERO_ID = p_sero_id
         AND soa.SEOA_NAME = 'ISSUE NEW TOKEN?' ;



    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    
    

EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'Failed to Update attribute:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );


 END M3VPN_NEW_TOKEN_ATTR_NULL;

-- 11-05-2012 Samankula Owitipana


-- Samankula Owitipana 2012/05/14 


PROCEDURE M3VPN_HAND_OVER_TOKEN(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);


BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION HANDLED BY'
AND SEOA_SERO_ID = p_sero_id;



         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-ACCM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'HAND OVER TOKEN' ;
         
         
 
 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
 
 

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change workgroups. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END M3VPN_HAND_OVER_TOKEN;


-- Samankula Owitipana 2012/05/14



-- Samankula Owitipana 2012/05/16 
-- Task Condition function

PROCEDURE M3VPN_TASK_CON_FUNCTION(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);
v_ORDER_TYPE        VARCHAR2(100);


BEGIN

select so.SERO_ORDT_TYPE INTO v_ORDER_TYPE
from service_orders so
where so.SERO_ID = p_sero_id;
select soa.SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES soa
where soa.SEOA_NAME='SECTION HANDLED BY'
and soa.SEOA_SERO_ID = p_sero_id;
IF p_impt_taskname = 'VERIFY PRICING' THEN     
IF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%' THEN
p_ret_msg := '';
ELSE
p_ret_msg := 'FALSE';
END IF;         
END IF;         
EXCEPTION
WHEN NO_DATA_FOUND THEN
   p_ret_msg := 'FALSE';
   
WHEN OTHERS THEN
   p_ret_msg := '';
  

END M3VPN_TASK_CON_FUNCTION;

-- Samankula Owitipana 2012/05/16


--- Jayan Liyanage 2012/03/12

PROCEDURE D_ETHERNET_VPN_CREATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )
IS v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_eng_net              VARCHAR2 (100);
v_cpe_class            VARCHAR2 (100);
v_cur_cpe_model        VARCHAR2 (100);
v_pre_cpe_model        VARCHAR2 (100);
v_fib_avalable         VARCHAR2 (100);

BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,
ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT wg.worg_name INTO v_eng_net FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue INTO v_cpe_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';   
select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_cur_cpe_model,v_pre_cpe_model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';   
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';ELSE       
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';       END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE INVOICE';       
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE INVOICE';END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'AND (   (v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle LIKE 'SALES-WSALE-%'))
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'
AND v_section_hndle LIKE 'SALES-SME-%'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
-------------------------------------------------------------------------------------

/*   IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_acc_bear_status = 'INSERVICE' AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_acc_bear_status = 'INSERVICE' AND ((v_core_network = 'MEN') OR (v_core_network = 'MPLS'))
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;
*/

---------------------------------------------------------------------------------------------------
   
/*IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_core_network = 'MEN' AND v_acc_nw <> 'MEN PORT' THEN 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF (v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' 
AND v_core_network = 'CEN' AND v_acc_nw <> 'CEN PORT') OR (v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' 
AND v_core_network = 'MPLS' AND v_acc_nw <> 'MPLS PORT')THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' THEN
DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
END IF;*/

IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE' AND v_acc_medium = 'P2P RADIO'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT'; END IF;

   
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class = 'SLT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
ELSIF  v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_acc_nw <>'MSAN PORT' OR v_acc_nw <> 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class = 'SLT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_eng_net
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
END IF;
/*IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
END IF; *//*IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
END IF; */ IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_ser_ctg = 'TEST' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-ACCM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' THEN
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' THEN
 DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_acc_nw = 'MEN PORT' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT'; ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT'; END IF; 
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
END IF;  IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_acc_medium = 'P2P RADIO' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'INSERVICE' THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'INSERVICE' THEN 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
END IF;

-- Jayan Liyanage Modified 2014/10/24
 
/*IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED'
THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COMM. FIBER LINK'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK';*/

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED' AND 
( v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')
THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER';

-- Jayan Liyanage Modified End 2014/10/24

END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND  v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_eng_net
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INTEGRATE AGG NW'; END IF; 
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND  (v_acc_nw = 'MSAN PORT' or v_acc_nw = 'DSLAM PORT') AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND  (v_acc_nw = 'MSAN PORT' or v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_ntu_class = 'SLT' AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_cpe_class = 'SLT'
AND v_cur_cpe_model <> v_pre_cpe_model AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_cpe_class = 'SLT' AND v_cur_cpe_model <> v_pre_cpe_model 
AND v_acc_bear_status = 'INSERVICE' THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';END IF;
IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_cpe_class = 'SLT' AND v_acc_bear_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE';END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_ETHERNET_VPN_CREATE;
--- Jayan Liyanage 2012/03/12

--- Jayan Liyanage 2012/03/20 --- Modify 12/02/2013-----21/08/2015---CREATE-TRANSFER migration type copyig removed on 17/12/2015

PROCEDURE D_ETHERNET_VPN_CP_BEARER_ATTR (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS BEARER ID'AND so.sero_id = p_sero_id;
CURSOR so_copyattr (v_new_bearer_id VARCHAR)IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')AND so.sero_stas_abbreviation <> 'CANCELLED'
AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED'
AND ci.cirt_displayname = v_new_bearer_id);

v_so_attr_name     VARCHAR2 (100);
v_so_attr_val      VARCHAR2 (100);
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100);
v_new_bearer_id    VARCHAR2 (100);
v_service_type     VARCHAR2 (100);
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);

BEGIN
OPEN bearer;FETCH bearer INTO v_bearer_id;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);LOOP FETCH so_copyattr
INTO v_so_attr_name, v_so_attr_val, v_cir_status; EXIT WHEN so_copyattr%NOTFOUND;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';ELSIF     v_service_type = 'D-ETHERNET VPN' AND 
v_service_order = 'CREATE'AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'CPE MODEL'THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'AND v_so_attr_name = 'NTU MODEL'THEN UPDATE service_order_attributes soa SET 
soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'NTU CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU CLASS';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU TYPE'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'AND v_so_attr_name = 'NTU ROUTING MODE'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'ACCESS MEDIUM'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN UPDATE service_order_attributes soa SET 
soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'ACCESS INTF PORT BW'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND
 v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
-- Modified 2014 / 11 / 21 
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';-- End 
END IF;


IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS N/W INTF';ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'SECTION_HANDLED_BY'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';ELSIF v_service_type = 'D-ETHERNET VPN' 
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';ELSIF v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NO OF COPPER PAIRS';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ACCESS INTF PORT BW'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL CHANGE?' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL CHANGE?' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL CHANGE?'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'OLD CIRCUIT ID' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'OLD CIRCUIT ID'; 
/*ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'MIGRATION TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
*/
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CHANGE?' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CUSTOMER INTF TYPE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ACCESS N/W INTF' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'CPE CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'CPE MODEL'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU TYPE'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';ELSIF     v_service_type = 'D-ETHERNET VPN' 
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'NTU ROUTING MODE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';-- END IF; 

ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
-- Modified 2014 / 11 / 21
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';-- End 
END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'AND v_so_attr_name = 'SECTION_HANDLED_BY'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'DATA RADIO MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';--END IF;

ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ACCESS N/W INTF' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU CLASS'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ACCESS MEDIUM'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';ELSIF v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'BACKBONE CORE NO'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' 
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS N/W INTF'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'SECTION_HANDLED_BY'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE CLASS'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS NODE CHANGE?' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
-- Modified 2014 / 11 / 21
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';-- End 
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'CUSTOMER INTF TYPE' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'BACKBONE CORE NO'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE';
 ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-CPE'AND v_so_attr_name = 'ACCESS N/W INTF'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'CPE CLASS'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';        
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';     
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE';            
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';        
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';END IF; END LOOP; 
IF v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'CREATE'  AND  (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE') THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id; END IF;  IF v_service_type = 'D-ETHERNET VPN' 
AND v_service_order = 'CREATE-TRANSFER' AND  (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE') THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id;END IF; IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND  (v_cir_status = 'COMMISSIONED' 
OR v_cir_status = 'INSERVICE') THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id; END IF;IF v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-SPEED' AND  (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id;
END IF;  IF v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-LOCATION' AND  (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'AND soa.seoa_sero_id = p_sero_id;END IF;
/*IF v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-EQUIPMENT' AND  v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'AND soa.seoa_sero_id = p_sero_id; END IF;*/

CLOSE so_copyattr;CLOSE bearer;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'COMPLETED' );EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_ETHERNET_VPN_CP_BEARER_ATTR;

--- Jayan Liyanage 2012/03/20  --- Modify 12/02/2013----- 21/08/2015



-- Jayan Liyanage 2012/03/12  ---Modify 12/02/2013--- 14//10/2015

PROCEDURE D_ETHERNET_VPN_BEAR_AT_MAP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS 

CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue
FROM service_orders so, service_order_attributes soa WHERE so.sero_id = soa.seoa_sero_id
AND soa.seoa_name = 'ACCESS BEARER ID' AND so.sero_id = p_sero_id;CURSOR so_copyattr (v_new_bearer_id VARCHAR)
IS SELECT DISTINCT soa.seoa_sero_id, c.cirt_status, c.cirt_serv_id
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE'
) AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN ( SELECT MAX (s.sero_id) FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED' AND ci.cirt_displayname like replace(v_new_bearer_id,'(N)')||'%');
CURSOR so_att_mapping IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue
FROM service_orders so, service_order_attributes soa
WHERE so.sero_id = soa.seoa_sero_id AND so.sero_id = p_sero_id;

v_cir_status      VARCHAR2 (100);
v_bearer_so_id    VARCHAR2 (100);
v_so_attr_name    VARCHAR2 (100);
v_so_att_val      VARCHAR2 (100);
v_new_bearer_id   VARCHAR2 (100);
v_bearer_id       VARCHAR2 (100);
v_service_type    VARCHAR2 (100);
v_service_order   VARCHAR2 (100);
v_new_service     VARCHAR2 (100);
v_cir_id          VARCHAR2 (100);
v_acc_bear_status VARCHAR2 (100);


BEGIN OPEN bearer; FETCH bearer INTO v_bearer_id; SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; SELECT DISTINCT so.sero_ordt_type
INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';

OPEN so_copyattr (v_bearer_id); FETCH so_copyattr INTO v_bearer_so_id, v_cir_status, v_cir_id; CLOSE bearer;
OPEN so_att_mapping;LOOP FETCH so_att_mapping INTO v_so_attr_name, v_so_att_val; EXIT WHEN so_att_mapping%NOTFOUND;
      
IF v_cir_status  = 'COMMISSIONED' THEN IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE SERIAL NUMBER';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ACCESS LINK DISTANCE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE' AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE' )
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id; END IF; END IF;

IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'NTU TYPE'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE MODEL'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER';IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CHANGE?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE CHANGE?'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';  ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER';
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-TRANSFER'AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'AND soa.seoa_sero_id = p_sero_id;
END IF; END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU MODEL';ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL' THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER';END IF;

IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU S/N'; END IF;
IF v_acc_bear_status = 'TO BE MODIFIED' THEN 
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU S/N';
END IF; END IF;/*
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = 'INSERVICE'
 WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;*/

ELSIF   v_cir_status  = 'INSERVICE' THEN
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU TYPE'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE'
AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU TYPE'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR'
AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU TYPE'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER'AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU MODEL'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
 AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'AND sa.satt_serv_id = v_cir_id;END IF;

IF v_acc_bear_status = 'TO BE MODIFIED' THEN 
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N' AND sa.satt_serv_id = v_cir_id;END IF;
END IF;
/*IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-EQUIPMENT'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = 'INSERVICE'
 WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;*/

END IF;
END LOOP;

CLOSE so_att_mapping;

CLOSE so_copyattr;

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_BEAR_AT_MAP;

--- Jayan Liyanage 2012/03/12  ---Modify 12/02/2013 --- 14//10/2015

--- Jayan Liyanage 2012/03/12

PROCEDURE D_ETHERNET_VPN_CREATE_TRSF (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_mig_type             VARCHAR2 (100);
v_ntu_model_chg        VARCHAR2 (100);
v_cpes_class           VARCHAR2 (100);
v_model_chg            VARCHAR2 (100);

BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,ar.area_code INTO v_rtom_code,v_lea_code
FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_cpes_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue INTO v_mig_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
SELECT soa.seoa_defaultvalue INTO v_ntu_model_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';
SELECT soa.seoa_defaultvalue INTO v_model_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?';

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')) THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';       
END IF;

/*IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT') 
OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT')) THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;*/

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'LEGACY TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'NGN TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF;      
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGGREGATE LINK'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGGREGATE LINK'; END IF;


IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'NGN TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; ELSE DELETE  service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; END IF;  


IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIRM MIGRATION'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIRM MIGRATION'; END IF;

/*IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF;*/

/*IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;*/

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; ELSE        
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF;
IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE DEL-TRNSFER SO';
END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'NO'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'NO'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; END IF;  
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'YES' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL  NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL  NTU'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_model_chg = 'YES'
AND v_cpes_class = 'SLT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE'; ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE'; END IF; 
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_model_chg = 'NO' AND v_cpes_class = 'SLT'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'NGN TO NGN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; END IF;    
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'NGN TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY-NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY-NTU'; END IF;  
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_CREATE_TRSF;

--- Jayan Liyanage 2012/03/12

-- Jayan Liyanage 2012/04/02

PROCEDURE D_ETHERNET_X_CONNE_WG_CHG (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS  v_equip_type              VARCHAR2 (100);
v_eq_loc_name             VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_work_group_mdf          VARCHAR2 (100);
v_location                VARCHAR2 (100);
v_main_node               VARCHAR2 (100);
v_sub_node                VARCHAR2 (100);
v_acc_nw                  VARCHAR2 (100);
v_acc_bearer_status       VARCHAR2 (100);
v_mig_type                VARCHAR2 (100);
v_access_bear_id          VARCHAR2 (100);
v_ch_dis                  VARCHAR2 (100);
v_cir_trib_status         VARCHAR2 (100);
v_cur_nof_copper          VARCHAR2 (100);
v_pre_nof_copper          VARCHAR2 (100);
v_access_node_chg         VARCHAR2 (100);
v_no_of_copper_pair_cur   VARCHAR2 (100);
v_no_of_copper_pair_pre   VARCHAR2 (100);
v_new_cir_id              VARCHAR2 (100);   
v_new_Cir_Name            VARCHAR2 (100);    
v_acc_nw_pre              VARCHAR2 (100);                

CURSOR cur_equi_type IS SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
FROM service_orders so, ports p, equipment e WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
OR e.equp_equt_abbreviation LIKE 'DSLAM%' OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id; CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 ) IS SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%' OR ci.cirt_status LIKE 'SUSPEND%'
OR ci.cirt_status LIKE 'COMMISS%' ) AND (   ci.cirt_status NOT LIKE 'CANCE%' OR ci.cirt_status NOT LIKE 'PENDING%' )
AND ci.CIRT_DISPLAYNAME <> v_new_cir_id AND c.cirt_displayname = parent_name; BEGIN OPEN cur_equi_type; FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;
CLOSE cur_equi_type;SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id; SELECT DISTINCT so.sero_area_code
INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT soa.seoa_defaultvalue,soa. Seoa_Prev_Value INTO v_acc_nw,v_acc_nw_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_mig_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
SELECT soa.seoa_defaultvalue INTO v_acc_bearer_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_nof_copper, v_pre_nof_copper FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NO OF COPPER PAIRS'; SELECT soa.seoa_defaultvalue INTO v_access_bear_id FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER ID';
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_access_node_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,
ar.area_code INTO v_rtom_code, v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA'; SELECT wg.worg_name
INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%'; SELECT wg.worg_name
INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%'; SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1)
AS node INTO v_location FROM DUAL; SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1))AS main_node, TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node,
v_sub_node FROM DUAL;OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status;CLOSE cur_tributer;
IF v_main_node IS NOT NULL THEN IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_main_node = v_sub_node
AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' AND v_main_node = v_sub_node
AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')AND v_acc_bearer_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' THEN DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_mig_type = 'LEGACY TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_main_node = v_sub_node AND(v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_mig_type = 'LEGACY TO NGN'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY MDF X CONNECT';ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' THEN
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_cur_nof_copper > v_pre_nof_copper THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_cur_nof_copper > v_pre_nof_copper THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE ADD. X CONNECTS';END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE'THEN
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE DSL LINE';ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR' THEN  DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE DSL LINE';
END IF; 

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_access_node_chg = 'YES'
AND (v_acc_nw_pre = 'DSLAM PORT' OR v_acc_nw_pre = 'MSAN PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE. OLD MDF X CONNEC'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw_pre = 'DSLAM PORT' OR v_acc_nw_pre = 'MSAN PORT') AND v_access_node_chg = 'YES' AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE. OLD MDF X CONNEC'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE. OLD MDF X CONNEC';
END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_access_node_chg = 'NO' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_main_node <> v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') 
AND v_access_node_chg = 'NO' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_main_node = v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-LOCATION'THEN  DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_access_node_chg = 'YES' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_main_node <> v_sub_node
AND v_acc_bearer_status = 'COMMISSIONED' THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_access_node_chg = 'YES' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_main_node = v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' THEN DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;END IF;

IF v_main_node IS NULL THEN IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-OR' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'CREATE-OR'THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';END IF;IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'CREATE-TRANSFER' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND v_cur_nof_copper > v_pre_nof_copper THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE ADD. X CONNECTS';END IF;

IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')AND v_access_node_chg = 'YES'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RE. OLD MDF X CONNEC'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RE. OLD MDF X CONNEC'; END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
END IF; IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_access_node_chg = 'NO'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND v_access_node_chg = 'YES'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-LOCATION' THEN
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;END IF;

IF v_main_node IS NULL THEN IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REM. ADD. X CONNECTS';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REM. ADD. X CONNECTS';END IF;
ELSif v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' then  DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REM. ADD. X CONNECTS';END IF;IF v_main_node IS NOT NULL THEN IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' 
AND v_main_node <> v_sub_node AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. DSL LINE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%') AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. DSL LINE';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE ADD. DSL LINE'; END IF; ELSif     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' then DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. DSL LINE';END IF; IF v_main_node IS NULL  then IF   v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE OSP LINE'; ELsif v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR' then
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE OSP LINE'; END IF; elsif v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR' then
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE OSP LINE';end if ;IF v_main_node IS NULL  then IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR' AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%') AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');EXCEPTION WHEN OTHERS THEN
p_ret_msg :='Failed to Workgroup Mapping Please check the Cross Connection Equip Type  :  - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,0, p_seit_id, 'ERROR');INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);


END D_ETHERNET_X_CONNE_WG_CHG;

-- Jayan Liyanage 2012/04/02



--- 13-08-2012  Samankula Owitipana
PROCEDURE D_ETHER_UPDAT_SERIALNO_NOTIFY(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
BEGIN
     p_ret_char := 'Update SERIAL NUMBER in NTU Network Element...!' ;                                      
EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_ETHER_UPDAT_SERIALNO_NOTIFY;
--- 13-08-2012  Samankula Owitipana


--- Jayan Liyanage 2012/04/05

PROCEDURE BEARER_DSP_DATE_UPDATE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_actual_dsp_date   VARCHAR2 (100);
   bearer_id           VARCHAR2 (100);
   v_service_od_id     VARCHAR2 (100);
   v_Cir_Status        VARCHAR2 (100);
   v_service_ord_type  VARCHAR2 (100);
   v_new_bearer_id     VARCHAR2 (100);
   v_new_service       VARCHAR2 (100);
/*
   CURSOR bearer_so (v_bearer_id VARCHAR)
   IS
      SELECT DISTINCT so.sero_id,C.CIRT_STATUS
                 FROM service_orders so, circuits c
                WHERE so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'PENDINGDELETE'
                       AND c.cirt_status <> 'CANCELLED'
                      )
                  AND (     so.sero_stas_abbreviation <> 'CANCELLED'
                      AND so.sero_stas_abbreviation <> 'CLOSED'
                      )
                  AND c.cirt_displayname = v_bearer_id;*/
                  
  CURSOR bearer_so (v_new_bearer_id VARCHAR,v_new_service VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_sero_id, c.cirt_status
           FROM service_orders so, service_order_attributes soa, circuits c
          WHERE so.sero_id = soa.seoa_sero_id
            AND so.sero_cirt_name = c.cirt_name
            AND (    c.cirt_status <> 'CANCELLED'
                 AND c.cirt_status <> 'PENDINGDELETE'
                )
            AND so.sero_stas_abbreviation <> 'CANCELLED'
            AND so.sero_ordt_type = v_new_service
            AND so.sero_id IN (
                   SELECT MAX (s.sero_id)
                     FROM service_orders s, circuits ci
                    WHERE s.sero_cirt_name = ci.cirt_name
                      AND s.sero_ordt_type = v_new_service
                      AND ci.cirt_displayname like replace(v_new_bearer_id,'(N)')||'%');
                  
                  
BEGIN
   SELECT DISTINCT soa.seoa_defaultvalue
              INTO bearer_id
              FROM service_orders so, service_order_attributes soa
             WHERE so.sero_id = soa.seoa_sero_id
               AND soa.seoa_name = 'ACCESS_ID'
               AND so.sero_id = p_sero_id;
              
             
             
             
   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_ord_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_actual_dsp_date
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACTUAL_DSP_DATE';

   OPEN bearer_so (bearer_id,v_service_ord_type);

   FETCH bearer_so
    INTO v_service_od_id,v_Cir_Status;

   CLOSE bearer_so;
   
   
   if v_Cir_Status = 'COMMISSIONED' then
   

   UPDATE service_order_attributes soa
      SET soa.seoa_defaultvalue = v_actual_dsp_date
    WHERE soa.seoa_sero_id = v_service_od_id
      AND soa.seoa_name = 'ACTUAL_DSP_DATE';

   UPDATE service_implementation_tasks sit
      SET sit.seit_stas_abbreviation = 'COMPLETED'
    WHERE sit.seit_taskname = 'ENTER BEARER DSP'
      AND sit.seit_sero_id = v_service_od_id;
      
   end if;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change  Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END BEARER_DSP_DATE_UPDATE;


--- Jayan Liyanage 2012/04/05


-- Jayan Liyanage 2012/04/05

PROCEDURE D_ETHE_COMPL_RULE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_main_ethe     VARCHAR2 (100);
   v_acc_bear_id   VARCHAR2 (100);
   v_service_id    VARCHAR2 (100);
   v_Cir_Status    VARCHAR2 (100);     
BEGIN
   p_ret_msg := '';

   SELECT DISTINCT soa.seoa_defaultvalue
              INTO v_acc_bear_id
              FROM service_orders so, service_order_attributes soa
             WHERE so.sero_id = soa.seoa_sero_id
               AND soa.seoa_name = 'ACCESS BEARER ID'
               AND so.sero_id = p_sero_id;

   SELECT ci.cirt_name,ci.CIRT_STATUS
     INTO v_main_ethe,v_Cir_Status
     FROM circuits ci
    WHERE ( ci.cirt_displayname LIKE TRIM (v_acc_bear_id) || '%(N)%' 
            OR ci.cirt_displayname = v_acc_bear_id
          )
      AND (ci.cirt_status <> 'PENDINGDELETE' AND ci.cirt_status <> 'CANCELLED'
          );

   SELECT so.sero_id
     INTO v_service_id
     FROM service_orders so, service_implementation_tasks sit
    WHERE so.sero_id = sit.seit_sero_id
      AND so.sero_cirt_name = v_main_ethe
      AND sit.seit_taskname = 'CLOSE SERVICE ORDER'
      AND (sit.seit_stas_abbreviation = 'ASSIGNED');

   IF v_service_id IS NOT NULL and v_Cir_Status = 'COMMISSIONED'
   THEN
      p_ret_msg :=
                  'D-DAB SERVICE ORDER IS STILL INPROGRESS :' || v_service_id;
   ELSE
      p_ret_msg := '';
   END IF;
EXCEPTION
   WHEN NO_DATA_FOUND
   THEN
      p_ret_msg := '';
END D_ETHE_COMPL_RULE;


-- Jayan Liyanage 2012/04/05


--- 13-08-2012  Samankula Owitipana
PROCEDURE D_ETHER_PLAN_MIG_DATE_NOTIFY(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
BEGIN
     p_ret_char := 'Verify PLANNED MIGRATION DATE...!' ;                                      
EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_ETHER_PLAN_MIG_DATE_NOTIFY;
--- 13-08-2012  Samankula Owitipana


--31-05-2014 updated by Jayan Sri Madura by finding bearer with replace N
PROCEDURE D_PREMIUM_VPN_BEA_ATT_CP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS

CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, 
service_order_attributes soa 
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID'AND so.sero_id = p_sero_id;

CURSOR so_copyattr (v_new_bearer_id VARCHAR)
IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status 
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED' AND ci.cirt_displayname LIKE  replace(v_new_bearer_id,'(N)')||'%'); 

v_so_attr_name     VARCHAR2 (100); 
v_so_attr_val      VARCHAR2 (100); 
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100); 
v_new_bearer_id    VARCHAR2 (100); 
v_service_type     VARCHAR2 (100); 
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);

BEGIN OPEN bearer;FETCH bearer INTO v_bearer_id;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);
LOOP FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 
EXIT WHEN so_copyattr%NOTFOUND;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
  AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE'AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa 
  SET soa.seoa_defaultvalue = v_so_attr_val 
  WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION HANDLED BY';

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'CPE CLASS'  THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE'AND v_so_attr_name = 'CPE TYPE'THEN 
UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'CPE MODEL' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val 
  WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CPE MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU MODEL' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU CLASS'THEN 
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU CLASS'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'NTU TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'  THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val  WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU ROUTING MODE'THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
 WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'NTU ROUTING MODE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ACCESS MEDIUM'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NO OF COPPER PAIRS' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val 
  WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN  UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND 
 v_service_order = 'CREATE' AND v_so_attr_name = 'DATA RADIO MODEL'THEN 
 UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'CREATE'AND v_so_attr_name = 'CUSTOMER INTF TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS LINK DISTANCE';ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
 -- Modified 2014 / 11 / 20 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';--End
    
END IF;  IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ACCESS N/W INTF'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'SECTION_HANDLED_BY'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CPE CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE TYPE'
 THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'CPE MODEL'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'NTU MODEL'THEN UPDATE service_order_attributes soa
 SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'NTU CLASS'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU ROUTING MODE'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ACCESS INTF PORT BW' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS INTF PORT BW';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'NTU MODEL CHANGE?' 
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL CHANGE?' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL CHANGE?'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'OLD CIRCUIT ID'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'OLD CIRCUIT ID';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CUSTOMER INTF TYPE';  ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'MIGRATION TYPE' THEN UPDATE service_order_attributes soa
 SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CHANGE?' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';  END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ACCESS N/W INTF' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'SECTION_HANDLED_BY'
 THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CPE CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
   AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU CLASS' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val  WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU TYPE'THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR'
 AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'DATA RADIO MODEL';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'CUSTOMER INTF TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order =  'CREATE-OR' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order =  'CREATE-OR'
AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
 WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS LINK DISTANCE';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order =  'CREATE-OR'
 AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
 -- Modified 2014 / 11 / 20 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';--End  
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ACCESS N/W INTF'
 THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'SECTION HANDLED BY';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'CPE CLASS' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'CPE TYPE'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'CPE MODEL' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
 AND soa.seoa_name = 'CPE MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU MODEL' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU CLASS'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
   AND soa.seoa_name = 'NTU TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
 THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU ROUTING MODE'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU ROUTING MODE';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ACCESS MEDIUM'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
   AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'ACCESS INTF PORT BW'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'CUSTOMER INTF TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
 WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS LINK DISTANCE';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'
 AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS N/W INTF'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE CLASS'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';        
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE TYPE' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';     
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU CLASS' THEN 
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NTU ROUTING MODE';            
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NO OF COPPER PAIRS';        
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS INTF PORT BW' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
-- Modified 2014 / 11 / 20 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS FIBER PROJ SO#'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS FIBER PROJ SO#';--End  
  END IF; IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
END IF; 

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE CLASS' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE MODEL' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF    
 v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU TYPE' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NTU ROUTING MODE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     
v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
 WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'DATA RADIO MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'DATA RADIO MODEL';--END IF;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'AND v_so_attr_name = 'SECTION_HANDLED_BY'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE CLASS' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE MODEL' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF    
 v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU TYPE' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NTU ROUTING MODE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ACCESS MEDIUM' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     
v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
 WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'DATA RADIO MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'DATA RADIO MODEL';--END IF;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'AND v_so_attr_name = 'CUSTOMER INTF TYPE'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
END IF;

--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

/*IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS N/W INTF'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY'; ELSIF v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'CPE CLASS'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';        
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE TYPE' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';     
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU CLASS' THEN 
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU ROUTING MODE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NTU ROUTING MODE';            
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS MEDIUM'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' 
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
  AND soa.seoa_name = 'NO OF COPPER PAIRS';        
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'ACCESS INTF PORT BW' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'DATA RADIO MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'BACKBONE CORE NO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ACCESS LINK DISTANCE'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'AGGREGATE NETWORK 1'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'AGGREGATE NETWORK 2'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'ACCESS NODE CHANGE?'
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = '' WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
END IF; */
 END LOOP; 
IF v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'CREATE'  AND  (v_cir_status = 'COMMISSIONED' OR 
  v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' 
  AND soa.seoa_sero_id = p_sero_id;
END IF;  IF v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'CREATE-TRANSFER'AND  (v_cir_status = 'COMMISSIONED' 
OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' 
  AND soa.seoa_sero_id = p_sero_id;END IF;
IF v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'CREATE-OR' AND  (v_cir_status = 'COMMISSIONED' OR 
  v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' 
  AND soa.seoa_sero_id = p_sero_id; END IF;
IF v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-LOCATION' AND  (v_cir_status = 'COMMISSIONED' OR 
  v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' 
  AND soa.seoa_sero_id = p_sero_id; end if;
/*IF v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-EQUIPMENT' AND  v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status 
  WHERE soa.seoa_name = 'ACCESS BEARER STATUS'AND soa.seoa_sero_id = p_sero_id;END IF;*/
CLOSE so_copyattr;CLOSE bearer;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id, 'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Ethernet VPN Process function. Please check the conditions:' || ' - Erro is:'|| TO_CHAR (SQLCODE)
|| '-'|| SQLERRM;p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id, 'ERROR'  );
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
END D_PREMIUM_VPN_BEA_ATT_CP;
--31-05-2014 updated by Jayan Sri Madura


--- Jayan Liyanage 2012/08/15   ---  Modified on 31/05/2014 with finding bearer by replacing N -- 14/10/2015
PROCEDURE D_PREMIUM_VPN_BEA_AT_MAP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2

)IS CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, service_order_attributes soa WHERE so.sero_id = soa.seoa_sero_id
AND soa.seoa_name = 'ACCESS_ID'  AND so.sero_id = p_sero_id;CURSOR so_copyattr (v_new_bearer_id VARCHAR) IS SELECT DISTINCT soa.seoa_sero_id, c.cirt_status, c.cirt_serv_id
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE'
) AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN ( SELECT MAX (s.sero_id) FROM service_orders s, circuits ci WHERE s.sero_cirt_name = ci.cirt_name  AND s.sero_stas_abbreviation <> 'CANCELLED' AND ci.cirt_displayname LIKE replace( v_new_bearer_id,'(N)') ||'%');
 CURSOR so_att_mapping IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue
FROM service_orders so, service_order_attributes soa WHERE so.sero_id = soa.seoa_sero_id AND so.sero_id = p_sero_id;


v_cir_status      VARCHAR2 (100); v_bearer_so_id    VARCHAR2 (100); v_so_attr_name    VARCHAR2 (100); v_so_att_val      VARCHAR2 (100);
v_new_bearer_id   VARCHAR2 (100); v_bearer_id       VARCHAR2 (100); v_service_type    VARCHAR2 (100); v_service_order   VARCHAR2 (100);
v_new_service     VARCHAR2 (100); v_cir_id          VARCHAR2 (100); v_acc_bear_status VARCHAR2 (100);
BEGIN OPEN bearer; FETCH bearer INTO v_bearer_id; 

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; SELECT DISTINCT so.sero_ordt_type
INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
OPEN so_copyattr (v_bearer_id); FETCH so_copyattr INTO v_bearer_so_id, v_cir_status, v_cir_id; CLOSE bearer;
OPEN so_att_mapping;LOOP FETCH so_att_mapping INTO v_so_attr_name, v_so_att_val; EXIT WHEN so_att_mapping%NOTFOUND;

IF v_cir_status  = 'COMMISSIONED' THEN IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU TYPE' 
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE MODEL' 
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND  v_service_order = 'CREATE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'ACCESS LINK DISTANCE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'ACCESS LINK DISTANCE';  IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE' ) THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status 
WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id; END IF; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'NTU TYPE'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
   AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
 THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE SERIAL NUMBER' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE-OR'AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER';
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE') THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU TYPE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
 AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
   AND soa.seoa_name = 'NTU MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE MODEL';
 ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
 AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CHANGE?'
 THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE CHANGE?'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';  ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE service_order_attributes soa
 SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER'; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER'AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS'
  AND soa.seoa_sero_id = p_sero_id;
END IF; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_so_attr_name = 'NTU MODEL' 
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val 
WHERE soa.seoa_sero_id = v_bearer_so_id  AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE MODEL'THEN
UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'CPE MODEL';  ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' 
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'ADDITIONAL NTU MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NO OF COPPER PAIRS' 
THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa   SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
  AND soa.seoa_name = 'CPE SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' 
  AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
   AND soa.seoa_name = 'NTU SERIAL NUMBER'; END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id 
AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU S/N'; END IF;

IF v_acc_bear_status = 'TO BE MODIFIED' THEN
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE SERIAL NUMBER' 
  THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU S/N';
END IF; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'  THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = 'INSERVICE' 
WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id; END IF;
/*IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL' THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id
AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE SERIAL NUMBER'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER';END IF; IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE service_order_attributes soaSET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_valWHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU S/N'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'CPE SERIAL NUMBER';ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val
WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'NTU SERIAL NUMBER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_att_val WHERE soa.seoa_sero_id = v_bearer_so_id AND soa.seoa_name = 'ADDITIONAL NTU S/N'; END IF; 
*/
ELSIF   v_cir_status  = 'INSERVICE' THEN IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU TYPE' 
  AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU MODEL' THEN 
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU MODEL' AND sa.satt_serv_id = v_cir_id; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE MODEL' THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS'
   AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN 
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'
AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status
WHERE soa.seoa_name = 'ACCESS BEARER STATUS'AND soa.seoa_sero_id = p_sero_id;END IF;END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU TYPE' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'NTU TYPE'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU MODEL'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU MODEL' 
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE MODEL'THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' 
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL' 
  AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS' AND sa.satt_serv_id = v_cir_id; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' 
AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' 
AND soa.seoa_sero_id = p_sero_id;END IF;END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU TYPE'THEN 
  UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU TYPE' AND sa.satt_serv_id = v_cir_id; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU MODEL'THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE-TRANSFER'
AND v_so_attr_name = 'CPE MODEL'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
 AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS' AND sa.satt_serv_id = v_cir_id;
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'NTU SERIAL NUMBER' 
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; 
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER'AND (v_cir_status = 'COMMISSIONED' OR v_cir_status = 'INSERVICE')THEN 
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cir_status WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id;
 END IF;
END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NTU MODEL'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU MODEL' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'CPE MODEL'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'CPE MODEL'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' 
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL' 
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'NO OF COPPER PAIRS'
THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS' AND sa.satt_serv_id = v_cir_id;
 ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'MODIFY-SPEED'
AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val 
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;END IF; 

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN 
  UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'NTU SERIAL NUMBER'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
 AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' 
 AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'AND sa.satt_serv_id = v_cir_id;END IF;
IF v_acc_bear_status = 'TO BE MODIFIED' THEN
IF     v_service_type ='D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N' AND sa.satt_serv_id = v_cir_id;END IF;
END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'  THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = 'INSERVICE' 
WHERE soa.seoa_name = 'ACCESS BEARER STATUS' AND soa.seoa_sero_id = p_sero_id; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU MODEL'THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU MODEL' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE MODEL'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE MODEL' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU MODEL'
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NO OF COPPER PAIRS'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NO OF COPPER PAIRS' AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id;
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_so_attr_name = 'NTU SERIAL NUMBER'THEN UPDATE services_attributes sa
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id;END IF;
/*
 IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER'THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val
WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER'
 AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N'
THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N'AND sa.satt_serv_id = v_cir_id;END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN UPDATE services_attributes sa 
SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'CPE SERIAL NUMBER' AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'NTU SERIAL NUMBER' 
AND sa.satt_serv_id = v_cir_id; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE' AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN
UPDATE services_attributes sa SET sa.satt_defaultvalue = v_so_att_val WHERE sa.satt_attribute_name = 'ADDITIONAL NTU S/N' AND sa.satt_serv_id = v_cir_id;END IF;*/
END IF;END LOOP;CLOSE so_att_mapping;CLOSE so_copyattr;p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Premium  VPN   Bearear Attr Process function. Please check the conditions:'
|| ' - Erro is:' || TO_CHAR (SQLCODE) || '-' || SQLERRM;p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);
END D_PREMIUM_VPN_BEA_AT_MAP;

--- Jayan Liyanage 2012/08/15


--- Jayan Liyanage 2012/08/14 Updated on 04/12/2013 modified  06/01/2016 11/01/2016

PROCEDURE D_PREMIUM_VPN_CREATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )
IS v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_eng_net              VARCHAR2 (100);
v_cpe_class            VARCHAR2 (100);
v_cur_cpe_model        VARCHAR2 (100);
v_pre_cpe_model        VARCHAR2 (100);
v_net_aggri_1          VARCHAR2 (100);
v_net_aggri_2          VARCHAR2 (100);
v_fib_avalable         VARCHAR2 (100);
v_cpe_class_pre     VARCHAR2 (100);
v_Ser_cpe_class VARCHAR2 (100);

BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,
ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT wg.worg_name INTO v_eng_net FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
---SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue,SOA.SEOA_PREV_VALUE  INTO v_cpe_class,v_cpe_class_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue  INTO v_Ser_cpe_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CPE CLASS';   
SELECT soa.seoa_defaultvalue/*,soa.seoa_prev_value */INTO v_cur_cpe_model/*,v_pre_cpe_model*/ FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';  
SELECT soa.seoa_defaultvalue INTO v_net_aggri_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';  
SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa  where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';ELSE       
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';       END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE INVOICE';       
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE INVOICE';END IF;IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'AND (   (v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle LIKE 'SALES-WSALE-%'))
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_section_hndle LIKE 'SALES-SME-%'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
 /*
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_core_network = 'MEN' AND v_acc_nw <> 'MEN PORT' THEN 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF (v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_core_network = 'CEN' AND v_acc_nw <> 'CEN PORT') OR (v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' 
AND v_core_network = 'MPLS' AND v_acc_nw <> 'MPLS PORT')THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' THEN
DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE' AND v_acc_medium = 'P2P RADIO'
AND v_acc_bear_status = 'COMMISSIONED'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'INSTALL SLT-END NTU';END IF; IF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'CREATE'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT'; END IF;   
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class = 'SLT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
END IF;
/*IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'
AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
END IF; */

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'
AND v_ser_ctg = 'TEST' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-ACCM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
ELSIF v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE' THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_bear_status = 'COMMISSIONED'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
ELSIF v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE' THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_nw = 'MEN PORT' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT'; ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
END IF;  IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_acc_medium = 'P2P RADIO' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'INSERVICE' THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN SUB PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE'AND v_acc_nw = 'MPLS PORT'AND v_acc_bear_status = 'INSERVICE' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
END IF;

-- Jayan Liyanage Modified 2014/10/24

/* IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED'
THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COMM. FIBER LINK'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK';
END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED'  
AND ( v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')
THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER';
END IF;

-- Jayan Liyanage Modified End. 2014/10/24

 IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND  v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED' THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_eng_net
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INTEGRATE AGG NW'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND  (v_acc_nw = 'MSAN PORT' or v_acc_nw = 'DSLAM PORT') AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND  (v_acc_nw = 'MSAN PORT' or v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'THEN  UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE' AND v_ntu_class = 'SLT' AND v_acc_bear_status = 'INSERVICE'
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';END IF;

/*IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'AND v_cpe_class = 'SLT'
AND v_cur_cpe_model <> v_pre_cpe_model AND v_cpe_class_pre = 'SLT'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
END IF; */

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'CREATE'AND v_cpe_class = 'SLT'
AND v_cur_cpe_model <> v_pre_cpe_model AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
END IF;

/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_cpe_class = 'SLT'  AND v_cur_cpe_model <> v_pre_cpe_model 
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';END IF;*/

 IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE'
AND v_cpe_class = 'SLT' AND v_cur_cpe_model <> v_pre_cpe_model 
AND v_acc_bear_status = 'INSERVICE' THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';END IF;


IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_cpe_class = 'SLT' AND v_acc_bear_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE';END IF;

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND ( v_acc_medium = 'FIBER' or v_acc_medium = 'COPPER-UTP')  
  AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_eng_net WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC. LINK';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC. LINK';END IF;

/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VLAN';
ELSE DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIGURE VLAN'; END IF;*/

-- Modified  Jayan Liyanage 06/01/2016

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND v_Ser_cpe_class = 'SLT' THEN
   UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPERATIONS' WHERE sit.seit_sero_id = p_sero_id
    AND sit.seit_taskname = 'INSTALL SERVICE CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL SERVICE CPE';END IF;

-- End 06/01/2016

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_PREMIUM_VPN_CREATE;

--- Jayan Liyanage 2012/08/14Updated on 04/12/2013 modified  06/01/2016


--- Jayan Liyanage 2012/08/15 TEST AGGREGATE LINK task WG changed to RTOM LEA OSP NC and PLAN SVC MIGRATION task added on 04-05-2014

PROCEDURE D_PREMIUM_VPN_CREATE_TRSF (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_mig_type             VARCHAR2 (100);
v_ntu_model_chg        VARCHAR2 (100);
v_cpes_class           VARCHAR2 (100);
v_net_aggri_1          VARCHAR2 (100);
v_net_aggri_2          VARCHAR2 (100);
v_model_chg            VARCHAR2 (100);

BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,ar.area_code INTO v_rtom_code,v_lea_code
FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
--SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_cpes_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue INTO v_mig_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
SELECT soa.seoa_defaultvalue INTO v_ntu_model_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';
SELECT soa.seoa_defaultvalue INTO v_net_aggri_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';  
SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
SELECT soa.seoa_defaultvalue INTO v_model_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?';

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')) THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';       
END IF;
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT') 
OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT')) THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;*/
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'LEGACY TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'NGN TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; END IF;      
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGGREGATE LINK'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'TEST AGGREGATE LINK'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PLAN SVC MIGRATION'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'PLAN SVC MIGRATION'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_mig_type = 'NGN TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; ELSE DELETE  service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; END IF;  


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'LEGACY TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-CONDESK' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIRM MIGRATION'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIRM MIGRATION'; END IF;
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF;
*/
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER'
AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; ELSE        
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF;

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE DEL-TRNSFER SO';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'NO'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'NO'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU LABEL'; END IF;  
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_ntu_model_chg = 'YES' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL  NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL  NTU'; END IF;  
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_model_chg = 'YES'
AND v_cpes_class = 'SLT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE'; ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_model_chg = 'NO' AND v_cpes_class = 'SLT'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'NGN TO NGN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; END IF;    
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_mig_type = 'NGN TO NGN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY-NTU'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY-NTU'; END IF; 
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname =  'CONFIG MEN VLAN'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname =  'CONFIG CEN VLAN'; END IF; */
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND v_acc_nw <> 'MPLS PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG IPVPN PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname =  'CONFIG IPVPN PORT'; END IF; 

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_PREMIUM_VPN_CREATE_TRSF;

--- Jayan Liyanage 2012/08/15




-- Dulip Fernando  2012/04/04 

PROCEDURE DAB_UPDATE_SO_BITRATE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SERVICE_SPEED VARCHAR2(15);

BEGIN

SELECT  SERO_SPED_ABBREVIATION INTO v_SERVICE_SPEED
FROM service_orders so
WHERE so.sero_id = p_sero_id ;


UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET SOA.seoa_defaultvalue = v_SERVICE_SPEED
WHERE SOA.seoa_sero_id = p_sero_id
AND SOA.seoa_name = 'TOTAL BEARER BIT RATE';
 
   
 
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to update "TOTAL BEARER BIT RATE" SO attribute .Please check :' || 'SERO_SPED_ABBREVIATION value ' || v_SERVICE_SPEED || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END DAB_UPDATE_SO_BITRATE;


-- Dulip Fernando  2012/04/04 

-- 04-07-2012 Samankula Owitipana
PROCEDURE ACCESS_NW_INT_TYPE_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

    
v_acc_nw varchar2(50);    
cursor c_acc_nw_type is    
SELECT upper(substr(soa.seoa_defaultvalue,1,instr(soa.seoa_defaultvalue,' ')-1)) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
BEGIN
open c_acc_nw_type;
fetch c_acc_nw_type into v_acc_nw;
close c_acc_nw_type;
IF v_acc_nw is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_acc_nw || '-NTU'
WHERE SA.SEOA_NAME = 'FROM TO'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set access network type to FROM TO attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END ACCESS_NW_INT_TYPE_SET;
-- 04-07-2012 Samankula Owitipana



-- 23-03-2012 Samankula Owitipana

PROCEDURE DAB_SEQ_ATTR_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_loc_aend    varchar2(100);
v_loc_bend    varchar2(100);
v_indx         varchar2(10);
v_acc_port_bw varchar2(50);
BEGIN
select lo.LOCN_TTNAME,lo2.LOCN_TTNAME  
into v_loc_aend,v_loc_bend
from service_orders so,service_orders so2,locations lo,locations lo2
where so.SERO_ID = so2.SERO_ID
and so.SERO_LOCN_ID_AEND = lo.LOCN_ID
and so.SERO_LOCN_ID_BEND = lo2.LOCN_ID
and so.SERO_ID = p_sero_id;
/*SELECT soa.seoa_defaultvalue
INTO v_acc_port_bw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW';*/
select lpad(nvl(max(substr(replace(ci.CIRT_DISPLAYNAME,'(N)'),-4)),0)+1,4,0) into v_indx from circuits ci
where ci.CIRT_LOCN_AEND = v_loc_aend and ci.CIRT_LOCN_BEND = v_loc_bend 
and (ci.CIRT_STATUS not like 'PEN%' and ci.CIRT_STATUS not like 'CAN%')--and ci.CIRT_DISPLAYNAME like '%' || v_acc_port_bw || '%'
and ci.CIRT_SERT_ABBREVIATION = 'D-DAB';
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_indx
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SEQ_ID';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed to set SEQ_ID attribute. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        ,p_ret_msg );
END DAB_SEQ_ATTR_SET;

-- 23-03-2012 Samankula Owitipana

-- 26-03-2012 Samankula Owitipana

PROCEDURE DAB_BEARER_ID_ATTR_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_cct_id varchar2(100);
BEGIN
select trim(replace(ci.CIRT_DISPLAYNAME,'(N)',''))
into v_cct_id from service_orders so,circuits ci
where so.SERO_CIRT_NAME = ci.CIRT_NAME
and so.SERO_ID = p_sero_id;
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_cct_id
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER ID';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION WHEN OTHERS THEN
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed to set ACCESS BEARER ID attribute. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        ,p_ret_msg );
END DAB_BEARER_ID_ATTR_SET;

-- 26-03-2012 Samankula Owitipana

-- Dulip Fernando  2012/02/29 

PROCEDURE VEY_PRICING_WG_CHANGE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);

BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION_HANDLED_BY'AND SEOA_SERO_ID=p_sero_id;


 IF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%'  THEN

--ADD APPROVE SO section 2012-04-11

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO' ;

    UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'VERIFY PRICING' ;


--ADD MODIFY PRICE PLAN section 2012-08-07

     UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY PRICE PLAN';

 
        ELSIF (v_SECTION_HANDLE_WG LIKE 'SALES-ENT-%') OR (v_SECTION_HANDLE_WG  LIKE 'SALES-WSALE-%' ) THEN
        
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'SALES-SIU-MGR'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'VERIFY PRICING';

--ADD APPROVE SO section 2012-04-11    

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'SALES-SIU-MGR'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO';







 END IF;
 
 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change SECTION_HANDLE_WG .Please check SECTION_HANDLE:' || v_SECTION_HANDLE_WG || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END VEY_PRICING_WG_CHANGE;


-- Dulip Fernando  2012/02/29 

-- Dulip Fernando  2012/02/29 

PROCEDURE SET_SECTION_HANDLE_WG_FO(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);
V_SEIT_WORG_NAME_FO VARCHAR2(100);

BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION_HANDLED_BY'AND SEOA_SERO_ID=p_sero_id;



 V_SEIT_WORG_NAME_FO:= v_SECTION_HANDLE_WG ||'-FO';

 

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = V_SEIT_WORG_NAME_FO
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'INITIATE  PRDUCT SO' ;
 
        
        
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = V_SEIT_WORG_NAME_FO
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'ENTER BEARER DSP';
         
    
  
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = V_SEIT_WORG_NAME_FO
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'MODIFY PRICE PLAN';  
         
         
         

   
   
   p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
        
EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change SECTION_HANDLE_WG .Please check SECTION_HANDLE:' || v_SECTION_HANDLE_WG || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END SET_SECTION_HANDLE_WG_FO;

-- Dulip Fernando  2012/02/29 


---- edited on 20/09/2012

-- Jayan Liyanage 2012/08/20

PROCEDURE D_PREMIUM_VPN_CHG (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )IS



v_net_aggri_1     VARCHAR2(100);
v_net_aggri_2     VARCHAR2(100);
v_service_type    VARCHAR2(100);
v_service_order   VARCHAR2(100);
v_acc_nw          VARCHAR2(100);

BEGIN



SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;


SELECT soa.seoa_defaultvalue INTO v_net_aggri_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';  
SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') 
AND v_acc_nw <> 'MEN PORT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' then DELETE  service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN VLAN'; END IF;


IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'CONFIG. CEN VLAN';
ELSif v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE' then DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. CEN VLAN'; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' 
AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' then DELETE  service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN'; END IF;

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' then
DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' 
AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' then DELETE  service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN'; END IF;
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-OR' then
DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN'; END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_PREMIUM_VPN_CHG;

-- Jayan Liyanage 2012/08/20

-- Jayan Liyanage 2012/08/22

PROCEDURE D_ACC_BEARER_ID_POPUP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )IS



v_net_aggri_1     VARCHAR2(100);
v_net_aggri_2     VARCHAR2(100);
v_service_type    VARCHAR2(100);
v_service_order   VARCHAR2(100);
v_acc_nw          VARCHAR2(100);

BEGIN


UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = 'ENTER BEARER ID'
WHERE  soa.seoa_name = 'ACCESS BEARER ID'
AND SOA.SEOA_SERO_ID IN (
SELECT DISTINCT S.SERO_ID
FROM service_orders S
WHERE S.SERO_ID = p_sero_id);


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_ACC_BEARER_ID_POPUP;

-- Jayan Liyanage 2012/08/22


-- Samankula Owitipana 2012/09/21
PROCEDURE DAB_UPDATE_SPEED_TO_ATTRIBUTE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_service_speed VARCHAR2(100);
BEGIN
select so.SERO_SPED_ABBREVIATION
INTO v_service_speed
from SERVICE_ORDERS SO
where so.SERO_ID = p_sero_id;
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_service_speed
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroups. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
END DAB_UPDATE_SPEED_TO_ATTRIBUTE;
-- Samankula Owitipana 2012/09/21


-- Samankula Owitipana 2012/09/21
PROCEDURE DAB_UPDATE_SPEED_TO_SERVICE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
v_service_speed VARCHAR2(100);
BEGIN
select soa.seoa_defaultvalue
into v_service_speed
from service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS INTF PORT BW';
update SERVICE_ORDERS SO
set so.SERO_SPED_ABBREVIATION = v_service_speed
where so.SERO_ID = p_sero_id;
update services se
set se.SERV_SPED_ABBREVIATION = v_service_speed
where se.SERV_ID = p_serv_id ;
update circuits ci
set ci.CIRT_SPED_ABBREVIATION = v_service_speed
where ci.CIRT_NAME = ( select so.SERO_CIRT_NAME from SERVICE_ORDERS SO
where so.SERO_ID = p_sero_id);
UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_service_speed
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SERVICE_SPEED';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroups. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
END DAB_UPDATE_SPEED_TO_SERVICE;
-- Samankula Owitipana 2012/09/21


-- 04-10-2012 Samankula Owitipana 

PROCEDURE  SIP_CONFIRM_NUMBER_WG_CH (

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                                     IN     Service_Orders.sero_id%TYPE,
      p_seit_id                                       IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                     IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                                    IN     work_order.woro_id%TYPE,
      p_ret_char                                   OUT    VARCHAR2,
      p_ret_number                            OUT    NUMBER,
      p_ret_msg                                    OUT    VARCHAR2) IS


CURSOR so_cus_type_cur IS
SELECT cu.CUSR_CUTP_TYPE
FROM service_orders so,customer cu
WHERE so.SERO_CUSR_ABBREVIATION = cu.CUSR_ABBREVIATION
and so.SERO_ID = p_sero_id;
v_cus_type    VARCHAR2(100) := null;
BEGIN
p_ret_char := '';
OPEN so_cus_type_cur;
FETCH so_cus_type_cur INTO v_cus_type;
CLOSE so_cus_type_cur;
IF v_cus_type like 'CORPORATE-LARGE%VERY LARGE' THEN
p_ret_char := 'MKT-SALES-CORP-ACCT';
ELSIF v_cus_type like 'CORPORATE-SME' THEN
p_ret_char := 'MKT-SALES-SME-ACCT';
ELSIF v_cus_type like 'REGIONAL-SME' THEN
p_ret_char := 'MKT-SALES-SMER-ACCT';
ELSIF v_cus_type like 'CORPORATE-WHOLESALE' THEN
p_ret_char := 'MKT-SALES-WSALE-ACCT';
END IF;p_ret_msg := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END SIP_CONFIRM_NUMBER_WG_CH;

-- 04-10-2012 Samankula Owitipana  



-- 24-03-2011 Gihan Amarasinghe

PROCEDURE SET_SO_STATUS_TO_APPROVED (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

   cursor c_sero_status is
     select so.SERO_STAS_ABBREVIATION
  from service_orders so
  where so.SERO_ID = p_sero_id;
  
   v_sero_status VARCHAR2(20);

BEGIN

    open c_sero_status;
 fetch c_sero_status into v_sero_status;
 close c_sero_status;

 if v_sero_status = 'PROPOSED' then
    update service_orders so
    set so.SERO_STAS_ABBREVIATION = 'APPROVED'
    where so.SERO_ID = p_sero_id;
    
 end if;
 
 -- The ACTUAL_DSP_DATE attribute current value shoud be null as per the SLT business process
 -- Added by Gihan
 UPDATE SERVICE_ORDER_ATTRIBUTES 
 SET SEOA_DEFAULTVALUE = NULL WHERE SEOA_SERO_ID = p_sero_id 
 AND SEOA_NAME = 'ACTUAL_DSP_DATE';

    p_ret_msg := '';

 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Failed to update SO Status to APPROVED. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END SET_SO_STATUS_TO_APPROVED;

-- 24-03-2011 Gihan Amarasinghe

-- 24-03-2011 Gihan Amarasinghe

PROCEDURE SET_TASK_STATUS_TO_COMPLETED (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


BEGIN

        p_ret_msg := '';

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Failed to update Task Status to COMPLETED. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END SET_TASK_STATUS_TO_COMPLETED;

-- 24-03-2011 Gihan Amarasinghe

-- 19-04-2011 Gihan Amarasinghe

PROCEDURE SET_SO_FEATURE_PROV_DATETIME (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

    cursor c_order_type is
        select so.SERO_ORDT_TYPE
        from service_orders so
        where so.SERO_ID = p_sero_id;
      
    cursor sofe_list_curr is
        select * from service_order_features sof
        where sof.SOFE_SERO_ID = p_sero_id
        and sof.SOFE_PROVISION_STATUS = 'Y';

    cursor dsp_date_curr is
        select soa.SEOA_DEFAULTVALUE from service_order_attributes soa
        where soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_NAME = 'ACTUAL_DSP_DATE';
        
    v_dsp_date VARCHAR2(30);
    v_order_type VARCHAR2(30);

BEGIN

    open dsp_date_curr;
    fetch dsp_date_curr into v_dsp_date;
    close dsp_date_curr;

    open c_order_type;
    fetch c_order_type into v_order_type;
    close c_order_type;
    
    if v_order_type like 'CREATE%' then
    
    update service_order_features sof
    set sof.SOFE_PREV_VALUE = 'N'
    where sof.SOFE_SERO_ID = p_sero_id;
    
    end if;
    
        for sofe_list_rec in sofe_list_curr loop

        if sofe_list_rec.SOFE_FEATURE_NAME in ('SF_IDD','SF_SECRET_CODE') then
            
            update service_order_attributes soa
            set soa.SEOA_DEFAULTVALUE = to_char(sofe_list_rec.SOFE_PROVISION_TIME,'DD-MON-YYYY HH24:MI')
            where soa.SEOA_SERO_ID = p_sero_id
            and soa.SEOA_SERO_REVISION = 0
            and soa.SEOA_NAME = 'SF_PROVISION_DATE'
            and soa.SEOA_SOFE_ID = sofe_list_rec.SOFE_ID;

        else

            update service_order_attributes soa
            set soa.SEOA_DEFAULTVALUE = v_dsp_date
            where soa.SEOA_SERO_ID = p_sero_id
            and soa.SEOA_SERO_REVISION = 0
            and soa.SEOA_NAME = 'SF_PROVISION_DATE'
            and soa.SEOA_SOFE_ID = sofe_list_rec.SOFE_ID;

        end if;

    end loop;
    
        p_ret_msg := '';

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Failed to update SF_PROVISIONED_DATE attribute. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END SET_SO_FEATURE_PROV_DATETIME;

-- 19-04-2011 Gihan Amarasinghe

-- 21-04-2011 Gihan Amarasinghe

PROCEDURE SET_SO_FEATURE_PROV_STATUS (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

   
 cursor sofe_list_curr is
  select sof.SOFE_ID from service_order_features sof
  where sof.SOFE_SERO_ID = p_sero_id
  and sof.SOFE_DEFAULTVALUE <> NVL(sof.SOFE_PREV_VALUE,'N')
  and sof.SOFE_PROVISION_STATUS is null;

 cursor dsp_date_curr is
  select soa.SEOA_DEFAULTVALUE from service_order_attributes soa
  where soa.SEOA_SERO_ID = p_sero_id
  and soa.SEOA_NAME = 'ACTUAL_DSP_DATE';
  
 v_dsp_date VARCHAR2(30);

BEGIN

 open dsp_date_curr;
 fetch dsp_date_curr into v_dsp_date;
 close dsp_date_curr;


     for sofe_list_rec in sofe_list_curr loop

  update service_order_features sof
  set sof.SOFE_PROVISION_STATUS = 'Y',
  sof.SOFE_PROVISION_TIME = to_date(v_dsp_date, 'DD-MON-YYYY HH24:MI')
  where sof.SOFE_SERO_ID = p_sero_id
  and sof.SOFE_ID = sofe_list_rec.SOFE_ID;

 end loop;
 
     p_ret_msg := '';

 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'Failed to update SO Feature Provision Status. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END SET_SO_FEATURE_PROV_STATUS;

-- 21-04-2011 Gihan Amarasinghe

-- 29-04-2011 Gihan Amarasinghe
PROCEDURE ASSOCIATE_CIRCUITS_ADSL (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

   cursor curr_adsl_oeid is
    select so.SERO_OEID, substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1) from service_orders so
    where so.SERO_ID = p_sero_id;

  /* cursor curr_pstn_oeid (t_oeid_adsl_cust in varchar2) is
 select so.SERO_OEID from service_orders so
 where so.SERO_SERT_ABBREVIATION = 'PSTN'
 and so.SERO_ORDT_TYPE = 'CREATE'
 and so.SERO_OEID like t_oeid_adsl_cust || '%';
*/

 cursor curr_pstn_oeid (t_oeid_adsl_cust in varchar2) is
   select so.SERO_OEID,so.SERO_SERT_ABBREVIATION,  so.SERO_ORDT_TYPE from service_orders so
     where so.SERO_OEID like t_oeid_adsl_cust || '%';

v_oeid_adsl_org varchar2(50);
v_oeid_adsl_cust varchar2(50);
v_oeid_pstn_org varchar2(50);


BEGIN

 open curr_adsl_oeid;
 fetch curr_adsl_oeid into v_oeid_adsl_org, v_oeid_adsl_cust;
 close curr_adsl_oeid;

/*
 open curr_pstn_oeid (v_oeid_adsl_cust);
 fetch curr_pstn_oeid into v_oeid_pstn_org;
     IF curr_pstn_oeid%NOTFOUND THEN
        v_oeid_pstn_org := v_oeid_adsl_org;
     END IF;
 close curr_pstn_oeid;
*/
--  Added by Rana
v_oeid_adsl_org := v_oeid_adsl_org; -- it will have this if PSTN service and Create Order Type is not found

 for curr_pstn_oeid_rec in curr_pstn_oeid (v_oeid_adsl_cust) loop
   if curr_pstn_oeid_rec.SERO_SERT_ABBREVIATION = 'PSTN' and curr_pstn_oeid_rec.SERO_ORDT_TYPE = 'CREATE' then
     v_oeid_pstn_org := curr_pstn_oeid_rec.SERO_oeid;
   end if;
 end loop;

--  end of Rana's Additions

 update service_orders so
 set so.SERO_OEID = v_oeid_pstn_org
 where so.SERO_ID = p_sero_id;


 P_dynamic_procedure.Process_create_circuit(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);

 update service_orders so
 set so.SERO_OEID = v_oeid_adsl_org
 where so.SERO_ID = p_sero_id;

 IF p_ret_msg IS NULL THEN
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
 else
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
 end if;

EXCEPTION

WHEN OTHERS THEN

      p_ret_msg  := 'Failed to associate the ADSL circuit to the current Service Order:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

   p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
  SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
  , p_ret_msg);


END ASSOCIATE_CIRCUITS_ADSL;
-- 29-04-2011 Gihan Amarasinghe

-- 15-05-2012 Samankula Owitipana

PROCEDURE DIDO_MOD_UPDATE_PILOT_NUM (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


v_NUMBER                service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
v_NUMBER_OLD           service_order_attributes.SEOA_DEFAULTVALUE%TYPE;
v_cct_id               circuits.CIRT_NAME%TYPE;
v_other_nam_chk      circuits.CIRT_NAME%TYPE;


CURSOR c_get_pilot_num IS
SELECT soa.SEOA_DEFAULTVALUE
FROM service_order_attributes soa
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'PILOT NUMBER' ;

CURSOR c_get_pilot_num_old IS
SELECT soa.SEOA_PREV_VALUE
FROM service_order_attributes soa
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'PILOT NUMBER' ;

CURSOR c_cct_id IS
SELECT so.SERO_CIRT_NAME
FROM service_orders so
WHERE so.SERO_ID = p_sero_id ;

CURSOR c_oth_nam_chk IS
SELECT ona.OTHN_CIRT_NAME 
FROM OTHER_NAMES ona
WHERE ona.OTHN_CIRT_NAME = v_cct_id
AND ona.OTHN_NAMETYPE = 'DIDO PILOT NUMBER';



BEGIN

OPEN c_get_pilot_num;
FETCH c_get_pilot_num INTO v_NUMBER;
CLOSE c_get_pilot_num;

OPEN c_get_pilot_num_old;
FETCH c_get_pilot_num_old INTO v_NUMBER_OLD;
CLOSE c_get_pilot_num_old;

OPEN c_cct_id;
FETCH c_cct_id INTO v_cct_id;
CLOSE c_cct_id;

OPEN c_oth_nam_chk;
FETCH c_oth_nam_chk INTO v_other_nam_chk;
CLOSE c_oth_nam_chk;


IF v_other_nam_chk IS NULL THEN

INSERT INTO OTHER_NAMES ONA (OTHN_CIRT_NAME, OTHN_NAME, OTHN_NAMETYPE, OTHN_WORG_NAME)
VALUES (v_cct_id,v_NUMBER,'DIDO PILOT NUMBER',NULL);

ELSIF v_NUMBER <> v_NUMBER_OLD THEN


UPDATE OTHER_NAMES ona
SET ona.OTHN_NAME = v_NUMBER
WHERE ona.OTHN_CIRT_NAME = v_cct_id
AND ona.OTHN_NAMETYPE = 'DIDO PILOT NUMBER';

END IF;




p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed to update Primary Number. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
      SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
      , p_ret_msg);


END DIDO_MOD_UPDATE_PILOT_NUM;

-- 15-05-2012 Samankula Owitipana


-- 21-06-2011 Gihan Amarasinghe Modified by Jayan Sri Madhura on 08/03/2016

PROCEDURE ASSOCIATE_RECON_NUMBERS (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


         
     CURSOR CUR_SERV_ID IS
        select SERO_SERV_ID, SERO_SERT_ABBREVIATION
        from Service_Orders
        where SERO_ID=p_sero_id;


     CURSOR CUR_RECON_NUMBER IS 
        select substr(SEOA_DEFAULTVALUE,0,3) NUCC_CODE, substr(SEOA_DEFAULTVALUE,4,7) NUMB_NUMBER
        from SERVICE_ORDER_ATTRIBUTES
        where SEOA_SERO_ID=p_sero_id
        and SEOA_NAME='RECON_NUMBER';
  
  CURSOR CUR_RECON_SEC_NUMBER IS 
        select substr(SEOA_DEFAULTVALUE,0,3) NUCC_CODE, substr(SEOA_DEFAULTVALUE,4,7) NUMB_NUMBER
        from SERVICE_ORDER_ATTRIBUTES
        where SEOA_SERO_ID=p_sero_id
        and SEOA_NAME='RECON_SECONDARY';
  
            
    CURSOR CUR_STATUS_ID (c_NUCC_CODE IN SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE, c_NUM IN SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE)  IS        
        select NUMB_NUMS_ID
        from  NUMBERS
        where NUMB_NUCC_CODE=c_NUCC_CODE
        and NUMB_NUMBER =c_NUM;
  
v_SERV_ID Service_Orders.SERO_SERV_ID%TYPE;
v_SERVICE_TYPE Service_Orders.SERO_SERT_ABBREVIATION%TYPE;
v_NUCC_CODE NUMBERS.NUMB_NUCC_CODE%TYPE;
v_NUMB_NUMBER NUMBERS.NUMB_NUMBER%TYPE;
v_NUMB_STATUS_ID NUMBERS.NUMB_NUMS_ID%TYPE;
v_NUCC_CODE2 NUMBERS.NUMB_NUCC_CODE%TYPE;
v_NUMB_NUMBER2 NUMBERS.NUMB_NUMBER%TYPE;
v_NUMB_STATUS_ID2 NUMBERS.NUMB_NUMS_ID%TYPE;




BEGIN

    OPEN  CUR_SERV_ID;
    FETCH  CUR_SERV_ID INTO v_SERV_ID, v_SERVICE_TYPE;
 IF CUR_SERV_ID%NOTFOUND THEN
     v_SERV_ID := '';
  v_SERVICE_TYPE := '';
    END IF; 
    CLOSE  CUR_SERV_ID;
 
    OPEN  CUR_RECON_NUMBER;
    FETCH  CUR_RECON_NUMBER INTO v_NUCC_CODE, v_NUMB_NUMBER;
 IF CUR_RECON_NUMBER%NOTFOUND THEN
     v_NUCC_CODE := '';
  v_NUMB_NUMBER := '';
    END IF; 
    CLOSE  CUR_RECON_NUMBER;
 
 IF  v_NUCC_CODE IS NULL OR v_NUMB_NUMBER IS NULL or length(v_NUCC_CODE) <> 3 or length(v_NUMB_NUMBER) <> 7  THEN    
          p_ret_msg  := 'Failed to associate number, The RECON_NUMBER Attribute value is invalid:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 else
         
      OPEN  CUR_STATUS_ID(v_NUCC_CODE, v_NUMB_NUMBER);
      FETCH  CUR_STATUS_ID INTO v_NUMB_STATUS_ID;
      CLOSE  CUR_STATUS_ID;    
    
      IF v_NUMB_STATUS_ID not in (5,3)  THEN     
                  
             p_ret_msg  := 'Failed to associate number, The number status is not QUARANTINED OR RESERVED:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;         
       ELSIF v_SERV_ID IS NULL THEN
      p_ret_msg  := 'Failed to associate number, Service Id is null:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
   ELSE    
           update  CLARITY.NUMBERS
           set NUMB_SERV_ID=v_SERV_ID, NUMB_NUMS_ID=6
           where NUMB_NUCC_CODE=v_NUCC_CODE 
              and NUMB_NUMBER =v_NUMB_NUMBER
              and (NUMB_NUMS_ID=5 OR NUMB_NUMS_ID=3);
      END IF;
 end if;



 if v_SERVICE_TYPE = 'ISDN' then
        OPEN  CUR_RECON_SEC_NUMBER;
        FETCH  CUR_RECON_SEC_NUMBER INTO v_NUCC_CODE2, v_NUMB_NUMBER2;
     IF CUR_RECON_SEC_NUMBER%NOTFOUND THEN
           v_NUCC_CODE2 := '';
        v_NUMB_NUMBER2 := '';
        END IF; 
        CLOSE  CUR_RECON_SEC_NUMBER;
 
     IF  v_NUCC_CODE2 IS NULL OR v_NUMB_NUMBER2 IS NULL or length(v_NUCC_CODE2) <> 3 or length(v_NUMB_NUMBER2) <> 7  THEN    
               p_ret_msg  := 'Failed to associate number, The RECON_NUMBER Attribute value is invalid:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
     else
         
         OPEN  CUR_STATUS_ID(v_NUCC_CODE2, v_NUMB_NUMBER2);
         FETCH  CUR_STATUS_ID INTO v_NUMB_STATUS_ID2;
         CLOSE  CUR_STATUS_ID;    
    
         IF v_NUMB_STATUS_ID2 not in (5,3)  THEN               
                p_ret_msg  := 'Failed to associate number, The number status is not QUARANTINED OR RESERVED:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;         
          ELSIF v_SERV_ID IS NULL THEN
         p_ret_msg  := 'Failed to associate number, Service Id is null:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      ELSE    
           update  CLARITY.NUMBERS
           set NUMB_SERV_ID=v_SERV_ID, NUMB_NUMS_ID=6
           where NUMB_NUCC_CODE=v_NUCC_CODE2 
              and NUMB_NUMBER =v_NUMB_NUMBER2
              and (NUMB_NUMS_ID=5 OR NUMB_NUMS_ID=3) ;
         END IF;
      end if;
 end if;



 
 IF p_ret_msg IS NULL THEN
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
 else
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
 end if;

    EXCEPTION
        WHEN OTHERS THEN
          p_ret_msg  := 'Failed to Assosiate RECON_NUMBERS :' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;  

    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

     INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
     SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
     , p_ret_msg);
    
END ASSOCIATE_RECON_NUMBERS;

-- 21-06-2011 Gihan Amarasinghe


-- 04-05-2011 Gihan Amarasinghe
PROCEDURE Call_RF_reservefacilityNGN (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


    cursor c_sero is
        select so.SERO_SERT_ABBREVIATION, so.SERO_ORDT_TYPE, so.SERO_OEID, so.SERO_SPED_ABBREVIATION, so.SERO_ADDE_ID_BEND from service_orders so
        where so.SERO_ID = p_sero_id;

    cursor c_get_sero_attr (t_attr_name in service_order_attributes.SEOA_NAME%TYPE) is
        select soa.SEOA_DEFAULTVALUE from service_order_attributes soa
        where soa.SEOA_NAME = t_attr_name
        and soa.SEOA_SERO_ID = p_sero_id
        and soa.SEOA_SERO_REVISION = 0;

    cursor c_get_frac_id (t_dp_loc_code in frame_containers.FRAC_LOCN_TTNAME%TYPE, t_dp_index in frame_containers.FRAC_INDEX%TYPE) is
        select fc.FRAC_ID from frame_containers fc
        where fc.FRAC_LOCN_TTNAME = t_dp_loc_code
        and fc.FRAC_FRAN_NAME = 'DP'
        and fc.FRAC_INDEX = t_dp_index;

    cursor c_get_add_servbility (t_frac_id in ADDRESS_SERVICEABILITY.ADDS_FRAC_ID%TYPE, t_adde_id in ADDRESS_SERVICEABILITY.ADDS_ADDE_ID%TYPE) is
        select asb.ADDS_FRAC_ID from ADDRESS_SERVICEABILITY asb
        where asb.ADDS_FRAC_ID = t_frac_id
        AND asb.ADDS_ADDE_ID = t_adde_id;
        
    cursor c_get_next_free_FA (t1_frac_id in frame_containers.FRAC_ID%TYPE) is
        select min(fa.FRAA_ID) from frame_containers fc, frame_units fu, frame_appearances fa
        where fc.FRAC_ID = fu.FRAU_FRAC_ID
        and fu.FRAU_ID = fa.FRAA_FRAU_ID
        and fc.FRAC_ID = t1_frac_id
        and fa.FRAA_SIDE = 'REAR'
        AND FA.FRAA_STATUS='INSERVICE'
        and fa.FRAA_CIRT_NAME is null;



       phonenumber       inventorymanager.clilong;
       serviceaddress    address;
    sert           servicetypeslist;
    reserveid      service_orders.SERO_OEID%TYPE;
       returnstatus      callstatus;
       l_attrb           attributeslist;
       serviceid         VARCHAR2 (50) := NULL;
       existingnumber    VARCHAR2 (20) := NULL;
    servicespeed      service_orders.SERO_SPED_ABBREVIATION%TYPE;
       servicefeatures   servicefeatureslist;
       addeid            NUMBER;
       exchcode          VARCHAR2 (50) := NULL;
       portid            NUMBER        := NULL;
       outofarea         VARCHAR2 (1)  := NULL;
       exchlocn          VARCHAR2 (15)    := NULL;
       exchtype          VARCHAR2 (20) := NULL;
       exchindex         VARCHAR2 (20) := NULL;
       ippool            VARCHAR2 (20) := NULL;
       dslamdist         VARCHAR2 (20) := NULL;
     entityType        varchar2(80)    := NULL;
     entityID          number;

    serv_type       varchar2(100) := NULL;
    v_bizdsl_platform varchar2(100) := NULL;
    v_lastmile_access varchar2(100) := NULL;
    is_to_call_RF      varchar2(100) := 'Y';
    sero_serv_type      service_orders.SERO_SERT_ABBREVIATION%TYPE;
    sero_ordt_type      service_orders.SERO_ORDT_TYPE%TYPE;
     Neib_phnNumber    VARCHAR2 (20) := NULL;
    New_DP_Added      varchar2(10)     := NULL;
    New_DP_loc      varchar2(100)    := NULL;
    New_DP_index      varchar2(10)    := NULL;
    new_DP_frac_id       NUMBER;
    add_servbility    ADDRESS_SERVICEABILITY.ADDS_FRAC_ID%TYPE;
    next_fraa_id      frame_appearances.FRAA_ID%TYPE;

BEGIN

-- Initialisation...
   servicefeatures := servicefeatureslist ('');
   l_attrb := attributeslist (ATTRIBUTE (NULL, NULL));
   phonenumber := NULL;
   serviceid := NULL;
   p_ret_msg := '';


    open c_sero;
    fetch c_sero into sero_serv_type, sero_ordt_type, reserveid, servicespeed, addeid;
    close c_sero;

       serviceaddress :=
              address (addeid, '',                                            --Floor
                       '',                                            --Building Name
                       '',                                             --Street Nmber
                       '',                                             --sttreet name
                       '',                                                --post code
                       '',                                                   --suburb
                       '',                                                     --city
                       '',                                               --state code
                       '',                                                  --country
                       l_attrb);

    open c_get_sero_attr('RF_SERVICE_TYPE');
    fetch c_get_sero_attr into serv_type;
        IF c_get_sero_attr%NOTFOUND THEN
        serv_type := '';
        END IF;
    close c_get_sero_attr;

    if serv_type is null then
        p_ret_msg := 'Please update the [RF_SERVICE_TYPE] attribute..';
    end if;    

    if serv_type IN ('ADSL') then
    
           sert := servicetypeslist (serv_type);

        open c_get_sero_attr('SA_PSTN_NUMBER');
        fetch c_get_sero_attr into existingnumber;
            IF c_get_sero_attr%NOTFOUND THEN
                  existingnumber := '';
            END IF;
        close c_get_sero_attr;

        if existingnumber is not null then
                
            inventorymanager.reservefacilityNGN (phonenumber,
                                        serviceaddress,
                                         sert,
                                         reserveid,
                                         serviceid,
                                         existingnumber,
                                         servicespeed,
                                         servicefeatures,
                                         portid,
                                         exchcode,
                                         outofarea,
                                         exchlocn,
                                         exchtype,
                                         exchindex,
                                         ippool,
                                         dslamdist,
                                         returnstatus,
                                         entityType,
                                         entityID
                                        );

                if returnstatus.code <> 0 then

                 p_ret_msg := 'RF Failed. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;

                end if;

        else
            p_ret_msg := 'Please update the [SA_PSTN_NUMBER] attribute..';
        end if;
        
    elsif serv_type IN ('D-BIZ-DSL') then
        
        sert := servicetypeslist (serv_type);
        
        open c_get_sero_attr('PARALLEL SERVICE');
        fetch c_get_sero_attr into v_bizdsl_platform;
            IF c_get_sero_attr%NOTFOUND THEN
                  v_bizdsl_platform := '';
            END IF;
        close c_get_sero_attr;

        if v_bizdsl_platform = 'PSTN' then        
        
           open c_get_sero_attr('PSTN PHONE NUMBER');
           fetch c_get_sero_attr into existingnumber;
           IF c_get_sero_attr%NOTFOUND THEN
                  existingnumber := '';
           END IF;
           close c_get_sero_attr;

           if existingnumber is not null then
                
                inventorymanager.reservefacilityNGN (phonenumber,
                                        serviceaddress,
                                         sert,
                                         reserveid,
                                         serviceid,
                                         existingnumber,
                                         servicespeed,
                                         servicefeatures,
                                         portid,
                                         exchcode,
                                         outofarea,
                                         exchlocn,
                                         exchtype,
                                         exchindex,
                                         ippool,
                                         dslamdist,
                                         returnstatus,
                                         entityType,
                                         entityID
                                        );

                if returnstatus.code <> 0 then

                 p_ret_msg := 'RF Failed. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;

                end if;

            else
                p_ret_msg := 'Please update the [PSTN PHONE NUMBER] attribute..';
            end if;
        else
        
            inventorymanager.reservefacilityNGN (phonenumber,
                                        serviceaddress,
                                         sert,
                                         reserveid,
                                         serviceid,
                                         existingnumber,
                                         servicespeed,
                                         servicefeatures,
                                         portid,
                                         exchcode,
                                         outofarea,
                                         exchlocn,
                                         exchtype,
                                         exchindex,
                                         ippool,
                                         dslamdist,
                                         returnstatus,
                                         entityType,
                                         entityID
                                        );

            if returnstatus.code <> 0 then

                 p_ret_msg := 'RF Failed. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;

            end if;
    
        end if;        
        
    elsif serv_type IN ('PSTN','ISDN','D-ILL','D-P2P','D-VPLS ACCESS LINK','D-IPVPN VIRT ACCESS','PABX','WIMAX','CCB','D-RVPN','D-IPLC','D-DIDO','D-IPVPN','PSTN,ADSL','PSTN,D-BIZ-DSL') then
        
        if serv_type in ('PSTN,ADSL') then        
               sert := servicetypeslist ('PSTN','ADSL');
        elsif serv_type in ('PSTN,D-BIZ-DSL') then        
               sert := servicetypeslist ('PSTN','D-BIZ-DSL');        
        else
            sert := servicetypeslist (serv_type);
        end if;
        
        if serv_type IN ('D-ILL','D-P2P','D-VPLS ACCESS LINK','D-IPVPN VIRT ACCESS','WIMAX','D-IPLC','D-DIDO','D-IPVPN') then
               open c_get_sero_attr('LAST_MILE_ACCESS');
            fetch c_get_sero_attr into v_lastmile_access;
            IF c_get_sero_attr%NOTFOUND THEN
                  v_lastmile_access := '';
            END IF;
            close c_get_sero_attr;
            
            if v_lastmile_access <> 'COPPER' then
               is_to_call_RF := 'N';
            end if;            
        end if;
        
        if is_to_call_RF = 'Y' then
            
            open c_get_sero_attr('SA_NEW_DP_ADDED (Y/N)?');
            fetch c_get_sero_attr into New_DP_Added;
            IF c_get_sero_attr%NOTFOUND THEN
                  New_DP_Added := 'N';
            END IF;
            close c_get_sero_attr;

            if upper(New_DP_Added) = 'Y' then
        
                open c_get_sero_attr('SA_NEW_DP_LOCATION_CODE');
                fetch c_get_sero_attr into New_DP_loc;
                IF c_get_sero_attr%NOTFOUND THEN
                      New_DP_loc := '';
                END IF;
                close c_get_sero_attr;
            
                if New_DP_loc is not null then
            
                    open c_get_sero_attr('SA_NEW_DP_INDEX');
                    fetch c_get_sero_attr into New_DP_index;
                    IF c_get_sero_attr%NOTFOUND THEN
                          New_DP_index := '';
                    END IF;
                    close c_get_sero_attr;

                    if New_DP_index is not null then
                
                        open c_get_frac_id(New_DP_loc, New_DP_index);
                        fetch c_get_frac_id into new_DP_frac_id;
                        IF c_get_frac_id%NOTFOUND THEN
                              new_DP_frac_id := NULL;
                        END IF;
                        close c_get_frac_id;

                        if new_DP_frac_id is null then
                           p_ret_msg := 'Unable to find the new DP using specified new DP location details. Please provide the correct details.';
                        else

                            open c_get_add_servbility(new_DP_frac_id, addeid);
                            fetch c_get_add_servbility into add_servbility;
                            IF c_get_add_servbility%NOTFOUND THEN
                                  add_servbility := '';
                            END IF;
                            close c_get_add_servbility;
        
                            if add_servbility is null then
                               insert into ADDRESS_SERVICEABILITY Values (new_DP_frac_id, addeid, 1, 0,NULL);
                            end if;

                            open c_get_next_free_FA(new_DP_frac_id);
                            fetch c_get_next_free_FA into next_fraa_id;
                            IF c_get_next_free_FA%NOTFOUND THEN
                                  next_fraa_id := '';
                            END IF;
                            close c_get_next_free_FA;

                            if next_fraa_id is null then
                                  p_ret_msg := 'Unable to find the free frame apperance on the specified new DP. Please provide the correct details.';
                            else

                                inventorymanager.reservefacilityNGN (phonenumber,
                                                   serviceaddress,
                                                 sert,
                                                 reserveid,
                                                 serviceid,
                                                 existingnumber,
                                                 servicespeed,
                                                 servicefeatures,
                                                 portid,
                                                 exchcode,
                                                 outofarea,
                                                 exchlocn,
                                                 exchtype,
                                                 exchindex,
                                                 ippool,
                                                 dslamdist,
                                                 returnstatus,
                                                 'FRAME APPEARANCE',
                                                 next_fraa_id
                                                );

                                if returnstatus.code <> 0 then

                                    p_ret_msg := 'RF Failed. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;

                                end if;
                            end if;

                        end if;
                
                    else
                        p_ret_msg := 'Please update the new DP index with [SA_NEW_DP_INDEX] attribute..';
                    end if;
                else
                    p_ret_msg := 'Please update the new DP location code with [SA_NEW_DP_LOCATION_CODE] attribute..';            

                end if;
                    
            else

                open c_get_sero_attr('SA_NEIGHBOURS_PHONE_NUMBER');
                fetch c_get_sero_attr into Neib_phnNumber;
                IF c_get_sero_attr%NOTFOUND THEN
                      Neib_phnNumber := '';
                END IF;
                close c_get_sero_attr;

                if Neib_phnNumber is not null then

                    inventoryManager.getStartingPointByNeighboursNo(Neib_phnNumber, entityType, entityID, returnStatus);

                    DBMS_OUTPUT.PUT_LINE('RF Failed 1. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg);
                    
                    if returnstatus.code <> 0 then
                       DBMS_OUTPUT.PUT_LINE('RF Failed 2. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg);
                        p_ret_msg := 'Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;
                    else
                
                        inventorymanager.reservefacilityNGN (phonenumber,
                                                   serviceaddress,
                                                 sert,
                                                 reserveid,
                                                 serviceid,
                                                 existingnumber,
                                                 servicespeed,
                                                 servicefeatures,
                                                 portid,
                                                 exchcode,
                                                 outofarea,
                                                 exchlocn,
                                                 exchtype,
                                                 exchindex,
                                                 ippool,
                                                 dslamdist,
                                                 returnstatus,
                                                 entityType,
                                                 entityID
                                                );

                        if returnstatus.code <> 0 then

                            p_ret_msg := 'RF Failed 3. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg;

                           DBMS_OUTPUT.PUT_LINE('RF Failed 3. Erro Code:' || TO_CHAR (returnstatus.code) || ' Msg:' || returnstatus.msg);
                                
                        end if;

                    end if;
                else
                    p_ret_msg := 'Please update the [SA_NEIGHBOURS_PHONE_NUMBER] attribute..';
                end if;
            end if;
        end if;
    end if;


EXCEPTION
    WHEN OTHERS THEN
      p_ret_msg  := 'RF Failed. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END Call_RF_reservefacilityNGN;
-- 04-05-2011 Gihan Amarasinghe


-- 15-03-2012 Samankula Owitipana

PROCEDURE IPLC_INT_SET_DATACCT_ID (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


v_data_cct varchar2(100);


BEGIN


select soa.SEOA_DEFAULTVALUE
into v_data_cct
from service_order_attributes soa
where soa.SEOA_NAME = 'DATA CIRCUIT ID'
and soa.SEOA_SERO_ID = p_sero_id;



UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE =  v_data_cct || '-INT'
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'DATA CIRCUIT ID' ;




p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');


EXCEPTION
WHEN OTHERS THEN

      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

      p_ret_msg  := 'Failed to set DATA CIRCUIT ID ATTRIBUTE. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
          SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
          , p_ret_msg || v_data_cct);

END IPLC_INT_SET_DATACCT_ID;

-- 15-03-2012 Samankula Owitipana


-- 26-03-2012 Samankula Owitipana

PROCEDURE CDMA_MOD_LOCATION_DSP (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS




BEGIN


UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = to_char(sysdate, 'DD-MON-YYYY HH24:MI')
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;


p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to set ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');


    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);


END CDMA_MOD_LOCATION_DSP;


-- 26-03-2012 Samankula Owitipana


-- 31-05-2012 Samankula Owitipana

PROCEDURE SPLIT_CHARGE_SET_DSP (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      
v_cct_id   varchar2(100);
v_dsp_date varchar2(100);
v_cr_no       varchar2(100);
v_split_so_id varchar2(100);
cursor c_split_so_id is
select so.SERO_ID 
from circuits ci,service_orders so 
where ci.CIRT_DISPLAYNAME = 'SPLIT-' || v_cct_id
and ci.CIRT_CUSR_ABBREVIATION = v_cr_no
and ci.CIRT_SERV_ID = so.SERO_SERV_ID
and so.SERO_STAS_ABBREVIATION = 'PROPOSED';       
BEGIN
 p_dynamic_extension.chk_ACTUAL_DSP_BILL_NOTIFY_DT(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);
IF p_ret_msg is null THEN    
SELECT upper(soa.seoa_defaultvalue) 
INTO v_cct_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'DATA CIRCUIT ID';
SELECT upper(soa.seoa_defaultvalue) 
INTO v_dsp_date
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACTUAL_DSP_DATE';
SELECT so.SERO_CUSR_ABBREVIATION
INTO v_cr_no
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;
open c_split_so_id;
fetch c_split_so_id into v_split_so_id;
close c_split_so_id;
IF v_split_so_id is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_date
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = v_split_so_id;
update SERVICE_IMPLEMENTATION_TASKS sit
set sit.SEIT_STAS_ABBREVIATION = 'COMPLETED',sit.SEIT_ACTUAL_END_DATE = sysdate
where sit.SEIT_SERO_ID = v_split_so_id
and sit.SEIT_TASKNAME = 'SET DSP DATE'
and sit.SEIT_STAS_ABBREVIATION = 'INPROGRESS';
END IF;ELSE
p_ret_msg := p_ret_msg;
END IF;
p_ret_msg  := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to update ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END SPLIT_CHARGE_SET_DSP;

-- 31-05-2012 Samankula Owitipana


-- 12-06-2012 Samankula Owitipana
PROCEDURE TRANSFER_AC_DSP_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      
v_dsp_val varchar2(50);      
cursor c_transfer_date_id is      
select to_char(to_date(soa.SEOA_DEFAULTVALUE ,'YYYY-MM-DD'),'DD-MON-YYYY') 
from service_order_attributes soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'TANSFER DATE';
BEGIN
open c_transfer_date_id;
fetch c_transfer_date_id into v_dsp_val;
close c_transfer_date_id;
IF v_dsp_val is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_val || ' 00:00'
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = NULL
WHERE SA.SEOA_NAME = 'TANSFER DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END TRANSFER_AC_DSP_SET;
-- 12-06-2012 Samankula Owitipana


-- 25-05-2012 Samankula Owitipana
PROCEDURE NON_DIALUP_SET_SERVICE_IDENTIY (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      
v_domain_name      varchar2(50);      
cursor c_domain_name_id is      
SELECT soa.seoa_defaultvalue 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DOMAIN_NAME';BEGIN
open c_domain_name_id;
fetch c_domain_name_id into v_domain_name;
close c_domain_name_id;
IF v_domain_name is not null THEN
UPDATE service_orders so
set so.SERO_SERV_DISPLAYNAME = v_domain_name ||'-' || replace(so.SERO_SERT_ABBREVIATION,'I-','')
where so.SERO_ID = p_sero_id;END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set service identifier. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END NON_DIALUP_SET_SERVICE_IDENTIY;
-- 25-05-2012 Samankula Owitipana


-- 21-06-2012 Samankula Owitipana
PROCEDURE IPLC_LOCAL_SO_TSK_COMPLETE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      
v_cct_id   varchar2(100);
v_local_so_id varchar2(100);
cursor c_local_so_id is
select so.SERO_ID 
from circuits ci,service_orders so 
where (ci.CIRT_DISPLAYNAME = v_cct_id or ci.CIRT_DISPLAYNAME like v_cct_id || '(N)')
and ci.CIRT_NAME = so.SERO_CIRT_NAME
and so.SERO_STAS_ABBREVIATION like 'A%';        
BEGIN 
SELECT replace(upper(soa.seoa_defaultvalue),'-INT','') 
INTO v_cct_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'DATA CIRCUIT ID';
open c_local_so_id;
fetch c_local_so_id into v_local_so_id;
close c_local_so_id;
IF v_local_so_id is not null THEN
update SERVICE_IMPLEMENTATION_TASKS sit
set sit.SEIT_STAS_ABBREVIATION = 'COMPLETED',sit.SEIT_ACTUAL_END_DATE = sysdate
where sit.SEIT_SERO_ID = v_local_so_id
and sit.SEIT_TASKNAME = 'ADD BSS INTL PROD'
and sit.SEIT_STAS_ABBREVIATION = 'INPROGRESS';
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to COMPLETED the ADD BSS INTL PROD task in local circuit. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END IPLC_LOCAL_SO_TSK_COMPLETE;
-- 21-06-2012 Samankula Owitipana


-- 22-06-2012 Samankula Owitipana
PROCEDURE PSTN_FACILITY_ADSL_TSK_CLOSE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_crm_order_id      varchar2(100);
v_adsl_so_id         varchar2(100);
cursor c_adsl_so_id is
select so.SERO_ID 
from service_orders so 
where so.SERO_OEID like v_crm_order_id || '-%'
and so.SERO_SERT_ABBREVIATION = 'ADSL'
and so.SERO_STAS_ABBREVIATION = 'PROPOSED';       
BEGIN
    
SELECT substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1)
INTO v_crm_order_id
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;
open c_adsl_so_id;
fetch c_adsl_so_id into v_adsl_so_id;
close c_adsl_so_id;
IF v_adsl_so_id is not null THEN
update SERVICE_IMPLEMENTATION_TASKS sit
set sit.SEIT_STAS_ABBREVIATION = 'COMPLETED',sit.SEIT_ACTUAL_END_DATE = sysdate
where sit.SEIT_SERO_ID = v_adsl_so_id
and sit.SEIT_TASKNAME = 'WAIT FOR FACILITY'
and sit.SEIT_STAS_ABBREVIATION = 'INPROGRESS';
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to update WAIT FOR FACILITY task in ADSL. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END PSTN_FACILITY_ADSL_TSK_CLOSE;
-- 22-06-2012 Samankula Owitipana


-- 26-06-2012 Samankula Owitipana
PROCEDURE SET_SERVICE_COMP_DATE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      
v_serv_comp_date date;      
cursor c_transfer_date_id is      
select to_date(soa.SEOA_DEFAULTVALUE ,'YYYY/MM/DD')
from service_order_attributes soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'SERVICE REQUIRED DATE';
BEGIN
open c_transfer_date_id;
fetch c_transfer_date_id into v_serv_comp_date;
close c_transfer_date_id;
IF v_serv_comp_date is not null THEN
UPDATE SERVICE_ORDERS SO
SET SO.SERO_COMPLETION_DATE = v_serv_comp_date
WHERE so.SERO_ID = p_sero_id;
/*update service_order_attributes soa
set soa.SEOA_DEFAULTVALUE = to_char(to_date(soa.SEOA_DEFAULTVALUE ,'YYYY/MM/DD'),'YYYY-MON-DD')
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'SERVICE REQUIRED DATE';*/
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set service completion date. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END SET_SERVICE_COMP_DATE;
-- 26-06-2012 Samankula Owitipana


-- 28-06-2012 Samankula Owitipana

PROCEDURE IPLC_DSP_TASK_CLOSE_FORIGN (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      
v_cct_id   varchar2(100);
v_dsp_date varchar2(100);
v_cr_no       varchar2(100);
v_forign_so_id varchar2(100);
cursor c_forign_so_id is
select so.SERO_ID 
from circuits ci,service_orders so 
where ci.CIRT_DISPLAYNAME like v_cct_id || '-INT%'
and ci.CIRT_SERV_ID = so.SERO_SERV_ID
and (so.SERO_STAS_ABBREVIATION like 'P%' or so.SERO_STAS_ABBREVIATION like 'A%');       
BEGIN
 p_dynamic_extension.chk_ACTUAL_DSP_BILL_NOTIFY_DT(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);
IF p_ret_msg is null THEN    
SELECT upper(soa.seoa_defaultvalue) 
INTO v_cct_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'DATA CIRCUIT ID';
SELECT upper(soa.seoa_defaultvalue) 
INTO v_dsp_date
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACTUAL_DSP_DATE';
SELECT so.SERO_CUSR_ABBREVIATION
INTO v_cr_no
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;
open c_forign_so_id;
fetch c_forign_so_id into v_forign_so_id;
close c_forign_so_id;
IF v_forign_so_id is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_date
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = v_forign_so_id;
update SERVICE_IMPLEMENTATION_TASKS sit
set sit.SEIT_STAS_ABBREVIATION = 'COMPLETED',sit.SEIT_ACTUAL_END_DATE = sysdate
where sit.SEIT_SERO_ID = v_forign_so_id
and sit.SEIT_TASKNAME = 'DSP FOR IPLC(INTL)'
and sit.SEIT_STAS_ABBREVIATION = 'INPROGRESS';
END IF;ELSE
p_ret_msg := p_ret_msg;
END IF;
p_ret_msg  := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to update ACTUAL_DSP_DATE and close the task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END IPLC_DSP_TASK_CLOSE_FORIGN;

-- 28-06-2012 Samankula Owitipana


-- 04-07-2012 Samankula Owitipana
PROCEDURE DSP_SYS_DATE_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

  
BEGIN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = to_char(sysdate,'DD-MON-YYYY HH24:MI')
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set ACTUAL_DSP_DATE attribute. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END DSP_SYS_DATE_SET;
-- 04-07-2012 Samankula Owitipana


-- 05-07-2012 Samankula Owitipana 

PROCEDURE  CONF_TESTLINK_WGCH_FUNCTION (

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                                     IN     Service_Orders.sero_id%TYPE,
      p_seit_id                                       IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                     IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                                    IN     work_order.woro_id%TYPE,
      p_ret_char                                   OUT    VARCHAR2,
      p_ret_number                            OUT    NUMBER,
      p_ret_msg                                    OUT    VARCHAR2) IS

v_sec_handel_by    VARCHAR2(100) := null;
v_rtom               VARCHAR2(100);
CURSOR seoa_cur IS
SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes
WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION HANDLED BY';
CURSOR c_rtom_area IS
select replace(ar.AREA_AREA_CODE,'R-','')
from service_orders so,areas ar
where so.SERO_AREA_CODE = ar.AREA_CODE
and so.SERO_ID = p_sero_id;
BEGIN
p_ret_char := '';
OPEN seoa_cur;
FETCH seoa_cur INTO v_sec_handel_by;
CLOSE seoa_cur;
OPEN c_rtom_area;
FETCH c_rtom_area INTO v_rtom;
CLOSE c_rtom_area;
IF v_sec_handel_by is null THEN
p_ret_char := 'CORP-SSU';
ELSIF v_sec_handel_by = 'Regional Telecom Office' THEN
p_ret_char := v_rtom || '-RTOM';
ELSE
p_ret_char := v_sec_handel_by || '-ACCM';
END IF;p_ret_msg := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END CONF_TESTLINK_WGCH_FUNCTION;

-- 05-07-2012 Samankula Owitipana


-- 10-07-2012 Samankula Owitipana

PROCEDURE PSTN_SET_EXCODE_ALLOCATEDNUM (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

v_ex_code       numbers.NUMB_AREA_CODE%TYPE;      
CURSOR ex_code_select_cur  IS
SELECT distinct nu.NUMB_AREA_CODE
FROM NUMBERS NU
WHERE nu.NUMB_SERV_ID = p_serv_id
and nu.NUMB_NUMS_ID = 4;
BEGIN
OPEN ex_code_select_cur;
FETCH ex_code_select_cur INTO v_ex_code;
CLOSE ex_code_select_cur;
UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_ex_code
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'SA_EXCHANGE_CODE' 
and soa.SEOA_DEFAULTVALUE is null;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN

      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed to set Primary Number. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END PSTN_SET_EXCODE_ALLOCATEDNUM;

-- 10-07-2012 Samankula Owitipana

-- 13-07-2012 Samankula Owitipana

PROCEDURE IPLC_CLOSE_ADD_FORIGN_TSK (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      
v_cct_id   varchar2(100);
v_cr_no       varchar2(100);
v_forign_so_id varchar2(100);
cursor c_forign_so_id is
select so.SERO_ID 
from circuits ci,service_orders so 
where ci.CIRT_DISPLAYNAME like v_cct_id || '-INT%'
and ci.CIRT_SERV_ID = so.SERO_SERV_ID
and (so.SERO_STAS_ABBREVIATION like 'P%' or so.SERO_STAS_ABBREVIATION like 'A%');       
BEGIN
SELECT upper(soa.seoa_defaultvalue) 
INTO v_cct_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'DATA CIRCUIT ID';
SELECT so.SERO_CUSR_ABBREVIATION
INTO v_cr_no
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;
open c_forign_so_id;
fetch c_forign_so_id into v_forign_so_id;
close c_forign_so_id;
IF v_forign_so_id is not null THEN
update SERVICE_IMPLEMENTATION_TASKS sit
set sit.SEIT_STAS_ABBREVIATION = 'COMPLETED',sit.SEIT_ACTUAL_END_DATE = sysdate
where sit.SEIT_SERO_ID = p_sero_id 
and sit.SEIT_TASKNAME = 'ADD BSS INTL PROD'
and (sit.SEIT_STAS_ABBREVIATION = 'INPROGRESS' or  sit.SEIT_STAS_ABBREVIATION = 'ASSIGNED');
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to COMPLETED the ADD BSS INTL PROD task. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END IPLC_CLOSE_ADD_FORIGN_TSK;

-- 13-07-2012 Samankula Owitipana


-- 13-07-2012 Samankula Owitipana
PROCEDURE SET_NULL_SERVICE_COMP_DATE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

      

BEGIN
update service_order_attributes soa
set soa.SEOA_DEFAULTVALUE = null
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'SERVICE REQUIRED DATE';
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set null the SERVICE REQUIRED DATE. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END SET_NULL_SERVICE_COMP_DATE;
-- 13-07-2012 Samankula Owitipana


-- 08-10-2009 Samankula Owitipana

PROCEDURE VMS_MAILBOX_SIZE_AUTO (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR acc_select_cur  IS
SELECT NVL(SOA.SEOA_DEFAULTVALUE,0) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'NB_OF_MAILBOXES';


CURSOR addcap_select_cur  IS
SELECT NVL(SOA.SEOA_DEFAULTVALUE,0) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ADDITIONAL MAILBOX CAPACITY';

CURSOR action_select_cur  IS
SELECT NVL(SOA.SEOA_DEFAULTVALUE,0) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'MODIFICATION ACTION';


v_NB_MAILBOXES VARCHAR2(10);
v_ADD_MAILBOX_CAP VARCHAR2(10);
v_FREE_MAILBOX_SIZE VARCHAR2(10);
v_TOT_MAILBOX_SIZE VARCHAR2(10);
v_MOD_ACTION VARCHAR2(30);





BEGIN

OPEN acc_select_cur;
FETCH acc_select_cur INTO v_NB_MAILBOXES;
CLOSE acc_select_cur;

OPEN addcap_select_cur;
FETCH addcap_select_cur INTO v_ADD_MAILBOX_CAP;
CLOSE addcap_select_cur;


OPEN action_select_cur;
FETCH action_select_cur INTO v_MOD_ACTION;
CLOSE action_select_cur;





v_FREE_MAILBOX_SIZE := v_NB_MAILBOXES * 10;




IF v_MOD_ACTION = 'INCREASE' THEN

v_TOT_MAILBOX_SIZE := v_FREE_MAILBOX_SIZE + v_ADD_MAILBOX_CAP;

ELSIF v_MOD_ACTION = 'DECREASE' THEN

v_TOT_MAILBOX_SIZE := v_FREE_MAILBOX_SIZE + v_ADD_MAILBOX_CAP;

END IF;






UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET SOA.SEOA_DEFAULTVALUE = v_FREE_MAILBOX_SIZE
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'FREE MAILBOX SIZE';


UPDATE SERVICE_ORDER_ATTRIBUTES SOA
SET SOA.SEOA_DEFAULTVALUE = v_TOT_MAILBOX_SIZE
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'TOTAL MAILBOX SIZE';





p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to set free and total mailbox size. Please check the attributes:NB_OF_MAILBOXES, ADDNL MAILBOX CAPCITY' || v_NB_MAILBOXES || ',' || v_ADD_MAILBOX_CAP || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg );


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');


END VMS_MAILBOX_SIZE_AUTO;

-- 08-10-2009 Samankula Owitipana

-- 24-07-2012 Samankula Owitipana

PROCEDURE  APPROVE_SO_WGCH_FUNCTION (

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                                     IN     Service_Orders.sero_id%TYPE,
      p_seit_id                                       IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                     IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                                    IN     work_order.woro_id%TYPE,
      p_ret_char                                   OUT    VARCHAR2,
      p_ret_number                            OUT    NUMBER,
      p_ret_msg                                    OUT    VARCHAR2) IS

v_sec_handel_by    VARCHAR2(100) := null;
v_rtom               VARCHAR2(100);
CURSOR seoa_cur IS
SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes
WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION HANDLED BY';
CURSOR c_rtom_area IS
select replace(ar.AREA_AREA_CODE,'R-','')
from service_orders so,areas ar
where so.SERO_AREA_CODE = ar.AREA_CODE
and so.SERO_ID = p_sero_id;
BEGIN
p_ret_char := '';
OPEN seoa_cur;
FETCH seoa_cur INTO v_sec_handel_by;
CLOSE seoa_cur;
OPEN c_rtom_area;
FETCH c_rtom_area INTO v_rtom;
CLOSE c_rtom_area;
IF v_sec_handel_by is null THEN
p_ret_char := 'CORP-SSU';
ELSIF v_sec_handel_by like '%SME%' THEN
p_ret_char := v_sec_handel_by || '-PSM';
ELSIF v_sec_handel_by = 'Regional Telecom Office' THEN
p_ret_char := v_rtom || '-RTOM';
ELSE
p_ret_char := v_sec_handel_by || '-MGR';
END IF;p_ret_msg := '';
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END APPROVE_SO_WGCH_FUNCTION;

-- 24-07-2012 Samankula Owitipana


-- 04-08-2012 Samankula Owitipana
PROCEDURE MIDC_ACTIVE_TERMINATE_DATE (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      
v_dsp_val            varchar2(100);
cursor c_transfer_date_id is      
select to_char(to_date(soa.SEOA_DEFAULTVALUE ,'YYYY-MM-DD'),'DD-MON-YYYY') 
from service_order_attributes soa
where soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_NAME = 'MIDC ACTIVATE/TERMINATE DATE';  
BEGIN
open c_transfer_date_id;
fetch c_transfer_date_id into v_dsp_val;
close c_transfer_date_id;
IF v_dsp_val is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_val || ' 00:01'
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to update DSP date. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END MIDC_ACTIVE_TERMINATE_DATE;
-- 04-08-2012 Samankula Owitipana

-- 22-06-2012 Samankula Owitipana

PROCEDURE MS_BIZA_DSP_NULL_CHK_PROVISION (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

    
v_service_cat varchar2(50);  
v_dsp_date    varchar2(50);  
cursor c_so_service_cat is    
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
   CURSOR sero_cur IS    
   SELECT sero_ordt_type
   FROM service_orders
   WHERE sero_id = p_sero_id;
   CURSOR sofe_cur IS
   SELECT sofe_feature_name, sofe_defaultvalue, sofe_prev_value, SOFE_PROVISION_STATUS
   FROM service_order_features
   WHERE sofe_sero_id = p_sero_id
   and (sofe_defaultvalue = 'Y' and sofe_prev_value is null or
   sofe_defaultvalue <> sofe_prev_value)
   AND NVL(sofe_provision_status,'N') = 'N';
   sero_rec            sero_cur%ROWTYPE;
   l_count            NUMBER := 0;
   l_unprovisioned_features    VARCHAR2(2000);
BEGIN
open c_so_service_cat;
fetch c_so_service_cat into v_service_cat;
close c_so_service_cat;
IF v_service_cat = 'TEST' THEN
SELECT upper(soa.seoa_defaultvalue) 
INTO v_dsp_date
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACTUAL_DSP_DATE';
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_date
WHERE SA.SEOA_NAME = 'TEST_SERVICE_DSP'
AND SA.SEOA_SERO_ID = p_sero_id;
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = null
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;p_ret_msg := '';
OPEN sero_cur;
FETCH sero_cur INTO sero_rec;
CLOSE sero_cur;
FOR sofe_rec  IN sofe_cur LOOP
IF sofe_rec.sofe_feature_name is not null THEN
      l_unprovisioned_features := l_unprovisioned_features || '   ' || sofe_rec.sofe_feature_name;
END IF;       
END LOOP;
IF  l_unprovisioned_features IS NOT NULL THEN 
p_ret_char := 'Some of the requested features are not yet provisioned. ' || SUBSTR(l_unprovisioned_features,1,100) || '...' ;                                      
END IF;
EXCEPTION
WHEN OTHERS THEN
      p_ret_msg  := 'Failed to Blank ACTUAL_DSP_DATE attribute or check_features_provisioned '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END MS_BIZA_DSP_NULL_CHK_PROVISION;

-- 22-06-2012 Samankula Owitipana

--- 15-12-2010  Samankula Owitipana


PROCEDURE DNR_ISSUE_INVOICE_WGCH(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR so_initiator_cur IS
SELECT SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'SA_SO_INITIATOR';


v_so_initiator VARCHAR2(20);


BEGIN



OPEN so_initiator_cur;
FETCH so_initiator_cur INTO v_so_initiator;
CLOSE so_initiator_cur;

         IF v_so_initiator = 'GENEVA_ADMIN' THEN

         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'CORP-SSU'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'ISSUE INVOICE' ;


         END IF;

p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to change WG. Please check SA_SO_INITIATOR attribute :' || v_so_initiator || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');


    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);


END DNR_ISSUE_INVOICE_WGCH;


--- 15-12-2010  Samankula Owitipana


--- 15-12-2010  Samankula Owitipana


PROCEDURE DNR_DOMAIN_EXP_SET(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS


CURSOR domain_exp_cur IS
SELECT TO_CHAR(TO_DATE(SUBSTR(trim(SOA.SEOA_DEFAULTVALUE),1,11),'DD-MON-YYYY')+364,'MM/DD/YYYY')
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ACTUAL_DSP_DATE';


CURSOR ren_reminder_cur IS
SELECT TO_CHAR(TO_DATE(SUBSTR(trim(SOA.SEOA_DEFAULTVALUE),1,11),'DD-MON-YYYY')+304,'MM/DD/YYYY')
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'ACTUAL_DSP_DATE';

v_domain_exp VARCHAR2(20);
v_ren_reminder VARCHAR2(20);

BEGIN



OPEN domain_exp_cur;
FETCH domain_exp_cur INTO v_domain_exp;
CLOSE domain_exp_cur;

OPEN ren_reminder_cur;
FETCH ren_reminder_cur INTO v_ren_reminder;
CLOSE ren_reminder_cur;


UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_domain_exp
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'DOMAIN EXPIRY DATE' ;

UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_ren_reminder
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'RENEWAL REMINDER DATE' ;


p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Failed to set Domain Expiry Date and Renewal Reminder Date . Please check ACTUAL_DSP_DATE attribute : - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;


    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');


    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);


END DNR_DOMAIN_EXP_SET;


--- 15-12-2010  Samankula Owitipana


--- 22-08-2012  Samankula Owitipana
PROCEDURE PSTN_MODFEATURE_PARASO_UPDATE(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
   
CURSOR sero_cur IS    
select so.SERO_ID 
from service_orders so        
where so.SERO_SERV_ID = p_serv_id
and so.SERO_ORDT_TYPE = 'MODIFY-LOCATION'   
and (so.SERO_STAS_ABBREVIATION = 'PROPOSED' or so.SERO_STAS_ABBREVIATION = 'APPROVED');
   CURSOR sofe_cur IS
   SELECT sofe_feature_name, sofe_defaultvalue, sofe_prev_value, SOFE_PROVISION_STATUS
   FROM service_order_features
   WHERE sofe_sero_id = p_sero_id
   AND nvl(sofe_defaultvalue,'N') <> nvl(sofe_prev_value ,'N') 
   AND NVL(sofe_provision_status,'N') = 'Y';
   v_sero_id           service_orders.SERO_ID%TYPE;
   l_count            NUMBER := 0;
   l_unprovisioned_features    VARCHAR2(2000);
BEGIN OPEN sero_cur;
FETCH sero_cur INTO v_sero_id;
CLOSE sero_cur;
FOR sofe_rec  IN sofe_cur LOOP
IF sofe_rec.sofe_feature_name is not null THEN
update service_order_features sof
set sof.SOFE_DEFAULTVALUE = sofe_rec.sofe_defaultvalue,sof.SOFE_PREV_VALUE = sofe_rec.sofe_prev_value
where sof.SOFE_FEATURE_NAME = sofe_rec.sofe_feature_name
and sof.SOFE_SERO_ID = v_sero_id; 
END IF;END LOOP;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');       
EXCEPTION
WHEN OTHERS THEN 
p_ret_msg := 'Parallel service order feature updation failed.' || ' - Erro is:'|| TO_CHAR (SQLCODE) || '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text) VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);                                    
END PSTN_MODFEATURE_PARASO_UPDATE;

--- 22-08-2012  Samankula Owitipana


-- 07-09-2012 Samankula Owitipana

PROCEDURE DIDO_DATACCT_NUM_NULL_SERVID (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
BEGIN
update numbers nu set nu.NUMB_SERV_ID = null, nu.NUMB_REMARK = p_serv_id
where nu.NUMB_SERV_ID = p_serv_id and nu.NUMB_NUMS_ID = 3;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION
WHEN OTHERS THEN
      p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
      p_ret_msg  := 'Failed set data cct number service id to null. - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
      SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
      , p_ret_msg);
END DIDO_DATACCT_NUM_NULL_SERVID;

-- 07-09-2012 Samankula Owitipana


--- 01-10-2012  Samankula Owitipana

PROCEDURE PSTN_MEGALINE_PKG_SET_OLD(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
CURSOR so_mega_pkg_cur IS
SELECT SOA.SEOA_DEFAULTVALUE
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'SA_MEGALINE_PACKAGE';
v_mega_pkg VARCHAR2(20);
BEGIN OPEN so_mega_pkg_cur;
FETCH so_mega_pkg_cur INTO v_mega_pkg;
CLOSE so_mega_pkg_cur;
IF v_mega_pkg is not null THEN
UPDATE service_order_attributes soa
SET SOA.SEOA_DEFAULTVALUE = v_mega_pkg
WHERE soa.SEOA_SERO_ID = p_sero_id
AND soa.SEOA_NAME = 'OLD_MEGALINE_PACKAGE';END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
EXCEPTION WHEN OTHERS THEN
p_ret_msg  := 'Failed to change WG. Please check SA_MEGALINE_PACKAGE attribute :' || v_mega_pkg || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE, p_ret_msg);
END PSTN_MEGALINE_PKG_SET_OLD;

--- 01-10-2012  Samankula Owitipana

--- 01-10-2012  Samankula Owitipana
PROCEDURE ASSOCIATE_CIRCUITS_MOD_LOC(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

   cursor curr_adsl_oeid is
    select so.SERO_OEID, substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1) from service_orders so
    where so.SERO_ID = p_sero_id;

 cursor curr_pstn_oeid (t_oeid_adsl_cust in varchar2) is
 select so.SERO_OEID from service_orders so
 where so.SERO_SERT_ABBREVIATION = 'PSTN'
 and so.SERO_ORDT_TYPE = 'MODIFY-LOCATION'
 and so.SERO_OEID like t_oeid_adsl_cust || '%';

v_oeid_adsl_org varchar2(50);
v_oeid_adsl_cust varchar2(50);
v_oeid_pstn_org varchar2(50);


BEGIN

 open curr_adsl_oeid;
 fetch curr_adsl_oeid into v_oeid_adsl_org, v_oeid_adsl_cust;
 close curr_adsl_oeid;

 open curr_pstn_oeid (v_oeid_adsl_cust);
 fetch curr_pstn_oeid into v_oeid_pstn_org;
     IF curr_pstn_oeid%NOTFOUND THEN
        v_oeid_pstn_org := v_oeid_adsl_org;
     END IF;
 close curr_pstn_oeid;

 update service_orders so
 set so.SERO_OEID = v_oeid_pstn_org
 where so.SERO_ID = p_sero_id;


 P_dynamic_procedure.Process_create_circuit(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);

 update service_orders so
 set so.SERO_OEID = v_oeid_adsl_org
 where so.SERO_ID = p_sero_id;

 IF p_ret_msg IS NULL THEN
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
 else
  p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
 end if;

EXCEPTION

WHEN OTHERS THEN

      p_ret_msg  := 'Failed to associate the ADSL circuit to the current Service Order:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

   p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

  INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
  SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
  , p_ret_msg);


END ASSOCIATE_CIRCUITS_MOD_LOC;
-- 15-10-2012 Saman Owitipana

--Updated by removing intermediate CANCELLED SO on 10-08-2015
--2012_07_19 Jayan Liyanage.Modified on 21-04-2014 by adding trim.ACCESS BEARER ID added on 27-10-2014
--.Modification error for other services corrected on 29-10-2014
PROCEDURE ATTRIBUTE_MAPPING (
   p_serv_id         IN     services.serv_id%TYPE,
   p_sero_id         IN     service_orders.sero_id%TYPE,
   p_seit_id         IN     service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN     implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN     work_order.woro_id%TYPE,
   p_ret_char           OUT VARCHAR2,
   p_ret_number         OUT NUMBER,
   p_ret_msg            OUT VARCHAR2)
IS


   v_actual_dsp_date    VARCHAR2 (100);
   bearer_id            VARCHAR2 (100);

   v_Cir_Status         VARCHAR2 (100);
   v_service_ord_type   VARCHAR2 (100);
   v_new_bearer_id      VARCHAR2 (100);
   v_new_service        VARCHAR2 (100);
   V_data_Cir_Id        VARCHAR2 (100);
   v_Service_od_id      VARCHAR2 (100);
   v_Cir_Stataus        VARCHAR2 (100);
   v_DSP_date           VARCHAR2 (100);
   v_Order_type         VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);

   CURSOR Cur_Delete_So (
      del_Cir_id VARCHAR2)
   IS
      SELECT DISTINCT soa.seoa_sero_id, c.cirt_status, soa.seoa_defaultvalue
        FROM service_orders so, service_order_attributes soa, circuits c
       WHERE     so.sero_id = soa.seoa_sero_id
             AND soa.seoa_name = 'ACTUAL_DSP_DATE'
             AND so.sero_cirt_name = c.cirt_name
             AND (    c.cirt_status <> 'CANCELLED'
                  AND c.cirt_status <> 'PENDINGDELETE')
             AND c.cirt_displayname = trim(del_Cir_id)
             AND SO.SERO_ORDT_TYPE <> 'MODIFY-ZERO PRICE'
             AND so.sero_stas_abbreviation <> 'CANCELLED'
             ---AND so.sero_ordt_type LIKE  'DELETE%'
             AND so.sero_datecreated IN
                    (SELECT MAX (s.sero_datecreated)
                       FROM service_orders s, circuits ci
                      WHERE     s.sero_cirt_name = ci.cirt_name
                            AND S.SERO_ORDT_TYPE <> 'MODIFY-ZERO PRICE'
                              AND s.sero_stas_abbreviation <> 'CANCELLED'
                            --and s.sero_ordt_type LIKE 'DELETE%'
                            AND ci.cirt_displayname = trim(del_Cir_id));

BEGIN
  

select distinct so.sero_sert_abbreviation into v_service_ord_type
from service_orders so where so.sero_id = p_sero_id;
  

if v_service_ord_type <> 'D-DAB' THEN
 SELECT DISTINCT soa.seoa_defaultvalue
     INTO V_data_Cir_Id
     FROM service_orders so, service_order_attributes soa
    WHERE     so.sero_id = soa.seoa_sero_id
          AND (   soa.seoa_name = 'DATA CIRCUIT ID'
               OR soa.seoa_name = 'REMOTE VPN DOMAIN NAME'
               OR soa.seoa_name = 'CIRCUIT ID')
          AND so.sero_id = p_sero_id;
          
 ELSIF v_service_type = 'D-DAB' THEN   
      SELECT DISTINCT soa.seoa_defaultvalue
     INTO V_data_Cir_Id
     FROM service_orders so, service_order_attributes soa
    WHERE     so.sero_id = soa.seoa_sero_id
          AND soa.seoa_name = 'ACCESS BEARER ID'
          AND so.sero_id = p_sero_id;
END IF;

   /*SELECT DISTINCT soa.seoa_defaultvalue
   INTO v_DSP_date FROM service_orders so, service_order_attributes soa
   WHERE so.sero_id = soa.seoa_sero_id
   AND soa.seoa_name = 'ACTUAL_DSP_DATE'
   AND so.sero_id = p_sero_id;*/

   /*SELECT DISTINCT so.sero_ordt_type
   INTO v_Order_type FROM service_orders so
   where so.sero_id = p_sero_id;
                 */

   OPEN Cur_Delete_So (V_data_Cir_Id);

   FETCH Cur_Delete_So
      INTO v_Service_od_id, v_Cir_Stataus, v_DSP_date;

   CLOSE Cur_Delete_So;



   UPDATE service_order_attributes soa
      SET soa.seoa_defaultvalue = v_DSP_date
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACTUAL_DSP_DATE';



   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Update DSP date  Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR');

      INSERT INTO service_task_comments (setc_seit_id,
                                         setc_id,
                                         setc_userid,
                                         setc_timestamp,
                                         setc_text)
           VALUES (p_seit_id,
                   setc_id_seq.NEXTVAL,
                   'CLARITYB',
                   SYSDATE,
                   p_ret_msg);
END ATTRIBUTE_MAPPING;

--2012_07_19 Jayan Liyanage


-- 11-07-2012 Samankula Owitipana
PROCEDURE ADSL_TRANSFER_SET_DSP (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS      

v_crm_order_id      varchar2(100);
v_pstn_so_id        varchar2(100);
v_dsp_val            varchar2(100);
cursor c_transfer_date_id is      
select to_char(to_date(soa.SEOA_DEFAULTVALUE ,'YYYY-MM-DD'),'DD-MON-YYYY') 
from service_order_attributes soa
where soa.SEOA_SERO_ID = v_pstn_so_id
and soa.SEOA_NAME = 'TANSFER DATE';  
BEGIN
SELECT substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1)
INTO v_crm_order_id
FROM service_orders so
WHERE so.SERO_ID = p_sero_id;
select so.SERO_ID 
into v_pstn_so_id
from service_orders so 
where so.SERO_OEID like v_crm_order_id || '-%'
and so.SERO_SERT_ABBREVIATION = 'PSTN';
open c_transfer_date_id;
fetch c_transfer_date_id into v_dsp_val;
close c_transfer_date_id;
IF v_dsp_val is not null THEN
UPDATE SERVICE_ORDER_ATTRIBUTES SA
SET SA.SEOA_DEFAULTVALUE = v_dsp_val || ' 00:01'
WHERE SA.SEOA_NAME = 'ACTUAL_DSP_DATE'
AND SA.SEOA_SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED'); 
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to update WAIT FOR FACILITY task in ADSL. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END ADSL_TRANSFER_SET_DSP;
-- 11-07-2012 Samankula Owitipana

-- 02-11-2012 Samankula Owitipana
PROCEDURE Call_RF_NGN_CHK_SUCCESS_Y (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS              
v_facility_success_val    varchar2(20);
v_facility_request_val   varchar2(20);  
v_new_dp_val  varchar2(20);    
CURSOR c_facility_success  IS SELECT upper(SOA.SEOA_DEFAULTVALUE)
FROM SERVICE_ORDER_ATTRIBUTES SOA WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'FACILITY SURVEY SUCCESS (Y/N)?'; CURSOR c_facility_request  IS
SELECT SOA.SEOA_DEFAULTVALUE FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'FACILITY SURVEY REQUIRED (Y/N)?';
CURSOR c_new_dp_added IS SELECT SOA.SEOA_DEFAULTVALUE FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'SA_NEW_DP_ADDED (Y/N)?';
BEGIN OPEN c_facility_success;
FETCH c_facility_success 
INTO v_facility_success_val;
CLOSE c_facility_success;
IF v_facility_success_val is null THEN
p_ret_msg  := 'Please fill FACILITY SURVEY SUCCESS (Y/N)? attribute';
ELSIF v_facility_success_val = 'Y' or v_facility_success_val = 'YES' THEN
P_SLT_FUNCTIONS_V2.Call_RF_reservefacilityNGN(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);                               
IF p_ret_msg is not null THEN p_ret_msg  := 'Failed' || p_ret_msg;
END IF;END IF; EXCEPTION
WHEN OTHERS THEN
      p_ret_msg  := 'Work order closing failed:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END Call_RF_NGN_CHK_SUCCESS_Y;
-- 02-11-2012 Samankula Owitipana

-- 08-11-2012 Samankula Owitipana

PROCEDURE IPTV_FEATURES_U2Y (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS  
cursor c_iptv_feature is      
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = 'IPTV';
cursor c_tstv_feature is
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = 'TSTV';
cursor c_vod_feature is
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = 'VIDEO ON DEMAND';


cursor c_ad_in_feature is
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE,sof.SOFE_PARENT_FEATURE_NAME
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = 'INTERNET';

cursor c_adsl_feature (T_f_name SERVICE_ORDER_FEATURES.sofe_feature_name%TYPE) IS
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = T_f_name;


cursor c_web_feature is
SELECT sof.SOFE_DEFAULTVALUE,sof.SOFE_PREV_VALUE
FROM SERVICE_ORDER_FEATURES sof
WHERE sof.sofe_sero_id= p_sero_id
AND sof.sofe_feature_name = 'WEB_GUARD';

v_ad_in_new VARCHAR2(25);
v_ad_in_old VARCHAR2(25);
v_ad_in_par VARCHAR2(25);
v_adsl_new VARCHAR2(25);
v_adsl_old VARCHAR2(25);
v_web_new VARCHAR2(25);
v_web_old VARCHAR2(25);

v_iptv_new VARCHAR2(25);
v_tstv_new VARCHAR2(25);
v_vod_new VARCHAR2(25);
v_iptv_old VARCHAR2(25);
v_tstv_old VARCHAR2(25);
v_vod_old VARCHAR2(25);

BEGIN
OPEN c_iptv_feature;FETCH c_iptv_feature INTO v_iptv_new,v_iptv_old;CLOSE c_iptv_feature;
OPEN c_tstv_feature;FETCH c_tstv_feature INTO v_tstv_new,v_tstv_old;CLOSE c_tstv_feature;
OPEN c_vod_feature;FETCH c_vod_feature INTO v_vod_new,v_vod_old;CLOSE c_vod_feature;

OPEN c_ad_in_feature;FETCH c_ad_in_feature INTO v_ad_in_new,v_ad_in_old,v_ad_in_par;CLOSE c_ad_in_feature;
OPEN c_adsl_feature (v_ad_in_par);FETCH c_adsl_feature INTO v_adsl_new,v_adsl_old;CLOSE c_adsl_feature;
OPEN c_web_feature ;FETCH c_web_feature INTO v_web_new,v_web_old;CLOSE c_web_feature;

    IF v_ad_in_new = 'U' and v_ad_in_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = 'INTERNET';
    END IF;

    IF v_adsl_new = 'U' and v_adsl_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = v_ad_in_par;
    END IF;

    IF v_web_new = 'U' and v_web_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = 'WEB_GUARD';
    END IF;

    IF v_iptv_new = 'U' and v_iptv_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = 'IPTV';
    END IF;
    
    IF v_tstv_new = 'U' and v_tstv_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = 'TSTV';
    END IF;
    
    IF v_vod_new = 'U' and v_vod_old = 'Y' THEN
    UPDATE SERVICE_ORDER_FEATURES sof
    SET sof.sofe_defaultvalue = 'Y'
    WHERE sof.sofe_sero_id= p_sero_id
    AND sof.sofe_feature_name = 'VIDEO ON DEMAND';
    END IF;
    
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');
    EXCEPTION WHEN OTHERS THEN
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
    p_ret_msg  := 'Failed to Set Y :' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE, p_ret_msg );
END IPTV_FEATURES_U2Y;


-- 08-11-2012 Samankula Owitipana

-- 02-11-2012 Samankula Owitipana
PROCEDURE Call_RF_NGN_CHK_SUCCESS_Y_KS (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

v_cct_id circuits.CIRT_NAME%TYPE;
v_bearer_cct_id circuits.CIRT_NAME%TYPE;
v_adsl_cct_id circuits.CIRT_NAME%TYPE;

v_pl_id_10 port_links.PORL_ID%TYPE;
v_pl_id_20 port_links.PORL_ID%TYPE;
v_pl_id_30 port_links.PORL_ID%TYPE;
v_pl_id_40 port_links.PORL_ID%TYPE;
v_pl_id_50 port_links.PORL_ID%TYPE;
v_pl_id_60 port_links.PORL_ID%TYPE;

v_DP_LOC_CHK FRAME_CONTAINERS.FRAC_FRAN_NAME%TYPE;
v_DP_FC_ID FRAME_CONTAINERS.FRAC_ID%TYPE;

v_DP_FA_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_DP_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_DP_CACE_ID FRAME_APPEARANCES.FRAA_CACE_ID%TYPE;
v_DP_FA_ID_F FRAME_APPEARANCES.FRAA_ID%TYPE;

v_CABD_FA_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_CABD_FC_ID FRAME_CONTAINERS.FRAC_ID%TYPE;
v_CHK_DFA FRAME_CONTAINERS.FRAC_FRAN_NAME%TYPE;
v_CABD_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_CABD_FA_ID_F FRAME_APPEARANCES.FRAA_ID%TYPE;

v_CABE_FA_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_CABE_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_CABE_CACE_ID FRAME_APPEARANCES.FRAA_CACE_ID%TYPE;
v_CABE_FA_ID_F FRAME_APPEARANCES.FRAA_ID%TYPE;

v_MDF_UG_FA_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_MDF_UG_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_MDF_UG_FA_ID_F FRAME_APPEARANCES.FRAA_ID%TYPE;

v_PORT_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_PORT_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_PORT_CACE_ID FRAME_APPEARANCES.FRAA_CACE_ID%TYPE;

v_MDF_EX_FA_ID FRAME_APPEARANCES.FRAA_ID%TYPE;
v_MDF_EX_PHY_ID FRAME_APPEARANCES.FRAA_PHYC_ID%TYPE;
v_MDF_EX_FA_ID_F FRAME_APPEARANCES.FRAA_ID%TYPE;

-----------------------------------------------------------------------      
v_facility_success_val  SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
v_nwe_dp_location      SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;  
v_new_dp_index          SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
v_switch_location      SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
v_switch_index          SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;   
v_rf_type        SERVICE_ORDER_ATTRIBUTES.SEOA_DEFAULTVALUE%TYPE;
v_equip_id        EQUIPMENT.EQUP_ID%TYPE;
v_equip_type       EQUIPMENT.EQUP_EQUT_ABBREVIATION%TYPE;
v_card_model      CARDS.CARD_MODEL%TYPE;
v_pstn_dis_name      CIRCUITS.CIRT_DISPLAYNAME%TYPE;
v_adsl_dis_name      CIRCUITS.CIRT_DISPLAYNAME%TYPE;
v_POTS_CABC_ID      CABLE_CORE_ENDS.CACE_CABC_ID%TYPE;

v_POTS_FRAA_ID_REAR    FRAME_APPEARANCES.FRAA_ID%TYPE;
v_POTS_FRAU_ID      FRAME_UNITS.FRAU_ID%TYPE;
v_POTS_FRAA_POSITION  FRAME_APPEARANCES.FRAA_POSITION%TYPE;
v_POTS_FRAA_ID_FRONT  FRAME_APPEARANCES.FRAA_ID%TYPE;




v_P_PHYC_ID        CABLE_CORE_ENDS.CACE_PHYC_ID%TYPE;
v_P_CACE_ID      CABLE_CORE_ENDS.CACE_ID%TYPE;
v_P_CABC_ID      CABLE_CORE_ENDS.CACE_CABC_ID%TYPE;
v_P_FRAA_ID_REAR  FRAME_APPEARANCES.FRAA_ID%TYPE;
v_P_FRAU_ID      FRAME_UNITS.FRAU_ID%TYPE;
v_P_FRAA_POSITION  FRAME_APPEARANCES.FRAA_POSITION%TYPE;
v_P_FRAA_ID_FRONT  FRAME_APPEARANCES.FRAA_ID%TYPE;




v_splitter_equip_id    EQUIPMENT.EQUP_ID%TYPE;
v_splitter_pot_out_id  PORTS.PORT_ID%TYPE;
v_splitter_dsl_in_id  PORTS.PORT_ID%TYPE;
v_splitter_pot_in_id  PORTS.PORT_ID%TYPE;
v_pstn_pots_out      PORTS.PORT_ID%TYPE;
v_adsl_dsl_in       PORTS.PORT_ID%TYPE;
v_splitter_index    varchar2(10);
v_pstn_cr        varchar2(30);
v_pstn_ac        varchar2(30);


v_oeid_pstn_cust varchar2(50);
v_oeid_pstn_org varchar2(50);
v_ordt_type  varchar2(50);
v_adsl_sero_id varchar2(50);
v_adsl_serv_id varchar2(50);
v_pstn_order_id varchar2(50);


cursor curr_adsl_oeid is
select substr(so.SERO_OEID,1,instr(so.SERO_OEID,'-')-1), sero_ordt_type,so.SERO_OEID 
from service_orders so
where so.SERO_ID = p_sero_id;

 cursor curr_pstn_oeid (t_oeid_pstn_cust in varchar2, t_ordt_type    varchar2) is
 select so.SERO_ID,so.SERO_SERV_ID 
 from service_orders so
 where so.SERO_id <> p_sero_id
 and so.SERO_ORDT_TYPE = t_ordt_type -- 'MODIFY-LOCATION'
 and so.SERO_OEID like t_oeid_pstn_cust || '%';
 
CURSOR c_facility_success  IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE))
FROM SERVICE_ORDER_ATTRIBUTES SOA WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'FACILITY SURVEY SUCCESS (Y/N)?'; 

CURSOR c_new_dp_location  IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'SA_NEW_DP_LOCATION_CODE';

CURSOR c_new_dp_index IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'SA_NEW_DP_INDEX';

CURSOR c_switch_location IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'SA_SWITCH_LOCATION_CODE';

CURSOR c_switch_index IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'SA_SWITCH_INDEX';

CURSOR c_rf_service_type IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id AND SOA.SEOA_NAME = 'RF_SERVICE_TYPE';

CURSOR c_adsl_dis_name IS SELECT trim(upper(SOA.SEOA_DEFAULTVALUE)) FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = v_adsl_sero_id AND SOA.SEOA_NAME = 'ADSL_CIRCUIT_ID';

cursor c_msan_sw_details IS
select eq.EQUP_ID,eq.EQUP_EQUT_ABBREVIATION
from equipment eq
where (eq.EQUP_EQUT_ABBREVIATION = 'NGN-MSAN' or eq.EQUP_EQUT_ABBREVIATION like 'MSAN-%')
and eq.EQUP_STATUS = 'INSERVICE'
and eq.EQUP_INDEX = v_switch_index
and eq.EQUP_LOCN_TTNAME = v_switch_location;


cursor c_splitter_index is
select lpad(nvl(max(eq.EQUP_INDEX),0)+1,3,'0')
from equipment eq
where eq.EQUP_EQUT_ABBREVIATION = 'DSL_SPLITTER'
and eq.EQUP_LOCN_TTNAME = v_nwe_dp_location
and eq.EQUP_INDEX not like '%-%';

------------------Check Location--------------------------------

    CURSOR c_chk_dp IS
    SELECT trim(fc.FRAC_ID)
    FROM FRAME_CONTAINERS fc
    WHERE fc.FRAC_FRAN_NAME = 'DP'
    and fc.FRAC_LOCN_TTNAME = v_nwe_dp_location
  and fc.FRAC_INDEX = v_new_dp_index
    AND fc.FRAC_STATUS = 'INSERVICE';

------------------Check DP--------------------------------

    CURSOR c_dp_data IS
    SELECT trim(fa.FRAA_ID),trim(fa.FRAA_PHYC_ID),trim(fa.FRAA_CACE_ID)
    FROM frame_units fu,FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fu.FRAU_ID = fa.FRAA_FRAU_ID
    AND fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fu.FRAU_FRAC_ID = v_DP_FC_ID
    AND fa.FRAA_SIDE = 'REAR'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;  
  
    
    CURSOR c_dp_data_f IS
    SELECT trim(fa.FRAA_ID)
    FROM FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fa.FRAA_PHYC_ID = v_DP_PHY_ID
    AND fa.FRAA_SIDE = 'FRONT'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;

------------------Check CAB D--------------------------------

    CURSOR c_chk_cab_d IS
    SELECT fa.FRAA_ID,fc.FRAC_ID,fc.FRAC_FRAN_NAME ,trim(fa.FRAA_PHYC_ID)
    FROM cable_core_ends cce,cable_core_ends cce2,FRAME_APPEARANCES fa,FRAME_UNITS fu,FRAME_CONTAINERS fc
    WHERE fa.FRAA_FRAU_ID = fu.FRAU_ID
    AND fu.FRAU_FRAC_ID = fc.FRAC_ID
    AND cce.CACE_PHYC_ID = v_DP_PHY_ID
    AND cce.CACE_ID = v_DP_CACE_ID
    AND cce.CACE_CABC_ID = cce2.CACE_CABC_ID
    AND cce2.CACE_PHYC_ID <> cce.CACE_PHYC_ID
    AND cce2.CACE_ID <> cce.CACE_ID
    AND cce2.CACE_PHYC_ID = fa.FRAA_PHYC_ID
    AND cce2.CACE_ID = fa.FRAA_CACE_ID
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL;


    CURSOR c_chk_cab_d_f IS
    SELECT trim(fa.FRAA_ID)
    FROM FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fa.FRAA_PHYC_ID = v_CABD_PHY_ID
    AND fa.FRAA_SIDE = 'FRONT'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;

------------------Check CAB E--------------------------------

    CURSOR c_chk_cab_e IS
    SELECT fa.FRAA_ID,fa.FRAA_PHYC_ID,fa.FRAA_CACE_ID
    FROM FRAME_APPEARANCES fa,FRAME_UNITS fu,FRAME_CONTAINERS fc,port_link_ports plp
    WHERE fa.FRAA_FRAU_ID = fu.FRAU_ID
    AND fu.FRAU_FRAC_ID = fc.FRAC_ID
    AND fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fc.FRAC_ID = v_CABD_FC_ID
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL
    AND fu.FRAU_NAME LIKE '%ESIDE%'
    AND fa.FRAA_SIDE = 'REAR';


    CURSOR c_chk_cab_e_f IS  
    SELECT trim(fa.FRAA_ID)
    FROM FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fa.FRAA_PHYC_ID = v_CABE_PHY_ID
    AND fa.FRAA_SIDE = 'FRONT'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;

------------------Check MDF UG--------------------------------

    CURSOR c_chk_mdf_ug IS
    SELECT fa.FRAA_ID,fa.FRAA_PHYC_ID
    FROM cable_core_ends cce,cable_core_ends cce2,FRAME_APPEARANCES fa,FRAME_UNITS fu,FRAME_CONTAINERS fc
    WHERE fa.FRAA_FRAU_ID = fu.FRAU_ID
    AND fu.FRAU_FRAC_ID = fc.FRAC_ID
    AND cce.CACE_PHYC_ID = v_CABE_PHY_ID
    AND cce.CACE_ID = v_CABE_CACE_ID
    AND cce.CACE_CABC_ID = cce2.CACE_CABC_ID
    AND cce2.CACE_PHYC_ID <> cce.CACE_PHYC_ID
    AND cce2.CACE_ID <> cce.CACE_ID
    AND cce2.CACE_PHYC_ID = fa.FRAA_PHYC_ID
    AND cce2.CACE_ID = fa.FRAA_CACE_ID
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL;


    CURSOR c_chk_mdf_ug_f IS
    SELECT trim(fa.FRAA_ID)
    FROM FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fa.FRAA_PHYC_ID = v_MDF_UG_PHY_ID
    AND fa.FRAA_SIDE = 'FRONT'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;


------------------Check Port--------------------------------

    CURSOR c_chk_port IS
    SELECT po.PORT_ID,po.PORT_PHYC_ID,po.PORT_CACE_ID,ca.CARD_MODEL
    FROM ports po,cards ca,port_link_ports plp
    WHERE po.PORT_EQUP_ID = ca.CARD_EQUP_ID
  and po.PORT_CARD_SLOT = ca.CARD_SLOT
  and po.PORT_ID = plp.POLP_PORT_ID(+)
    AND po.PORT_EQUP_ID = v_equip_id
    AND po.PORT_NAME like 'POTS-IN%'
    AND po.PORT_STATUS = 'INSERVICE'
  and ca.CARD_STATUS = 'INSERVICE'
    AND po.PORT_CIRT_NAME IS NULL
    AND plp.POLP_PORT_ID IS NULL;
  
  
  CURSOR c_chk_port_combo IS
  SELECT po.PORT_ID,po.PORT_PHYC_ID,po.PORT_CACE_ID,ca.CARD_MODEL
    FROM ports po,cards ca,port_link_ports plp
    WHERE po.PORT_EQUP_ID = ca.CARD_EQUP_ID
  and po.PORT_CARD_SLOT = ca.CARD_SLOT
  and po.PORT_ID = plp.POLP_PORT_ID(+)
    AND po.PORT_EQUP_ID = v_equip_id
    AND po.PORT_NAME like 'POTS-IN%'
    AND po.PORT_STATUS = 'INSERVICE'
  and ca.CARD_STATUS = 'INSERVICE'
    AND po.PORT_CIRT_NAME IS NULL
    AND plp.POLP_PORT_ID IS NULL
   order by po.PORT_ID desc;

------------------Check MDF EX--------------------------------

    CURSOR c_chk_mdf_ex IS
    SELECT fa.FRAA_ID ,fa.FRAA_PHYC_ID
    FROM cable_core_ends cce,cable_core_ends cce2,FRAME_APPEARANCES fa,FRAME_UNITS fu,FRAME_CONTAINERS fc
    WHERE fa.FRAA_FRAU_ID = fu.FRAU_ID
    AND fu.FRAU_FRAC_ID = fc.FRAC_ID
    AND cce.CACE_PHYC_ID = v_PORT_PHY_ID
    AND cce.CACE_ID = v_PORT_CACE_ID
    AND cce.CACE_CABC_ID = cce2.CACE_CABC_ID
    AND cce2.CACE_PHYC_ID <> cce.CACE_PHYC_ID
    AND cce2.CACE_ID <> cce.CACE_ID
    AND cce2.CACE_PHYC_ID = fa.FRAA_PHYC_ID
    AND cce2.CACE_ID = fa.FRAA_CACE_ID
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL;


    CURSOR c_chk_mdf_ex_f IS
    SELECT trim(fa.FRAA_ID)
    FROM FRAME_APPEARANCES fa,port_link_ports plp
    WHERE fa.FRAA_ID = plp.POLP_FRAA_ID(+)
    AND fa.FRAA_PHYC_ID = v_MDF_EX_PHY_ID
    AND fa.FRAA_SIDE = 'FRONT'
    AND fa.FRAA_STATUS = 'INSERVICE'
    AND fa.FRAA_CIRT_NAME IS NULL
    AND plp.POLP_FRAA_ID IS NULL;

--------------------------------------------------------  

        cursor c_pstn_pots_out_data is
        select po.PORT_ID,po.PORT_PHYC_ID,po.PORT_CACE_ID,cce.CACE_CABC_ID
        from ports po,PORT_HIERARCHY ph,CABLE_CORE_ENDS cce
        where po.PORT_ID = ph.PORH_PARENTID
        and po.PORT_PHYC_ID = cce.CACE_PHYC_ID
        and po.PORT_CACE_ID = cce.CACE_ID
        and ph.PORH_CHILDID = v_PORT_ID;      
        
        
        cursor c_rear_mdf_adsl is 
        SELECT fa.FRAA_ID,fa.FRAA_FRAU_ID,fa.FRAA_POSITION
            FROM CABLE_CORE_ENDS cce,FRAME_APPEARANCES fa
            WHERE cce.CACE_PHYC_ID = fa.FRAA_PHYC_ID
            AND cce.CACE_ID = fa.FRAA_CACE_ID
            AND cce.CACE_CABC_ID = v_P_CABC_ID
            AND cce.CACE_PHYC_ID <> v_P_PHYC_ID
            AND cce.CACE_ID <> v_P_CACE_ID;        


        cursor c_front_mdf_adsl is
           SELECT fa.FRAA_ID
           FROM FRAME_APPEARANCES fa
           WHERE fa.FRAA_FRAU_ID = v_P_FRAU_ID
           AND fa.FRAA_POSITION = v_P_FRAA_POSITION
           AND fa.FRAA_SIDE = 'FRONT';
        
            cursor c_rear_adsl_pot is
            SELECT fa.FRAA_ID,fa.FRAA_FRAU_ID,fa.FRAA_POSITION
                FROM CABLE_CORE_ENDS cce,FRAME_APPEARANCES fa
                WHERE cce.CACE_PHYC_ID = fa.FRAA_PHYC_ID
                AND cce.CACE_ID = fa.FRAA_CACE_ID
                AND cce.CACE_CABC_ID = v_POTS_CABC_ID
                AND cce.CACE_PHYC_ID <> v_PORT_PHY_ID
                AND cce.CACE_ID <> v_PORT_CACE_ID;

            cursor c_front_adsl_pot is
               SELECT fa.FRAA_ID
               FROM FRAME_APPEARANCES fa
               WHERE fa.FRAA_FRAU_ID = v_POTS_FRAU_ID
               AND fa.FRAA_POSITION = v_POTS_FRAA_POSITION
               AND fa.FRAA_SIDE = 'FRONT';        


BEGIN 
  



OPEN c_facility_success;
FETCH c_facility_success 
INTO v_facility_success_val;
CLOSE c_facility_success;
OPEN c_new_dp_location;
FETCH c_new_dp_location 
INTO v_nwe_dp_location;
CLOSE c_new_dp_location;
OPEN c_new_dp_index;
FETCH c_new_dp_index 
INTO v_new_dp_index  ;
CLOSE c_new_dp_index;
OPEN c_switch_location;
FETCH c_switch_location 
INTO v_switch_location;
CLOSE c_switch_location;
OPEN c_switch_index;
FETCH c_switch_index 
INTO v_switch_index;
CLOSE c_switch_index;
OPEN c_rf_service_type;
FETCH c_rf_service_type 
INTO v_rf_type;
CLOSE c_rf_service_type;
OPEN c_msan_sw_details;
FETCH c_msan_sw_details 
INTO v_equip_id,v_equip_type;
CLOSE c_msan_sw_details;
OPEN c_splitter_index;
FETCH c_splitter_index 
INTO v_splitter_index;
CLOSE c_splitter_index;

open curr_adsl_oeid;
fetch curr_adsl_oeid into v_oeid_pstn_cust, v_ordt_type,v_pstn_order_id;
close curr_adsl_oeid;
 
open curr_pstn_oeid (v_oeid_pstn_cust, v_ordt_type );
fetch curr_pstn_oeid into v_adsl_sero_id,v_adsl_serv_id;
close curr_pstn_oeid;
 
OPEN c_adsl_dis_name;
FETCH c_adsl_dis_name 
INTO v_adsl_dis_name;
CLOSE c_adsl_dis_name;
 



IF v_facility_success_val is null THEN

p_ret_msg  := 'Please fill FACILITY SURVEY SUCCESS (Y/N)? attribute';

ELSIF v_facility_success_val = 'Y' or v_facility_success_val = 'YES' THEN

    IF (v_equip_type = 'NGN-MSAN' or v_equip_type like 'MSAN-%') THEN
    
    
    IF v_rf_type = 'PSTN' or v_rf_type = 'PSTN,ADSL' THEN
    
    P_dynamic_procedure.Process_create_circuit(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);
    
    
    IF p_ret_msg is not null THEN
    
    p_ret_msg := 'Create circuit failed: ' || p_ret_msg;
    
    END IF;
    
    
    SELECT ci.CIRT_NAME,ci.CIRT_DISPLAYNAME,ci.CIRT_CUSR_ABBREVIATION,ci.CIRT_ACCT_NUMBER
        INTO v_cct_id,v_pstn_dis_name,v_pstn_cr,v_pstn_ac
        FROM circuits ci
        WHERE ci.CIRT_SERV_ID = p_serv_id
        AND ci.CIRT_STATUS = 'PROPOSED'
        AND ci.CIRT_DISPLAYNAME LIKE '%(N)';
    
    
    UPDATE circuits ci
    set ci.CIRT_LOCN_AEND = v_switch_location,ci.CIRT_LOCN_BEND = v_nwe_dp_location
    where ci.CIRT_NAME = v_cct_id;
    
    p_dynamic_extension.update_so_header_from_cirt (
                p_serv_id,
                  p_sero_id,
                p_seit_id,
                p_impt_taskname,
                p_woro_id,
                p_ret_char,
                p_ret_number,
                   p_ret_msg);


          IF p_ret_msg IS NOT NULL THEN

           p_ret_msg := p_ret_msg || ' Check DP Addresses Error.';
    
         END IF;
    
    
       
     IF v_rf_type = 'PSTN' THEN
     
     ---------------------------------------------------------------------------------------------------
     
     OPEN c_chk_dp;
         FETCH c_chk_dp INTO v_DP_FC_ID;
         CLOSE c_chk_dp;

         OPEN c_dp_data;

         LOOP

         v_DP_FA_ID := NULL;
         v_DP_PHY_ID := NULL;
         v_DP_CACE_ID := NULL;


         FETCH c_dp_data INTO v_DP_FA_ID,v_DP_PHY_ID,v_DP_CACE_ID;
         EXIT WHEN c_dp_data%NOTFOUND;

         OPEN c_chk_cab_d;
         FETCH c_chk_cab_d INTO v_CABD_FA_ID,v_CABD_FC_ID,v_CHK_DFA,v_CABD_PHY_ID;
         EXIT WHEN c_chk_cab_d%FOUND;
         v_CABD_FA_ID := NULL;
         CLOSE c_chk_cab_d;

         END LOOP;

         IF v_CABD_FA_ID IS NOT NULL THEN

         CLOSE c_chk_cab_d;

         END IF;

         CLOSE c_dp_data;

         OPEN c_dp_data_f;
         FETCH c_dp_data_f INTO v_DP_FA_ID_F;
         CLOSE c_dp_data_f;


         OPEN c_chk_cab_d_f;
         FETCH c_chk_cab_d_f INTO v_CABD_FA_ID_F;
         CLOSE c_chk_cab_d_f;




         OPEN c_chk_port;

         LOOP

         v_PORT_ID := NULL;
         v_PORT_PHY_ID := NULL;
         v_PORT_CACE_ID := NULL;

         FETCH c_chk_port INTO v_PORT_ID,v_PORT_PHY_ID,v_PORT_CACE_ID,v_card_model;
         EXIT WHEN c_chk_port%NOTFOUND;

         OPEN c_chk_mdf_ex;
         FETCH c_chk_mdf_ex INTO v_MDF_EX_FA_ID,v_MDF_EX_PHY_ID;
         EXIT WHEN c_chk_mdf_ex%FOUND;
         v_MDF_EX_FA_ID := NULL;
         CLOSE c_chk_mdf_ex;

         END LOOP;

         IF v_MDF_EX_FA_ID IS NOT NULL THEN

         CLOSE c_chk_mdf_ex;

         END IF;

         CLOSE c_chk_port;



         OPEN c_chk_mdf_ex_f;
         FETCH c_chk_mdf_ex_f INTO v_MDF_EX_FA_ID_F;
         CLOSE c_chk_mdf_ex_f;


     IF v_card_model <> 'COMBO' THEN
     
            IF  v_CHK_DFA = 'CABINET' THEN

                OPEN c_chk_cab_e;

               LOOP

               v_CABE_FA_ID := NULL;
               v_CABE_PHY_ID := NULL;
               v_CABE_CACE_ID := NULL;

                FETCH c_chk_cab_e INTO v_CABE_FA_ID,v_CABE_PHY_ID,v_CABE_CACE_ID;
               EXIT WHEN c_chk_cab_e%NOTFOUND;

                OPEN c_chk_mdf_ug;
                FETCH c_chk_mdf_ug INTO v_MDF_UG_FA_ID,v_MDF_UG_PHY_ID;
               EXIT WHEN c_chk_mdf_ug%FOUND;
               v_MDF_UG_FA_ID := NULL;
                CLOSE c_chk_mdf_ug;

               END LOOP;

               IF v_MDF_UG_FA_ID IS NOT NULL THEN

               CLOSE c_chk_mdf_ug;

               END IF;

                CLOSE c_chk_cab_e;

               OPEN c_chk_cab_e_f;
                FETCH c_chk_cab_e_f INTO v_CABE_FA_ID_F;
                CLOSE c_chk_cab_e_f;


               OPEN c_chk_mdf_ug_f;
                FETCH c_chk_mdf_ug_f INTO v_MDF_UG_FA_ID_F;
                CLOSE c_chk_mdf_ug_f;


               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_50  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_60  FROM dual;

            
         

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_cct_id, 20, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_cct_id, 40, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_50, v_cct_id, 50, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_60, v_cct_id, 60, 'PHYSICAL', NULL, 'Y');
                            
                IF     v_DP_FA_ID_F is null THEN
                
                    p_ret_msg  := 'DP Front not found'    ;
                    
                END IF;    
                
                IF     v_DP_FA_ID is null THEN
                
                    p_ret_msg  := 'DP Rear not found'    ;
                    
                END IF;    
                
                IF     v_CABD_FA_ID is null THEN
                
                    p_ret_msg  := 'CABINET DSIDE Rear not found'    ;
                    
                END IF;    
                
                IF     v_CABD_FA_ID_F is null THEN
                
                    p_ret_msg  := 'CABINET DSIDE Front not found'    ;
                    
                END IF;
                
                
    


                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'F', v_DP_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_CABE_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_CABE_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'T', v_MDF_UG_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'F', v_MDF_UG_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_60, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_60, 'T', NULL);


               ELSE



              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;




               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_cct_id, 20, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_cct_id, 40, 'PHYSICAL', NULL, 'Y');




                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'F', v_DP_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_40, 'T', NULL);



                end if;
         -------------------------------------------------------------------------------------------------------     
        ELSE
      
        --------------------------------------------Create Bearer--------------------------------------------
          select CIRT_NAME_SEQ.nextval 
          into v_bearer_cct_id 
          from dual;

          INSERT INTO CIRCUITS ( CIRT_NAME, CIRT_INSERVICE, CIRT_CUSR_ABBREVIATION, CIRT_SPED_ABBREVIATION,
          CIRT_SERE_ID, CIRT_STATUS, CIRT_EXPIRYDATE, CIRT_TYPE, CIRT_ARING_ABBREVIATION,
          CIRT_BRING_ABBREVIATION, CIRT_EMPE_ID, CIRT_COMMENT, CIRT_DECOMMISSIONED, CIRT_SERT_ABBREVIATION,
          CIRT_ACCT_NUMBER, CIRT_LOCN_AEND, CIRT_LOCN_BEND, CIRT_COMPLIANCE, CIRT_PREFIX, CIRT_SUFFIX,
          CIRT_SERIALNO, CIRT_CLCISVCCODE, CIRT_CLCISVCMOD, CIRT_CLCICOMPANY, CIRT_CLCISEGMENT,
          CIRT_OUTSERVICE, CIRT_SLRL_NAME, CIRT_DISPLAYNAME, CIRT_NOTIFYDATE, CIRT_SERV_ID,
          CIRT_RESERVATIONID, CIRT_RELM_NAME, CIRT_REALM, CIRT_EQUT_LEVEL ) VALUES ( 
          v_bearer_cct_id,  sysdate,v_pstn_cr, '4K-VOICE', NULL, 'PROPOSED',  null, 'BEARER', NULL, NULL, 'CL_ADM', NULL, 
          NULL, 'PSTN', v_pstn_ac, v_nwe_dp_location, v_switch_location, 'ITU', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
          v_switch_location || ' ' || v_nwe_dp_location|| ' ' || ' 4K-VOICE ' ||  v_pstn_dis_name, NULL, NULL, NULL, NULL, NULL, NULL); 
  
  
      
      
        select EQUP_ID_SEQ.nextval 
          into v_splitter_equip_id 
          from dual;

        -------------------------------Splitter Equipment---------------------------------------------
          INSERT INTO EQUIPMENT ( EQUP_ID, EQUP_EQUT_ABBREVIATION, EQUP_INDEX, EQUP_LOCN_TTNAME,
          EQUP_POSITION, EQUP_STATUS, EQUP_MANS_NAME, EQUP_NODEID, EQUP_IPADDRESS, EQUP_CUSR_ABBREVIATION,
          EQUP_MANR_ABBREVIATION, EQUP_EQUM_MODEL, EQUP_SERIALNUMBER, EQUP_INSERVICE, EQUP_SUPPLIER,
          EQUP_DEALER, EQUP_MAINTAINER, EQUP_COMMENTS, EQUP_WORG_NAME, EQUP_EXCC_CODE, EQUP_RELM_NAME,
          EQUP_DISCSTATUS, EQUP_DISCSTATUSDATE, EQUP_IPREGION ) VALUES
          ( v_splitter_equip_id, 'DSL_SPLITTER', v_splitter_index, v_nwe_dp_location, NULL, 'INSERVICE', NULL, NULL, NULL, 'SLT'
          , 'GENERIC', NULL, NULL,  sysdate, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
  


          --------------------------------------Create Splitter CARD----------------------------------------------
          INSERT INTO CARDS ( CARD_EQUP_ID, CARD_SLOT, CARD_NAME, CARD_LOCN_TTNAME, CARD_MODEL, CARD_REVISION,
          CARD_SERIAL, CARD_DEVIATION, CARD_STATUS, CARD_UNITSTATUS, CARD_OLD_STATUS, CARD_MODE,
          CARD_NEMSNAME, PARENT_CARD_SLOT ) VALUES ( v_splitter_equip_id, 'NA', 'MAIN_UNIT', v_nwe_dp_location,
          NULL, NULL, NULL, NULL, 'INSERVICE', NULL, NULL, 'NEITHER', NULL, NULL); 


  
          --------------------------------------Create Splitter POTS-OUT port----------------------------------------------
          select PORT_ID_SEQ.nextval 
          into v_splitter_pot_out_id 
          from dual;

          INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
          PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
          PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
          PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
          v_splitter_pot_out_id, v_splitter_equip_id, 'POTS-OUT', 'NA', NULL, v_bearer_cct_id, NULL, NULL, 'PARENT', NULL, 'INSERVICE'
          , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  


          -------------------------------------Create Splitter DSL-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_dsl_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_dsl_in_id, v_splitter_equip_id, 'DSL-IN', 'NA', NULL, null, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL); 
 



         --------------------------------------Create Splitter POTS-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_pot_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_pot_in_id, v_splitter_equip_id, 'POTS-IN', 'NA', NULL, v_cct_id, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  
 



         --------------------------------------Create PORT HIERARCHY----------------------------------------------

         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_dsl_in_id); 
         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_pot_in_id); 
        
        
             
            IF  v_CHK_DFA = 'CABINET' THEN

                OPEN c_chk_cab_e;

               LOOP

               v_CABE_FA_ID := NULL;
               v_CABE_PHY_ID := NULL;
               v_CABE_CACE_ID := NULL;

                FETCH c_chk_cab_e INTO v_CABE_FA_ID,v_CABE_PHY_ID,v_CABE_CACE_ID;
               EXIT WHEN c_chk_cab_e%NOTFOUND;

                OPEN c_chk_mdf_ug;
                FETCH c_chk_mdf_ug INTO v_MDF_UG_FA_ID,v_MDF_UG_PHY_ID;
               EXIT WHEN c_chk_mdf_ug%FOUND;
               v_MDF_UG_FA_ID := NULL;
                CLOSE c_chk_mdf_ug;

               END LOOP;

               IF v_MDF_UG_FA_ID IS NOT NULL THEN

               CLOSE c_chk_mdf_ug;

               END IF;

                CLOSE c_chk_cab_e;

               OPEN c_chk_cab_e_f;
                FETCH c_chk_cab_e_f INTO v_CABE_FA_ID_F;
                CLOSE c_chk_cab_e_f;


               OPEN c_chk_mdf_ug_f;
                FETCH c_chk_mdf_ug_f INTO v_MDF_UG_FA_ID_F;
                CLOSE c_chk_mdf_ug_f;
        
        
        ------------------------------------PSTN----------------------------------------------------------------


               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

                        

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');
              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_10, 'T', null);      
        
        
        -----------------------------------Bearer------------------------------------------------------------------  
        select po.PORT_ID
        into v_pstn_pots_out 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID = v_PORT_ID;
        
            
         SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_50  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_60  FROM dual;


         

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_50, v_bearer_cct_id, 50, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_60, v_bearer_cct_id, 60, 'PHYSICAL', NULL, 'Y');



                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_CABE_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_CABE_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'T', v_MDF_UG_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'F', v_MDF_UG_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_60, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_60, 'T', NULL);



               ELSE

         --------------------------------PSTN-----------------------------------------------------------------

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;
              

                INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_10, 'T', null);    
              
      -----------------------------------BEARER-----------------------------------------------------------------
      
          select po.PORT_ID
        into v_pstn_pots_out 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID = v_PORT_ID;      
        
        
              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;




               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');




                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', NULL);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_40, 'T', NULL);          

                



                END IF;
        

 
    
      
      
      
      END IF;
     
     
     
     ELSIF v_rf_type = 'PSTN,ADSL' THEN
     
     
     OPEN c_chk_dp;
         FETCH c_chk_dp INTO v_DP_FC_ID;
         CLOSE c_chk_dp;

         OPEN c_dp_data;

         LOOP

         v_DP_FA_ID := NULL;
         v_DP_PHY_ID := NULL;
         v_DP_CACE_ID := NULL;


         FETCH c_dp_data INTO v_DP_FA_ID,v_DP_PHY_ID,v_DP_CACE_ID;
         EXIT WHEN c_dp_data%NOTFOUND;

         OPEN c_chk_cab_d;
         FETCH c_chk_cab_d INTO v_CABD_FA_ID,v_CABD_FC_ID,v_CHK_DFA,v_CABD_PHY_ID;
         EXIT WHEN c_chk_cab_d%FOUND;
         v_CABD_FA_ID := NULL;
         CLOSE c_chk_cab_d;

         END LOOP;

         IF v_CABD_FA_ID IS NOT NULL THEN

         CLOSE c_chk_cab_d;

         END IF;

         CLOSE c_dp_data;

         OPEN c_dp_data_f;
         FETCH c_dp_data_f INTO v_DP_FA_ID_F;
         CLOSE c_dp_data_f;


         OPEN c_chk_cab_d_f;
         FETCH c_chk_cab_d_f INTO v_CABD_FA_ID_F;
         CLOSE c_chk_cab_d_f;




         OPEN c_chk_port_combo;

         LOOP

         v_PORT_ID := NULL;
         v_PORT_PHY_ID := NULL;
         v_PORT_CACE_ID := NULL;

         FETCH c_chk_port_combo INTO v_PORT_ID,v_PORT_PHY_ID,v_PORT_CACE_ID,v_card_model;
         EXIT WHEN c_chk_port_combo%NOTFOUND;

         OPEN c_chk_mdf_ex;
         FETCH c_chk_mdf_ex INTO v_MDF_EX_FA_ID,v_MDF_EX_PHY_ID;
         EXIT WHEN c_chk_mdf_ex%FOUND;
         v_MDF_EX_FA_ID := NULL;
         CLOSE c_chk_mdf_ex;

         END LOOP;

         IF v_MDF_EX_FA_ID IS NOT NULL THEN

         CLOSE c_chk_mdf_ex;

         END IF;

         CLOSE c_chk_port_combo;



         OPEN c_chk_mdf_ex_f;
         FETCH c_chk_mdf_ex_f INTO v_MDF_EX_FA_ID_F;
         CLOSE c_chk_mdf_ex_f;
     

     


     IF v_card_model <> 'COMBO'  THEN
     
            
      ---------------------------------------ADSL Header-----------------------------------------------------
      
        select CIRT_NAME_SEQ.nextval 
          into v_adsl_cct_id 
          from dual;

          INSERT INTO CIRCUITS ( CIRT_NAME, CIRT_INSERVICE, CIRT_CUSR_ABBREVIATION, CIRT_SPED_ABBREVIATION,
          CIRT_SERE_ID, CIRT_STATUS, CIRT_EXPIRYDATE, CIRT_TYPE, CIRT_ARING_ABBREVIATION,
          CIRT_BRING_ABBREVIATION, CIRT_EMPE_ID, CIRT_COMMENT, CIRT_DECOMMISSIONED, CIRT_SERT_ABBREVIATION,
          CIRT_ACCT_NUMBER, CIRT_LOCN_AEND, CIRT_LOCN_BEND, CIRT_COMPLIANCE, CIRT_PREFIX, CIRT_SUFFIX,
          CIRT_SERIALNO, CIRT_CLCISVCCODE, CIRT_CLCISVCMOD, CIRT_CLCICOMPANY, CIRT_CLCISEGMENT,
          CIRT_OUTSERVICE, CIRT_SLRL_NAME, CIRT_DISPLAYNAME, CIRT_NOTIFYDATE, CIRT_SERV_ID,
          CIRT_RESERVATIONID, CIRT_RELM_NAME, CIRT_REALM, CIRT_EQUT_LEVEL ) VALUES ( 
          v_adsl_cct_id,  sysdate,v_pstn_cr, 'ADSL', NULL, 'PROPOSED',  null, 'INTERNET', NULL, NULL, 'CL_ADM', NULL, 
          NULL, 'ADSL', v_pstn_ac, v_nwe_dp_location, v_switch_location, 'ITU', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
           v_adsl_dis_name || '(N)', NULL, v_adsl_serv_id, NULL, NULL, NULL, NULL);
      
        --------------------------------------------Create Bearer--------------------------------------------
          select CIRT_NAME_SEQ.nextval 
          into v_bearer_cct_id 
          from dual;

          INSERT INTO CIRCUITS ( CIRT_NAME, CIRT_INSERVICE, CIRT_CUSR_ABBREVIATION, CIRT_SPED_ABBREVIATION,
          CIRT_SERE_ID, CIRT_STATUS, CIRT_EXPIRYDATE, CIRT_TYPE, CIRT_ARING_ABBREVIATION,
          CIRT_BRING_ABBREVIATION, CIRT_EMPE_ID, CIRT_COMMENT, CIRT_DECOMMISSIONED, CIRT_SERT_ABBREVIATION,
          CIRT_ACCT_NUMBER, CIRT_LOCN_AEND, CIRT_LOCN_BEND, CIRT_COMPLIANCE, CIRT_PREFIX, CIRT_SUFFIX,
          CIRT_SERIALNO, CIRT_CLCISVCCODE, CIRT_CLCISVCMOD, CIRT_CLCICOMPANY, CIRT_CLCISEGMENT,
          CIRT_OUTSERVICE, CIRT_SLRL_NAME, CIRT_DISPLAYNAME, CIRT_NOTIFYDATE, CIRT_SERV_ID,
          CIRT_RESERVATIONID, CIRT_RELM_NAME, CIRT_REALM, CIRT_EQUT_LEVEL ) VALUES ( 
          v_bearer_cct_id,  sysdate,v_pstn_cr, '4K-VOICE', NULL, 'PROPOSED',  null, 'BEARER', NULL, NULL, 'CL_ADM', NULL, 
          NULL, 'PSTN', v_pstn_ac, v_nwe_dp_location, v_switch_location, 'ITU', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
          v_switch_location || ' ' || v_nwe_dp_location|| ' ' || ' 4K-VOICE ' ||  v_pstn_dis_name, NULL, NULL, NULL, NULL, NULL, NULL); 
  
  
      
      
        select EQUP_ID_SEQ.nextval 
          into v_splitter_equip_id 
          from dual;

        -------------------------------Splitter Equipment---------------------------------------------
          INSERT INTO EQUIPMENT ( EQUP_ID, EQUP_EQUT_ABBREVIATION, EQUP_INDEX, EQUP_LOCN_TTNAME,
          EQUP_POSITION, EQUP_STATUS, EQUP_MANS_NAME, EQUP_NODEID, EQUP_IPADDRESS, EQUP_CUSR_ABBREVIATION,
          EQUP_MANR_ABBREVIATION, EQUP_EQUM_MODEL, EQUP_SERIALNUMBER, EQUP_INSERVICE, EQUP_SUPPLIER,
          EQUP_DEALER, EQUP_MAINTAINER, EQUP_COMMENTS, EQUP_WORG_NAME, EQUP_EXCC_CODE, EQUP_RELM_NAME,
          EQUP_DISCSTATUS, EQUP_DISCSTATUSDATE, EQUP_IPREGION ) VALUES
          ( v_splitter_equip_id, 'DSL_SPLITTER', v_splitter_index, v_nwe_dp_location, NULL, 'INSERVICE', NULL, NULL, NULL, 'SLT'
          , 'GENERIC', NULL, NULL,  sysdate, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
  


          --------------------------------------Create Splitter CARD----------------------------------------------
          INSERT INTO CARDS ( CARD_EQUP_ID, CARD_SLOT, CARD_NAME, CARD_LOCN_TTNAME, CARD_MODEL, CARD_REVISION,
          CARD_SERIAL, CARD_DEVIATION, CARD_STATUS, CARD_UNITSTATUS, CARD_OLD_STATUS, CARD_MODE,
          CARD_NEMSNAME, PARENT_CARD_SLOT ) VALUES ( v_splitter_equip_id, 'NA', 'MAIN_UNIT', v_nwe_dp_location,
          NULL, NULL, NULL, NULL, 'INSERVICE', NULL, NULL, 'NEITHER', NULL, NULL); 


  
          --------------------------------------Create Splitter POTS-OUT port----------------------------------------------
          select PORT_ID_SEQ.nextval 
          into v_splitter_pot_out_id 
          from dual;

          INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
          PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
          PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
          PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
          v_splitter_pot_out_id, v_splitter_equip_id, 'POTS-OUT', 'NA', NULL, v_bearer_cct_id, NULL, NULL, 'PARENT', NULL, 'INSERVICE'
          , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  


          -------------------------------------Create Splitter DSL-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_dsl_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_dsl_in_id, v_splitter_equip_id, 'DSL-IN', 'NA', NULL, v_adsl_cct_id, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL); 
 



         --------------------------------------Create Splitter POTS-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_pot_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_pot_in_id, v_splitter_equip_id, 'POTS-IN', 'NA', NULL, v_cct_id, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  
 



         --------------------------------------Create PORT HIERARCHY----------------------------------------------

         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_dsl_in_id); 
         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_pot_in_id); 
        
        ---------------------------------------------------------------------------------------------------------
        
        
        
        
        
        
             
            IF  v_CHK_DFA = 'CABINET' THEN

                OPEN c_chk_cab_e;

               LOOP

               v_CABE_FA_ID := NULL;
               v_CABE_PHY_ID := NULL;
               v_CABE_CACE_ID := NULL;

                FETCH c_chk_cab_e INTO v_CABE_FA_ID,v_CABE_PHY_ID,v_CABE_CACE_ID;
               EXIT WHEN c_chk_cab_e%NOTFOUND;

                OPEN c_chk_mdf_ug;
                FETCH c_chk_mdf_ug INTO v_MDF_UG_FA_ID,v_MDF_UG_PHY_ID;
               EXIT WHEN c_chk_mdf_ug%FOUND;
               v_MDF_UG_FA_ID := NULL;
                CLOSE c_chk_mdf_ug;

               END LOOP;

               IF v_MDF_UG_FA_ID IS NOT NULL THEN

               CLOSE c_chk_mdf_ug;

               END IF;

                CLOSE c_chk_cab_e;

               OPEN c_chk_cab_e_f;
                FETCH c_chk_cab_e_f INTO v_CABE_FA_ID_F;
                CLOSE c_chk_cab_e_f;


               OPEN c_chk_mdf_ug_f;
                FETCH c_chk_mdf_ug_f INTO v_MDF_UG_FA_ID_F;
                CLOSE c_chk_mdf_ug_f;
        
        
        ------------------------------------PSTN----------------------------------------------------------------
        
        open c_rear_adsl_pot;
        fetch c_rear_adsl_pot into v_POTS_FRAA_ID_REAR,v_POTS_FRAU_ID,v_POTS_FRAA_POSITION;
        close c_rear_adsl_pot;
            
        open c_front_adsl_pot;
        fetch c_front_adsl_pot into v_POTS_FRAA_ID_FRONT;
        close c_front_adsl_pot;  


               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

                        

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');
              
        INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_cct_id, 20, 'JUMPER', NULL, 'Y');
              
        INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_cct_id, 30, 'PHYSICAL', NULL, 'Y');            
              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( null, v_pl_id_10, 'T', v_POTS_FRAA_ID_REAR);  
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_POTS_FRAA_ID_FRONT);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_MDF_EX_FA_ID_F);  
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_30, 'T',null );              
        
        
        -----------------------------------Bearer------------------------------------------------------------------  
        
        
        
            
        
        open c_pstn_pots_out_data;
        fetch c_pstn_pots_out_data into v_pstn_pots_out,v_P_PHYC_ID,v_P_CACE_ID,v_P_CABC_ID;
        close c_pstn_pots_out_data;
        
        open c_rear_mdf_adsl;
        fetch c_rear_mdf_adsl into v_P_FRAA_ID_REAR,v_P_FRAU_ID,v_P_FRAA_POSITION;
        close c_rear_mdf_adsl;
        
        open c_front_mdf_adsl;
        fetch c_front_mdf_adsl into v_P_FRAA_ID_FRONT;
        close c_front_mdf_adsl;
        
        
        
            
         SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_50  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_60  FROM dual;


         

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_50, v_bearer_cct_id, 50, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_60, v_bearer_cct_id, 60, 'PHYSICAL', NULL, 'Y');



                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_CABE_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_CABE_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'T', v_MDF_UG_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'F', v_MDF_UG_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'T', v_P_FRAA_ID_FRONT);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_60, 'F', v_P_FRAA_ID_REAR);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_60, 'T', NULL);



               ELSE

         --------------------------------PSTN-----------------------------------------------------------------

              open c_rear_adsl_pot;
        fetch c_rear_adsl_pot into v_POTS_FRAA_ID_REAR,v_POTS_FRAU_ID,v_POTS_FRAA_POSITION;
        close c_rear_adsl_pot;
            
        open c_front_adsl_pot;
        fetch c_front_adsl_pot into v_POTS_FRAA_ID_FRONT;
        close c_front_adsl_pot;  


               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

                        

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');
              
        INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_cct_id, 20, 'JUMPER', NULL, 'Y');
              
        INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_cct_id, 30, 'PHYSICAL', NULL, 'Y');            
              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( null, v_pl_id_10, 'T', v_POTS_FRAA_ID_REAR);  
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_POTS_FRAA_ID_FRONT);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_MDF_EX_FA_ID_F);  
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_30, 'T',null );              
        

              
      -----------------------------------BEARER-----------------------------------------------------------------
      
          open c_pstn_pots_out_data;
        fetch c_pstn_pots_out_data into v_pstn_pots_out,v_P_PHYC_ID,v_P_CACE_ID,v_P_CABC_ID;
        close c_pstn_pots_out_data;
        
        open c_rear_mdf_adsl;
        fetch c_rear_mdf_adsl into v_P_FRAA_ID_REAR,v_P_FRAU_ID,v_P_FRAA_POSITION;
        close c_rear_mdf_adsl;
        
        open c_front_mdf_adsl;
        fetch c_front_mdf_adsl into v_P_FRAA_ID_FRONT;
        close c_front_mdf_adsl;    
        
        
              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;




               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');




                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', NULL);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_P_FRAA_ID_FRONT);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_P_FRAA_ID_REAR);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_40, 'T', NULL);          

                



                END IF;
        

         --------------------------------------------ADSL--------------------------------------------         
         
         
          select po.PORT_ID
        into v_adsl_dsl_in 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID <> v_PORT_ID
        and ph.PORH_PARENTID = v_pstn_pots_out;
         
         
         SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;
              

                INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_adsl_cct_id, 10, 'LOGICAL', NULL, 'Y');              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_dsl_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_adsl_dsl_in, v_pl_id_10, 'T', null);  
    
         
         
         --------------------------------------Create CIRCUIT HIERARCHY-------------------------------------------
         
         INSERT INTO CIRCUIT_HIERARCHY ( CIRH_PARENT, CIRH_CHILD, CIRH_TRIBUTARY, CIRH_PARENTORDER,CIRH_PATH ) VALUES ( 
           v_bearer_cct_id, v_adsl_cct_id, NULL, 1, NULL);
         
         INSERT INTO CIRCUIT_HIERARCHY ( CIRH_PARENT, CIRH_CHILD, CIRH_TRIBUTARY, CIRH_PARENTORDER,CIRH_PATH ) VALUES ( 
           v_bearer_cct_id, v_cct_id, NULL, 1, NULL);
         
         update service_orders so
         set so.SERO_CIRT_NAME = v_adsl_cct_id
         where so.SERO_ID = v_adsl_sero_id;   
         
         

      
      -------------------------------------------------------------------------------------------------------     
        ELSE
      
      ---------------------------------------ADSL Header-----------------------------------------------------
      
        select CIRT_NAME_SEQ.nextval 
          into v_adsl_cct_id 
          from dual;

          INSERT INTO CIRCUITS ( CIRT_NAME, CIRT_INSERVICE, CIRT_CUSR_ABBREVIATION, CIRT_SPED_ABBREVIATION,
          CIRT_SERE_ID, CIRT_STATUS, CIRT_EXPIRYDATE, CIRT_TYPE, CIRT_ARING_ABBREVIATION,
          CIRT_BRING_ABBREVIATION, CIRT_EMPE_ID, CIRT_COMMENT, CIRT_DECOMMISSIONED, CIRT_SERT_ABBREVIATION,
          CIRT_ACCT_NUMBER, CIRT_LOCN_AEND, CIRT_LOCN_BEND, CIRT_COMPLIANCE, CIRT_PREFIX, CIRT_SUFFIX,
          CIRT_SERIALNO, CIRT_CLCISVCCODE, CIRT_CLCISVCMOD, CIRT_CLCICOMPANY, CIRT_CLCISEGMENT,
          CIRT_OUTSERVICE, CIRT_SLRL_NAME, CIRT_DISPLAYNAME, CIRT_NOTIFYDATE, CIRT_SERV_ID,
          CIRT_RESERVATIONID, CIRT_RELM_NAME, CIRT_REALM, CIRT_EQUT_LEVEL ) VALUES ( 
          v_adsl_cct_id,  sysdate,v_pstn_cr, 'ADSL', NULL, 'PROPOSED',  null, 'INTERNET', NULL, NULL, 'CL_ADM', NULL, 
          NULL, 'ADSL', v_pstn_ac, v_nwe_dp_location, v_switch_location, 'ITU', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
           v_adsl_dis_name || '(N)', NULL, v_adsl_serv_id, NULL, NULL, NULL, NULL);
      
        --------------------------------------------Create Bearer--------------------------------------------
          select CIRT_NAME_SEQ.nextval 
          into v_bearer_cct_id 
          from dual;

          INSERT INTO CIRCUITS ( CIRT_NAME, CIRT_INSERVICE, CIRT_CUSR_ABBREVIATION, CIRT_SPED_ABBREVIATION,
          CIRT_SERE_ID, CIRT_STATUS, CIRT_EXPIRYDATE, CIRT_TYPE, CIRT_ARING_ABBREVIATION,
          CIRT_BRING_ABBREVIATION, CIRT_EMPE_ID, CIRT_COMMENT, CIRT_DECOMMISSIONED, CIRT_SERT_ABBREVIATION,
          CIRT_ACCT_NUMBER, CIRT_LOCN_AEND, CIRT_LOCN_BEND, CIRT_COMPLIANCE, CIRT_PREFIX, CIRT_SUFFIX,
          CIRT_SERIALNO, CIRT_CLCISVCCODE, CIRT_CLCISVCMOD, CIRT_CLCICOMPANY, CIRT_CLCISEGMENT,
          CIRT_OUTSERVICE, CIRT_SLRL_NAME, CIRT_DISPLAYNAME, CIRT_NOTIFYDATE, CIRT_SERV_ID,
          CIRT_RESERVATIONID, CIRT_RELM_NAME, CIRT_REALM, CIRT_EQUT_LEVEL ) VALUES ( 
          v_bearer_cct_id,  sysdate,v_pstn_cr, '4K-VOICE', NULL, 'PROPOSED',  null, 'BEARER', NULL, NULL, 'CL_ADM', NULL, 
          NULL, 'PSTN', v_pstn_ac, v_nwe_dp_location, v_switch_location, 'ITU', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
          v_switch_location || ' ' || v_nwe_dp_location|| ' ' || ' 4K-VOICE ' ||  v_pstn_dis_name, NULL, NULL, NULL, NULL, NULL, NULL); 
  
  
      
      
        select EQUP_ID_SEQ.nextval 
          into v_splitter_equip_id 
          from dual;

        -------------------------------Splitter Equipment---------------------------------------------
          INSERT INTO EQUIPMENT ( EQUP_ID, EQUP_EQUT_ABBREVIATION, EQUP_INDEX, EQUP_LOCN_TTNAME,
          EQUP_POSITION, EQUP_STATUS, EQUP_MANS_NAME, EQUP_NODEID, EQUP_IPADDRESS, EQUP_CUSR_ABBREVIATION,
          EQUP_MANR_ABBREVIATION, EQUP_EQUM_MODEL, EQUP_SERIALNUMBER, EQUP_INSERVICE, EQUP_SUPPLIER,
          EQUP_DEALER, EQUP_MAINTAINER, EQUP_COMMENTS, EQUP_WORG_NAME, EQUP_EXCC_CODE, EQUP_RELM_NAME,
          EQUP_DISCSTATUS, EQUP_DISCSTATUSDATE, EQUP_IPREGION ) VALUES
          ( v_splitter_equip_id, 'DSL_SPLITTER', v_splitter_index, v_nwe_dp_location, NULL, 'INSERVICE', NULL, NULL, NULL, 'SLT'
          , 'GENERIC', NULL, NULL,  sysdate, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
  


          --------------------------------------Create Splitter CARD----------------------------------------------
          INSERT INTO CARDS ( CARD_EQUP_ID, CARD_SLOT, CARD_NAME, CARD_LOCN_TTNAME, CARD_MODEL, CARD_REVISION,
          CARD_SERIAL, CARD_DEVIATION, CARD_STATUS, CARD_UNITSTATUS, CARD_OLD_STATUS, CARD_MODE,
          CARD_NEMSNAME, PARENT_CARD_SLOT ) VALUES ( v_splitter_equip_id, 'NA', 'MAIN_UNIT', v_nwe_dp_location,
          NULL, NULL, NULL, NULL, 'INSERVICE', NULL, NULL, 'NEITHER', NULL, NULL); 


  
          --------------------------------------Create Splitter POTS-OUT port----------------------------------------------
          select PORT_ID_SEQ.nextval 
          into v_splitter_pot_out_id 
          from dual;

          INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
          PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
          PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
          PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
          v_splitter_pot_out_id, v_splitter_equip_id, 'POTS-OUT', 'NA', NULL, v_bearer_cct_id, NULL, NULL, 'PARENT', NULL, 'INSERVICE'
          , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  


          -------------------------------------Create Splitter DSL-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_dsl_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_dsl_in_id, v_splitter_equip_id, 'DSL-IN', 'NA', NULL, v_adsl_cct_id, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL); 
 



         --------------------------------------Create Splitter POTS-IN port----------------------------------------------
         select PORT_ID_SEQ.nextval 
         into v_splitter_pot_in_id 
         from dual;

         INSERT INTO PORTS ( PORT_ID, PORT_EQUP_ID, PORT_NAME, PORT_CARD_SLOT, PORT_ALARMNAME,
         PORT_CIRT_NAME, PORT_USAGE, PORT_PORC_ABBREVIATION, PORT_RELATION, PORT_LOCN_TTNAME, PORT_STATUS,
         PORT_DISPLAYED, PORT_PHYSICAL, PORT_SPED_ABBREVIATION, PORT_DYNAMIC, PORT_OLD_STATUS, PORT_PHYC_ID,
         PORT_CACE_ID, PORT_NAMEGROUPID, PORT_NUMB_ID ) VALUES ( 
         v_splitter_pot_in_id, v_splitter_equip_id, 'POTS-IN', 'NA', NULL, v_cct_id, NULL, NULL, 'CHILD', NULL, 'INSERVICE'
         , 'Y', 'Y', NULL, NULL, NULL, NULL, NULL, NULL, NULL);  
 



         --------------------------------------Create PORT HIERARCHY----------------------------------------------

         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_dsl_in_id); 
         INSERT INTO PORT_HIERARCHY ( PORH_PARENTID, PORH_CHILDID ) VALUES ( 
         v_splitter_pot_out_id, v_splitter_pot_in_id); 
        
        
             
            IF  v_CHK_DFA = 'CABINET' THEN

                OPEN c_chk_cab_e;

               LOOP

               v_CABE_FA_ID := NULL;
               v_CABE_PHY_ID := NULL;
               v_CABE_CACE_ID := NULL;

                FETCH c_chk_cab_e INTO v_CABE_FA_ID,v_CABE_PHY_ID,v_CABE_CACE_ID;
               EXIT WHEN c_chk_cab_e%NOTFOUND;

                OPEN c_chk_mdf_ug;
                FETCH c_chk_mdf_ug INTO v_MDF_UG_FA_ID,v_MDF_UG_PHY_ID;
               EXIT WHEN c_chk_mdf_ug%FOUND;
               v_MDF_UG_FA_ID := NULL;
                CLOSE c_chk_mdf_ug;

               END LOOP;

               IF v_MDF_UG_FA_ID IS NOT NULL THEN

               CLOSE c_chk_mdf_ug;

               END IF;

                CLOSE c_chk_cab_e;

               OPEN c_chk_cab_e_f;
                FETCH c_chk_cab_e_f INTO v_CABE_FA_ID_F;
                CLOSE c_chk_cab_e_f;


               OPEN c_chk_mdf_ug_f;
                FETCH c_chk_mdf_ug_f INTO v_MDF_UG_FA_ID_F;
                CLOSE c_chk_mdf_ug_f;
        
        
        ------------------------------------PSTN----------------------------------------------------------------


               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

                        

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');
              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_10, 'T', null);      
        
        
        -----------------------------------Bearer------------------------------------------------------------------  
        select po.PORT_ID
        into v_pstn_pots_out 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID = v_PORT_ID;
        
            
         SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_50  FROM dual;

               SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_60  FROM dual;


         

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');
              
               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_50, v_bearer_cct_id, 50, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_60, v_bearer_cct_id, 60, 'PHYSICAL', NULL, 'Y');



                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_CABE_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_CABE_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'T', v_MDF_UG_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'F', v_MDF_UG_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_50, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_60, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_60, 'T', NULL);



               ELSE

         --------------------------------PSTN-----------------------------------------------------------------

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;
              

                INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_cct_id, 10, 'LOGICAL', NULL, 'Y');              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_PORT_ID, v_pl_id_10, 'T', null);    
              
      -----------------------------------BEARER-----------------------------------------------------------------
      
          select po.PORT_ID
        into v_pstn_pots_out 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID = v_PORT_ID;      
        
        
              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_20  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_30  FROM dual;

              SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_40  FROM dual;




               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_bearer_cct_id, 10, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_20, v_bearer_cct_id, 20, 'PHYSICAL', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_30, v_bearer_cct_id, 30, 'JUMPER', NULL, 'Y');

               INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_40, v_bearer_cct_id, 40, 'PHYSICAL', NULL, 'Y');




                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_pot_out_id, v_pl_id_10, 'F', NULL);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_10, 'T', v_DP_FA_ID_F);      

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'F', v_DP_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_20, 'T', v_CABD_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'F', v_CABD_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_30, 'T', v_MDF_EX_FA_ID_F);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( NULL, v_pl_id_40, 'F', v_MDF_EX_FA_ID);

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_pstn_pots_out, v_pl_id_40, 'T', NULL);          

                



                END IF;
        

         --------------------------------------------ADSL--------------------------------------------         
         
         
          select po.PORT_ID
        into v_adsl_dsl_in 
        from ports po,PORT_HIERARCHY ph
        where po.PORT_ID = ph.PORH_PARENTID
        and ph.PORH_CHILDID <> v_PORT_ID
        and ph.PORH_PARENTID = v_pstn_pots_out;
         
         
         SELECT PORL_ID_SEQ.NEXTVAL INTO v_pl_id_10  FROM dual;
              

                INSERT INTO PORT_LINKS ( PORL_ID, PORL_CIRT_NAME, PORL_SEQUENCE, PORL_LINT_ABBREVIATION,PORL_DETAILS, PORL_EXTERNAL )
                            VALUES ( v_pl_id_10, v_adsl_cct_id, 10, 'LOGICAL', NULL, 'Y');              
            

                INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_splitter_dsl_in_id, v_pl_id_10, 'F', null);
              
        INSERT INTO PORT_LINK_PORTS ( POLP_PORT_ID, POLP_PORL_ID, POLP_COMMONPORT,POLP_FRAA_ID )
                            VALUES ( v_adsl_dsl_in, v_pl_id_10, 'T', null);  
    
         
         
         --------------------------------------Create CIRCUIT HIERARCHY-------------------------------------------
         
         INSERT INTO CIRCUIT_HIERARCHY ( CIRH_PARENT, CIRH_CHILD, CIRH_TRIBUTARY, CIRH_PARENTORDER,CIRH_PATH ) VALUES ( 
           v_bearer_cct_id, v_adsl_cct_id, NULL, 1, NULL);
         
         INSERT INTO CIRCUIT_HIERARCHY ( CIRH_PARENT, CIRH_CHILD, CIRH_TRIBUTARY, CIRH_PARENTORDER,CIRH_PATH ) VALUES ( 
           v_bearer_cct_id, v_cct_id, NULL, 1, NULL);
         
         update service_orders so
         set so.SERO_CIRT_NAME = v_adsl_cct_id
         where so.SERO_ID = v_adsl_sero_id;   
         
         
         
         
      
      
      END IF;


    END IF;
    
    IF v_cct_id is not null THEN
    
    update circuits ci
    set ci.CIRT_COMMENT = v_pstn_order_id
    where ci.CIRT_NAME = v_cct_id;
    
    delete from SERVICE_IMPLEMENTATION_TASKS sit
    where sit.SEIT_SERO_ID = p_sero_id
    and sit.SEIT_TASKNAME = 'ASSOCIATE CIRCUIT';
    
    END IF;
    
    IF v_bearer_cct_id is not null THEN
    
    update circuits ci
    set ci.CIRT_COMMENT = v_pstn_order_id
    where ci.CIRT_NAME = v_bearer_cct_id;
    
    END IF;
    
    IF v_adsl_cct_id is not null THEN
    
    update circuits ci
    set ci.CIRT_COMMENT = v_pstn_order_id
    where ci.CIRT_NAME = v_adsl_cct_id;
    
    delete from SERVICE_IMPLEMENTATION_TASKS sit
    where sit.SEIT_SERO_ID = v_adsl_sero_id
    and sit.SEIT_TASKNAME = 'ASSOCIATE CIRCUIT';
    
    END IF;
    
    
   ELSE
    
    p_ret_msg  := 'Wrong RF_SERVICE_TYPE value: ' || v_rf_type;  
     
     
   END IF;
    
   ELSE

        P_SLT_FUNCTIONS_V2.Call_RF_reservefacilityNGN(
                                  p_serv_id,
                                p_sero_id,
                                p_seit_id,
                                p_impt_taskname,
                                p_woro_id,
                                p_ret_char,
                                p_ret_number,
                                p_ret_msg);    
    
       IF p_ret_msg is not null THEN 

         p_ret_msg  := 'Failed: ' || p_ret_msg;

       END IF;

    END IF;

END IF; 

dbms_output.put_line(p_ret_msg);

EXCEPTION
WHEN OTHERS THEN

      p_ret_msg  := 'Work order closing failed:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
      
END Call_RF_NGN_CHK_SUCCESS_Y_KS;
-- 02-11-2012 Samankula Owitipana

--- 11-12-2012  Samankula Owitipana
PROCEDURE adsl_check_x_connections(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
v_sero_order_tp varchar2(50);
v_port_data        varchar2(50);   
CURSOR sero_cur IS    
SELECT sero_ordt_type
FROM service_orders
WHERE sero_id = p_sero_id;
CURSOR c_port_data IS
select po.PORT_NAME 
from service_orders so,circuits ci,port_links pl,port_link_ports plp,ports po
where so.SERO_CIRT_NAME = ci.CIRT_NAME
and ci.CIRT_NAME = pl.PORL_CIRT_NAME
and pl.PORL_ID = plp.POLP_PORL_ID
and plp.POLP_PORT_ID = po.PORT_ID
and so.SERO_ID =p_sero_id
and po.PORT_NAME like 'DSL-IN-%';
BEGIN
p_ret_msg := '';
open c_port_data;
fetch c_port_data into v_port_data;
close c_port_data;
open sero_cur;
fetch sero_cur into v_sero_order_tp;
close sero_cur;
IF  v_port_data IS NULL THEN 
p_ret_msg  := 'Wrong circuit crossconnection or crossconnection not designed.' ;                                      
END IF;
EXCEPTION
WHEN OTHERS THEN 
p_ret_msg  := 'check X connection failed. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END adsl_check_x_connections;
--- 11-12-2012  Samankula Owitipana

--- 18-12-2012  Samankula Owitipana
PROCEDURE adsl_check_x_con_update_cct(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
      
v_sero_order_tp varchar2(50);
v_port_data        varchar2(50);   
CURSOR sero_cur IS   
SELECT sero_ordt_type
FROM service_orders
WHERE sero_id = p_sero_id;
CURSOR c_port_data IS
select po.PORT_NAME 
from service_orders so,circuits ci,port_links pl,port_link_ports plp,ports po
where so.SERO_CIRT_NAME = ci.CIRT_NAME
and ci.CIRT_NAME = pl.PORL_CIRT_NAME
and pl.PORL_ID = plp.POLP_PORL_ID
and plp.POLP_PORT_ID = po.PORT_ID
and so.SERO_ID =p_sero_id
and po.PORT_NAME like 'DSL-IN-%';
BEGIN
p_ret_msg := '';
P_dynamic_procedure.Process_ISSUE_WORK_ORDER(
        p_serv_id,
        p_sero_id,
        p_seit_id,
        p_impt_taskname,
        p_woro_id,
        p_ret_char,
        p_ret_number,
        p_ret_msg);        
IF p_ret_msg IS NULL THEN
open c_port_data;
fetch c_port_data into v_port_data;
close c_port_data;
open sero_cur;
fetch sero_cur into v_sero_order_tp;
close sero_cur;
IF  v_port_data IS NULL THEN 
p_ret_msg  := 'Wrong circuit crossconnection or crossconnection not designed.' ;                                      
END IF;
ELSE
p_ret_msg := p_ret_msg || ' - CCT set commission error';     
END IF;
EXCEPTION
WHEN OTHERS THEN 
p_ret_msg  := 'check X connection failed. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END adsl_check_x_con_update_cct;
--- 18-12-2012  Samankula Owitipana

-- Jayan Liyanage 2012/12/10

PROCEDURE D_PREMIUM_VPN_MODIFY_SPEED (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS v_cir_status              VARCHAR2 (100); v_new_bearer_id           VARCHAR2 (100); v_section_hndle           VARCHAR2 (100); v_service_type  VARCHAR2 (100); v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100); v_rtom_code               VARCHAR2 (100); v_lea_code                VARCHAR2 (100); v_acc_bear_status         VARCHAR2 (100);
v_core_network            VARCHAR2 (100); v_acc_medium              VARCHAR2 (100); v_work_group              VARCHAR2 (100); v_acc_nw                  VARCHAR2 (100); v_cur_ntu_class           VARCHAR2 (100);
v_pre_ntu_class           VARCHAR2 (100); v_work_group_cpe          VARCHAR2 (100); v_ser_ctg                 VARCHAR2 (100); v_so_attr_name            VARCHAR2 (100);
v_so_attr_val             VARCHAR2 (100); v_bearer_id               VARCHAR2 (100); v_no_of_copper_pair_cur   VARCHAR2 (100); v_no_of_copper_pair_pre   VARCHAR2 (100);
v_cpe_class_cur           VARCHAR2 (100); v_cpe_class_pre           VARCHAR2 (100); v_acc_port_bw_cur         VARCHAR2 (100); v_acc_port_bw_pre         VARCHAR2 (100);
v_cur_ntu_model           VARCHAR2 (100); v_pre_ntu_model           VARCHAR2 (100); v_cur_cpe_model           VARCHAR2 (100); v_pre_cpe_model           VARCHAR2 (100);
v_Cur_port_bw             VARCHAR2 (100); v_Pre_port_bw             VARCHAR2 (100); v_acc_nw_pre              VARCHAR2 (100); v_agre_nw_1               varchar2 (1000); v_agre_nw_2               varchar2 (1000);              
BEGIN  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
--SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_ntu_class, v_pre_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_ntu_model, v_pre_ntu_model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_acc_nw,v_acc_nw_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_Cur_port_bw,v_Pre_port_bw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'NO OF COPPER PAIRS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cpe_class_cur, v_cpe_class_pre FROM service_order_attributes soa  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_cpe_model, v_pre_cpe_model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_acc_port_bw_cur, v_acc_port_bw_pre  FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
SELECT soa.seoa_defaultvalue  INTO v_agre_nw_1  FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';
SELECT soa.seoa_defaultvalue  INTO v_agre_nw_2  FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
IF  v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND (   (v_section_hndle LIKE 'SALES-ENT-%') OR (v_section_hndle LIKE 'SALES-WSALE-%') )
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'  AND v_acc_medium = 'P2P RADIO' AND v_Cur_port_bw <> v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_no_of_copper_pair_cur <> v_no_of_copper_pair_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REDESIGN CIRCUIT';
ELSE DELETE      service_implementation_tasks sit  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REDESIGN CIRCUIT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') AND v_no_of_copper_pair_cur > v_no_of_copper_pair_pre THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT';ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT';END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND (v_no_of_copper_pair_cur > v_no_of_copper_pair_pre)THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONST. ADD. OSP LINE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONST. ADD. OSP LINE';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_no_of_copper_pair_cur = v_no_of_copper_pair_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY TRIB. PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY TRIB. PORT';END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_acc_medium = 'P2P RADIO'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY RADIO LINK';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY RADIO LINK';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_Cur_ntu_class = 'SLT' AND v_cur_ntu_model <> v_pre_ntu_model THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY NTU'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_Cur_ntu_class = 'SLT' AND v_cur_ntu_model = v_pre_ntu_model
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'RECONFIG NTU'AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_cpe_class_cur = 'SLT'AND v_cpe_class_pre = 'SLT'AND v_cur_cpe_model <> v_pre_cpe_model
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY CPE' AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_cpe_class_cur = 'SLT'AND v_cpe_class_pre <> 'SLT'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'INSTALL CPE'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-SPEED' AND v_cpe_class_cur <> 'SLT' AND v_cpe_class_pre = 'SLT'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'COLLECT CPE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'COLLECT CPE'AND sit.seit_sero_id = p_sero_id; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-SPEED' AND v_cpe_class_cur = 'SLT'AND v_cur_cpe_model = v_pre_cpe_model THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'RECONFIG CPE'AND sit.seit_sero_id = p_sero_id;END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_agre_nw_1 = 'MEN'AND v_agre_nw_2 = 'MEN' AND v_acc_nw = 'MEN PORT'  THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN VLAN'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY MEN VLAN'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_agre_nw_1 = 'CEN'AND v_agre_nw_2 = 'CEN' AND v_acc_nw = 'CEN PORT'  THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEN VLAN'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY CEN VLAN'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND v_acc_nw = 'MEN PORT' AND v_Cur_port_bw = v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN SUB PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND v_acc_nw = 'CEN PORT' AND v_Cur_port_bw = v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CEN SUB PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_acc_nw = 'MEN PORT'AND v_Cur_port_bw <> v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN PORT BW';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY MEN PORT BW' AND sit.seit_sero_id = p_sero_id;END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND (v_section_hndle LIKE 'SALES-ENT-%' OR v_section_hndle LIKE 'SALES-WSALE-%')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN';
ELSIF  v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_section_hndle LIKE 'SALES-SME-%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_ser_ctg = 'TEST'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle||'-ACCM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED' AND (v_no_of_copper_pair_cur <> v_no_of_copper_pair_pre or v_acc_port_bw_cur <> v_acc_port_bw_pre)
THEN UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_section_hndle || '-FO'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'UPDATE ACC. BEARER';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'UPDATE ACC. BEARER'AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. OSP LINE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-SPEED'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. OSP LINE';END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id,0, p_seit_id,'COMPLETED' ); EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Premium VPN Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM; p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg
);/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND v_core_network = 'MEN'AND v_acc_port_bw_cur = v_acc_port_bw_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'AND ((v_core_network = 'CEN') OR (v_core_network = 'MPLS')) THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED' AND v_core_network = 'MEN'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';  ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';END IF;
*/END D_PREMIUM_VPN_MODIFY_SPEED;

-- Jayan Liyanage 2012/12/10

--Dulip Fernando 2012-04-23
PROCEDURE RESERVER_RELEASE_PORT(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_ACCESS_NW_INTF VARCHAR2(100);
v_NO_OF_COPPER_PAIRS_OLD NUMBER(2);
v_NO_OF_COPPER_PAIRS_NEW NUMBER(2);
V_ACCESS_INTF_PORT_BW_NEW VARCHAR2(10);
V_ACCESS_INTF_PORT_BW_OLD VARCHAR2(10);


            cursor c_access_nw is                 
            select SEOA_DEFAULTVALUE 
            from SERVICE_ORDER_ATTRIBUTES
            where SEOA_NAME='ACCESS N/W INTF' AND SEOA_SERO_ID=p_sero_id;

            cursor c_copper_no_new is
            select SEOA_DEFAULTVALUE 
            from SERVICE_ORDER_ATTRIBUTES
            where SEOA_NAME='NO OF COPPER PAIRS' AND SEOA_SERO_ID=p_sero_id;
            
            cursor c_copper_no_old is
            select SEOA_PREV_VALUE 
            from SERVICE_ORDER_ATTRIBUTES
            where SEOA_NAME='NO OF COPPER PAIRS' AND SEOA_SERO_ID=p_sero_id;
            
            cursor c_acc_port_bw_new is
            select SEOA_DEFAULTVALUE 
            from SERVICE_ORDER_ATTRIBUTES
            where SEOA_NAME='ACCESS INTF PORT BW' AND SEOA_SERO_ID=p_sero_id;
            
            cursor c_acc_port_bw_old is
            select SEOA_PREV_VALUE 
            from SERVICE_ORDER_ATTRIBUTES
            where SEOA_NAME='ACCESS INTF PORT BW' AND SEOA_SERO_ID=p_sero_id;

BEGIN

open c_access_nw;
fetch c_access_nw INTO v_ACCESS_NW_INTF;
close c_access_nw;

open c_copper_no_new;
fetch c_copper_no_new INTO v_NO_OF_COPPER_PAIRS_NEW;
close c_copper_no_new;

open c_copper_no_old;         
fetch c_copper_no_old INTO v_NO_OF_COPPER_PAIRS_OLD;
close c_copper_no_old;
            
open c_acc_port_bw_new;
fetch c_acc_port_bw_new INTO V_ACCESS_INTF_PORT_BW_NEW;
close c_acc_port_bw_new;

open c_acc_port_bw_old;
fetch c_acc_port_bw_old INTO V_ACCESS_INTF_PORT_BW_OLD;
close c_acc_port_bw_old;

            

      IF 

            v_ACCESS_NW_INTF='MSAN PORT' AND (v_NO_OF_COPPER_PAIRS_NEW > v_NO_OF_COPPER_PAIRS_OLD)
                  


                  THEN
                  
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RELEASE ADD MSANPORT';
 
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE MEN PORT';

      ELSIF

            
            v_ACCESS_NW_INTF='MSAN PORT' AND (v_NO_OF_COPPER_PAIRS_NEW < v_NO_OF_COPPER_PAIRS_OLD)



                  THEN
                  
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE ADD MSANPO';
 
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE MEN PORT';

      ELSIF


            v_ACCESS_NW_INTF='MEN PORT'AND (V_ACCESS_INTF_PORT_BW_NEW <> V_ACCESS_INTF_PORT_BW_OLD)

            

            THEN
                  
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE ADD MSANPO';
                        
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RELEASE ADD MSANPORT';
                                    
      ELSE
      
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE ADD MSANPO';
                        
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RESERVE MEN PORT';
                                    
                        DELETE service_implementation_tasks sit
                              WHERE sit.seit_sero_id = p_sero_id
                              AND sit.seit_taskname = 'RELEASE ADD MSANPORT';       
                                    
                        

      END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
 
 
EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change Task .Please check : - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  


END RESERVER_RELEASE_PORT;

---Dulip Fernando 2012-04-23

-- 25-05-2012 Samankula Owitipana
PROCEDURE I_MYWEB_SET_SERVICE_IDENTIY (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS

    
v_domain_name varchar2(50);    
cursor c_domain_name_id is    
SELECT upper(soa.seoa_defaultvalue) 
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DOMAIN_NAME';
BEGIN
open c_domain_name_id;
fetch c_domain_name_id into v_domain_name;
close c_domain_name_id;
IF v_domain_name is not null THEN
UPDATE service_orders so
set so.SERO_SERV_DISPLAYNAME = v_domain_name
where so.SERO_ID = p_sero_id;
END IF;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');   
EXCEPTION
WHEN OTHERS THEN
p_ret_msg  := 'Failed to set service identifier. '  || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
, p_ret_msg );
END I_MYWEB_SET_SERVICE_IDENTIY;
-- 25-05-2012 Samankula Owitipana

-- 06-03-2012 jayan Liyanage 

PROCEDURE I_MYWEB_WG_CHANGE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_service_type    VARCHAR2 (100);
v_section_hndle   VARCHAR2 (100);
v_oredr_type      VARCHAR2 (100);

BEGIN SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_oredr_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
IF     v_oredr_type = 'CREATE' AND v_service_type = 'I-MY WEB' AND (   v_section_hndle LIKE 'SALES-ENT-%' OR v_section_hndle LIKE 'SALES-WSALE-%')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_oredr_type = 'CREATE' AND v_service_type = 'I-MY WEB' AND v_section_hndle LIKE 'SALES-SME' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF; 
IF     v_oredr_type = 'DELETE'AND v_service_type = 'I-MY WEB'AND (   v_section_hndle LIKE 'SALES-ENT-%'OR v_section_hndle LIKE 'SALES-WSALE-%')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_oredr_type = 'DELETE'AND v_service_type = 'I-MY WEB' AND v_section_hndle LIKE 'SALES-SME'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
END IF;IF     v_oredr_type = 'SUSPEND'AND v_service_type = 'I-MY WEB'AND (   v_section_hndle LIKE 'SALES-ENT-%'OR v_section_hndle LIKE 'SALES-WSALE-%')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_oredr_type = 'SUSPEND' AND v_service_type = 'I-MY WEB'AND v_section_hndle LIKE 'SALES-SME'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
IF     v_oredr_type = 'RESUME'AND v_service_type = 'I-MY WEB'AND (   v_section_hndle LIKE 'SALES-ENT-%'OR v_section_hndle LIKE 'SALES-WSALE-%')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_oredr_type = 'RESUME' AND v_service_type = 'I-MY WEB' AND v_section_hndle LIKE 'SALES-SME'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
IF     v_oredr_type = 'MODIFY-FEATURE'AND v_service_type = 'I-MY WEB'AND (   v_section_hndle LIKE 'SALES-ENT-%'OR v_section_hndle LIKE 'SALES-WSALE-%')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_oredr_type = 'MODIFY-FEATURE' AND v_service_type = 'I-MY WEB'AND v_section_hndle LIKE 'SALES-SME'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'MKT-SALES-SMER-MGR'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'COMPLETED');
EXCEPTION WHEN OTHERS THEN
p_ret_msg :='Failed to Change WG in I_MYWEB Process function. Please check the Attributes:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg
);
END I_MYWEB_WG_CHANGE;

-- 06-03-2012 jayan Liyanage 

--- 21-01-2013 Janaka
PROCEDURE SLT_SET_DSLAM_SVLAN_ID(      p_serv_id                IN     Services.serv_id%TYPE,
      p_sero_id                IN     Service_Orders.sero_id%TYPE,
      p_seit_id                IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname          IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                IN     work_order.woro_id%TYPE,
      p_ret_char                  OUT    VARCHAR2,
      p_ret_number                OUT    NUMBER,
      p_ret_msg                   OUT    VARCHAR2) IS

    CURSOR c_vlan_query (v_seit_id Service_Implementation_Tasks.seit_id%TYPE) IS
    SELECT 
    SUBSTR(SORD_VALUE,INSTR(SUBSTR(SORD_VALUE,1,INSTR(SORD_VALUE,CHR(9)||'Entree'||CHR(9))-1),CHR(9),-1,1)+1,(INSTR(SORD_VALUE,CHR(9)||'Entree'||CHR(9))) - (INSTR(SUBSTR(SORD_VALUE,1,INSTR(SORD_VALUE,CHR(9)||'Entree'||CHR(9))-1),CHR(9),-1,1)+1)) EntreeVLAN,
    SUBSTR(SORD_VALUE,INSTR(SUBSTR(SORD_VALUE,1,INSTR(SORD_VALUE,CHR(9)||'SVLAN'||CHR(9))-1),CHR(9),-1,1)+1,(INSTR(SORD_VALUE,CHR(9)||'SVLAN'||CHR(9))) - (INSTR(SUBSTR(SORD_VALUE,1,INSTR(SORD_VALUE,CHR(9)||'SVLAN'||CHR(9))-1),CHR(9),-1,1)+1)) EntreeSVLAN
     FROM service_implementation_tasks,
              sop_queue,
              sop_reply_data
        WHERE seit_id = v_seit_id 
          AND sopq_seit_id = seit_id
          AND sopq_sopc_command = 'LST-VLAN'
          AND sord_sopq_requestid = sopq_requestid
          AND SORD_NAME = 'RAW_MESSAGES';
          

    l_vlan_query          VARCHAR2(2000);
    l_entree_vlan_id    NUMBER;
    l_entree_Svlan_id    NUMBER;
    v_seit_id Service_Implementation_Tasks.seit_id%TYPE;

     e_no_vlan_data_found  EXCEPTION;

    BEGIN

         BEGIN
             SELECT MAX(SEIT_ID) 
            INTO v_seit_id 
            FROM SERVICE_IMPLEMENTATION_TASKS 
            WHERE SEIT_SERO_ID = p_sero_id AND SEIT_TASKNAME IN ('QUERY DSLAM VLAN ID','QUERY VLAN ID');
                 EXCEPTION
                   WHEN OTHERS THEN
                      p_ret_msg  := 'Unable to get Task Id for QUERY DSLAM SVLAN ID Task';
         END;

         OPEN c_vlan_query(v_seit_id);
         FETCH c_vlan_query 
         INTO l_entree_vlan_id ,l_entree_Svlan_id;
         CLOSE c_vlan_query;
         
         IF l_entree_Svlan_id IS NOT NULL
         THEN
            UPDATE SERVICE_ORDER_ATTRIBUTES SET SEOA_DEFAULTVALUE=SEOA_DEFAULTVALUE||'-S' 
            WHERE SEOA_SERO_ID=p_sero_id
            AND SEOA_NAME='ADSL_EQIP_MODEL';
            
            UPDATE SERVICE_ORDER_ATTRIBUTES soa
            SET soa.SEOA_DEFAULTVALUE = l_entree_Svlan_id
            WHERE soa.SEOA_NAME = 'SVLAN_ID'
            AND soa.SEOA_SERO_ID = p_sero_id;
         
         
         p_ret_char := 'OK';
        p_ret_msg := NULL;

        p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id, 'COMPLETED'); 
        
        ELSE
        
        p_ret_msg := NULL;

        p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id, 'COMPLETED');
        
    END IF;

 EXCEPTION

   WHEN e_no_vlan_data_found THEN
         p_ret_msg  := 'Failed to SET_DSLAM_SVLAN_ID. No data for SVlan ID' ;

    WHEN OTHERS THEN
       p_ret_msg  := 'Failed to SET_DSLAM_SVLAN_ID. Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
END SLT_SET_DSLAM_SVLAN_ID;

--- 21-01-2013 Janaka

--- Jayan Liyanage 2013/01/30

PROCEDURE D_PREMIUM_VPN_MODIFY_CPE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS


v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class_cur        VARCHAR2 (100);
v_ntu_class_pre        VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_ntu_model_cur        VARCHAR2 (100);
v_ntu_model_pre        VARCHAR2 (100);
v_cpe_class_cur        VARCHAR2 (100);
v_cpe_class_pre        VARCHAR2 (100);
v_cpe_type_cur         VARCHAR2 (100);
v_cpe_type_pre         VARCHAR2 (100);
v_cpe_model_cur        VARCHAR2 (100);
v_cpe_model_pre        VARCHAR2 (100);


BEGIN


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_acc_bear_status
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                           AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
/*
SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';*/

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_class_cur, v_ntu_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_model_cur, v_ntu_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_class_cur, v_cpe_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_type_cur, v_cpe_type_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_model_cur, v_cpe_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur <> v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;


IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_class_pre = 'SLT'
AND v_cpe_model_cur <> v_cpe_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_model_cur = v_cpe_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur = v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_class_pre <> 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur <> 'SLT'
AND v_cpe_class_pre = 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
END IF;

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-CPE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UPDATE ACC. BEARER';
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                         0,
                         p_seit_id,
                         'COMPLETED'
                        );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Premium VPN Modify CPE Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                            0,
                            p_seit_id,
                            'ERROR'
                           );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_PREMIUM_VPN_MODIFY_CPE;

--- Jayan Liyanage 2013/01/30


--- Jayan Liyanage 2013/01/30 / Modified --> 14/10/2015

PROCEDURE D_PREMIUM_VPN_MODIFY_EQUIP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class_cur        VARCHAR2 (100);
v_ntu_class_pre        VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_ntu_model_cur        VARCHAR2 (100);
v_ntu_model_pre        VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group_nw        VARCHAR2 (100);
v_cpe_class_cur         VARCHAR2 (100);
v_cpe_class_pre         VARCHAR2 (100);
v_acc_nw_intf            VARCHAR2 (100);
v_cpe_mod_cur           VARCHAR2 (100);
v_cpe_mod_pre           VARCHAR2 (100);
v_Cur_Vlan_Tag          VARCHAR2 (100);
v_Pre_Vlan_Tag          VARCHAR2 (100);



BEGIN


SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'ACCESS BEARER STATUS';

SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so
WHERE so.sero_id = p_sero_id;



SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                 AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name =
v_rtom_code || '-' || v_lea_code || '-OSP-NC';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name = v_rtom_code || '-CPE-NC' ;
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg
WHERE worg_name = v_rtom_code || '-ENG-NW';
/*
SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';*/

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_class_cur, v_ntu_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_model_cur, v_ntu_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';

SELECT soa.seoa_defaultvalue
INTO v_acc_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_acc_nw_intf
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';


SELECT soa.seoa_defaultvalue,SOA.SEOA_PREV_VALUE
INTO v_Cur_Vlan_Tag,v_Pre_Vlan_Tag
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE INTO v_cpe_class_cur, v_cpe_class_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE INTO v_cpe_mod_cur, v_cpe_mod_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';





IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;

/*IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur <> v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;*/


IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-EQUIPMENT' AND v_acc_bear_status = 'TO BE MODIFIED'  
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UPDATE ACC. BEARER';
END IF;


-- Modification Start 14/10/2015

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT' 
  AND v_ntu_class_cur = 'SLT' AND NVL(v_ntu_model_cur,0) <> NVL(v_ntu_model_pre,0) 
  and v_acc_medium = 'COPPER'
THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND
 sit.seit_taskname = 'MODIFY NTU'; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN' AND
   v_service_order = 'MODIFY-EQUIPMENT' AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) <> NVL(v_ntu_model_pre,0)
 and v_acc_medium = 'FIBER'
THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY NTU FO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY NTU FO'; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN' 
  AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) =  NVL(v_ntu_model_pre,0)
 and v_acc_medium = 'COPPER'
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU'; END IF;


IF     v_service_type = 'D-PREMIUM IPVPN' 
  AND v_service_order = 'MODIFY-EQUIPMENT' AND v_ntu_class_cur = 'SLT'
AND NVL(v_ntu_model_cur,0) = NVL(v_ntu_model_pre,0) 
and v_acc_medium = 'FIBER'
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG NTU FO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG NTU FO'; END IF;
 
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  v_acc_nw_intf = 'MEN PORT' and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG MEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG MEN PORT'; END IF;
   
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  v_acc_nw_intf = 'CEN PORT' and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG CEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG CEN PORT'; END IF;
 
 IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_acc_nw_intf = 'MSAN PORT' OR v_acc_nw_intf = 'DSLAM PORT') and NVL(v_Cur_Vlan_Tag,0) <> NVL(v_Pre_Vlan_Tag,0) 
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG SHDSL PORT'; END IF;
  
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre = 'SLT') and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'MODIFY CPE'; END IF;
 
/* IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND  ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre = 'SLT') and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0) THEN  
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'MODIFY CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'MODIFY CPE'; END IF;*/
 
  IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND v_cpe_class_cur = 'SLT' and NVL(v_cpe_mod_cur,0) = NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG CPE'; END IF;
 
   IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND ( v_cpe_class_cur = 'SLT' and  v_cpe_class_pre <> 'SLT') --and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'INSTALL CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'INSTALL CPE'; END IF;
 
   IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND ( v_cpe_class_cur <> 'SLT' and  v_cpe_class_pre = 'SLT') --and NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0)   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'DS-OPERATIONS'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'COLLECT CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'COLLECT CPE'; END IF;
 
 IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-EQUIPMENT'
   AND ( ( v_cpe_class_cur <> v_cpe_class_pre) or NVL(v_cpe_mod_cur,0) <> NVL(v_cpe_mod_pre,0) )   
THEN UPDATE service_implementation_tasks sit
   SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'RECONFIG IPVPN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
 AND sit.seit_taskname = 'RECONFIG IPVPN PORT'; END IF;
-- End 14/10/2015


p_implementation_tasks.update_task_status_byid (p_sero_id,
               0,
               p_seit_id,
               'COMPLETED'
              );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Premium VPN Modify - Equipment Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                  0,
                  p_seit_id,
                  'ERROR'
                 );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_PREMIUM_VPN_MODIFY_EQUIP;

--- Jayan Liyanage 2013/01/30 // Modified --> 14/10/2015


--- Jayan Liyanage 2013/02/11
  
PROCEDURE D_PREMIUM_VPN_SUSPEND (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS


v_service_type varchar2(100);
v_service_order varchar2(100);
v_section_hndle varchar2(100);
   
BEGIN

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'SUSPEND'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';

ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'SUSPEND'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';

ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;
   
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_PREMIUM_VPN_SUSPEND;

--- Jayan Liyanage 2013/02/11


--- Jayan Liyanage 2013/01/30

PROCEDURE D_DAB_UPDAT_SERIALNO_NOTIFY(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
BEGIN
     p_ret_char := 'Enter  New NTU Model...!' ;                                      
EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_DAB_UPDAT_SERIALNO_NOTIFY;

--- Jayan Liyanage 2013/01/30


--- Jayan Liyanage 2013/02/11   

PROCEDURE D_PREMIUM_VPN_RESUME (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

   
v_service_type varchar2(100);
v_service_order varchar2(100);
v_section_hndle varchar2(100);


BEGIN

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'RESUME'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';

ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'RESUME'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';

ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;
   
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_PREMIUM_VPN_RESUME;

--- Jayan Liyanage 2013/02/11

--- Jayan Liyanage 2012/03/12

PROCEDURE D_ETHERNET_VPN_MODIFY_CPE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS


v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class_cur        VARCHAR2 (100);
v_ntu_class_pre        VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_ntu_model_cur        VARCHAR2 (100);
v_ntu_model_pre        VARCHAR2 (100);
v_cpe_class_cur        VARCHAR2 (100);
v_cpe_class_pre        VARCHAR2 (100);
v_cpe_type_cur         VARCHAR2 (100);
v_cpe_type_pre         VARCHAR2 (100);
v_cpe_model_cur     VARCHAR2 (100);
v_cpe_model_pre     VARCHAR2 (100);
BEGIN


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_acc_bear_status
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                           AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';

SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_class_cur, v_ntu_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_model_cur, v_ntu_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_class_cur, v_cpe_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_type_cur, v_cpe_type_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_cpe_model_cur, v_cpe_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur <> v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;


IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_class_pre = 'SLT'
AND v_cpe_model_cur <> v_cpe_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE';
END IF;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_model_cur = v_cpe_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur =  v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur = 'SLT'
AND v_cpe_class_pre <> 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_cpe_class_cur <> 'SLT'
AND v_cpe_class_pre = 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-CPE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
END IF;

IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-CPE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UPDATE ACC. BEARER';
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
                         0,
                         p_seit_id,
                         'COMPLETED'
                        );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                            0,
                            p_seit_id,
                            'ERROR'
                           );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_MODIFY_CPE;

--- Jayan Liyanage 2012/03/12



--- Jayan Liyanage 2012/03/12 updated on 03/08/2015

PROCEDURE D_ETHERNET_VPN_MODIFY_EQUIP (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class_cur        VARCHAR2 (100);
v_ntu_class_pre        VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_ntu_model_cur        VARCHAR2 (100);
v_ntu_model_pre        VARCHAR2 (100);
BEGIN


SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_acc_bear_status
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                 AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';

SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_class_cur, v_ntu_class_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue,soa.SEOA_PREV_VALUE
INTO v_ntu_model_cur, v_ntu_model_pre
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';




IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_ntu_class_cur = 'SLT'
AND v_ntu_model_cur <> v_ntu_model_pre
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEA')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY VPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND v_core_network = 'MEN'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-EQUIPMENT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UPDATE ACC. BEARER';
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
               0,
               p_seit_id,
               'COMPLETED'
              );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Modify - Equipment Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                  0,
                  p_seit_id,
                  'ERROR'
                 );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_MODIFY_EQUIP;

--- Jayan Liyanage 2012/03/20


--- Jayan Liyanage 2012/03/16 Updated on 12/10/2015

PROCEDURE D_ETHERNET_VPN_SUS_RES (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_section_hndle      VARCHAR2 (100);
   v_service_type       VARCHAR2 (100);
   v_service_ord_type   VARCHAR2 (100);
   v_core_nw            VARCHAR2 (100);
BEGIN
   SELECT so.sero_ordt_type, so.sero_sert_abbreviation
     INTO v_service_ord_type, v_service_type
     FROM service_orders so
    WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_section_hndle
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'SECTION HANDLED BY';

   SELECT soa.seoa_defaultvalue
     INTO v_core_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name ='VPLS CORE NETWORK';

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_ord_type = 'SUSPEND'
      AND (   v_section_hndle LIKE 'SALES-ENT-%'
           OR v_section_hndle LIKE 'SALES-WSALE-%'
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_ord_type = 'SUSPEND'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-PSM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
       
   ELSIF     v_service_type = 'D-ETHERNET VPN'
           AND v_service_ord_type = 'SUSPEND' THEN
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_ord_type = 'SUSPEND'
      AND v_core_nw = 'MEN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_ord_type = 'SUSPEND'
         AND (v_core_nw = 'MPLS' OR v_core_nw = 'CEN')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
   END IF;

   ----- Resume Start
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_ord_type = 'RESUME'
      AND (   v_section_hndle LIKE 'SALES-ENT-%'
           OR v_section_hndle LIKE 'SALES-WSALE-%'
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_ord_type = 'RESUME'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-PSM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
       
   ELSIF     v_service_type = 'D-ETHERNET VPN'
           AND v_service_ord_type = 'RESUME' THEN
           
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_ord_type = 'RESUME'
      AND v_core_nw = 'MEN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_ord_type = 'RESUME'
         AND (v_core_nw = 'MPLS' OR v_core_nw = 'CEN')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   END IF;

   --- Resume End
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_ETHERNET_VPN_SUS_RES;

--- Jayan Liyanage 2012/03/12  Updated on 12/10/2015

-- Dulip Fernando  2012/04/09 

PROCEDURE APPROVE_SO_WG_CHANGE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);

BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION_HANDLED_BY'AND SEOA_SERO_ID=p_sero_id;


 IF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%'  THEN
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'SALES-SME-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO' ;
 
        ELSIF (v_SECTION_HANDLE_WG LIKE 'SALES-ENT-%') OR (v_SECTION_HANDLE_WG  LIKE 'SALES-WSALE-%' ) THEN
        
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'SALES-SIU-MGR'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO';

 END IF;
 
 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change SECTION_HANDLE_WG .Please check SECTION_HANDLE:' || v_SECTION_HANDLE_WG || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END APPROVE_SO_WG_CHANGE;


-- Dulip Fernando  2012/04/09 

-- Dulip Fernando  2012/04/11

PROCEDURE UPLOAD_LAN_PRO_WG_CHANGE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char           OUT VARCHAR2,
      p_ret_number         OUT NUMBER,
      p_ret_msg            OUT VARCHAR2) IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);

BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
from SERVICE_ORDER_ATTRIBUTES
where SEOA_NAME='SECTION_HANDLED_BY'AND SEOA_SERO_ID=p_sero_id;


         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-ACCM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'UPLOAD LAN PROFILE' ;
 
      
 p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change SECTION_HANDLE_WG .Please check SECTION_HANDLE:' || v_SECTION_HANDLE_WG || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END UPLOAD_LAN_PRO_WG_CHANGE;


-- Dulip Fernando  2012/04/11

-- Jayan Liyanage 2012/05/14 --- 14/10/2015

PROCEDURE BEARER_CPE_EQUI_MAP (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_actual_dsp_date    VARCHAR2 (100);
   bearer_id            VARCHAR2 (100);
   v_service_od_id      VARCHAR2 (100);
   v_cir_status         VARCHAR2 (100);
   v_service_ord_type   VARCHAR2 (100);
   v_new_bearer_id      VARCHAR2 (100);
   v_new_service        VARCHAR2 (100);
   v_Acc_Bear_Stat      VARCHAR2 (100);

/*
   CURSOR bearer_so (v_bearer_id VARCHAR)
   IS
      SELECT DISTINCT so.sero_id,C.CIRT_STATUS
                 FROM service_orders so, circuits c
                WHERE so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'PENDINGDELETE'
                       AND c.cirt_status <> 'CANCELLED'
                      )
                  AND (     so.sero_stas_abbreviation <> 'CANCELLED'
                      AND so.sero_stas_abbreviation <> 'CLOSED'
                      )
                  AND c.cirt_displayname = v_bearer_id;*/
   CURSOR bearer_so (v_new_bearer_id VARCHAR, v_new_service VARCHAR)
   IS
      SELECT DISTINCT soa.seoa_sero_id, c.cirt_status
                 FROM service_orders so,
                      service_order_attributes soa,
                      circuits c
                WHERE so.sero_id = soa.seoa_sero_id
                  AND so.sero_cirt_name = c.cirt_name
                  AND (    c.cirt_status <> 'CANCELLED'
                       AND c.cirt_status <> 'PENDINGDELETE'
                      )
                  AND so.sero_stas_abbreviation <> 'CANCELLED'
                  AND so.sero_ordt_type = v_new_service
                  AND so.sero_id IN (
                         SELECT MAX (s.sero_id)
                           FROM service_orders s, circuits ci
                          WHERE s.sero_cirt_name = ci.cirt_name
                            AND s.sero_ordt_type = v_new_service
                            AND ci.cirt_displayname = v_new_bearer_id);
BEGIN
   SELECT DISTINCT soa.seoa_defaultvalue
              INTO bearer_id
              FROM service_orders so, service_order_attributes soa
             WHERE so.sero_id = soa.seoa_sero_id
               AND soa.seoa_name = 'ACCESS_ID'
               AND so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_ord_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_actual_dsp_date
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACTUAL_DSP_DATE';
    
    
       SELECT soa.seoa_defaultvalue
     INTO v_Acc_Bear_Stat
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
    
    

   OPEN bearer_so (bearer_id, v_service_ord_type);

   FETCH bearer_so
    INTO v_service_od_id, v_cir_status;

   CLOSE bearer_so;

   IF v_Acc_Bear_Stat = 'TO BE MODIFIED'
   THEN
      UPDATE service_order_attributes soa
         SET soa.seoa_defaultvalue = v_actual_dsp_date
       WHERE soa.seoa_sero_id = v_service_od_id
         AND soa.seoa_name = 'ACTUAL_DSP_DATE';

      UPDATE service_implementation_tasks sit
         SET sit.seit_stas_abbreviation = 'COMPLETED'
       WHERE sit.seit_taskname = 'ENTER BEARER DSP'
         AND sit.seit_sero_id = v_service_od_id;
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change  Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END BEARER_CPE_EQUI_MAP;

-- Jayan Liyanage 2012/05/14 -- 14/10/2015

--- 08-02-2013  Samankula Owitipana
--- 03-01-2014 Edited -----
---- 15-12-2015 Edited to new X-Connections ----
PROCEDURE ADSL_PSTN_CARD_PORT_CHK (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS

v_already_rearranged varchar2(30);
v_adsl_equip_id number;
v_adsl_cct_id varchar2(30);
v_adsl_dis_name varchar2(30);
v_pstn_cct_id varchar2(30);
v_pstn_dis_name varchar2(30);
v_adsl_loc_aend varchar2(100);
v_adsl_inservice_dt date;
v_adsl_cct_state varchar2(30);
v_adsl_speed varchar2(100);
v_pstn_loc_aend varchar2(100);
v_pstn_loc_bend varchar2(100);
v_dp_loc varchar2(100);
v_split_index varchar2(10);
v_pstn_cr varchar2(30);
v_pstn_ac varchar2(30);
v_bearer_cct_id varchar2(30);
v_dp_loop number;
v_dp_r_plp_position varchar2(5);
v_dp_index varchar2(10);              
v_splitter_equip_id number;              
v_splitter_pot_out_id number;              
v_splitter_dsl_in_id number;               
v_splitter_pot_in_id number;
v_adsl_card_slot varchar2(100);
v_adsl_port_id number;
v_pstn_msan_pl_id number;
v_msan_sw_child_pid number;
v_dslam_logic_plid number; 
v_dslam_logic_ptin_pid number;
v_dslam_logic_ptin_position varchar2(5);
v_dslam_dp_plid number;
v_dslam_dp_fraa_id number;
v_msan_adsl_plid number;
v_dslam_adsl_plid number;
p_error_msg varchar2(1000);
p_error_2 varchar2(1000);
v_pstn_pots_card varchar2(100);
v_pstn_pots_port varchar2(100);
v_adsl_pots_card varchar2(100);
v_adsl_pots_port varchar2(100);
v_adsl_eq_id number;
v_pstn_eq_id number;

/*cursor adsl_card_port is
select po.PORT_CARD_SLOT,po.PORT_ID
from ports po
where (po.PORT_CARD_SLOT not like 'P%' and po.PORT_CARD_SLOT not like 'DP%')
and po.PORT_CIRT_NAME = v_adsl_cct_id; */

-- curser modifed to check the pstn rearranged or not
cursor chk_already_rearranged (in_cirt_id in varchar2)is
select ci.CIRT_NAME 
from CIRCUIT_HIERARCHY ch,circuits ci
where ch.CIRH_PARENT = ci.CIRT_NAME
and ci.CIRT_TYPE = 'BEARER'
and ch.CIRH_CHILD = in_cirt_id;

chk_already_rearranged_re chk_already_rearranged%rowtype;

begin

P_dynamic_procedure.PROCESS_UPDATE_CIRT_commision(
              p_serv_id,
              p_sero_id,
              p_seit_id,
              p_impt_taskname,
              p_woro_id,
              p_ret_char,
              p_ret_number,
              p_ret_msg);
              

IF p_ret_msg IS NULL THEN


select so.SERO_CIRT_NAME,replace(ci.CIRT_DISPLAYNAME,'(N)','') 
into v_adsl_cct_id,v_adsl_dis_name
from service_orders so,circuits ci
where so.SERO_CIRT_NAME = ci.CIRT_NAME
and so.SERO_ID = p_sero_id;

select eq.EQUP_ID
into v_adsl_equip_id
from equipment eq,ports po,port_link_ports plp,port_links pl
where eq.EQUP_ID = po.PORT_EQUP_ID
and po.port_id = plp.polp_port_id
and plp.polp_porl_id = pl.porl_id
and pl.porl_cirt_name = v_adsl_cct_id
and (po.PORT_CARD_SLOT not like 'D%' and po.PORT_CARD_SLOT not like 'M%' and po.PORT_CARD_SLOT not like 'NA%');
--and eq.EQUP_EQUT_ABBREVIATION like 'MSAN-%'; 

SELECT trim(SOA.SEOA_DEFAULTVALUE)
INTO v_pstn_dis_name
FROM SERVICE_ORDER_ATTRIBUTES SOA
WHERE SOA.SEOA_SERO_ID = p_sero_id
AND SOA.SEOA_NAME = 'SA_PSTN_NUMBER';

SELECT ci.CIRT_NAME
INTO v_pstn_cct_id
FROM circuits ci
WHERE ci.CIRT_DISPLAYNAME like v_pstn_dis_name || '%'
and (ci.CIRT_STATUS not like 'CA%' and ci.CIRT_STATUS not like 'PE%' and ci.CIRT_STATUS <> 'OUTOFSERVICE'
and ci.CIRT_STATUS <> 'COPY' );

open chk_already_rearranged(v_pstn_cct_id);
fetch chk_already_rearranged into chk_already_rearranged_re;
close chk_already_rearranged;

if chk_already_rearranged_re.CIRT_NAME is null then 

    select distinct po.PORT_CARD_SLOT,replace(po.PORT_NAME,'POTS-OUT-',''),po.PORT_EQUP_ID
    into v_pstn_pots_card,v_pstn_pots_port,v_pstn_eq_id
    from port_links pl,port_link_ports plp,ports po
    where pl.PORL_ID = plp.POLP_PORL_ID
    and plp.POLP_PORT_ID = po.PORT_ID
    and po.PORT_NAME like 'POTS-OUT-%'
    and pl.PORL_CIRT_NAME = v_pstn_cct_id
    and rownum = 1;

else

    select distinct po.PORT_CARD_SLOT,replace(po.PORT_NAME,'POTS-IN-',''),po.PORT_EQUP_ID
    into v_pstn_pots_card,v_pstn_pots_port,v_pstn_eq_id
    from port_links pl,port_link_ports plp,ports po
    where pl.PORL_ID = plp.POLP_PORL_ID
    and plp.POLP_PORT_ID = po.PORT_ID
    and po.PORT_NAME like 'POTS-IN-%'
    and pl.PORL_CIRT_NAME = v_pstn_cct_id
    and rownum = 1;

end if;

select distinct po.PORT_CARD_SLOT,replace(po.PORT_NAME,'DSL-IN-',''),po.PORT_EQUP_ID
into v_adsl_pots_card,v_adsl_pots_port,v_adsl_eq_id
from port_links pl,port_link_ports plp,ports po
where pl.PORL_ID = plp.POLP_PORL_ID
and plp.POLP_PORT_ID = po.PORT_ID
and po.PORT_NAME like 'DSL-IN-%'
and pl.PORL_CIRT_NAME = v_adsl_cct_id;

IF (v_adsl_pots_card = v_pstn_pots_card) and (v_adsl_pots_port = v_pstn_pots_port)
and (v_adsl_eq_id = v_pstn_eq_id) THEN

null;  
  
ELSE

p_ret_msg  := 'ADSL Circuit DSL-IN Card and port not match with PSTN POTS-IN card and port. ' || p_error_msg;

END IF;  

ELSE

p_ret_msg  :=  p_ret_msg;

END IF;  

   
exception  
when others then
 
    p_error_msg := ' ADSL PSTN CARD PORT CHECK FAILED: ' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM || ' Failed at ' || p_error_2;
    p_ret_msg := p_error_msg;    
 
end ADSL_PSTN_CARD_PORT_CHK;
---- 15-12-2015 Edited to new X-Connections ----
--- 03-01-2014 Edited -----
--- 08-02-2013  Samankula Owitipana

--- Jayan Liyanage 2012/03/21

PROCEDURE D_ETHERNET_VPN_MODIFY_SPEED (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS v_cir_status              VARCHAR2 (100);
v_new_bearer_id           VARCHAR2 (100);
v_section_hndle           VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_acc_bear_status         VARCHAR2 (100);
v_core_network            VARCHAR2 (100);
v_acc_medium              VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_acc_nw                  VARCHAR2 (100);
v_cur_ntu_class           VARCHAR2 (100);
v_pre_ntu_class           VARCHAR2 (100);
v_work_group_cpe          VARCHAR2 (100);
v_ser_ctg                 VARCHAR2 (100);
v_so_attr_name            VARCHAR2 (100);
v_so_attr_val             VARCHAR2 (100);
v_bearer_id               VARCHAR2 (100);
v_no_of_copper_pair_cur   VARCHAR2 (100);
v_no_of_copper_pair_pre   VARCHAR2 (100);
v_cpe_class_cur           VARCHAR2 (100);
v_cpe_class_pre           VARCHAR2 (100);
v_acc_port_bw_cur         VARCHAR2 (100);
v_acc_port_bw_pre         VARCHAR2 (100);
v_cur_ntu_model           VARCHAR2 (100);
v_pre_ntu_model           VARCHAR2 (100);
v_cur_cpe_model           VARCHAR2 (100);
v_pre_cpe_model           VARCHAR2 (100);
v_Cur_port_bw             VARCHAR2 (100);
v_Pre_port_bw             VARCHAR2 (100);
v_acc_nw_pre              VARCHAR2 (100);BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_ntu_class, v_pre_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_ntu_model, v_pre_ntu_model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_acc_nw,v_acc_nw_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_Cur_port_bw,v_Pre_port_bw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id  AND soa.seoa_name = 'NO OF COPPER PAIRS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cpe_class_cur, v_cpe_class_pre FROM service_order_attributes soa  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_cpe_model, v_pre_cpe_model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_acc_port_bw_cur, v_acc_port_bw_pre  FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
IF  v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY PRICING'; END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND (   (v_section_hndle LIKE 'SALES-ENT-%') OR (v_section_hndle LIKE 'SALES-WSALE-%') )
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED' AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') AND v_no_of_copper_pair_cur > v_no_of_copper_pair_pre THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT';ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACT. ADD. SHDSL PORT';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT ADD.SHDSL PORT';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_no_of_copper_pair_cur = v_no_of_copper_pair_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY TRIB. PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY TRIB. PORT';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND (v_no_of_copper_pair_cur > v_no_of_copper_pair_pre)THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONST. ADD. OSP LINE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONST. ADD. OSP LINE';END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_no_of_copper_pair_cur <> v_no_of_copper_pair_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REDESIGN CIRCUIT';
ELSE DELETE      service_implementation_tasks sit  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REDESIGN CIRCUIT';END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'AND v_core_network = 'MEN'AND v_acc_port_bw_cur = v_acc_port_bw_pre THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'AND ((v_core_network = 'CEN') OR (v_core_network = 'MPLS')) THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY VPLS PORT';END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED' AND v_core_network = 'MEN'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';  ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND (v_section_hndle LIKE 'SALES-ENT-%' OR v_section_hndle LIKE 'SALES-WSALE-%')THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN';
ELSIF  v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_section_hndle LIKE 'SALES-SME-%'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';END IF;IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED' AND (v_no_of_copper_pair_cur <> v_no_of_copper_pair_pre or v_acc_port_bw_cur <> v_acc_port_bw_pre)
THEN UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_section_hndle || '-FO'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'UPDATE ACC. BEARER';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'UPDATE ACC. BEARER'AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'
AND v_Cur_ntu_class = 'SLT' AND v_cur_ntu_model <> v_pre_ntu_model THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY NTU';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY NTU'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_Cur_ntu_class = 'SLT' AND v_cur_ntu_model = v_pre_ntu_model
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'RECONFIG NTU'AND sit.seit_sero_id = p_sero_id;END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_cpe_class_cur = 'SLT'AND v_cpe_class_pre = 'SLT'AND v_cur_cpe_model <> v_pre_cpe_model
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY CPE' AND sit.seit_sero_id = p_sero_id;END IF; IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'MODIFY-SPEED'AND v_cpe_class_cur = 'SLT'AND v_cpe_class_pre <> 'SLT'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'INSTALL CPE'
AND sit.seit_sero_id = p_sero_id;END IF;IF     v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-SPEED' AND v_cpe_class_cur <> 'SLT' AND v_cpe_class_pre = 'SLT'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'COLLECT CPE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'COLLECT CPE'AND sit.seit_sero_id = p_sero_id; END IF; IF     v_service_type = 'D-ETHERNET VPN'  AND v_service_order = 'MODIFY-SPEED'
AND v_cpe_class_cur = 'SLT'AND v_cur_cpe_model = v_pre_cpe_model THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'RECONFIG CPE'AND sit.seit_sero_id = p_sero_id;END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'MODIFY-SPEED'AND v_acc_nw = 'MEN PORT'AND v_Cur_port_bw <> v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MEN PORT BW';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'MODIFY MEN PORT BW' AND sit.seit_sero_id = p_sero_id;END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'  AND v_acc_medium = 'P2P RADIO' AND v_Cur_port_bw <> v_Pre_port_bw THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONDUCT FIELD TRIAL';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_acc_medium = 'P2P RADIO'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY RADIO LINK';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY RADIO LINK';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_ser_ctg = 'TEST'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle||'-ACCM'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';END IF;
IF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE ADD. OSP LINE'; ELSIF     v_service_type = 'D-ETHERNET VPN'AND v_service_order = 'MODIFY-SPEED'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE ADD. OSP LINE';END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id,0, p_seit_id,'COMPLETED' ); EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM; p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg
);
END D_ETHERNET_VPN_MODIFY_SPEED;
--- Jayan Liyanage 2012/03/21
--- Jayan Liyanage 2013/01/10(Last modify on 28/01/2015)

PROCEDURE D_PREMIUM_VPN_DELETE (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS



CURSOR cur_tributer (parent_name VARCHAR2,order_Cir  VARCHAR2)IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'PROPOSED%' OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%' OR ci.cirt_status NOT LIKE 'PENDING%' )
AND ci.CIRT_DISPLAYNAME <> order_Cir AND c.cirt_displayname = replace(parent_name,'(N)');
CURSOR cur_equi_type IS SELECT DISTINCT e.equp_equt_abbreviation
FROM service_orders so, ports p, equipment e WHERE so.sero_cirt_name = p.port_cirt_name
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

   v_service_type         VARCHAR2 (100);
   v_service_order        VARCHAR2 (100);
   v_section_hndle        VARCHAR2 (100);
   v_core_network         VARCHAR2 (100);
   v_acc_nw               VARCHAR2 (100);
   v_access_bear_id       VARCHAR2 (100);
   parent_name            VARCHAR2 (100);
   v_ch_parent            VARCHAR2 (100);
   v_ch_dis               VARCHAR2 (100);
   v_cir_trib_status      VARCHAR2 (100);
   v_acc_medium           VARCHAR2 (100);
   v_media_type           VARCHAR2 (100);
   v_equip_type           VARCHAR2 (100);
   v_work_group_mdf       VARCHAR2 (100);
   v_ntu_class            VARCHAR2 (100);
   v_cpe_class            VARCHAR2 (100);
   v_service_order_area   VARCHAR2 (100);
   v_rtom_code            VARCHAR2 (100);
   v_lea_code             VARCHAR2 (100);
   v_work_group           VARCHAR2 (100);
   v_work_group_cpe       VARCHAR2 (100);
   v_new_Cir_Name         VARCHAR2 (100); 
   order_Cir              VARCHAR2 (100); 
   v_aggr_1               VARCHAR2 (100); 
   v_aggr_2               VARCHAR2 (100); 
   v_work_group_EN        VARCHAR2 (100); 
   v_work_group_nw     VARCHAR2 (100);
BEGIN
   OPEN cur_equi_type;  FETCH cur_equi_type    INTO v_equip_type;
   CLOSE cur_equi_type;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_access_bear_id FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';    
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes, ar.area_code INTO v_rtom_code, v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
---SELECT wg.worg_name INTO v_work_group_EN FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NM' || '%';
SELECT wg.worg_name INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';
--SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_media_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_cpe_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue INTO v_aggr_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';
SELECT soa.seoa_defaultvalue INTO v_aggr_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
    
OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);
FETCH cur_tributer
INTO v_ch_dis, v_cir_trib_status;
CLOSE cur_tributer;
   -- close Cur_Tributer;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%') )
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO'; END IF; 
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_nw <> 'MPLS PORT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE IPVPN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE IPVPN PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' 
AND v_acc_nw = 'MEN PORT'AND v_ch_dis IS NULL
 THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
END IF;
 IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS NOT NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE MPLS SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE MPLS SUB PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE'AND
(v_aggr_1 = 'MEN' or v_aggr_2 = 'MEN')AND v_acc_nw <>  'MEN PORT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT MEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT MEN VLAN';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'AND (v_aggr_1 = 'CEN' or v_aggr_2 = 'CEN')
AND v_acc_nw <>  'CEN PORT' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT CEA VLAN';
ELSE DELETE      service_implementation_tasks sit 
  WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT CEA VLAN'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
ELSE DELETE      service_implementation_tasks sit 
  WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'CEN PORT' AND v_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'MEN PORT' AND v_ch_dis IS NOT NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NOT  NULL THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NOT NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'FIBER'
AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS   NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE AGG LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE AGG LINK';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'P2P RADIO'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
END IF; 

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'P2P RADIO'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
END IF;


IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ntu_class = 'SLT' AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';


ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE'
  AND v_cpe_class = 'SLT'AND v_ch_dis IS NULL THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE'; 

ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT CPE'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE'
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
p_ret_msg :=
'Failed to Change D-Premium  VPN Delete Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);


END D_PREMIUM_VPN_DELETE;
--- Jayan Liyanage 2013/01/10
-- Jayan Liyanage 2013/01/15  

PROCEDURE D_PREMIUM_VPN_DELETE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

CURSOR cur_tributer (parent_name VARCHAR2,order_Cir  VARCHAR2)IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'PROPOSED%' OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%' OR ci.cirt_status NOT LIKE 'PENDING%' )
AND ci.CIRT_DISPLAYNAME <> order_Cir AND c.cirt_displayname = parent_name;
CURSOR cur_equi_type IS SELECT DISTINCT e.equp_equt_abbreviation
FROM service_orders so, ports p, equipment e WHERE so.sero_cirt_name = p.port_cirt_name
AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;

   v_service_type         VARCHAR2 (100);
   v_service_order        VARCHAR2 (100);
   v_section_hndle        VARCHAR2 (100);
   v_core_network         VARCHAR2 (100);
   v_acc_nw               VARCHAR2 (100);
   v_access_bear_id       VARCHAR2 (100);
   parent_name            VARCHAR2 (100);
   v_ch_parent            VARCHAR2 (100);
   v_ch_dis               VARCHAR2 (100);
   v_cir_trib_status      VARCHAR2 (100);
   v_acc_medium           VARCHAR2 (100);
   v_media_type           VARCHAR2 (100);
   v_equip_type           VARCHAR2 (100);
   v_work_group_mdf       VARCHAR2 (100);
   v_ntu_class            VARCHAR2 (100);
   v_cpe_class            VARCHAR2 (100);
   v_service_order_area   VARCHAR2 (100);
   v_rtom_code            VARCHAR2 (100);
   v_lea_code             VARCHAR2 (100);
   v_work_group           VARCHAR2 (100);
   v_work_group_cpe       VARCHAR2 (100);
   v_new_Cir_Name         VARCHAR2 (100); 
   order_Cir              VARCHAR2 (100); 
   v_aggr_1               VARCHAR2 (100); 
   v_aggr_2               VARCHAR2 (100); 
   v_work_group_EN        VARCHAR2 (100); 
-- v_work_group_mdf     VARCHAR2 (100);
BEGIN
   OPEN cur_equi_type;  FETCH cur_equi_type    INTO v_equip_type;
   CLOSE cur_equi_type;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_access_bear_id FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';    
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes, ar.area_code INTO v_rtom_code, v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT wg.worg_name INTO v_work_group_EN FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
SELECT wg.worg_name INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';
--SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_media_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue INTO v_cpe_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue INTO v_aggr_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';
SELECT soa.seoa_defaultvalue INTO v_aggr_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
    
OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);
FETCH cur_tributer
INTO v_ch_dis, v_cir_trib_status;
CLOSE cur_tributer;
   -- close Cur_Tributer;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%') )
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO'; END IF; 
IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw <> 'MPLS PORT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE IPVPN PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE IPVPN PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MEN PORT'AND v_ch_dis IS NULL
 THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
END IF; 

IF     v_service_type = 'D-PREMIUM IPVPN'                       
AND v_service_order = 'DELETE-OR' AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS not  NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE MPLS SUB PORT';
ELSE DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DELETE MPLS SUB PORT';                
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR'AND
(v_aggr_1 = 'MEN' or v_aggr_2 = 'MEN')AND v_acc_nw <> 'MEN PORT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT MEN VLAN';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT MEN VLAN';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'AND (v_aggr_1 = 'CEN' or v_aggr_2 = 'CEN')
AND v_acc_nw <>  'CEN PORT' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT CEN VLAN';
ELSE DELETE service_implementation_tasks sit 
  WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT CEN VLAN'; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
ELSE DELETE  service_implementation_tasks sit 
  WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'CEN PORT' AND v_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MEN PORT' AND v_ch_dis IS NOT NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
ELSE DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NOT  NULL THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS not  NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_medium = 'FIBER'
AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
ELSE DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS   NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_EN
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE AGG LINK';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE AGG LINK';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_medium = 'P2P RADIO'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
ELSE
DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
END IF; 

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_medium = 'P2P RADIO'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
END IF;


IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ntu_class = 'SLT' AND v_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';

ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw <> 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL 
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_EN
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR'
  AND v_cpe_class = 'SLT'AND v_ch_dis IS NULL THEN
 UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE'; 

ELSE DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT CPE'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR'
AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
ELSE DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
0,p_seit_id,'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
p_ret_msg :=
'Failed to Change D-Premium  VPN Delete-Or Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id,'ERROR');
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);


END D_PREMIUM_VPN_DELETE_OR;
-- Jayan Liyanage 2013/01/15  

--- Jayan Liyanage 2012/03/12

PROCEDURE D_ETHERNET_VPN_CREATE_OR (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   v_cir_status           VARCHAR2 (100);
   v_new_bearer_id        VARCHAR2 (100);
   v_section_hndle        VARCHAR2 (100);
   v_service_type         VARCHAR2 (100);
   v_service_order        VARCHAR2 (100);
   v_service_order_area   VARCHAR2 (100);
   v_rtom_code            VARCHAR2 (100);
   v_lea_code             VARCHAR2 (100);
   v_acc_bear_status      VARCHAR2 (100);
   v_core_network         VARCHAR2 (100);
   v_acc_medium           VARCHAR2 (100);
   v_work_group           VARCHAR2 (100);
   v_acc_nw               VARCHAR2 (100);
   v_ntu_class            VARCHAR2 (100);
   v_work_group_cpe       VARCHAR2 (100);
   v_ser_ctg              VARCHAR2 (100);
   v_so_attr_name         VARCHAR2 (100);
   v_so_attr_val          VARCHAR2 (100);
   v_bearer_id            VARCHAR2 (100);
   v_cpe_class            VARCHAR2 (100);
   v_work_group_ENG       VARCHAR2 (100);
   Cur_v_cpe_Model        VARCHAR2 (100);
   Pre_v_cpe_Model        VARCHAR2 (100);
   v_fib_avalable         VARCHAR2 (100);
   
BEGIN
   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_section_hndle
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'SECTION HANDLED BY';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_bear_status
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS BEARER STATUS';

   SELECT DISTINCT so.sero_area_code
              INTO v_service_order_area
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                                                     AS codes,
          ar.area_code
     INTO v_rtom_code,
          v_lea_code
     FROM areas ar
    WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

   SELECT wg.worg_name
     INTO v_work_group
     FROM work_groups wg
    WHERE worg_name LIKE
                    v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

   SELECT wg.worg_name
     INTO v_work_group_cpe
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';

   SELECT wg.worg_name
     INTO v_work_group_ENG
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';

   SELECT soa.seoa_defaultvalue
     INTO v_core_network
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_medium
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

   SELECT soa.seoa_defaultvalue
     INTO v_ntu_class
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
    
  SELECT soa.seoa_defaultvalue
     INTO v_cpe_class
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
    
   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO  Cur_v_cpe_Model,Pre_v_cpe_Model
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

   SELECT soa.seoa_defaultvalue
     INTO v_ser_ctg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
    
    select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
     where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

/*   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle||'-PSM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'VERIFY PRICING';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'VERIFY PRICING';
   END IF;*/

/*   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SME-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE INVOICE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ISSUE INVOICE';
   END IF;*/

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%')
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-OR'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_rtom_code || '-RTOM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'APPROVE SO';
   END IF;

/*   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_core_network = 'MEN'
      AND v_acc_nw <> 'MEN PORT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-OR'
         --AND v_acc_bear_status = 'INSERVICE'
         AND ((v_core_network = 'CEN' AND v_acc_nw <> 'CEN PORT')
         OR (v_core_network = 'MPLS' AND  v_acc_nw <> 'MPLS PORT'))
         
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG VPLS PORT';
   END IF;*/

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_medium = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'MSAN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_ntu_class = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_cpe
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL NTU';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-OR'
         AND v_acc_nw <> 'MSAN PORT'
         AND v_acc_bear_status = 'COMMISSIONED'
         AND v_ntu_class = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_ENG
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL NTU';
   END IF;

  /* IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_core_network = 'MEN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-OR'
         AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   END IF;*/

  /* IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_core_network = 'MEN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'CREATE-OR'
         AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   END IF;*/

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_ser_ctg = 'TEST'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-ACCM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
   END IF;

   IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
   END IF;

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE ACC BEARER';

   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE ACC BEARER';

   END IF;
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS PORT';
   END IF;
   
   --- Jayan Liyanage Modified 2014 /10 /24

/*   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_medium = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COMM. FIBER LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COMM. FIBER LINK';
   END IF;
*/

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_medium = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED' AND  ( v_fib_avalable = 'NO' OR 
      v_fib_avalable = 'INCOMPLETE')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SFC-SOM-DATA'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'WAIT FOR FIBER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'WAIT FOR FIBER';
   END IF;

-- Jayan Liyanage Modified End 2014/10/24

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_medium = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'SETUP RADIO LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'SETUP RADIO LINK';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_cpe_class  = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL CPE';
   END IF;

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
   END IF;

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   END IF;

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   END IF;


   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_cpe_class  = 'SLT'
      AND v_acc_bear_status = 'INSERVICE'
      AND Cur_v_cpe_Model <> Pre_v_cpe_Model
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY CPE';
   END IF;
   
      IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_cpe_class  = 'SLT'
      AND v_acc_bear_status = 'INSERVICE'
      AND Cur_v_cpe_Model <> Pre_v_cpe_Model
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG CPE';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND v_ntu_class  = 'SLT'
      AND v_acc_bear_status = 'INSERVICE'

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG NTU';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'CREATE-OR'
      AND (v_acc_medium = 'FIBER' OR v_acc_medium = 'COPPER-TWP')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_ENG
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
   END IF;



   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-Ethernet VPN Create-Or Process function. Please check the order conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_ETHERNET_VPN_CREATE_OR;

--- Jayan Liyanage 2012/03/21


--- Jayan Liyanage 2013/03/08

PROCEDURE BER_DEL (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS
   CURSOR cur_tributery
   IS
      SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
                 FROM circuits c,
                      circuit_hierarchy ch,
                      circuits ci,
                      service_orders so
                WHERE c.cirt_name = ch.cirh_parent
                  AND ch.cirh_child = ci.cirt_name
                  AND so.sero_cirt_name = c.cirt_name
                  AND (   ci.cirt_status LIKE 'INSERVICE%'
                       OR ci.cirt_status LIKE 'PROPOSED%'
                       OR ci.cirt_status LIKE 'SUSPEND%'
                       OR ci.cirt_status LIKE 'COMMISS%'
                      )
                  AND (   ci.cirt_status NOT LIKE 'CANCE%'
                       OR ci.cirt_status NOT LIKE 'PENDING%'
                      )
                  AND so.sero_id = p_sero_id;

   v_cir_dispaly_name   VARCHAR2 (100);
   v_cir_status         VARCHAR2 (100);
BEGIN
   p_ret_msg := '';

   OPEN cur_tributery;

   FETCH cur_tributery
    INTO v_cir_dispaly_name, v_cir_status;

   CLOSE cur_tributery;

   IF v_cir_dispaly_name IS NOT NULL
   THEN
      p_ret_msg :=
            'D-DAB Service Tributery are available , Please Check the Bearer Tributery Service:'
         || v_cir_dispaly_name;
   ELSE
      p_ret_msg := '';
   END IF;
EXCEPTION
   WHEN NO_DATA_FOUND
   THEN
      p_ret_msg := '';
END BER_DEL;

--- Jayan Liyanage 2013/03/08

--- Jayan Liyanage 2013/03/08

--Dulip Fernando and Indika de Silva 2013-03-06

PROCEDURE  SEC_HAN_PSM_OR_MGR(

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                      IN     Service_Orders.sero_id%TYPE,
      p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                      IN     work_order.woro_id%TYPE,
      p_ret_char                     OUT    VARCHAR2,
      p_ret_number                   OUT    NUMBER,
      p_ret_msg                      OUT    VARCHAR2) IS


v_sec_handel_by      VARCHAR2(100) := null;
v_rtom               VARCHAR2(100);


CURSOR seoa_cur IS
SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes
WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION HANDLED BY';


BEGIN

p_ret_char := '';

OPEN  seoa_cur;
FETCH seoa_cur INTO v_sec_handel_by;
CLOSE seoa_cur;


IF v_sec_handel_by is null 

THEN 

p_ret_char := 'CORP-SSU';

ELSIf (v_sec_handel_by LIKE 'SALES-ENT-%') OR (v_sec_handel_by  LIKE 'SALES-WSALE-%')

THEN
       
p_ret_char := v_sec_handel_by || '-MGR';
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
         WHERE SIT.SEIT_SERO_ID = p_sero_id;
         

ELSIF  (v_sec_handel_by LIKE 'SALES-SME-%') 

THEN
       
p_ret_char := v_sec_handel_by || '-PSM';
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
         WHERE SIT.SEIT_SERO_ID =  p_sero_id;
         

END IF;

p_ret_msg := '';

EXCEPTION

WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:Please check SECTION_HANDLE_WG ' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END SEC_HAN_PSM_OR_MGR;

--Dulip Fernando and Indika de Silva 2013-03-06 

--- Jayan Liyanage 2013/03/08
PROCEDURE D_PRE_NOTIFY_MSG(
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
BEGIN
     p_ret_char := 'Verify PLANNED MIGRATION DATE...!' ;                                      
EXCEPTION WHEN OTHERS THEN 
      p_ret_msg  := 'Notify function Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;                                    
END D_PRE_NOTIFY_MSG;
--- Jayan Liyanage 2013/03/07


-- Jayan Liyanage 2013/01/15  COPPER TWP to COPPER UTP changed on 28/06/2014

PROCEDURE D_PREMIUM_VPN_CREATE_OR (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_cpe_class            VARCHAR2 (100);
v_work_group_ENG       VARCHAR2 (100);
Cur_v_cpe_Model        VARCHAR2 (100);
Pre_v_cpe_Model        VARCHAR2 (100);
v_agrregate_nw_1       VARCHAR2 (100);
v_agrregate_nw_2       VARCHAR2 (100);
v_fib_avalable         VARCHAR2 (100);
BEGIN
SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_acc_bear_status
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';

SELECT soa.seoa_defaultvalue
INTO v_agrregate_nw_1
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NETWORK 1';

SELECT soa.seoa_defaultvalue
INTO v_agrregate_nw_2
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'AGGREGATE NETWORK 2';

select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
SELECT wg.worg_name INTO v_work_group_ENG FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';
---SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_medium FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue INTO v_ntu_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';    
SELECT soa.seoa_defaultvalue INTO v_cpe_class FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';  
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO  Cur_v_cpe_Model,Pre_v_cpe_Model FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

 IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle||'-PSM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY PRICING';
END IF;

/*   IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SME-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE INVOICE';
END IF;*/

   IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;

/*   IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_bear_status = 'INSERVICE'
AND v_core_network = 'MEN'
AND v_acc_nw <> 'MEN PORT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
--AND v_acc_bear_status = 'INSERVICE'
AND ((v_core_network = 'CEN') OR (v_core_network = 'MPLS'))
AND v_acc_nw <> 'MEN PORT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG VPLS PORT';
END IF;
*/
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_medium = 'P2P RADIO'
AND v_acc_bear_status = 'COMMISSIONED'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'MSAN PORT'
AND v_acc_bear_status = 'COMMISSIONED'
AND v_ntu_class = 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw <> 'MSAN PORT'
AND v_acc_bear_status = 'COMMISSIONED'
AND v_ntu_class = 'SLT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_ENG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
END IF;

/*   IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw <> 'MPLS PORT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG IPVPN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG IPVPN PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_ser_ctg = 'TEST'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-ACCM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM TEST SERVICE';
END IF;
IF v_service_type = 'D-PREMIUM IPVPN' AND 
  v_service_order = 'CREATE-OR'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ISSUE DELETE-OR SO';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN PORT';
END IF;

-- Jayan Liyanage 2014 / 10 / 24
/*IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_medium = 'FIBER'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COMM. FIBER LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COMM. FIBER LINK';
END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_medium = 'FIBER'
AND v_acc_bear_status = 'COMMISSIONED' AND  ( v_fib_avalable = 'NO' 
OR v_fib_avalable = 'INCOMPLETE')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'WAIT FOR FIBER';
END IF;

-- Jayan Liyanage 2014 / 10 / 24


IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_medium = 'P2P RADIO'
AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_cpe_class  = 'SLT'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL CPE';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'INSERVICE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_cpe_class  = 'SLT'
AND v_acc_bear_status = 'INSERVICE'
AND Cur_v_cpe_Model <> Pre_v_cpe_Model
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY CPE';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_cpe_class  = 'SLT'
AND v_acc_bear_status = 'INSERVICE'
AND Cur_v_cpe_Model <> Pre_v_cpe_Model
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG CPE';
END IF;
 IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND (v_acc_medium = 'FIBER' OR v_acc_medium = 'COPPER-UTP' )
AND v_acc_bear_status = 'COMMISSIONED'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_ENG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id =p_sero_id
AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
END IF;

/*IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw <> 'MEN PORT'
AND (v_agrregate_nw_1 = 'MEN' OR v_agrregate_nw_2 = 'MEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_ENG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN VLAN';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_acc_nw <> 'MEN PORT'
AND (v_agrregate_nw_1 = 'CEN' OR v_agrregate_nw_2 = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_ENG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN VLAN';
END IF;*/IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'CREATE-OR'
AND v_ntu_class  = 'SLT'
AND v_acc_bear_status = 'INSERVICE'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'RECONFIG NTU';
END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Premium VPN Create-Or Process function. Please check the order conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_PREMIUM_VPN_CREATE_OR;
-- Jayan Liyanage 2013/01/15  

-- Dulip Fernando  2012/05/15 

PROCEDURE DEL_OR_WG_CHNAGE(
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS
 
 
v_SECTION_HANDLE_WG VARCHAR2(100);

BEGIN


select SEOA_DEFAULTVALUE INTO v_SECTION_HANDLE_WG
FROM service_order_attributes
where SEOA_NAME='SECTION_HANDLED_BY'AND SEOA_SERO_ID=p_sero_id;


 IF v_SECTION_HANDLE_WG LIKE 'SALES-SME-%'  THEN
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = v_SECTION_HANDLE_WG||'-PSM'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO' ;
 
        ELSIF v_SECTION_HANDLE_WG like 'SALES-ENT-%' or v_SECTION_HANDLE_WG like 'SALES-WSALE-%' THEN
        
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = 'SALES-SIU-MGR'
         WHERE SIT.SEIT_SERO_ID =  p_sero_id
         AND SIT.SEIT_TASKNAME = 'APPROVE SO';

   END IF;
   
   
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
       

EXCEPTION
WHEN OTHERS THEN
 
      p_ret_msg  := 'Failed to change SECTION_HANDLE_WG .Please check SECTION_HANDLE:' || v_SECTION_HANDLE_WG || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
 
 
    p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');
 
 
    INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
    SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
    , p_ret_msg);
  

END DEL_OR_WG_CHNAGE;
-- Dulip Fernando  2012/05/15 

--- Jayan Liyanage 2013/03/11

PROCEDURE D_E_VPN_CREATE_TR_ID (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type    VARCHAR2(100);
v_service_order   VARCHAR2(100);
v_core_network    VARCHAR2(100);
v_acc_nw          VARCHAR2(100);

BEGIN
  
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';



IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT') 
OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT')) THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'  THEN 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF  v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' 
THEN DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF;
IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-TRANSFER' THEN 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' 
  AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' 
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' 
AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT') 
OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT')) 
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'CONFIG VPLS PORT';
 ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' THEN 
 DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' 
  AND v_core_network = 'MEN' THEN
UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
 ELSIF     v_service_type = 'D-ETHERNET VPN'
  AND v_service_order = 'CREATE-OR'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') 
THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; 
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' THEN
 DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
   AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit 
  SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; 
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
 ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE-OR' THEN
  DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;


IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' 
  AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT')
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' 
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
 AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT') 
OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT')) THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; 
ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'  THEN  DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_core_network = 'MEN' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'  THEN 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF;

IF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE' AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF     v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'CREATE'  THEN 
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;



p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet Create-Transf VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_E_VPN_CREATE_TR_ID;

--- Jayan Liyanage 2013/03/11

--- Jayan Liyanage 2013/03/12
PROCEDURE  BEARER_CP(
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS

v_acc_bear_id varchar2(100);

begin

SELECT soa.seoa_defaultvalue INTO v_acc_bear_id
 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'ACCESS BEARER ID';
UPDATE service_order_attributes SOA
SET SOA.SEOA_DEFAULTVALUE = v_acc_bear_id where 
soa.seoa_name = 'ACCESS_ID' and  soa.seoa_sero_id = p_sero_id;
  
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Copy Bearer Att Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END BEARER_CP;

--- Jayan Liyanage 2013/03/12

--- Jayan Liyanage 2013/03/12

PROCEDURE D_PREMIUM_VPN_BEA_ATT_CP_DEL (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS

CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, 
service_order_attributes soa 
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID'AND so.sero_id = p_sero_id;

CURSOR so_copyattr (v_new_bearer_id VARCHAR)
IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status 
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED' AND ci.cirt_displayname LIKE  v_new_bearer_id||'%'); 

v_so_attr_name     VARCHAR2 (100); 
v_so_attr_val      VARCHAR2 (100); 
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100); 
v_new_bearer_id    VARCHAR2 (100); 
v_service_type     VARCHAR2 (100); 
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);

BEGIN OPEN bearer;FETCH bearer INTO v_bearer_id;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);
LOOP FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 
EXIT WHEN so_copyattr%NOTFOUND;


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;
 END LOOP; 

 CLOSE so_copyattr;CLOSE bearer;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id, 'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Ethernet VPN Process function. Please check the conditions:' || ' - Erro is:'|| TO_CHAR (SQLCODE)
|| '-'|| SQLERRM;p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id, 'ERROR'  );
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_PREMIUM_VPN_BEA_ATT_CP_DEL;

--- Jayan Liyanage 2013/03/12

-- Jayan Liyanage 2013/03/12
PROCEDURE D_PREM_VPN_X_CONNE_WG_CHG_DEL (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2)IS

v_equip_type              VARCHAR2 (100); v_eq_loc_name             VARCHAR2 (100); v_service_type            VARCHAR2 (100); v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100); v_rtom_code               VARCHAR2 (100); v_lea_code                VARCHAR2 (100); v_work_group              VARCHAR2 (100); v_work_group_mdf          VARCHAR2 (100);
v_location                VARCHAR2 (100); v_main_node               VARCHAR2 (100); v_sub_node                VARCHAR2 (100); v_acc_nw                  VARCHAR2 (100);
v_acc_bearer_status       VARCHAR2 (100); v_mig_type                VARCHAR2 (100); v_access_bear_id          VARCHAR2 (100); v_ch_dis                  VARCHAR2 (100);
v_cir_trib_status         VARCHAR2 (100); v_cur_nof_copper          VARCHAR2 (100); v_pre_nof_copper          VARCHAR2 (100); v_access_node_chg         VARCHAR2 (100);
v_no_of_copper_pair_cur   VARCHAR2 (100); v_no_of_copper_pair_pre   VARCHAR2 (100); v_new_cir_id              VARCHAR2 (100);    v_new_Cir_Name            VARCHAR2 (100);           


CURSOR cur_equi_type IS
SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname FROM service_orders so, ports p, equipment e
WHERE so.sero_cirt_name = p.port_cirt_name AND (   e.equp_equt_abbreviation LIKE 'MSAN%'OR e.equp_equt_abbreviation LIKE 'DSLAM%'OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')AND p.port_equp_id = e.equp_id AND so.sero_id = p_sero_id;
CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 )IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name
AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%'OR ci.cirt_status NOT LIKE 'PENDING%'
)AND ci.CIRT_DISPLAYNAME <> v_new_cir_id AND c.cirt_displayname = parent_name; BEGIN
OPEN cur_equi_type;FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name;CLOSE cur_equi_type;
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT soa.seoa_defaultvalue INTO v_mig_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';
SELECT soa.seoa_defaultvalue INTO v_acc_bearer_status FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cur_nof_copper, v_pre_nof_copper FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
SELECT soa.seoa_defaultvalue INTO v_access_bear_id FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name and  so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_access_node_chg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS NODE CHANGE?';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,ar.area_code INTO v_rtom_code, v_lea_code
FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
SELECT wg.worg_name INTO v_work_group_mdf FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';
SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1) AS node INTO v_location FROM DUAL;
SELECT TRIM (SUBSTR (v_location, 1, INSTR (v_location, '-', '1', 1) - 1)) AS main_node,
TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node INTO v_main_node, v_sub_node FROM DUAL;
OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status;CLOSE cur_tributer;

IF v_main_node IS NOT NULL THEN IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_main_node <> v_sub_node AND 
  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')AND v_ch_dis IS NULL THEN 
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
    AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_work_group_mdf
       WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
      THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_main_node <> v_sub_node AND 
  (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')AND v_ch_dis IS NULL THEN 
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_main_node = v_sub_node AND (v_equip_type LIKE 'MSAN%' or v_equip_type LIKE 'DSLAM%')
    AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit  SET sit.seit_worg_name = v_work_group_mdf
       WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
      THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF;
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE DSL LINE';ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' THEN  DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE DSL LINE';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'NO'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_main_node <> v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT';ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'NO' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
AND v_main_node <> v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'YES'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_main_node <> v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'YES'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_main_node <> v_sub_node AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' THEN
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT';END IF;
*/END IF; IF v_main_node IS NULL THEN IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_equip_type LIKE 'MSAN%' AND (
  v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf  
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' THEN DELETE
      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_equip_type LIKE 'MSAN%' AND (
  v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_ch_dis IS NULL
THEN  UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_mdf  
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
ELSIF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' THEN DELETE
      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF; 
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'NO'
AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_equip_type LIKE 'MSAN%' AND v_access_node_chg = 'YES' AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT') AND v_acc_bearer_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_mdf WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' THEN DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MAKE MDF X CONNECT'; END IF;
*/END IF;
p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id, 'COMPLETED' ); EXCEPTION WHEN OTHERS THEN
p_ret_msg := 'Failed to Workgroup Mapping Please check the Cross Connection Equip Type  :  - Erro is:'
|| TO_CHAR (SQLCODE) || '-' || SQLERRM; p_implementation_tasks.update_task_status_byid (p_sero_id, 0, p_seit_id,'ERROR' );INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_PREM_VPN_X_CONNE_WG_CHG_DEL;

-- Jayan Liyanage 2013/03/12

--- Jayan Liyanage 2013/03/12

PROCEDURE D_ETH_VPN_CP_BEARER_ATT_DEL (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)IS

CURSOR bearer IS SELECT DISTINCT soa.seoa_defaultvalue FROM service_orders so, 
service_order_attributes soa 
WHERE so.sero_id = soa.seoa_sero_id AND soa.seoa_name = 'ACCESS_ID'AND so.sero_id = p_sero_id;

CURSOR so_copyattr (v_new_bearer_id VARCHAR)
IS SELECT DISTINCT soa.seoa_name, soa.seoa_defaultvalue, c.cirt_status 
FROM service_orders so, service_order_attributes soa, circuits c WHERE so.sero_id = soa.seoa_sero_id
AND so.sero_cirt_name = c.cirt_name AND (    c.cirt_status <> 'CANCELLED'AND c.cirt_status <> 'PENDINGDELETE')
AND so.sero_stas_abbreviation <> 'CANCELLED'AND so.sero_id IN (SELECT MAX (s.sero_id)FROM service_orders s, circuits ci 
WHERE s.sero_cirt_name = ci.cirt_name AND s.sero_stas_abbreviation <> 'CANCELLED' AND ci.cirt_displayname LIKE  v_new_bearer_id||'%'); 

v_so_attr_name     VARCHAR2 (100); 
v_so_attr_val      VARCHAR2 (100); 
v_bearer_id        VARCHAR2 (100);
v_cir_status       VARCHAR2 (100); 
v_new_bearer_id    VARCHAR2 (100); 
v_service_type     VARCHAR2 (100); 
v_service_order    VARCHAR2 (100);
v_new_service_type VARCHAR2 (100);

BEGIN OPEN bearer;FETCH bearer INTO v_bearer_id;

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id; 
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
OPEN so_copyattr (v_bearer_id);
LOOP FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 
EXIT WHEN so_copyattr%NOTFOUND;


IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS N/W INTF'
THEN  UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
    AND soa.seoa_name = 'ACCESS N/W INTF'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
 AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN  UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val
  WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';  
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE CLASS'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE CLASS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE TYPE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CPE MODEL'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'CPE MODEL'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' 
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU CLASS' THEN UPDATE service_order_attributes soa
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU TYPE'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
AND soa.seoa_name = 'NTU TYPE'; 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NTU ROUTING MODE' THEN UPDATE service_order_attributes soa 
SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'NTU ROUTING MODE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'ACCESS MEDIUM' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id 
 AND soa.seoa_name = 'NO OF COPPER PAIRS'; ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' 
 AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
 WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR'
AND v_so_attr_name = 'DATA RADIO MODEL'THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'DATA RADIO MODEL';
 
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CUSTOMER INTF TYPE';
ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'BACKBONE CORE NO'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'BACKBONE CORE NO'; 

ELSIF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'ACCESS LINK DISTANCE' 
THEN UPDATE service_order_attributes soa  SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS LINK DISTANCE'; ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'DELETE-OR' AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?'
THEN UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; END IF;
 END LOOP; 

 CLOSE so_copyattr;CLOSE bearer;

p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id, 'COMPLETED' );
EXCEPTION WHEN OTHERS THEN p_ret_msg :='Failed to Change D-Ethernet VPN Process function. Please check the conditions:' || ' - Erro is:'|| TO_CHAR (SQLCODE)
|| '-'|| SQLERRM;p_implementation_tasks.update_task_status_byid (p_sero_id,0,p_seit_id, 'ERROR'  );
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp,setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg);

END D_ETH_VPN_CP_BEARER_ATT_DEL;

--- Jayan Liyanage 2013/03/12

--- Jayan Liyanage 2013/03/12 Updated on 22/07/2014

PROCEDURE D_ETH_X_CONNE_WG_CHG_DEL (
   p_serv_id         IN     services.serv_id%TYPE,
   p_sero_id         IN     service_orders.sero_id%TYPE,
   p_seit_id         IN     service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN     implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN     work_order.woro_id%TYPE,
   p_ret_char           OUT VARCHAR2,
   p_ret_number         OUT NUMBER,
   p_ret_msg            OUT VARCHAR2)
IS

   v_equip_type              VARCHAR2 (100);
   v_eq_loc_name             VARCHAR2 (100);
   v_service_type            VARCHAR2 (100);
   v_service_order           VARCHAR2 (100);
   v_service_order_area      VARCHAR2 (100);
   v_rtom_code               VARCHAR2 (100);
   v_lea_code                VARCHAR2 (100);
   v_work_group              VARCHAR2 (100);
   v_work_group_mdf          VARCHAR2 (100);
   v_location                VARCHAR2 (100);
   v_main_node               VARCHAR2 (100);
   v_sub_node                VARCHAR2 (100);
   v_acc_nw                  VARCHAR2 (100);
   v_acc_bearer_status       VARCHAR2 (100);
   v_mig_type                VARCHAR2 (100);
   v_access_bear_id          VARCHAR2 (100);
   v_ch_dis                  VARCHAR2 (100);
   v_cir_trib_status         VARCHAR2 (100);
   v_cur_nof_copper          VARCHAR2 (100);
   v_pre_nof_copper          VARCHAR2 (100);
   v_access_node_chg         VARCHAR2 (100);
   v_no_of_copper_pair_cur   VARCHAR2 (100);
   v_no_of_copper_pair_pre   VARCHAR2 (100);
   v_new_cir_id              VARCHAR2 (100);
   v_new_Cir_Name            VARCHAR2 (100);
   v_acc_nw_pre              VARCHAR2 (100);

   CURSOR cur_equi_type
   IS
      SELECT DISTINCT e.equp_equt_abbreviation, e.equp_locn_ttname
        FROM service_orders so, ports p, equipment e
       WHERE     so.sero_cirt_name = p.port_cirt_name
             AND (   e.equp_equt_abbreviation LIKE 'MSAN%'
                  OR e.equp_equt_abbreviation LIKE 'DSLAM%'
                  OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%'
                  OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%')
             AND p.port_equp_id = e.equp_id
             AND so.sero_id = p_sero_id;

   CURSOR cur_tributer (
      parent_name     VARCHAR2,
      v_new_cir_id    VARCHAR2)
   IS
      SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
        FROM circuits c, circuit_hierarchy ch, circuits ci
       WHERE     c.cirt_name = ch.cirh_parent
             AND ch.cirh_child = ci.cirt_name
             AND (   ci.cirt_status LIKE 'INSERVICE%'
                  OR ci.cirt_status LIKE 'PROPOSED%'
                  OR ci.cirt_status LIKE 'SUSPEND%'
                  OR ci.cirt_status LIKE 'COMMISS%')
             AND (   ci.cirt_status NOT LIKE 'CANCE%'
                  OR ci.cirt_status NOT LIKE 'PENDING%')
             AND ci.CIRT_DISPLAYNAME <> v_new_cir_id
             AND c.cirt_displayname = parent_name;

BEGIN
   OPEN cur_equi_type;

   FETCH cur_equi_type
      INTO v_equip_type, v_eq_loc_name;

   CLOSE cur_equi_type;

   SELECT DISTINCT so.sero_sert_abbreviation
     INTO v_service_type
     FROM service_orders so
    WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
     INTO v_service_order
     FROM service_orders so
    WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_area_code
     INTO v_service_order_area
     FROM service_orders so
    WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue, soa.Seoa_Prev_Value
     INTO v_acc_nw, v_acc_nw_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

   SELECT soa.seoa_defaultvalue
     INTO v_mig_type
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_bearer_status
     FROM service_order_attributes soa
    WHERE     soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'ACCESS BEARER STATUS';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cur_nof_copper, v_pre_nof_copper
     FROM service_order_attributes soa
    WHERE     soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'NO OF COPPER PAIRS';

   SELECT soa.seoa_defaultvalue
     INTO v_access_bear_id
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';

   SELECT DISTINCT c.cirt_displayname
     INTO v_new_Cir_Name
     FROM service_orders so, circuits c
    WHERE so.sero_cirt_name = c.cirt_name AND so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_access_node_chg
     FROM service_order_attributes soa
    WHERE     soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'ACCESS NODE CHANGE?';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre
     FROM service_order_attributes soa
    WHERE     soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'NO OF COPPER PAIRS';

   SELECT SUBSTR (ar.area_area_code,
                  3,
                  INSTR (ar.area_area_code, '-', 1) + 1)
             AS codes,
          ar.area_code
     INTO v_rtom_code, v_lea_code
     FROM areas ar
    WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

   SELECT wg.worg_name
     INTO v_work_group
     FROM work_groups wg
    WHERE worg_name LIKE
             v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

   SELECT wg.worg_name
     INTO v_work_group_mdf
     FROM work_groups wg
    WHERE worg_name LIKE
             v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';

   SELECT SUBSTR (v_eq_loc_name, 1, INSTR (v_eq_loc_name, '-NODE', '1') - 1)
             AS node
     INTO v_location
     FROM DUAL;

   SELECT TRIM (SUBSTR (v_location,
                        1,
                          INSTR (v_location,
                                 '-',
                                 '1',
                                 1)
                        - 1))
             AS main_node,
          TRIM (SUBSTR (v_location, INSTR (v_location, '-') + 1)) AS sub_node
     INTO v_main_node, v_sub_node
     FROM DUAL;

   OPEN cur_tributer (v_access_bear_id, v_new_Cir_Name);

   FETCH cur_tributer
      INTO v_ch_dis, v_cir_trib_status;

   CLOSE cur_tributer;


   IF v_main_node IS NOT NULL
   THEN
      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE'
         AND v_main_node <> v_sub_node
         AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
         AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'DELETE'
            AND v_main_node = v_sub_node
            AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
            AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
            AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      END IF;

      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE-OR'
         AND v_main_node <> v_sub_node
         AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
         AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'DELETE-OR'
            AND v_main_node = v_sub_node
            AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
            AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
            AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      END IF;

      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE-OR'
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE DSL LINE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'DELETE-OR'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE DSL LINE';
      END IF;
   END IF;

   IF v_main_node IS NULL
   THEN
      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE-OR'
         AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE OSP LINE';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'DELETE-OR'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE OSP LINE';
      END IF;
   ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE-OR'
   THEN
      DELETE service_implementation_tasks sit
       WHERE     sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'REMOVE OSP LINE';
   END IF;

   IF v_main_node IS NULL
    THEN
     IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE'
         AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
         AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
        ELSIF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; END IF;
   
      IF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'DELETE-OR'
         AND (v_equip_type LIKE 'MSAN%' OR v_equip_type LIKE 'DSLAM%')
         AND (v_acc_nw = 'DSLAM PORT' OR v_acc_nw = 'MSAN PORT')
         AND v_ch_dis IS NULL
      THEN
         UPDATE service_implementation_tasks sit
            SET sit.seit_worg_name = v_work_group_mdf
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      ELSIF     v_service_type = 'D-ETHERNET VPN'
            AND v_service_order = 'DELETE-OR'
      THEN
         DELETE service_implementation_tasks sit
          WHERE     sit.seit_sero_id = p_sero_id
                AND sit.seit_taskname = 'REMOVE CROSS CONNECT';
      END IF;
   END IF;

   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED');
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Workgroup Mapping Please check the Cross Connection Equip Type  :  - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR');

      INSERT INTO service_task_comments (setc_seit_id,
                                         setc_id,
                                         setc_userid,
                                         setc_timestamp,
                                         setc_text)
           VALUES (p_seit_id,
                   setc_id_seq.NEXTVAL,
                   'CLARITYB',
                   SYSDATE,
                   p_ret_msg);
END D_ETH_X_CONNE_WG_CHG_DEL;

--- Jayan Liyanage 2013/03/12

--- Jayan Liyanage 2012/03/20

PROCEDURE D_ETHERNET_VPN_DELETE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
CURSOR cur_tributer (parent_name VARCHAR2,order_Cir  VARCHAR2)
IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent
AND ch.cirh_child = ci.cirt_name
AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%'
OR ci.cirt_status LIKE 'COMMISS%'
)
AND (   ci.cirt_status NOT LIKE 'CANCE%'
OR ci.cirt_status NOT LIKE 'PENDING%'
)
AND ci.CIRT_DISPLAYNAME <> order_Cir
AND c.cirt_displayname =replace( parent_name,'(N)');

CURSOR cur_equi_type
IS
SELECT DISTINCT e.equp_equt_abbreviation
FROM service_orders so, ports p, equipment e
WHERE so.sero_cirt_name = p.port_cirt_name
AND p.port_equp_id = e.equp_id
AND so.sero_id = p_sero_id;

v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_access_bear_id       VARCHAR2 (100);
parent_name            VARCHAR2 (100);
v_ch_parent            VARCHAR2 (100);
v_ch_dis               VARCHAR2 (100);
v_cir_trib_status      VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_media_type           VARCHAR2 (100);
v_equip_type           VARCHAR2 (100);
v_work_group_mdf       VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_cpe_class            VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_new_Cir_Name         VARCHAR2 (100); 
order_Cir              VARCHAR2 (100); 
v_work_group_ENG     VARCHAR2 (100);
BEGIN
OPEN cur_equi_type;

FETCH cur_equi_type
INTO v_equip_type;

CLOSE cur_equi_type;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_access_bear_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';
    
SELECT DISTINCT c.cirt_displayname
into v_new_Cir_Name
FROM service_orders so,circuits c
where so.sero_cirt_name = c.cirt_name
and  so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                   AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
    
SELECT wg.worg_name
INTO v_work_group_ENG
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';

SELECT wg.worg_name
INTO v_work_group_mdf
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';

SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue
INTO v_acc_nw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue
INTO v_acc_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_media_type
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE';

SELECT soa.seoa_defaultvalue
INTO v_ntu_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue
INTO v_cpe_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);

FETCH cur_tributer
INTO v_ch_dis, v_cir_trib_status;

CLOSE cur_tributer;

-- close Cur_Tributer;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF v_service_type = 'D-ETHERNET VPN' AND v_service_order = 'DELETE'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_core_network = 'MEN'
AND v_acc_nw <> 'MEN PORT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND ((v_core_network = 'CEN' AND v_acc_nw <> 'CEN PORT')OR 
(v_core_network = 'MPLS' AND v_acc_nw <> 'MPLS PORT'))
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
         
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS not NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'FIBER'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'P2P RADIO'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_medium = 'P2P RADIO'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw <> 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_ENG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_cpe_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
ELSE

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
END IF;
   
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
END IF;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
END IF;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE'
AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MPLS SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MPLS SUB PORT';
END IF;

p_implementation_tasks.update_task_status_byid (p_sero_id,
   0,
   p_seit_id,
   'COMPLETED'
  );
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet  VPN  DELETE Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
      0,
      p_seit_id,
      'ERROR'
     );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_DELETE;
--- Jayan Liyanage 2012/03/20

--- Jayan Liyanage 2013/03/12

PROCEDURE D_ETHERNET_VPN_DELETE_OR (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS
CURSOR cur_tributer (parent_name VARCHAR2,V_new_id varchar2)
IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent
AND ch.cirh_child = ci.cirt_name
AND (   ci.cirt_status LIKE 'INSERVICE%'
OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%'
OR ci.cirt_status LIKE 'COMMISS%'
)
AND (   ci.cirt_status NOT LIKE 'CANCE%'
OR ci.cirt_status NOT LIKE 'PENDING%'
)
AND CI.CIRT_DISPLAYNAME <> V_new_id
AND c.cirt_displayname = parent_name;

CURSOR cur_equi_type
IS
SELECT DISTINCT e.equp_equt_abbreviation
FROM service_orders so, ports p, equipment e
WHERE so.sero_cirt_name = p.port_cirt_name
AND p.port_equp_id = e.equp_id
AND so.sero_id = p_sero_id;

v_service_type      VARCHAR2 (100);
v_service_order     VARCHAR2 (100);
v_section_hndle     VARCHAR2 (100);
v_core_network      VARCHAR2 (100);
v_acc_nw            VARCHAR2 (100);
v_access_bear_id    VARCHAR2 (100);
parent_name         VARCHAR2 (100);
v_ch_parent         VARCHAR2 (100);
v_ch_dis            VARCHAR2 (100);
v_cir_trib_status   VARCHAR2 (100);
v_acc_medium        VARCHAR2 (100);
v_media_type        VARCHAR2 (100);
v_equip_type        VARCHAR2 (100);
v_work_group_mdf    VARCHAR2 (100);
v_ntu_class         VARCHAR2 (100);
v_cpe_class         VARCHAR2 (100);
v_service_order_area VARCHAR2 (100);
v_rtom_code         VARCHAR2 (100);
v_lea_code          VARCHAR2 (100);
v_work_group        VARCHAR2 (100);
v_work_group_cpe    VARCHAR2 (100);
v_new_Cir_Nam       VARCHAR2 (100);
V_new_id            VARCHAR2 (100);   
v_work_group_eNG    VARCHAR2 (100);                       

 
BEGIN
OPEN cur_equi_type;

FETCH cur_equi_type
INTO v_equip_type;

CLOSE cur_equi_type;

SELECT DISTINCT so.sero_sert_abbreviation
INTO v_service_type
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type
INTO v_service_order
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_section_hndle
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue
INTO v_access_bear_id
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID';

SELECT DISTINCT so.sero_area_code
INTO v_service_order_area
FROM service_orders so
WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                   AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

SELECT wg.worg_name
INTO v_work_group
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name
INTO v_work_group_cpe
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
    
SELECT wg.worg_name
INTO v_work_group_eNG
FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';


SELECT wg.worg_name
INTO v_work_group_mdf
FROM work_groups wg
WHERE worg_name LIKE
v_rtom_code || '-' || v_lea_code || '%' || 'MDF' || '%';

SELECT soa.seoa_defaultvalue
INTO v_core_network
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue
INTO v_acc_nw
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue
INTO v_acc_medium
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue
INTO v_media_type
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE';
    
SELECT DISTINCT c.cirt_displayname
into v_new_Cir_Nam
FROM service_orders so,circuits c
where so.sero_cirt_name = c.cirt_name
and  so.sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue
INTO v_ntu_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue
INTO v_cpe_class
FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

OPEN cur_tributer (v_access_bear_id,v_new_Cir_Nam);

FETCH cur_tributer
INTO v_ch_dis, v_cir_trib_status;

CLOSE cur_tributer;

-- close Cur_Tributer;
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (   (v_section_hndle LIKE 'SALES-ENT-%')
OR (v_section_hndle LIKE 'SALES-WSALE-%')
)
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_section_hndle LIKE 'SALES-SME-%'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle||'-PSM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_core_network = 'MEN'
AND v_acc_nw <> 'MEN PORT'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND ((v_core_network = 'MPLS' AND  v_acc_nw <> 'CEN PORT') OR 
(v_core_network = 'MPLS' AND  v_acc_nw <> 'MPLS PORT'))
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE VPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MEN PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE CEN PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE MPLS PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. SHDSL PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS  not NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_medium = 'FIBER'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINSTALL FIBER LINK';
END IF;
/*
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE DSL LINE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE DSL LINE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OSP LINE';
END IF;
*/
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSIF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw <> 'DSLAM PORT')
AND v_ntu_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_eNG
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT NTU';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_cpe_class = 'SLT'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'COLLECT CPE';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_ch_dis IS NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. ACC BEARER';
END IF;
   
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND ( v_acc_medium = 'WIRELESS TDM' OR v_acc_medium = 'WIRELESS ETHRNET')
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU';
END IF;
   
IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND  v_acc_medium = 'WIRELESS TDM'
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE RADIO LINK';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MEN PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MEN SUB PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'CEN PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE CEN SUB PORT';
END IF;

IF     v_service_type = 'D-ETHERNET VPN'
AND v_service_order = 'DELETE-OR'
AND v_acc_nw = 'MPLS PORT'
AND v_ch_dis IS NOT NULL
THEN
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MPLS SUB PORT';
ELSE
DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE MPLS SUB PORT';
END IF;





p_implementation_tasks.update_task_status_byid (p_sero_id,
 0,
 p_seit_id,
 'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
    0,
    p_seit_id,
    'ERROR'
   );

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_ETHERNET_VPN_DELETE_OR;

--- Jayan Liyanage 2013/03/12

--- 25-03-2013 Dinesh
PROCEDURE SLT_SET_PLANNED_EVENTS_ATTR
(     p_serv_id                IN     Services.serv_id%TYPE,
      p_sero_id                IN     Service_Orders.sero_id%TYPE,
      p_seit_id                IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname          IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                IN     work_order.woro_id%TYPE,
      p_ret_char              OUT     VARCHAR2,
      p_ret_number            OUT     NUMBER,
      p_ret_msg               OUT     VARCHAR2) IS

    CURSOR C_PE_query  IS
    select PLAE_ACTT_ABBREVIATION,PLAE_CREATEDCENTER,PLAE_REQA_ABBREVIATION
    from PLANNED_EVENTS,SERVICE_ORDERS
    where PLAE_NUMBER=SERO_OEID
    AND SERO_ID=p_sero_id; 
          

    l_PE_ABBREVIATION          VARCHAR2(100);
    l_PE_CREATEDCENTER      VARCHAR2(100);
    l_PE_REQA_ABBREVIATION      VARCHAR2(100);


    pe_no_attribute_found  EXCEPTION;

    BEGIN


         OPEN C_PE_query;
         FETCH C_PE_query 
         INTO l_PE_ABBREVIATION ,l_PE_CREATEDCENTER ,l_PE_REQA_ABBREVIATION;
         CLOSE C_PE_query;
         
             IF l_PE_ABBREVIATION IS NOT NULL AND l_PE_CREATEDCENTER IS NOT NULL
             THEN
                    UPDATE SERVICE_ORDER_ATTRIBUTES 
                    SET SEOA_DEFAULTVALUE=l_PE_ABBREVIATION
                    WHERE SEOA_SERO_ID=p_sero_id
                    AND SEOA_NAME= 'PE ACTIVITY';
                    
                    UPDATE SERVICE_ORDER_ATTRIBUTES soa
                    SET soa.SEOA_DEFAULTVALUE = l_PE_CREATEDCENTER
                    WHERE soa.SEOA_NAME = 'PE NATURE'
                    AND soa.SEOA_SERO_ID = p_sero_id;
                    
                    UPDATE SERVICE_ORDER_ATTRIBUTES soa
                    SET soa.SEOA_DEFAULTVALUE = l_PE_REQA_ABBREVIATION
                    WHERE soa.SEOA_NAME = 'PE AREA'
                    AND soa.SEOA_SERO_ID = p_sero_id;

             
             p_ret_char := 'OK';
            p_ret_msg := NULL;

            p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id, 'COMPLETED'); 
            
           ELSE
            
            p_ret_msg := NULL;

            p_implementation_tasks.update_task_status_byid(p_sero_id, 0, p_seit_id, 'COMPLETED');
            
           END IF;

     EXCEPTION

       WHEN pe_no_attribute_found THEN
             p_ret_msg  := 'Failed to PLANNED EVENTS ATTRIBUTES. No data for PE Attribute' ;

        WHEN OTHERS THEN
           p_ret_msg  := 'Failed to PLANNED EVENTS ATTRIBUTES:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM ;
    END SLT_SET_PLANNED_EVENTS_ATTR;

--- 25-03-2013  Dinesh

--- Jayan Liyanage 2012/08/14

PROCEDURE D_PRE_VPN_TRS (
      p_serv_id             IN     Services.serv_id%TYPE,
      p_sero_id             IN     Service_Orders.sero_id%TYPE,
      p_seit_id             IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname       IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id             IN     work_order.woro_id%TYPE,
      p_ret_char               OUT    VARCHAR2,
      p_ret_number             OUT    NUMBER,
      p_ret_msg                OUT    VARCHAR2) IS
      
      
      
v_service_type                 VARCHAR2 (100);
v_service_order                VARCHAR2 (100);
v_net_aggri_1                  VARCHAR2 (100);
v_net_aggri_2                  VARCHAR2 (100);
v_acc_nw                       VARCHAR2 (100);


BEGIN
SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_net_aggri_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1';  
SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'MEN' OR v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname =  'CONFIG MEN VLAN'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname =  'CONFIG CEN VLAN'; END IF; 

p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Premium VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);
INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);

END D_PRE_VPN_TRS;

---- Jayan Liyanage 2012/08/14

--- Jayan Liyanage 2013/03/07  


PROCEDURE D_PREMUIM_VPN_MODIFY_LOC (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2
)
IS



CURSOR pre_cir (v_old_ids VARCHAR)
IS
SELECT DISTINCT c.cirt_status FROM circuits c WHERE c.cirt_displayname = v_old_ids;               
CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 )IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
FROM circuits c, circuit_hierarchy ch, circuits ci WHERE c.cirt_name = ch.cirh_parent
AND ch.cirh_child = ci.cirt_name AND (   ci.cirt_status LIKE 'INSERVICE%' OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%' OR ci.cirt_status LIKE 'COMMISS%') AND (   ci.cirt_status NOT LIKE 'CANCE%'
OR ci.cirt_status NOT LIKE 'PENDING%') AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' 
-- OR ci.CIRT_DISPLAYNAME <> v_new_cir_id )
AND c.cirt_displayname like replace(parent_name,'(N)') ||'%' ;
CURSOR cur_Old_tributer (old_parent_name VARCHAR2,v_new_cir_id varchar2 )IS
SELECT DISTINCT ci.cirt_displayname, ci.cirt_status FROM circuits c, circuit_hierarchy ch, circuits ci
WHERE c.cirt_name = ch.cirh_parent AND ch.cirh_child = ci.cirt_name
AND (   ci.cirt_status LIKE 'INSERVICE%'OR ci.cirt_status LIKE 'PROPOSED%'
OR ci.cirt_status LIKE 'SUSPEND%'OR ci.cirt_status LIKE 'COMMISS%')
AND (   ci.cirt_status NOT LIKE 'CANCE%'OR ci.cirt_status NOT LIKE 'PENDING%')
AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' 
--OR ci.CIRT_DISPLAYNAME <> v_new_cir_id )
AND c.cirt_displayname = old_parent_name;

v_cir_status              VARCHAR2 (100);
v_new_bearer_id           VARCHAR2 (100);
v_section_hndle           VARCHAR2 (100);
v_service_type            VARCHAR2 (100);
v_service_order           VARCHAR2 (100);
v_service_order_area      VARCHAR2 (100);
v_rtom_code               VARCHAR2 (100);
v_lea_code                VARCHAR2 (100);
v_acc_bear_status         VARCHAR2 (100);
v_core_network            VARCHAR2 (100);
v_acc_medium_cur          VARCHAR2 (100);
v_acc_medium_pre          VARCHAR2 (100);
v_work_group              VARCHAR2 (100);
v_acc_nw                  VARCHAR2 (100);
v_ntu_class_cur           VARCHAR2 (100);
v_ntu_class_pre           VARCHAR2 (100);
v_work_group_cpe          VARCHAR2 (100);
v_ser_ctg                 VARCHAR2 (100);
v_so_attr_name            VARCHAR2 (100);
v_so_attr_val             VARCHAR2 (100);
v_bearer_id               VARCHAR2 (100);
v_no_of_copper_pair_cur   VARCHAR2 (100);
v_no_of_copper_pair_pre   VARCHAR2 (100);
v_cpe_class_cur           VARCHAR2 (100);
v_cpe_class_pre           VARCHAR2 (100);
v_acc_port_bw_cur         VARCHAR2 (100);
v_acc_port_bw_pre         VARCHAR2 (100);
v_acc_node_change         VARCHAR2 (100);
v_old_cir_id              VARCHAR2 (100);
v_old_ids                 VARCHAR2 (100);
v_old_staus               VARCHAR2 (100);
parent_name               VARCHAR2 (100);
v_new_cir_id              VARCHAR2 (100);
v_access_bear_id          VARCHAR2 (100);
v_new_Cir_Name            VARCHAR2 (100);
v_Pre_access_bear_id      VARCHAR2 (100);
old_parent_name           VARCHAR2 (100);
v_Old_ch_dis              VARCHAR2 (100);
v_Old_cir_trib_status     VARCHAR2 (100);
v_ch_dis                  VARCHAR2 (100);
v_cir_trib_status         VARCHAR2 (100);
v_Pre_acc_nw              VARCHAR2 (100);
v_work_group_nw           VARCHAR2 (100);
v_Cur_Media               VARCHAR2 (100);
v_Pre_Media               VARCHAR2 (100);
v_pre_core_nw             VARCHAR2 (100);
v_cpe_mode_cur            VARCHAR2 (100);
v_cpe_mode_pre            VARCHAR2 (100);
v_aggr_nw_1               VARCHAR2 (100);
v_aggr_nw_2               VARCHAR2 (100);
v_aggr_nw_1_pre           VARCHAR2 (100);
v_aggr_nw_2_pre           VARCHAR2 (100);
v_fib_avalable            VARCHAR2 (100);
   
BEGIN
SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT DISTINCT so.sero_ordt_type INTO v_service_order FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';
SELECT soa.seoa_defaultvalue INTO v_acc_bear_status FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS BEARER STATUS';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_Cur_Media,v_Pre_Media FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE';

SELECT DISTINCT so.sero_area_code INTO v_service_order_area FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)AS codes,ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar
WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';
SELECT wg.worg_name INTO v_work_group FROM work_groups wg
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
                    
SELECT wg.worg_name INTO v_work_group_nw FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-'  || '%' || 'ENG-NW' || '%';
SELECT wg.worg_name INTO v_work_group_cpe FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
--SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_core_network,v_pre_core_nw FROM service_order_attributes soa
--WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_acc_medium_cur, v_acc_medium_pre
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_ntu_class_cur, v_ntu_class_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_acc_nw,v_Pre_acc_nw
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';

SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NO OF COPPER PAIRS';

SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cpe_class_cur, v_cpe_class_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';
SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_cpe_mode_cur, v_cpe_mode_pre
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';

SELECT soa.seoa_defaultvalue, soa.seoa_prev_value INTO v_acc_port_bw_cur, v_acc_port_bw_pre
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS INTF PORT BW';
SELECT soa.seoa_defaultvalue INTO v_acc_node_change FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id
AND soa.seoa_name = 'ACCESS NODE CHANGE?';

select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

SELECT soa.seoa_defaultvalue INTO v_old_cir_id FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'OLD CIRCUIT ID';
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_access_bear_id,v_Pre_access_bear_id
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS_ID'; 
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_aggr_nw_1,v_aggr_nw_1_pre FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1'; 
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_aggr_nw_2,v_aggr_nw_2_pre
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
    
SELECT DISTINCT c.cirt_displayname into v_new_Cir_Name FROM service_orders so,circuits c where so.sero_cirt_name = c.cirt_name
and  so.sero_id = p_sero_id;OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);
FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status;CLOSE cur_tributer;  
OPEN cur_Old_tributer (v_Pre_access_bear_id,v_new_Cir_Name);
FETCH cur_Old_tributer INTO v_Old_ch_dis, v_Old_cir_trib_status;
CLOSE cur_Old_tributer;

  
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND (   (v_section_hndle LIKE 'SALES-ENT-%') OR (v_section_hndle LIKE 'SALES-WSALE-%'))
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'APPROVE SO';ELSIF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION'AND v_section_hndle LIKE 'SALES-SME-%'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_rtom_code || '-RTOM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_taskname = 'APPROVE SO'
AND sit.seit_sero_id = p_sero_id; END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'COMMISSIONED' AND v_acc_node_change = 'YES'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MEN PORT';ELSE DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED'AND v_acc_node_change = 'YES'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN PORT';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_nw = 'MPLS PORT' AND v_acc_bear_status = 'COMMISSIONED'
AND v_acc_node_change = 'YES'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG MPLS PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_nw <> 'MPLS PORT'AND v_acc_node_change = 'YES'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG IPVPN PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG IPVPN PORT';END IF;

 -- Jayan Liyanage 2014/10/24 Modified.
 
/*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medium_cur = 'FIBER'
AND v_acc_bear_status = 'COMMISSIONED'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK';END IF;*/

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medium_cur = 'FIBER' 
AND v_acc_bear_status = 'COMMISSIONED' AND ( v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-SOM-DATA'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER';END IF;

 -- Jayan Liyanage 2014/10/24 Modified.

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medium_cur = 'P2P RADIO'
AND v_acc_bear_status = 'COMMISSIONED'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL SLT-END NTU'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL SLT-END NTU';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_medium_cur = 'P2P RADIO' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'SETUP RADIO LINK';END IF;
  
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE' AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';END IF;
  
IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class_cur = 'SLT' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL NTU';
ELSIF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw <> 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED'AND v_ntu_class_cur = 'SLT'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_nw WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL NTU';ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL NTU';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_bear_status = 'COMMISSIONED'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; END IF;IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-SPEED'AND (   (v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle LIKE 'SALES-WSALE-%') )
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO'WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN'; ELSIF  v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-SPEED'
AND v_section_hndle LIKE 'SALES-SME-%' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM'
WHERE sit.seit_sero_id = p_sero_id; ELSE   DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY PRICE PLAN';END IF;

/*   OPEN pre_cir (v_old_ids);

FETCH pre_cir
INTO v_old_staus;

CLOSE pre_cir;*/

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
AND v_ntu_class_pre = 'SLT' AND v_Old_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD NTU';
ELSIF   v_service_type = 'D-PREMIUM IPVPN'    AND v_service_order = 'MODIFY-LOCATION'
AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT') AND v_ntu_class_pre = 'SLT' AND v_Old_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit   
SET sit.seit_worg_name = v_work_group_nw WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD NTU';
else  DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD NTU';
END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_cpe_class_pre = 'SLT' AND v_Old_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD CPE';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD CPE';
END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
AND v_Old_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE OLD OSP LINE'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE OLD OSP LINE';


END IF;IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_Media = 'FIBER'AND v_Old_ch_dis IS NULL
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'UNINS. OLD FIBER LIN'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'UNINS. OLD FIBER LIN'; END IF;IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_acc_medium_pre = 'P2P RADIO' AND v_acc_node_change = 'YES'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'REMOVE SLT-END NTU'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE SLT-END NTU'; END IF;

IF v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_Old_ch_dis IS NULL  THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEAC. OLD ACC BEARER';ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname =  'DEAC. OLD ACC BEARER';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
AND v_Old_ch_dis IS NULL AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD SHDSL PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT OLD SHDSL PORT'; END IF;IF     v_service_type = 'D-PREMIUM IPVPN'AND v_service_order = 'MODIFY-LOCATION'AND v_acc_medium_cur = 'P2P RADIO'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD RADIO'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COLLECT OLD RADIO';END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN'           --- task name shoud change Prod
AND v_service_order = 'MODIFY-LOCATION' AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT') AND v_Old_ch_dis IS NOT NULL
AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD TRIB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD TRIB PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_nw = 'MEN PORT'
AND v_acc_bear_status = 'INSERVICE' AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN SUB PORT';END IF;

IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_nw = 'MEN PORT'AND v_acc_bear_status = 'INSERVICE' 
AND v_acc_node_change = 'YES'THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN SUB PORT';ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN SUB PORT';END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_acc_nw = 'MPLS PORT' AND v_acc_bear_status = 'INSERVICE'
AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_ntu_class_cur = 'SLT'
AND v_acc_bear_status = 'INSERVICE' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_cpe_class_cur = 'SLT' AND v_acc_bear_status = 'INSERVICE'
AND v_cpe_mode_cur <> v_cpe_mode_pre THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE'; END IF;
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_cpe_class_cur = 'SLT'
AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INSTALL CPE'; END IF;  
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_acc_nw = 'MEN PORT' AND v_Old_ch_dis IS not NULL
AND v_acc_node_change = 'YES' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MEN SUB PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MEN SUB PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_acc_nw = 'CEN PORT' AND v_Old_ch_dis IS not NULL AND v_acc_node_change = 'YES'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'DEL OLD CEN SUB PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD CEN SUB PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_acc_nw = 'MPLS PORT' AND v_Old_ch_dis IS not NULL AND v_acc_node_change = 'YES'
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MPLS SUB PRT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEL OLD MPLS SUB PRT'; END IF;
   
   
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_nw <> 'MEN PORT'
AND v_acc_node_change = 'YES' AND ( v_aggr_nw_1 = 'MEN' OR v_aggr_nw_2 = 'MEN' ) THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MEN VLAN';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_nw <> 'CEN PORT'
AND v_acc_node_change = 'YES' AND ( v_aggr_nw_1 = 'CEN' OR v_aggr_nw_2 = 'CEN' ) THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN VLAN'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG CEN VLAN'; END IF; /*IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'COMMISSIONED' THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_nw WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW'; END IF;*/
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_node_change = 'NO'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG IPVPN PORT';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG IPVPN PORT';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_node_change = 'YES'THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE IPVPN PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE IPVPN PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND ( v_aggr_nw_1_pre = 'MEN' OR v_aggr_nw_2_pre = 'MEN') AND v_acc_node_change = 'YES'
AND v_Pre_acc_nw <> 'MEN PORT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD MEN VLAN'; ELSE
DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD MEN VLAN';
END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND ( v_aggr_nw_1_pre = 'CEN' OR v_aggr_nw_2_pre = 'CEN')
AND v_acc_node_change = 'YES' AND v_Pre_acc_nw <> 'MEN PORT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD CEA VLAN'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT OLD CEA VLAN'; END IF;
   
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_node_change = 'YES'
AND v_Pre_acc_nw = 'MEN PORT' AND v_Old_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT. OLD MEN PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEACT. OLD MEN PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_acc_node_change = 'YES' AND v_Pre_acc_nw = 'CEN PORT' AND v_Old_ch_dis IS NULL THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. OLD CEN PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. OLD CEN PORT'; END IF;
  IF     v_service_type = 'D-PREMIUM IPVPN'  AND v_service_order = 'MODIFY-LOCATION' AND (v_acc_medium_cur = 'FIBER' OR v_acc_medium_cur = 'COPPER-UTP')  
AND v_acc_bear_status = 'COMMISSIONED'  THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group_nw
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; ELSE DELETE      service_implementation_tasks sit 
  WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC.LINK'; END IF; 
IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION' AND v_acc_node_change = 'YES' AND v_Pre_acc_nw = 'MPLS PORT'
AND v_Old_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. OLD MPLS PORT'; ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'DEACT. OLD MPLS PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN' AND v_service_order = 'MODIFY-LOCATION'
AND v_acc_node_change = 'YES' AND v_Pre_acc_nw <> 'MPLS PORT' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD IPVPN PORT'; ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DEL OLD IPVPN PORT'; END IF; IF     v_service_type = 'D-PREMIUM IPVPN'
AND v_service_order = 'MODIFY-LOCATION' AND v_Pre_acc_nw = 'CEN PORT' AND v_Old_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE AGG LINK';
ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'REMOVE AGG LINK'; END IF;
   
   
   
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'COMPLETED'
);
EXCEPTION
WHEN OTHERS
THEN
p_ret_msg :=
'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
0,
p_seit_id,
'ERROR'
);

INSERT INTO service_task_comments
(setc_seit_id, setc_id, setc_userid, setc_timestamp,
setc_text
)
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
p_ret_msg
);
END D_PREMUIM_VPN_MODIFY_LOC;

--- Jayan Liyanage 2013/03/07 

--- Jayan Liyanage 2012/03/21

PROCEDURE D_ETHERNET_VPN_MODIFY_LOC (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS



   CURSOR pre_cir (v_old_ids VARCHAR)
   IS
      SELECT DISTINCT c.cirt_status
                 FROM circuits c
                WHERE c.cirt_displayname = v_old_ids;
                
   CURSOR cur_tributer (parent_name VARCHAR2,v_new_cir_id varchar2 )
   IS
      SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
                 FROM circuits c, circuit_hierarchy ch, circuits ci
                WHERE c.cirt_name = ch.cirh_parent
                  AND ch.cirh_child = ci.cirt_name
                  AND (   ci.cirt_status LIKE 'INSERVICE%'
                       OR ci.cirt_status LIKE 'PROPOSED%'
                       OR ci.cirt_status LIKE 'SUSPEND%'
                       OR ci.cirt_status LIKE 'COMMISS%'
                      )
                  AND (   ci.cirt_status NOT LIKE 'CANCE%'
                       OR ci.cirt_status NOT LIKE 'PENDING%'
                      )
                  AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' 
                     -- OR ci.CIRT_DISPLAYNAME <> v_new_cir_id )
                  AND c.cirt_displayname = parent_name;
                  
  CURSOR cur_Old_tributer (old_parent_name VARCHAR2,v_new_cir_id varchar2 )
   IS
      SELECT DISTINCT ci.cirt_displayname, ci.cirt_status
                 FROM circuits c, circuit_hierarchy ch, circuits ci
                WHERE c.cirt_name = ch.cirh_parent
                  AND ch.cirh_child = ci.cirt_name
                  AND (   ci.cirt_status LIKE 'INSERVICE%'
                       OR ci.cirt_status LIKE 'PROPOSED%'
                       OR ci.cirt_status LIKE 'SUSPEND%'
                       OR ci.cirt_status LIKE 'COMMISS%'
                      )
                  AND (   ci.cirt_status NOT LIKE 'CANCE%'
                       OR ci.cirt_status NOT LIKE 'PENDING%'
                      )
                  AND ci.CIRT_DISPLAYNAME not like replace(v_new_cir_id,'(N)') ||'%' 
                      --OR ci.CIRT_DISPLAYNAME <> v_new_cir_id )
                  AND c.cirt_displayname = old_parent_name;

   v_cir_status              VARCHAR2 (100);
   v_new_bearer_id           VARCHAR2 (100);
   v_section_hndle           VARCHAR2 (100);
   v_service_type            VARCHAR2 (100);
   v_service_order           VARCHAR2 (100);
   v_service_order_area      VARCHAR2 (100);
   v_rtom_code               VARCHAR2 (100);
   v_lea_code                VARCHAR2 (100);
   v_acc_bear_status         VARCHAR2 (100);
   v_core_network            VARCHAR2 (100);
   v_acc_medium_cur          VARCHAR2 (100);
   v_acc_medium_pre          VARCHAR2 (100);
   v_work_group              VARCHAR2 (100);
   v_acc_nw                  VARCHAR2 (100);
   v_ntu_class_cur           VARCHAR2 (100);
   v_ntu_class_pre           VARCHAR2 (100);
   v_work_group_cpe          VARCHAR2 (100);
   v_ser_ctg                 VARCHAR2 (100);
   v_so_attr_name            VARCHAR2 (100);
   v_so_attr_val             VARCHAR2 (100);
   v_bearer_id               VARCHAR2 (100);
   v_no_of_copper_pair_cur   VARCHAR2 (100);
   v_no_of_copper_pair_pre   VARCHAR2 (100);
   v_cpe_class_cur           VARCHAR2 (100);
   v_cpe_class_pre           VARCHAR2 (100);
   v_acc_port_bw_cur         VARCHAR2 (100);
   v_acc_port_bw_pre         VARCHAR2 (100);
   v_acc_node_change         VARCHAR2 (100);
   v_old_cir_id              VARCHAR2 (100);
   v_old_ids                 VARCHAR2 (100);
   v_old_staus               VARCHAR2 (100);
   parent_name               VARCHAR2 (100);
   v_new_cir_id              VARCHAR2 (100);
   v_access_bear_id          VARCHAR2 (100);
   v_new_Cir_Name            VARCHAR2 (100);
   v_Pre_access_bear_id      VARCHAR2 (100);
   old_parent_name           VARCHAR2 (100);
   v_Old_ch_dis              VARCHAR2 (100);
   v_Old_cir_trib_status     VARCHAR2 (100);
   v_ch_dis                  VARCHAR2 (100);
   v_cir_trib_status         VARCHAR2 (100);
   v_Pre_acc_nw              VARCHAR2 (100);
   v_work_group_nw           VARCHAR2 (100);
   v_Cur_Media               VARCHAR2 (100);
   v_Pre_Media               VARCHAR2 (100);
   v_pre_core_nw             VARCHAR2 (100);
   v_cpe_mode_cur            VARCHAR2 (100);
   v_cpe_mode_pre            VARCHAR2 (100);
   v_fib_avalable            VARCHAR2 (100);
   
BEGIN


   SELECT DISTINCT so.sero_sert_abbreviation
              INTO v_service_type
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT DISTINCT so.sero_ordt_type
              INTO v_service_order
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT soa.seoa_defaultvalue
     INTO v_section_hndle
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'SECTION HANDLED BY';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_bear_status
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS BEARER STATUS';
      
      
   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_Cur_Media,v_Pre_Media
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'MEDIA TYPE';

   SELECT DISTINCT so.sero_area_code
              INTO v_service_order_area
              FROM service_orders so
             WHERE so.sero_id = p_sero_id;

   SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                                                     AS codes,
          ar.area_code
     INTO v_rtom_code,
          v_lea_code
     FROM areas ar
    WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

   SELECT wg.worg_name
     INTO v_work_group
     FROM work_groups wg
    WHERE worg_name LIKE
                    v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';
                    
    SELECT wg.worg_name
     INTO v_work_group_nw
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';

   SELECT wg.worg_name
     INTO v_work_group_cpe
     FROM work_groups wg
    WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';
    

   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_core_network,v_pre_core_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK';

   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_acc_medium_cur, v_acc_medium_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS MEDIUM';

   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_ntu_class_cur, v_ntu_class_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_acc_nw,v_Pre_acc_nw
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';
    
    select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
     where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;


   SELECT soa.seoa_defaultvalue
     INTO v_ser_ctg
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_no_of_copper_pair_cur, v_no_of_copper_pair_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
          AND soa.seoa_name = 'NO OF COPPER PAIRS';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cpe_class_cur, v_cpe_class_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';

   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_cpe_mode_cur, v_cpe_mode_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';



   SELECT soa.seoa_defaultvalue, soa.seoa_prev_value
     INTO v_acc_port_bw_cur, v_acc_port_bw_pre
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS INTF PORT BW';

   SELECT soa.seoa_defaultvalue
     INTO v_acc_node_change
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id
      AND soa.seoa_name = 'ACCESS NODE CHANGE?';

   SELECT soa.seoa_defaultvalue
     INTO v_old_cir_id
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'OLD CIRCUIT ID';

   SELECT soa.seoa_defaultvalue,soa.seoa_prev_value
     INTO v_access_bear_id,v_Pre_access_bear_id
     FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER ID';
    
    SELECT DISTINCT c.cirt_displayname
   into v_new_Cir_Name
      FROM service_orders so,circuits c
              where so.sero_cirt_name = c.cirt_name
             and  so.sero_id = p_sero_id;
   
   OPEN cur_tributer (v_access_bear_id,v_new_Cir_Name);

   FETCH cur_tributer
    INTO v_ch_dis, v_cir_trib_status;

   CLOSE cur_tributer;
   
   OPEN cur_Old_tributer (v_Pre_access_bear_id,v_new_Cir_Name);

   FETCH cur_Old_tributer
    INTO v_Old_ch_dis, v_Old_cir_trib_status;

   CLOSE cur_Old_tributer;

  
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%')
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SIU-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_rtom_code || '-RTOM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_taskname = 'APPROVE SO'
              AND sit.seit_sero_id = p_sero_id;
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'CEN PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS PORT';
   END IF;



   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_core_network = 'MEN'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_acc_nw <> 'CEN PORT' OR v_acc_nw <> 'CEA PORT')
         AND (v_core_network = 'CEN' OR v_core_network = 'MPLS')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG VPLS PORT';
   END IF;
   
   -- Jayan Liyanage Modified 2014/10/24

/*   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_cur = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COMM. FIBER LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COMM. FIBER LINK';
   END IF;*/
   
      IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_cur = 'FIBER'
      AND v_acc_bear_status = 'COMMISSIONED' AND 
      ( v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SFC-SOM-DATA'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'WAIT FOR FIBER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'WAIT FOR FIBER';
   END IF;

-- Jayan Liyanage Modified End 2014/10/24

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_cur = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL SLT-END NTU';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_cur = 'P2P RADIO'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'SETUP RADIO LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'SETUP RADIO LINK';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONSTRUCT OSP LINE';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'INSERVICE'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
      AND v_acc_bear_status = 'COMMISSIONED'
      AND v_ntu_class_cur = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_cpe
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL NTU';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
         AND v_acc_bear_status = 'COMMISSIONED'
         AND v_ntu_class_cur = 'SLT'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_nw
       WHERE sit.seit_sero_id = p_sero_id
             AND sit.seit_taskname = 'INSTALL NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL NTU';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_core_network = 'MEN'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
         AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_core_network = 'MEN'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_bear_status = 'COMMISSIONED'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ACTIVATE ACC BEARER';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-SPEED'
       AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%') )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   ELSIF  v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-SPEED'
      AND v_section_hndle LIKE 'SALES-SME-%' THEN 
      
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-PSM'
       WHERE sit.seit_sero_id = p_sero_id;
       
       ELSE   DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'MODIFY PRICE PLAN';
   END IF;

/*   OPEN pre_cir (v_old_ids);

   FETCH pre_cir
    INTO v_old_staus;

   CLOSE pre_cir;*/

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
      AND v_ntu_class_pre = 'SLT'
      AND v_Old_ch_dis IS NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_cpe
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD NTU';
   ELSIF   v_service_type = 'D-ETHERNET VPN'    AND v_service_order = 'MODIFY-LOCATION'
      AND (v_Pre_acc_nw <>  'MSAN PORT' OR v_Pre_acc_nw <>  'DSLAM PORT')
      AND v_ntu_class_pre = 'SLT'
      AND v_Old_ch_dis IS NULL THEN
      
       UPDATE service_implementation_tasks sit          -- NEED TO VERIFY THIS CONDITIONS 
         SET sit.seit_worg_name = v_work_group_nw
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD NTU';
         
       else  DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD NTU';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_cpe_class_pre = 'SLT'
      AND v_Old_ch_dis IS NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD CPE';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
      AND v_Old_ch_dis IS NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE OLD OSP LINE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE OLD OSP LINE';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'       ---
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_pre = 'FIBER'
      AND v_Old_ch_dis IS NULL
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'CORP-SSU'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'UNINS. OLD FIBER LIN';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'UNINS. OLD FIBER LIN';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_pre = 'P2P RADIO'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'REMOVE SLT-END NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'REMOVE SLT-END NTU';
   END IF;


   IF v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Old_ch_dis IS NULL 
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_section_hndle || '-FO'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEAC. OLD ACC BEARER';
   END IF;


----
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_pre_core_nw  = 'MEN'   
      AND v_Pre_acc_nw <> 'MEN PORT'  
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';
         
         
   ELSIF    v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND ((v_pre_core_nw  = 'CEN' AND v_Pre_acc_nw <> 'CEN PORT') OR
          (v_pre_core_nw  = 'MPLS' AND v_Pre_acc_nw <> 'MPLS PORT'))
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT. OLD VPLS PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'MEN PORT'
      AND v_Old_ch_dis IS NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD MEN PORT';
   ELSE
      DELETE  service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT. OLD MEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'CEN PORT'
      AND v_Old_ch_dis IS NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD CEN PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT. OLD CEN PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'MPLS PORT'
      AND v_Old_ch_dis IS NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT. OLD MPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT. OLD MPLS PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
      AND v_Old_ch_dis IS NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACT OLD SHDSL PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACT OLD SHDSL PORT';
   END IF;
   
   
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_medium_cur = 'P2P RADIO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'TX-RADIO-LAB'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'COLLECT OLD RADIO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'COLLECT OLD RADIO';
   END IF;
   
    IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (v_Pre_acc_nw = 'MSAN PORT' OR v_Pre_acc_nw = 'DSLAM PORT')
      AND v_Old_ch_dis IS NOT NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-OPR-NM'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEACTIVATE TRIB PORT';
   END IF;


   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MEN SUB PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MEN PORT'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG CEN SUB PORT';
   END IF;
--

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_nw = 'MPLS PORT'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
   END IF;

   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_ntu_class_cur = 'SLT'
      AND v_acc_bear_status = 'INSERVICE'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG NTU';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG NTU';
   END IF;
   
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_cpe_class_cur = 'SLT'
      AND v_acc_bear_status = 'INSERVICE'
      AND v_cpe_mode_cur <> v_cpe_mode_pre
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG CPE';
   END IF;
   
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_cpe_class_cur = 'SLT'
      AND v_acc_bear_status = 'COMMISSIONED'

   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-CPEI'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'INSTALL CPE';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'INSTALL CPE';
   END IF;
   
  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'MEN PORT'
      AND v_Old_ch_dis IS not NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEL OLD MEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEL OLD MEN SUB PORT';
   END IF;

  IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'CEN PORT'
      AND v_Old_ch_dis IS not NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEL OLD CEN SUB PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEL OLD CEN SUB PORT';
   END IF;
   
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_Pre_acc_nw = 'MPLS PORT'
      AND v_Old_ch_dis IS not NULL
      AND v_acc_node_change = 'YES'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'DEL OLD MPLS SUB PRT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'DEL OLD MPLS SUB PRT';
   END IF;
      IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_acc_bear_status = 'COMMISSIONED'
      AND (v_acc_medium_cur = 'FIBER' OR v_acc_medium_cur = 'COPPER-UTP')
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_work_group_nw
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'ESTABLISH ACC.LINK';
   END IF;
   
    IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND v_core_network = 'MEN'
      AND v_acc_node_change = 'NO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'DS-MEN'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG VPLS PORT';
         
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND (v_core_network = 'CEN' OR v_core_network = 'MPLS')
         AND v_acc_node_change = 'NO'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'IPNET-PROV'
       WHERE sit.seit_sero_id = p_sero_id
         AND sit.seit_taskname = 'RECONFIG VPLS PORT';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_sero_id = p_sero_id
              AND sit.seit_taskname = 'RECONFIG VPLS PORT';
   END IF;
   
   
   p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                   0,
                                                   p_seit_id,
                                                   'COMPLETED'
                                                  );
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
         || ' - Erro is:'
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
      p_implementation_tasks.update_task_status_byid (p_sero_id,
                                                      0,
                                                      p_seit_id,
                                                      'ERROR'
                                                     );

      INSERT INTO service_task_comments
                  (setc_seit_id, setc_id, setc_userid, setc_timestamp,
                   setc_text
                  )
           VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
                   p_ret_msg
                  );
END D_ETHERNET_VPN_MODIFY_LOC;

--- Jayan Liyanage 2012/03/21

---- Jayan Liyanage  2013/04/08

PROCEDURE D_ET_MDF_LOC_APP (
   p_serv_id         IN       services.serv_id%TYPE,
   p_sero_id         IN       service_orders.sero_id%TYPE,
   p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
   p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
   p_woro_id         IN       work_order.woro_id%TYPE,
   p_ret_char        OUT      VARCHAR2,
   p_ret_number      OUT      NUMBER,
   p_ret_msg         OUT      VARCHAR2
)
IS

v_service_type       varchar2(100);
v_service_order      varchar2(100);
v_section_hndle      varchar2(100);
v_service_order_area varchar2(100);
v_rtom_code          varchar2(100);
v_lea_code           varchar2(100);

begin

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;
SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SECTION HANDLED BY';          
SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1)
                                                     AS codes,
ar.area_code
INTO v_rtom_code,
v_lea_code
FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

  
   IF     v_service_type = 'D-ETHERNET VPN'
      AND v_service_order = 'MODIFY-LOCATION'
      AND (   (v_section_hndle LIKE 'SALES-ENT-%')
           OR (v_section_hndle LIKE 'SALES-WSALE-%')
          )
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = 'SALES-SI-MGR'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSIF     v_service_type = 'D-ETHERNET VPN'
         AND v_service_order = 'MODIFY-LOCATION'
         AND v_section_hndle LIKE 'SALES-SME-%'
   THEN
      UPDATE service_implementation_tasks sit
         SET sit.seit_worg_name = v_rtom_code || '-RTOM'
       WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';
   ELSE
      DELETE      service_implementation_tasks sit
            WHERE sit.seit_taskname = 'APPROVE SO'
              AND sit.seit_sero_id = p_sero_id;
   END IF;


p_implementation_tasks.update_task_status_byid (p_sero_id,0, p_seit_id,'COMPLETED' ); 
EXCEPTION WHEN OTHERS THEN 
  p_ret_msg :='Failed to Change D-Ethernet VPN Process function. Please check the conditions:'
|| ' - Erro is:'|| TO_CHAR (SQLCODE)|| '-'|| SQLERRM; p_implementation_tasks.update_task_status_byid (p_sero_id, 0,p_seit_id,'ERROR');
INSERT INTO service_task_comments(setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text)VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,p_ret_msg
);

END D_ET_MDF_LOC_APP;

---- Jayan Liyanage  2013/04/08


-- Dulip Fernando 2013/04/01 Updated by Indika de silva on 03/12/2013
-- This function will populate the 'UPDATE TEST SERVICE and WG s for D-BIL based on "TEST SERVICE ALTERED?" attribute

PROCEDURE D_BIL_TST_SVC_ALTR_WF(
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_cir_status         VARCHAR2 (100); 
  v_new_bearer_id      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_acc_bear_status    VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_ntu_class          VARCHAR2 (100); 
  v_ntu_model_change   VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_ser_ctg            VARCHAR2 (100); 
  v_so_attr_name       VARCHAR2 (100); 
  v_so_attr_val        VARCHAR2 (100); 
  v_bearer_id          VARCHAR2 (100); 
  v_cpe_class          VARCHAR2 (100); 
  v_work_group_eng     VARCHAR2 (100); 
  cur_v_cpe_model      VARCHAR2 (100); 
  pre_v_cpe_model      VARCHAR2 (100); 
  v_agrregate_nw       VARCHAR2 (100); 
  v_test_service_alt   VARCHAR2 (100); 
--v_agrregate_nw_2       VARCHAR2 (100); 
BEGIN 
    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    --TEST SERVICE ALTERED? 
    SELECT soa.seoa_defaultvalue 
    INTO   v_test_service_alt 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'TEST SERVICE ALTERED?'; 

    --UPDATE TEST SERVICE  
    IF v_service_type = 'D-BIL' 
       AND v_test_service_alt = 'YES' 
       AND v_service_order IN ( 'CREATE', 'CREATE-OR', 'MODIFY-SPEED','CREATE-BACKUP' ) THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_test_service_alt IS NULL 
       AND v_service_order IN ( 'CREATE', 'CREATE-OR', 'MODIFY-SPEED','CREATE-BACKUP' ) THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
    END IF; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Execute D_BIL_TST_SVC_ALTR_WF  Process function. Please check the order conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_TST_SVC_ALTR_WF;

-- Dulip Fernando 2013/04/01 Updated by Indika de silva on 03/12/2013

-----Dulip Fernando and Indika De silva add CREATE-BACKUP service order 
---- Indika De Silva 2013/02/28
---- Dulip Fernando Modified Modified 2013-03-14
---- Dulip Fernando Modified 2013-03-19 for DELETE and DELETE-OR
---- Dulip Fernando Modified 2013-03-22 for "CREATE-TRANSFER"
----Indika De Silva Modified 2013-06-05 for "MODIFY-LOCATION"
PROCEDURE D_BIL_CONNE_WG_CHG (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_equip_type            VARCHAR2 (100); 
  v_eq_loc_name           VARCHAR2 (100); 
  v_service_type          VARCHAR2 (100); 
  v_service_order         VARCHAR2 (100); 
  v_service_order_area    VARCHAR2 (100); 
  v_rtom_code             VARCHAR2 (100); 
  v_lea_code              VARCHAR2 (100); 
  v_work_group            VARCHAR2 (100); 
  v_work_group_mdf        VARCHAR2 (100); 
  v_location              VARCHAR2 (100); 
  v_main_node             VARCHAR2 (100); 
  v_sub_node              VARCHAR2 (100); 
  v_acc_nw                VARCHAR2 (100); 
  v_acc_bearer_status     VARCHAR2 (100); 
  v_mig_type              VARCHAR2 (100); 
  v_access_bear_id        VARCHAR2 (100); 
  v_ch_dis                VARCHAR2 (100); 
  v_access_id             VARCHAR2 (100); 
  v_cir_trib_status       VARCHAR2 (100); 
  v_cur_nof_copper        VARCHAR2 (100); 
  v_pre_nof_copper        VARCHAR2 (100); 
  v_access_node_chg       VARCHAR2 (100); 
  v_no_of_copper_pair_cur VARCHAR2 (100); 
  v_no_of_copper_pair_pre VARCHAR2 (100); 
  v_new_cir_id            VARCHAR2 (100); 
  v_new_cir_name          VARCHAR2 (100); 
  v_acc_medium            VARCHAR2 (100); 
  v_acc_medium_pre        VARCHAR2 (100); 
  v_ch_dis_p              VARCHAR2 (100); 
  v_cir_trib_status_p     VARCHAR2 (100); 
  v_pre_eq                VARCHAR2 (100); 
  v_pre_location          VARCHAR2 (100); 
  v_location_pre          VARCHAR2 (100); 
  v_pre_main_node         VARCHAR2 (100); 
  v_pre_sub_node          VARCHAR2 (100); 
  CURSOR cur_equi_type IS 
    SELECT DISTINCT e.equp_equt_abbreviation, 
                    e.equp_locn_ttname 
    FROM   service_orders so, 
           ports p, 
           equipment e 
    WHERE  so.sero_cirt_name = p.port_cirt_name 
           AND ( e.equp_equt_abbreviation LIKE 'MSAN%' 
                  OR e.equp_equt_abbreviation LIKE 'DSLAM%' 
                  OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%' 
                  OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%' ) 
           AND p.port_equp_id = e.equp_id 
           AND so.sero_id = p_sero_id; 
  CURSOR cur_tributer ( 
    parent_name  VARCHAR2, 
    v_new_cir_id VARCHAR2) IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   circuits c, 
           circuit_hierarchy ch, 
           circuits ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname NOT LIKE REPLACE (v_new_cir_id,'(N)')||'%' 
           AND c.cirt_displayname like replace(parent_name,'(N)')||'%'; 
  CURSOR cur_tributer_p ( 
    parent_pre_name  VARCHAR2, 
    v_parent_cir_old VARCHAR2) IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   circuits c, 
           circuit_hierarchy ch, 
           circuits ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname NOT LIKE REPLACE (v_parent_cir_old,'(N)')||'%' 
           AND c.cirt_displayname like replace(parent_pre_name,'(N)')||'%'; 
  CURSOR cur_eq_pre ( 
    parent_i VARCHAR2) IS 
    SELECT DISTINCT e.equp_equt_abbreviation, 
                    e.equp_locn_ttname 
    FROM   ports p, 
           equipment e, 
           circuits ci 
    WHERE  ci.cirt_name = p.port_cirt_name 
           AND ( e.equp_equt_abbreviation LIKE 'MSAN%' 
                  OR e.equp_equt_abbreviation LIKE 'DSLAM%' 
                  OR e.equp_equt_abbreviation LIKE 'MEDIA CONVERTER%' 
                  OR e.equp_equt_abbreviation LIKE 'DUMMY NTU%' ) 
           AND p.port_equp_id = e.equp_id 
           AND ci.cirt_displayname = parent_i; 
BEGIN 
    OPEN cur_equi_type; 

    FETCH cur_equi_type INTO v_equip_type, v_eq_loc_name; 

    CLOSE cur_equi_type; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_mig_type 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'MIGRATION TYPE'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_bearer_status 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER STATUS'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_cur_nof_copper, v_pre_nof_copper 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NO OF COPPER PAIRS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_bear_id 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID'; 

    SELECT soa.seoa_prev_value 
    INTO   v_access_id 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS_ID'; 

    SELECT DISTINCT c.cirt_displayname 
    INTO   v_new_cir_name 
    FROM   service_orders so, 
           circuits c 
    WHERE  so.sero_cirt_name = c.cirt_name 
           AND so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_node_chg 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS NODE CHANGE?'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_acc_medium, v_acc_medium_pre 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_no_of_copper_pair_cur, v_no_of_copper_pair_pre 
    FROM   service_order_attributes soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NO OF COPPER PAIRS'; 

    SELECT Substr (ar.area_area_code, 3, Instr (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   areas ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   work_groups wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_mdf 
    FROM   work_groups wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'MDF' 
                          || '%'; 

    SELECT Substr (v_eq_loc_name, 1, Instr (v_eq_loc_name, '-NODE', '1') - 1) AS 
           node 
    INTO   v_location 
    FROM   dual; 

    SELECT Trim (Substr (v_location, 1, Instr (v_location, '-', '1', 1) - 1)) AS 
           main_node, 
           Trim (Substr (v_location, Instr (v_location, '-') + 1))            AS 
           sub_node 
    INTO   v_main_node, v_sub_node 
    FROM   dual; 

    -- Pre Location Details Start 
    OPEN cur_tributer (v_access_bear_id, v_new_cir_name); 

    FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status; 

    CLOSE cur_tributer; 

    OPEN cur_tributer_p (v_access_id, v_new_cir_name); 

    FETCH cur_tributer_p INTO v_ch_dis_p, v_cir_trib_status_p; 

    CLOSE cur_tributer_p; 

    OPEN cur_eq_pre (v_access_id); 

    FETCH cur_eq_pre INTO v_pre_eq, v_pre_location; 

    CLOSE cur_eq_pre; 

    SELECT Substr (v_pre_location, 1, Instr (v_pre_location, '-NODE', '1') - 1) 
           AS 
           node 
    INTO   v_location_pre 
    FROM   dual; 

    SELECT Trim (Substr (v_location_pre, 1, Instr (v_location_pre, '-', '1', 1) 
                                            - 1) 
           ) AS 
           main_node, 
           Trim (Substr (v_location_pre, Instr (v_location_pre, '-') + 1)) 
           AS sub_node 
    INTO   v_pre_main_node, v_pre_sub_node 
    FROM   dual; 

     
    IF v_main_node IS NOT NULL THEN
       
     --CREATE    
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%%DSLM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      ----CREATE-BACKUP

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-BACKUP' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-BACKUP' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%%DSLM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-BACKUP' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CREATE-OR 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-OR' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-OR' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_nw = 'DSLAM PORT' 
                   OR v_acc_nw = 'MSAN PORT' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      --CREATE-TRANSFER 
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-TRANSFER' 
         AND v_main_node = v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-TRANSFER' 
            AND v_main_node <> v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-TRANSFER' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF;
      
      --MODIFY-SPEED 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND v_main_node <> v_sub_node
         AND v_acc_medium = 'COPPER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-SPEED' 
            AND v_main_node = v_sub_node
            AND v_acc_medium = 'COPPER' 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_nw = 'DSLAM PORT' 
                   OR v_acc_nw = 'MSAN PORT' ) 
            AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      END IF; 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      END IF; 

      --DELETE 
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'DELETE' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND v_acc_medium = 'COPPER' 
            AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF; 

      --DELETE-OR 
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'DELETE-OR' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_acc_medium = 'COPPER' 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE-OR' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_nw = 'DSLAM PORT' 
                   OR v_acc_nw = 'MSAN PORT' ) 
            AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF; 

      --MODIFY-LOCATION 
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_medium = 'COPPER' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' 
            AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND v_main_node <> v_sub_node 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' 
            AND v_main_node = v_sub_node 
            AND ( v_equip_type LIKE '%MSAN%' 
                   OR v_equip_type LIKE '%DSLAM%' ) 
            AND ( v_acc_medium = 'COPPER' ) 
            AND v_acc_bearer_status = 'COMMISSIONED' 
            AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF; 
    END IF; 

    IF v_main_node IS NULL THEN
     --CREATE 
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CREATE-BACKUP     
     IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-BACKUP' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-BACKUP' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CREATE-OR 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-OR' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF;
      
      --CREATE-TRANSFER 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'CREATE-TRANSFER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_mig_type = 'LEGACY TO NGN' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'CREATE-TRANSFER' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF;
      
      --MODIFY-SPEED 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND v_acc_medium = 'COPPER' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_cur_nof_copper > v_pre_nof_copper THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE ADD. X CONNECTS'; 
      END IF;
      
      
      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-SPEED' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND v_no_of_copper_pair_cur < v_no_of_copper_pair_pre THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-SPEED' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REM. ADD. X CONNECTS'; 
      END IF;
      
      --DELETE 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'DELETE' 
         AND v_equip_type LIKE '%MSAN%' 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF;
      
      --DELETE-OR 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'DELETE-OR' 
         AND v_equip_type LIKE '%MSAN%' 
         AND ( v_acc_nw = 'DSLAM PORT' 
                OR v_acc_nw = 'MSAN PORT' ) 
         AND v_ch_dis IS NULL THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'DELETE-OR' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'REMOVE CROSS CONNECT'; 
      END IF;
      
      --MODIFY-LOCATION 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'YES' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MAKE MDF X CONNECT'; 
      END IF; 

      IF v_service_type = 'D-BIL' 
         AND v_service_order = 'MODIFY-LOCATION' 
         AND ( v_equip_type LIKE '%MSAN%' 
                OR v_equip_type LIKE '%DSLAM%' ) 
         AND ( v_acc_medium = 'COPPER' ) 
         AND v_acc_bearer_status = 'COMMISSIONED' 
         AND v_access_node_chg = 'NO' THEN 
        UPDATE service_implementation_tasks sit 
        SET    sit.seit_worg_name = v_work_group_mdf 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      ELSIF v_service_type = 'D-BIL' 
            AND v_service_order = 'MODIFY-LOCATION' THEN 
        DELETE service_implementation_tasks sit 
        WHERE  sit.seit_sero_id = p_sero_id 
               AND sit.seit_taskname = 'MODIFY MDF X CONNECT'; 
      END IF; 
    END IF; 

     

    p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 'Failed to Workgroup Mapping Please check the Cross Connection Equip Type  :  - Erro  is:' 
                          || To_char (SQLCODE) 
                          || '-' 
                          || SQLERRM; 

             p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, 
             p_seit_id, 
             'ERROR' 
             ); 

             INSERT INTO service_task_comments 
                         (setc_seit_id, 
                          setc_id, 
                          setc_userid, 
                          setc_timestamp, 
                          setc_text) 
             VALUES      (p_seit_id, 
                          setc_id_seq.NEXTVAL, 
                          'CLARITYB', 
                          SYSDATE, 
                          p_ret_msg); 
END D_BIL_CONNE_WG_CHG;

---- Indika de silva 03-12-2013 add  CREATE-BACKUP

PROCEDURE D_BIL_VPN_CHG (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_net_aggre     VARCHAR2(100); 
  v_service_type  VARCHAR2(100); 
  v_service_order VARCHAR2(100); 
  v_acc_nw        VARCHAR2(100); 
BEGIN 
    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_net_aggre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'AGGREGATE NETWORK'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE' 
       AND v_net_aggre = 'MEN' 
       AND v_acc_nw <> 'MEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE' 
       AND v_net_aggre = 'CEN' 
       AND v_acc_nw <> 'CEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_net_aggre = 'MEN' 
       AND v_acc_nw <> 'MEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE-TRANSFER' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_net_aggre = 'CEN' 
       AND v_acc_nw <> 'CEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE-TRANSFER' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    END IF;
    
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-BACKUP' 
       AND v_net_aggre = 'MEN' 
       AND v_acc_nw <> 'MEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE-BACKUP' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-BACKUP' 
       AND v_net_aggre = 'CEN' 
       AND v_acc_nw <> 'CEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'CREATE-BACKUP' THEN 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    END IF; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 
'Failed to Change D_BIL_VPN_CHG Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg );  
END D_BIL_VPN_CHG;

---- Dulip Fernando 2013-02-26 
---- Modified 2013-03-12
---- MOdified 2013-03-20 comment CONSTRUCT FIBER LINK /ACT. SERVICE PORT /

PROCEDURE D_BIL_CON_CREATE (
p_serv_id         IN       services.serv_id%TYPE,
p_sero_id         IN       service_orders.sero_id%TYPE,
p_seit_id         IN       service_implementation_tasks.seit_id%TYPE,
p_impt_taskname   IN       implementation_tasks.impt_taskname%TYPE,
p_woro_id         IN       work_order.woro_id%TYPE,
p_ret_char        OUT      VARCHAR2,
p_ret_number      OUT      NUMBER,
p_ret_msg         OUT      VARCHAR2 )
IS 
v_cir_status           VARCHAR2 (100);
v_new_bearer_id        VARCHAR2 (100);
v_section_hndle        VARCHAR2 (100);
v_service_type         VARCHAR2 (100);
v_service_order        VARCHAR2 (100);
v_service_order_area   VARCHAR2 (100);
v_rtom_code            VARCHAR2 (100);
v_lea_code             VARCHAR2 (100);
v_acc_bear_status      VARCHAR2 (100);
v_core_network         VARCHAR2 (100);
v_acc_medium           VARCHAR2 (100);
v_work_group           VARCHAR2 (100);
v_acc_nw               VARCHAR2 (100);
v_ntu_class            VARCHAR2 (100);
v_ntu_model_changed    VARCHAR2 (100);
v_work_group_cpe       VARCHAR2 (100);
v_ser_ctg              VARCHAR2 (100);
v_so_attr_name         VARCHAR2 (100);
v_so_attr_val          VARCHAR2 (100);
v_bearer_id            VARCHAR2 (100);
v_eng_net              VARCHAR2 (100);
v_cpe_class            VARCHAR2 (100);
v_cur_cpe_model        VARCHAR2 (100);
v_pre_cpe_model        VARCHAR2 (100);
v_net_aggri            VARCHAR2 (100); 
v_fib_avalable         VARCHAR2 (100); 
--v_net_aggri_1          VARCHAR2 (100);
--v_net_aggri_2          VARCHAR2 (100);




--v_acc_nw='ACCESS N/W INTF'
--v_acc_medium='ACCESS MEDIUM'
--v_acc_bear_status=ACCESS BEARER STATUS
--v_ser_ctg=
--v_net_aggri_1=AGGREGATE NETWORK 1
--v_net_aggri_2=AGGREGATE NETWORK 2
--NTU MODEL CHANGE?

BEGIN

SELECT DISTINCT so.sero_sert_abbreviation INTO v_service_type
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_ordt_type INTO v_service_order
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT DISTINCT so.sero_area_code INTO v_service_order_area
FROM service_orders so WHERE so.sero_id = p_sero_id;

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,
ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';

--INSTALL SLT-END-NTU tasks work group 

SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) AS codes,ar.area_code INTO v_rtom_code,v_lea_code FROM areas ar WHERE ar.area_code = v_service_order_area AND ar.area_aret_code = 'LEA';


SELECT wg.worg_name INTO v_work_group FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || v_lea_code || '%' || 'OSP-NC' || '%';

SELECT wg.worg_name INTO v_work_group_cpe 
FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'CPE-NC' || '%';

SELECT wg.worg_name INTO v_eng_net FROM work_groups wg 
WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NW' || '%';

SELECT soa.seoa_defaultvalue INTO v_section_hndle FROM service_order_attributes soa WHERE 
soa.seoa_sero_id = p_sero_id AND soa.seoa_name ='SECTION HANDLED BY';

SELECT soa.seoa_defaultvalue INTO v_acc_bear_status 
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';

---SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE 

--soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';

SELECT soa.seoa_defaultvalue INTO v_acc_medium 
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name ='ACCESS MEDIUM';

SELECT soa.seoa_defaultvalue INTO v_ntu_class 
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU CLASS';

SELECT soa.seoa_defaultvalue INTO v_acc_nw FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS N/W INTF';


SELECT soa.seoa_defaultvalue INTO v_ser_ctg FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'SERVICE CATEGORY';

SELECT soa.seoa_defaultvalue INTO v_cpe_class FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CLASS';  
 
SELECT soa.seoa_defaultvalue,soa.seoa_prev_value INTO v_cur_cpe_model,v_pre_cpe_model 
FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE MODEL';  

SELECT soa.seoa_defaultvalue INTO v_net_aggri FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name ='AGGREGATE NETWORK';  

SELECT soa.seoa_defaultvalue INTO v_ntu_model_changed 
FROM service_order_attributes soa 
WHERE soa.seoa_sero_id =p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';

select distinct soa.seoa_defaultvalue into v_fib_avalable  from service_order_attributes soa 
where soa.seoa_name = 'ACCESS FIBER AVAILABLE ?' and soa.seoa_sero_id = p_sero_id;

/*
SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa 
WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2';
*/


/*
IF 
  

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_section_hndle LIKE 'SALES-SME-%' 

THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id AND 

sit.seit_taskname = 'VERIFY PRICING';


ELSE       

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname 

= 'VERIFY PRICING'; 

END IF;
*/


/*
IF  

v_service_type = 'D-BIL'AND v_service_order = 'CREATE'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ISSUE INVOICE';       


ELSE 

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname 

= 'ISSUE INVOICE';

END IF;

IF     v_service_type = 'D-BIL'
AND v_service_order = 'CREATE'AND (   (v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle 

LIKE 'SALES-WSALE-%'))
THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';

ELSIF 

v_service_type = 'D-BIL'AND v_service_order = 'CREATE'
AND v_section_hndle LIKE 'SALES-SME-%'THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND 

sit.seit_taskname = 'APPROVE SO';

ELSE

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname 

= 'APPROVE SO';

END IF;
 /*


IF 

v_service_type = 'D-BIL' AND v_service_order = 'CREATE'
AND v_core_network = 'MEN' AND v_acc_nw <> 'MEN PORT' THEN 
UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN' 
WHERE sit.seit_sero_id = p_sero_id 
AND sit.seit_taskname = 'CONFIG VPLS PORT';


ELSIF 

(v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_core_network = 'CEN' AND v_acc_nw 

<> 'CEN PORT') OR (v_service_type = 'D-BIL' 

AND v_service_order = 'CREATE' AND v_core_network = 'MPLS' AND v_acc_nw <> 'MPLS PORT')

THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'CONFIG VPLS PORT';
ELSIF v_service_type = 'D-BIL' AND v_service_order = 'CREATE' THEN
DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname 

= 'CONFIG VPLS PORT';
END IF;*/

IF    

v_service_type = 'D-BIL'AND v_service_order = 'CREATE' AND v_acc_medium = 'P2P RADIO'AND v_acc_bear_status = 'COMMISSIONED'

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL SLT-END NTU';

ELSE 

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id  AND sit.seit_taskname = 'INSTALL SLT-END NTU';

END IF; 

IF   

v_service_type = 'D-BIL'  AND v_service_order = 'CREATE'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')AND v_acc_bear_status = 'COMMISSIONED'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE';

ELSE 

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONSTRUCT OSP LINE';

END IF;

IF    

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw ='DSLAM PORT') AND v_acc_bear_status = 'COMMISSIONED' 

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';

ELSE 

DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE SHDSL PORT';

END IF;

/*ACT. SERVICE PORT
IF    

 v_service_type = 'D-BIL' AND v_service_order = 'CREATE'AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw ='DSLAM PORT') AND v_acc_bear_status = 'INSERVICE' 

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT';

ELSE 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACT. SERVICE PORT'; 

END IF;   

*/

/*
IF    

v_service_type = 'D-BIL' AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'COMMISSIONED' AND v_ntu_class = 'SLT'

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';


ELSE 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INSTALL NTU';
END IF;

*/ 

/*IF     v_service_type = 'D-BIL'
AND v_service_order = 'CREATE'
AND v_core_network = 'MEN'
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSIF     v_service_type = 'D-BIL'
AND v_service_order = 'CREATE'
AND (v_core_network = 'MPLS' OR v_core_network = 'CEN')
THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE VPLS PORT';
END IF; */

IF   

 v_service_type = 'D-BIL'AND v_service_order = 'CREATE' AND v_ser_ctg = 'TEST' 
 
 THEN 
 
 UPDATE service_implementation_tasks sit SET sit.seit_worg_name =v_section_hndle || '-ACCM' 
 WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE';

ELSIF 

v_service_type = 'D-BIL'AND v_service_order = 'CREATE' 

THEN 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 

END IF;

IF    
v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_bear_status = 'COMMISSIONED'

THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_section_hndle || '-FO'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER';

ELSIF 

v_service_type = 'D-BIL'AND v_service_order = 'CREATE'

THEN 

DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE ACC BEARER';

 END IF;
 
IF
v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_nw = 'MEN PORT' AND v_acc_bear_status = 'COMMISSIONED'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN PORT'; 

ELSE 

DELETE  service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN PORT';

END IF;
 
IF  

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'COMMISSIONED' 

THEN UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN PORT';

ELSE

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. CEN PORT';

END IF; 

IF  v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_nw = 'MPLS PORT'
AND v_acc_bear_status = 'COMMISSIONED'

THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONFIG. MPLS PORT';

ELSE 

DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND 

sit.seit_taskname = 'CONFIG. MPLS PORT';

END IF;

/*

--CONSTRUCT FIBER LINK 

 IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED'

THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';


ELSE DELETE   service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'CONSTRUCT FIBER LINK';
END IF; 

*/

IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_medium = 'P2P RADIO' AND v_acc_bear_status = 'COMMISSIONED'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'TX-RADIO-LAB'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname ='SETUP RADIO LINK';

ELSE 

DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'SETUP RADIO LINK'; 

END IF;


IF 

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_nw = 'MEN PORT'AND v_acc_bear_status = 'INSERVICE'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN SUB PORT';

ELSE 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. MEN SUB PORT';

END IF; 

IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_acc_nw = 'CEN PORT' AND v_acc_bear_status = 'INSERVICE' 

THEN  

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'IPNET-PROV' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. CEN SUB PORT';


ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG. CEN SUB PORT'; 
END IF; 

IF     v_service_type = 'D-BIL'
AND v_service_order = 'CREATE'AND v_acc_nw = 'MPLS PORT'AND v_acc_bear_status = 'INSERVICE' 

THEN
 
UPDATE service_implementation_tasks sit 
SET sit.seit_worg_name = 'IPNET-PROV'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';

ELSE 

DELETE      service_implementation_tasks sit 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG MPLS SUB PORT';
END IF; 

-- Jayan Liyanage Modified 2014/10/24
/*IF  

v_service_type = 'D-BIL'
AND v_service_order = 'CREATE' AND v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED'

THEN

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = 'CORP-SSU' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK'; 

ELSE 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'COMM. FIBER LINK';

END IF;*/


IF  v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND 
  v_acc_medium = 'FIBER' AND v_acc_bear_status = 'COMMISSIONED' AND  
  ( v_fib_avalable = 'NO' OR v_fib_avalable = 'INCOMPLETE')
  THEN

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SFC-SOM-DATA' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER'; 
ELSE DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'WAIT FOR FIBER';
END IF;
-- Jayan Liyanage Modified End. 2014/10/24

IF    

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND (v_acc_medium ='FIBER' OR v_acc_medium ='COPPER-UTP') AND v_acc_bear_status ='COMMISSIONED' 

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_eng_net WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ESTABLISH ACC. LINK';

ELSE 

DELETE service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ESTABLISH ACC. LINK';

END IF;



/*

IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND  v_acc_nw = 'CEN PORT'
AND v_acc_bear_status = 'COMMISSIONED' 

THEN 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_eng_net
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'INTEGRATE AGG NW';

ELSE 

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'INTEGRATE AGG NW';

END IF; 

*/

IF  

v_service_type = 'D-BIL' AND v_service_order = 'CREATE'
AND  (v_acc_nw = 'MSAN PORT' or v_acc_nw = 'DSLAM PORT') AND v_acc_bear_status = 'INSERVICE'

THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';


ELSE 

DELETE   service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND 

sit.seit_taskname = 'ACTIVATE TRIB. PORT';

END IF;

/*
IF  v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND  (v_acc_nw = 'MSAN PORT' or 

v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'

THEN

UPDATE service_implementation_tasks sit

SET sit.seit_worg_name = 'DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; 

ELSE

DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'ACTIVATE TRIB. PORT';

END IF; 

*/

--VERIFY NTU
 
IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE'
 
THEN
 
UPDATE service_implementation_tasks sit SET sit.seit_worg_name ='DS-OPR-NM' WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'VERIFY NTU';
 
ELSE
 
DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'VERIFY NTU';
 
END IF;


IF    

v_service_type = 'D-BIL' AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE' AND v_ntu_class = 'SLT' AND v_ntu_model_changed='YES'

THEN 

UPDATE service_implementation_tasks sit
SET sit.seit_worg_name = v_work_group_cpe
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';


ELSE 

DELETE      service_implementation_tasks sit
WHERE sit.seit_sero_id = p_sero_id
AND sit.seit_taskname = 'MODIFY NTU';
END IF;


 
IF   

v_service_type = 'D-BIL' AND v_service_order = 'CREATE'
AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT')
AND v_acc_bear_status = 'INSERVICE' AND v_ntu_class = 'SLT' AND v_ntu_model_changed='NO' 

THEN  

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI'
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';

ELSE

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG NTU';

END IF;



IF  

v_service_type = 'D-BIL'AND v_service_order = 'CREATE'AND v_cpe_class = 'SLT'
AND v_cur_cpe_model <> v_pre_cpe_model AND v_acc_bear_status = 'INSERVICE'


THEN 

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id= p_sero_id
AND sit.seit_taskname = 'MODIFY CPE'; 

ELSE

DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY CPE';

END IF; 



--RECONFIG CPE
IF  

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_cpe_class = 'SLT' AND v_cur_cpe_model=v_pre_cpe_model 
AND v_acc_bear_status = 'INSERVICE' 

THEN  

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' 
WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';

ELSE 

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'RECONFIG CPE';

END IF;



IF 

v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND v_cpe_class = 'SLT' AND v_acc_bear_status = 'COMMISSIONED' 

THEN

UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-CPEI' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname ='INSTALL CPE';

ELSE 

DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname ='INSTALL CPE';

END IF;
    
    
/*IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'MEN' OR 

v_net_aggri_2 = 'MEN') AND v_acc_nw <> 'MEN 

PORT' THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id 

= p_sero_id AND sit.seit_taskname = 

'CONFIGURE VLAN';
ELSIF v_service_type = 'D-BIL' AND v_service_order = 'CREATE' AND (v_net_aggri_1 = 'CEN' OR 

v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'MEN PORT' 

THEN
UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE 

sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 

'CONFIGURE VLAN';
ELSE DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND 

sit.seit_taskname = 'CONFIGURE VLAN'; END IF;*/


p_implementation_tasks.update_task_status_byid (p_sero_id,
                                     0,
                                     p_seit_id,
                                     'COMPLETED'
                                    );
EXCEPTION WHEN OTHERS THEN p_ret_msg :=
'Failed to Change D-BIL Process function. Please check the conditions:'
|| ' - Erro is:'
|| TO_CHAR (SQLCODE)
|| '-'
|| SQLERRM;
p_implementation_tasks.update_task_status_byid (p_sero_id,
                                        0,
                                        p_seit_id,
                                        'ERROR'
                                       );

INSERT INTO service_task_comments (setc_seit_id, setc_id, setc_userid, setc_timestamp, setc_text
    )
VALUES (p_seit_id, setc_id_seq.NEXTVAL, 'CLARITYB', SYSDATE,
     p_ret_msg
    );
END D_BIL_CON_CREATE;

---- Dulip Fernando 2013-02-26

-----Dulip Fernando and Indika De Silva add CREATE-BACKUP
---- Dulip Fernando modified for D-BIL. 2013/12/02 
---- This function will copy attributes from BEARERE  SO to tributory service SO

PROCEDURE D_BIL_BEA_ATT_CP (

p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   service_orders so, 
           service_order_attributes soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR) IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue, 
                    c.cirt_status 
    FROM   service_orders so, 
           service_order_attributes soa, 
           circuits c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT Max (s.sero_id) 
                              FROM   service_orders s, 
                                     circuits ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname = v_new_bearer_id); 
  v_so_attr_name     VARCHAR2 (100); 
  v_so_attr_val      VARCHAR2 (100); 
  v_bearer_id        VARCHAR2 (100); 
  v_cir_status       VARCHAR2 (100); 
  v_new_bearer_id    VARCHAR2 (100); 
  v_service_type     VARCHAR2 (100); 
  v_service_order    VARCHAR2 (100); 
  v_new_service_type VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   service_orders so 
    WHERE  so.sero_id = p_sero_id; 

    OPEN so_copyattr (v_bearer_id); 

    LOOP 
        FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 

        EXIT WHEN so_copyattr%NOTFOUND; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        --ELSIF     v_service_type = 'D-BIL'  
        --AND v_service_order = 'CREATE'AND v_so_attr_name = 'SECTION_HANDLED_BY' 
        --THEN UPDATE service_order_attributes soa  
        --SET soa.seoa_defaultvalue = v_so_attr_val  
        --WHERE soa.seoa_sero_id = p_sero_id  
        --AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        -- Modification start 2014 / 11 / 20
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?'; 
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS FIBER PROJ SO#' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER PROJ SO#'; -- End;
                  
        END IF; 

        -- 'CREATE-TRANSFER' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-TRANSFER' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU MODEL'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU CLASS'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU TYPE'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU ROUTING MODE'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU MODEL CHANGE?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL CHANGE?'; 
        /*CPE MODEL CHANGE? 
         
        ELSIF      
         
        v_service_type = 'D-BIL' 
        AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL CHANGE?' THEN UPDATE service_order_attributes soa  
        SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id  
        AND soa.seoa_name = 'CPE MODEL CHANGE?'; 
         
        -- CPE MODEL CHANGE? 
         
        */ 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'OLD CIRCUIT ID' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'OLD CIRCUIT ID'; 
        /* 
         
        ELSIF      
         
        v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'MIGRATION TYPE'  
         
        THEN UPDATE service_order_attributes soa 
         SET soa.seoa_defaultvalue = v_so_attr_val  
        WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE'; 
         
        */ 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE CHANGE?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CHANGE?'; 
        END IF; 

        --CREATE-OR 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        --ACC. LINK PLAN EVENT ID CREATE-OR 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        
                -- Modification start 2014 / 11 / 20
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?'; 
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS FIBER PROJ SO#' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER PROJ SO#'; -- End;         
                 
        END IF; 

        --MODIFY-SPEED 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-SPEED' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE-OR' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'MODIFY-CPE'-- 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-CPE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --MODIFY-EQUIPMENT 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-EQUIPMENT' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        ------------------ 
        --MODIFY-LOCATION 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-LOCATION' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        
      -- Modification start 2014 / 11 / 20
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS FIBER AVAILABLE ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER AVAILABLE ?'; 
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS FIBER PROJ SO#' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS FIBER PROJ SO#'; -- End;    
                 ---New Modification 28/05/2014
          ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'AGGREGATE NETWORK' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = '' 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'AGGREGATE NETWORK'; 
           ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-LOCATION' 
              AND v_so_attr_name = 'ACCESS NODE CHANGE?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = '' 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS NODE CHANGE?';      ---End Modification 28/05/2014   
                                     
                              
        END IF; 
        
        -- CREATE-BACKUP
        
        
          IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-BACKUP' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
          AND soa.seoa_name = 'ACCESS N/W INTF'; 
        --ELSIF     v_service_type = 'D-BIL'  
        --AND v_service_order = 'CREATE-BACKUP'AND v_so_attr_name = 'SECTION_HANDLED_BY' 
        --THEN UPDATE service_order_attributes soa  
        --SET soa.seoa_defaultvalue = v_so_attr_val  
        --WHERE soa.seoa_sero_id = p_sero_id  
        --AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-BACKUP' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE service_order_attributes soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        END IF; 
        
        
        
    END LOOP; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-LOCATION' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 
    
     IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-BACKUP' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE service_order_attributes soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    CLOSE so_copyattr; 

    CLOSE bearer; 

    p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 
'Failed to Change D_BIL_BEA_ATT_CP Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| To_char (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.Update_task_status_byid (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO service_task_comments 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg); 
END D_BIL_BEA_ATT_CP;  
---- Dulip Fernando modified for D-BIL. 2013/12/02

----- Dinesh 24-04-2013--------------
 PROCEDURE SLT_PROVISION_FEATURE_CHECK (
      P_SERV_ID                IN     SERVICES.SERV_ID%TYPE,
      P_SERO_ID                IN     SERVICE_ORDERS.SERO_ID%TYPE,
      P_SEIT_ID                IN     SERVICE_IMPLEMENTATION_TASKS.SEIT_ID%TYPE,
      P_IMPT_TASKNAME          IN     IMPLEMENTATION_TASKS.IMPT_TASKNAME%TYPE,
      P_WORO_ID                IN     WORK_ORDER.WORO_ID%TYPE,
      P_RET_CHAR                  OUT    VARCHAR2,
      P_RET_NUMBER                OUT    NUMBER,
      P_RET_MSG                   OUT    VARCHAR2) IS
   

    CURSOR SERO_CUR IS
      SELECT SERO_ORDT_TYPE
        FROM SERVICE_ORDERS
          WHERE SERO_ID = P_SERO_ID;

   CURSOR SOFE_CUR    IS
      SELECT SOFE_FEATURE_NAME, SOFE_DEFAULTVALUE, SOFE_PREV_VALUE,SOFE_PROVISION_STATUS
        FROM SERVICE_ORDER_FEATURES
        WHERE SOFE_SERO_ID = P_SERO_ID
        AND SOFE_DEFAULTVALUE = 'Y'
        AND (SOFE_PREV_VALUE = 'N' OR SOFE_PREV_VALUE IS NULL)
        AND NVL(SOFE_PROVISION_STATUS,'N') = 'N';
        
   CURSOR SOFE_CUR_N   IS
      SELECT SOFE_FEATURE_NAME, SOFE_DEFAULTVALUE, SOFE_PREV_VALUE,SOFE_PROVISION_STATUS
        FROM SERVICE_ORDER_FEATURES
        WHERE SOFE_SERO_ID = P_SERO_ID
        AND SOFE_DEFAULTVALUE = 'N'
        AND SOFE_PREV_VALUE = 'Y'
        AND NVL(SOFE_PROVISION_STATUS,'N') = 'N';

   SERO_REC            SERO_CUR%ROWTYPE;
   L_COUNT            NUMBER := 0;
   L_UNPROVISIONED_FEATURES    VARCHAR2(2000);

  BEGIN
      
    
    DBMS_OUTPUT.PUT_LINE('Process check_features_provisioned for Sero:' || P_SERO_ID );
    P_RET_MSG := '';

    OPEN SERO_CUR;
    FETCH SERO_CUR INTO SERO_REC;
    CLOSE SERO_CUR;

    FOR SOFE_REC  IN SOFE_CUR LOOP
      IF SERO_REC.SERO_ORDT_TYPE IN ('CREATE','MODIFY-SERVICE','DELETE','SUSPEND','RESUME') THEN
        IF SOFE_REC.SOFE_PROVISION_STATUS IS NULL
             THEN L_UNPROVISIONED_FEATURES := L_UNPROVISIONED_FEATURES || '   ' || SOFE_REC.SOFE_FEATURE_NAME;
        END IF;
      END IF;
    
    END LOOP;
 
    IF  L_UNPROVISIONED_FEATURES IS NOT NULL THEN 
        P_RET_CHAR := 'Some of the requested features are not yet provisioned. ' || SUBSTR(L_UNPROVISIONED_FEATURES,1,100) || '...' ; 
        DBMS_OUTPUT.PUT_LINE(P_RET_CHAR);                                              
    END IF;
    
    FOR SOFE_REC  IN SOFE_CUR_N LOOP
      IF SERO_REC.SERO_ORDT_TYPE IN ('CREATE','MODIFY-SERVICE','DELETE','SUSPEND','RESUME') THEN
        IF SOFE_REC.SOFE_PROVISION_STATUS IS NULL
             THEN L_UNPROVISIONED_FEATURES := L_UNPROVISIONED_FEATURES || '   ' || SOFE_REC.SOFE_FEATURE_NAME;
        END IF;
      END IF;
    
    END LOOP;
 
    IF  L_UNPROVISIONED_FEATURES IS NOT NULL THEN 
        P_RET_CHAR := 'Some of the requested features are not yet provisioned. ' || SUBSTR(L_UNPROVISIONED_FEATURES,1,100) || '...' ; 
        DBMS_OUTPUT.PUT_LINE(P_RET_CHAR);                                              
    END IF;

  EXCEPTION
    WHEN OTHERS THEN 
        P_RET_MSG  := 'check_features_provisioned.  Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;  
        DBMS_OUTPUT.PUT_LINE(P_RET_MSG);                                    
  END ;
  
----- Dinesh 24-04-2013--------------

--- 24-04-2013 Samankula Owitipana

PROCEDURE DATA_OLD_SERVICE_PRIORITY_SET (
      p_serv_id            IN     Services.serv_id%TYPE,
      p_sero_id            IN     Service_Orders.sero_id%TYPE,
      p_seit_id            IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname      IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id            IN     work_order.woro_id%TYPE,
      p_ret_char              OUT VARCHAR2,
      p_ret_number            OUT NUMBER,
      p_ret_msg               OUT VARCHAR2)   IS



v_old_priority varchar2(50);

cursor c_old_service_priority is
select soa.SEOA_DEFAULTVALUE 
from service_order_attributes soa
where soa.SEOA_NAME = 'OLD_SERVICE_PRIORITY'
and soa.SEOA_SERO_ID = p_sero_id
and soa.SEOA_DEFAULTVALUE is not null;


BEGIN


            open c_old_service_priority;
            fetch c_old_service_priority into v_old_priority;
            close c_old_service_priority;


         IF  v_old_priority is not null THEN


               update service_order_attributes soa
               set soa.SEOA_DEFAULTVALUE = v_old_priority
               where soa.SEOA_NAME = 'SERVICE_PRIORITY'
               and soa.SEOA_SERO_ID = p_sero_id;


         END IF;


p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'COMPLETED');



EXCEPTION
WHEN OTHERS THEN


        p_ret_msg  := 'Failed to Delete the tasks:' || ' - Erro is:' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;

        p_implementation_tasks.update_task_status_byid(p_sero_id,0, p_seit_id,'ERROR');

        INSERT INTO SERVICE_TASK_COMMENTS ( SETC_SEIT_ID, SETC_ID, SETC_USERID, SETC_TIMESTAMP,
        SETC_TEXT ) VALUES ( p_seit_id, SETC_ID_SEQ.NEXTVAL, 'CLARITYB',  SYSDATE
        , p_ret_msg );


END DATA_OLD_SERVICE_PRIORITY_SET;

--- 24-04-2013 Samankula Owitipana


PROCEDURE D_BIL_CP_ATT_FROM_BEA_DEL (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS_ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR)IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue, 
                    c.cirt_status 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa, 
           CIRCUITS c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT MAX (s.sero_id) 
                              FROM   SERVICE_ORDERS s, 
                                     CIRCUITS ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname LIKE 
                                         v_new_bearer_id 
                                         ||'%'); 
  v_so_attr_name     VARCHAR2 (100); 
  v_so_attr_val      VARCHAR2 (100); 
  v_bearer_id        VARCHAR2 (100); 
  v_cir_status       VARCHAR2 (100); 
  v_new_bearer_id    VARCHAR2 (100); 
  v_service_type     VARCHAR2 (100); 
  v_service_order    VARCHAR2 (100); 
  v_new_service_type VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    OPEN so_copyattr (v_bearer_id); 

    LOOP 
        FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 

        EXIT WHEN so_copyattr%NOTFOUND; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 
    END LOOP; 

    CLOSE so_copyattr; 

    CLOSE bearer; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 
  'Failed to Change D-BIL Process function. Please check the conditions:' 
  || ' - Erro is:' 
  || TO_CHAR (SQLCODE) 
  || '-' 
  || SQLERRM; 

  p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
  'ERROR' 
  ); 

  INSERT INTO SERVICE_TASK_COMMENTS 
              (setc_seit_id, 
               setc_id, 
               setc_userid, 
               setc_timestamp, 
               setc_text) 
  VALUES      (p_seit_id, 
               setc_id_seq.NEXTVAL, 
               'CLARITYB', 
               SYSDATE, 
               p_ret_msg); 
END D_BIL_CP_ATT_FROM_BEA_DEL;

--- Dulip Fernando 2013-03-18

-- Indika De Silva 2013/02/28
-- This function will copy attributes from BEARERE  SO to tributory service SO -EXECUTE ON  "COPY BEARER ATTRIBUTES"
--Last update on 29/01/2015 by Jayan Sri Madura

PROCEDURE D_BIL_CRE_TRNS_BEA_ATT_CP1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR) IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue, 
                    c.cirt_status 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa, 
           CIRCUITS c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT MAX (s.sero_id) 
                              FROM   SERVICE_ORDERS s, 
                                     CIRCUITS ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname = v_new_bearer_id); 
  v_so_attr_name     VARCHAR2 (100); 
  v_so_attr_val      VARCHAR2 (100); 
  v_bearer_id        VARCHAR2 (100); 
  v_cir_status       VARCHAR2 (100); 
  v_new_bearer_id    VARCHAR2 (100); 
  v_service_type     VARCHAR2 (100); 
  v_service_order    VARCHAR2 (100); 
  v_new_service_type VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    OPEN so_copyattr (v_bearer_id); 

    LOOP 
        FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 

        EXIT WHEN so_copyattr%NOTFOUND; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        --ELSIF     v_service_type = 'D-BIL'  
        --AND v_service_order = 'CREATE'AND v_so_attr_name = 'SECTION_HANDLED_BY' 
        --THEN UPDATE service_order_attributes soa  
        --SET soa.seoa_defaultvalue = v_so_attr_val  
        --WHERE soa.seoa_sero_id = p_sero_id  
        --AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        END IF; 

        -- 'CREATE-TRANSFER' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-TRANSFER' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
     /*   ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY';*/ 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU MODEL CHANGE?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL CHANGE?'; 
        /*CPE MODEL CHANGE? 
         
        ELSIF      
         
        v_service_type = 'D-BIL' 
        AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL CHANGE?' THEN UPDATE service_order_attributes soa  
        SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id  
        AND soa.seoa_name = 'CPE MODEL CHANGE?'; 
         
        -- CPE MODEL CHANGE? 
         
        */ 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'OLD CIRCUIT ID' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'OLD CIRCUIT ID'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'MIGRATION TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'MIGRATION TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE CHANGE?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CHANGE?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?';   
       ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        END IF; 

        -- 
        --CREATE-OR 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        --ACC. LINK PLAN EVENT ID CREATE-OR 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        END IF; 

        --MODIFY-SPEED 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-SPEED' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE-OR' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL'THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'MODIFY-CPE'-- 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-CPE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --MODIFY-EQUIPMENT 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-EQUIPMENT' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 
    END LOOP; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    ------------------ 
    --MODIFY-LOCATION 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-LOCATION' 
       AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS N/W INTF'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'SECTION HANDLED BY'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE CLASS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE CLASS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU  MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU CLASS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU CLASS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU  ROUTING MODE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS  MEDIUM'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NO  OF COPPER PAIRS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'DATA  RADIO MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'BACKBONE CORE NO'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'VLAN  TAGGED/UNTAGGED ?'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACC.  LINK PLAN EVENT ID'; 
    END IF; 

    --MODIFY-LOCATION 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'OR' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    CLOSE so_copyattr; 

    CLOSE bearer; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to D_BIL_CRE_TRNS_BEA_ATT_CP1 Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg); 
END D_BIL_CRE_TRNS_BEA_ATT_CP1;  

--- Dulip Fernando 2013-03-21

--- Dulip Fernando 2013-03-21
-- Indika De Silva 2013/02/28
-- This function will copy attributes from BEARERE  SO to tributory service SO -EXECUTE ON  "COPY BEARER ATTRIBUTES" 

PROCEDURE D_BIL_CRE_TRNS_BEA_ATT_CP2 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR) IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue, 
                    c.cirt_status 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa, 
           CIRCUITS c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT MAX (s.sero_id) 
                              FROM   SERVICE_ORDERS s, 
                                     CIRCUITS ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname = v_new_bearer_id); 
  v_so_attr_name     VARCHAR2 (100); 
  v_so_attr_val      VARCHAR2 (100); 
  v_bearer_id        VARCHAR2 (100); 
  v_cir_status       VARCHAR2 (100); 
  v_new_bearer_id    VARCHAR2 (100); 
  v_service_type     VARCHAR2 (100); 
  v_service_order    VARCHAR2 (100); 
  v_new_service_type VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    OPEN so_copyattr (v_bearer_id); 

    LOOP 
        FETCH so_copyattr INTO v_so_attr_name, v_so_attr_val, v_cir_status; 

        EXIT WHEN so_copyattr%NOTFOUND; 

        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        --ELSIF     v_service_type = 'D-BIL'  
        --AND v_service_order = 'CREATE'AND v_so_attr_name = 'SECTION_HANDLED_BY' 
        --THEN UPDATE service_order_attributes soa  
        --SET soa.seoa_defaultvalue = v_so_attr_val  
        --WHERE soa.seoa_sero_id = p_sero_id  
        --AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        END IF; 

        -- 'CREATE-TRANSFER' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-TRANSFER' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFER' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        /* 
         
        ELSIF  
        v_service_type = 'D-BIL'AND v_service_order = 'CREATE-TRANSFER'AND v_so_attr_name = 'NTU MODEL CHANGE?'  
        THEN UPDATE service_order_attributes soa  
        SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'NTU MODEL CHANGE?';   
         
        */ 
        /*CPE MODEL CHANGE? 
         
        ELSIF      
         
        v_service_type = 'D-BIL' 
        AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE MODEL CHANGE?' THEN UPDATE service_order_attributes soa  
        SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id  
        AND soa.seoa_name = 'CPE MODEL CHANGE?'; 
         
        -- CPE MODEL CHANGE? 
         
        */ 
        /* 
        ELSIF     
         
        v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'OLD CIRCUIT ID' 
         
        THEN  
         
        UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id   AND soa.seoa_name = 'OLD CIRCUIT ID';  
         
        */ 
        /* 
        ELSIF      
         
        v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'MIGRATION TYPE'  
         
        THEN UPDATE service_order_attributes soa 
         SET soa.seoa_defaultvalue = v_so_attr_val  
        WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MIGRATION TYPE'; 
         
        */ 
        /* 
         
        ELSIF      
         
        v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'CPE CHANGE?'  
         
        THEN  
         
        UPDATE service_order_attributes soa 
        SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CPE CHANGE?'; 
         
        */ 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-TRANSFE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        /* 
        ELSIF     
         
        v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_so_attr_name = 'OLD SERVICE TYPE' 
         
        THEN  
         
        UPDATE service_order_attributes soa SET soa.seoa_defaultvalue = v_so_attr_val WHERE soa.seoa_sero_id = p_sero_id   AND soa.seoa_name = 'OLD SERVICE TYPE';  
         
        */ 
        END IF; 

        -- 
        --CREATE-OR 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'CREATE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        --ACC. LINK PLAN EVENT ID CREATE-OR 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'CREATE-OR' 
              AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACC. LINK PLAN EVENT ID'; 
        END IF; 

        --MODIFY-SPEED 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-SPEED' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-SPEED' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'DELETE-OR' 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'DELETE-OR' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'DATA RADIO MODEL'THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'DELETE-OR' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --'MODIFY-CPE'-- 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-CPE' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-CPE' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 

        --MODIFY-EQUIPMENT 
        IF v_service_type = 'D-BIL' 
           AND v_service_order = 'MODIFY-EQUIPMENT' 
           AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS N/W INTF'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'SECTION HANDLED BY'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CPE MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CPE MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU CLASS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU CLASS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NTU ROUTING MODE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS MEDIUM'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'NO OF COPPER PAIRS'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS INTF PORT BW' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'DATA RADIO MODEL'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'BACKBONE CORE NO'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
        ELSIF v_service_type = 'D-BIL' 
              AND v_service_order = 'MODIFY-EQUIPMENT' 
              AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
          UPDATE SERVICE_ORDER_ATTRIBUTES soa 
          SET    soa.seoa_defaultvalue = v_so_attr_val 
          WHERE  soa.seoa_sero_id = p_sero_id 
                 AND soa.seoa_name = 'VLAN TAGGED/UNTAGGED ?'; 
        END IF; 
    END LOOP; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    ------------------ 
    --MODIFY-LOCATION 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-LOCATION' 
       AND v_so_attr_name = 'ACCESS N/W INTF' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS N/W INTF'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'SECTION_HANDLED_BY' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'SECTION HANDLED BY'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE CLASS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE CLASS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CPE MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CPE MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU  MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU CLASS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU CLASS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ADDITIONAL NTU MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ADDITIONAL NTU MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NTU ROUTING MODE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NTU  ROUTING MODE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS MEDIUM' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS  MEDIUM'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'NO OF COPPER PAIRS' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'NO  OF COPPER PAIRS'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS INTF PORT BW'THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS INTF PORT BW'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'DATA RADIO MODEL' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'DATA  RADIO MODEL'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'CUSTOMER INTF TYPE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'CUSTOMER INTF TYPE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'BACKBONE CORE NO' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'BACKBONE CORE NO'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACCESS LINK DISTANCE' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACCESS LINK DISTANCE'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'VLAN TAGGED/UNTAGGED ?' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'VLAN  TAGGED/UNTAGGED ?'; 
    ELSIF v_service_type = 'D-BIL' 
          AND v_service_order = 'MODIFY-LOCATION' 
          AND v_so_attr_name = 'ACC. LINK PLAN EVENT ID' THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_so_attr_val 
      WHERE  soa.seoa_sero_id = p_sero_id 
             AND soa.seoa_name = 'ACC.  LINK PLAN EVENT ID'; 
    END IF; 

    --MODIFY-LOCATION 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'OR' 
       AND ( v_cir_status = 'COMMISSIONED' 
              OR v_cir_status = 'INSERVICE' ) THEN 
      UPDATE SERVICE_ORDER_ATTRIBUTES soa 
      SET    soa.seoa_defaultvalue = v_cir_status 
      WHERE  soa.seoa_name = 'ACCESS BEARER STATUS' 
             AND soa.seoa_sero_id = p_sero_id; 
    END IF; 

    CLOSE so_copyattr; 

    CLOSE bearer; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to D_BIL_CRE_TRNS_BEA_ATT_CP1 Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg); 
END D_BIL_CRE_TRNS_BEA_ATT_CP2;

--- Dulip Fernando 2013-03-21

--- Dulip Fernando 2013-03-21

-- Dulip Fernando 2013/03/14
-- This function will populate the tasks and WG s for D-BIL CREATE-OR

PROCEDURE D_BIL_CREATE_OR_WF1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_cir_status         VARCHAR2 (100); 
  v_new_bearer_id      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_acc_bear_status    VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_ntu_class          VARCHAR2 (100); 
  v_ntu_model_change   VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_ser_ctg            VARCHAR2 (100); 
  v_so_attr_name       VARCHAR2 (100); 
  v_so_attr_val        VARCHAR2 (100); 
  v_bearer_id          VARCHAR2 (100); 
  v_cpe_class          VARCHAR2 (100); 
  v_work_group_eng     VARCHAR2 (100); 
  cur_v_cpe_model      VARCHAR2 (100); 
  pre_v_cpe_model      VARCHAR2 (100); 
  v_agrregate_nw       VARCHAR2 (100); 
  v_test_service_alt   VARCHAR2 (100); 
--v_agrregate_nw_2       VARCHAR2 (100); 
BEGIN 
    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    ---- v_ntu_model_change 
    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_model_change 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU MODEL CHANGE?'; 

    --TEST SERVICE ALTERED? 
    SELECT soa.seoa_defaultvalue 
    INTO   v_test_service_alt 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'TEST SERVICE ALTERED?'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_bear_status 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER STATUS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_agrregate_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'AGGREGATE NETWORK'; 

    --SELECT soa.seoa_defaultvalue INTO v_agrregate_nw_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id 
    --AND soa.seoa_name = 'AGGREGATE NETWORK 2'; 
    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   AREAS ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_cpe 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'CPE-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_eng 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'ENG-NW' 
                          || '%'; 

    ---SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_medium 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU CLASS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_cpe_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CLASS'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   cur_v_cpe_model, pre_v_cpe_model 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE MODEL'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_ser_ctg 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SERVICE CATEGORY'; 

    --VERIFY NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'VERIFY NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'VERIFY NTU'; 
    END IF; 

    --INSTALL SLT-END NTU  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_medium = 'P2P RADIO' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL SLT-END NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL SLT-END NTU'; 
    END IF; 

    --CONSTRUCT OSP LINE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_medium = 'COPPER' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONSTRUCT OSP LINE'; 
    END IF; 

    --ACTIVATE SHDSL PORT   
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
    END IF; 

    --ACTIVATE TRIB. PORT  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; 
    END IF; 

    --CONFIG. MPLS PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MPLS PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MPLS PORT'; 
    END IF; 

    --CONFIG MPLS SUB PORT   
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG MPLS SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG MPLS SUB PORT'; 
    END IF; 

    --CONFIRM TEST SERVICE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_ser_ctg = 'TEST' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-ACCM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIRM TEST SERVICE'; 
    END IF; 

    --ACTIVATE ACC BEARER 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
    END IF; 

    --CONFIG. MEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN PORT'; 
    END IF; 

    --CONFIG. CEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN PORT'; 
    END IF; 

 -- Jayan Liyanage 2014/10/24

/*    --COMM. FIBER LINK  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_medium = 'FIBER' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COMM. FIBER LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COMM. FIBER LINK'; 
    END IF; */
    
      --COMM. FIBER LINK  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_medium = 'FIBER' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'SFC-SOM-DATA' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'WAIT FOR FIBER'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'WAIT FOR FIBER';  END IF;
             
   -- Jayan Liyanage Modified End. 2014/10/24

    --ESTABLISH ACC. LINK  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_medium = 'FIBER' 
              OR v_acc_medium = 'COPPER-UTP' ) 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group_eng 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ESTABLISH ACC. LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ESTABLISH ACC. LINK'; 
    END IF; 

    --SETUP RADIO LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_medium = 'P2P RADIO' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'TX-RADIO-LAB' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'SETUP RADIO LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'SETUP RADIO LINK'; 
    END IF; 

    --INSTALL CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_cpe_class = 'SLT' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL CPE'; 
    END IF; 

    --CONFIG. MEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN SUB PORT'; 
    END IF; 

    --CONFIG. CEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN SUB PORT'; 
    END IF; 

    --MODIFY CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_cpe_class = 'SLT' 
       AND v_acc_bear_status = 'INSERVICE' 
       AND cur_v_cpe_model <> pre_v_cpe_model THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    END IF; 

    --MODIFY NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ntu_class = 'SLT' 
       AND v_ntu_model_change = 'YES' 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU'; 
    END IF; 

    --RECONFIG CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_cpe_class = 'SLT' 
       AND v_acc_bear_status = 'INSERVICE' 
       AND cur_v_cpe_model = pre_v_cpe_model THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    END IF; 

    --CONFIG. MEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw <> 'MEN PORT' 
       AND ( v_agrregate_nw = 'MEN' ) THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    END IF; 

    --CONFIG. CEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND v_acc_nw <> 'MEN PORT' 
       AND ( v_agrregate_nw = 'CEN' ) THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    END IF; 

    --RECONFIG NTU   
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ntu_class = 'SLT' 
       AND v_ntu_model_change = 'NO' 
       AND v_acc_bear_status = 'INSERVICE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    END IF; 

    /* 
     
    --UPDATE TEST SERVICE  
     
    IF  v_service_type = 'D-BIL' AND v_service_order = 'CREATE-OR' AND  v_test_service_alt='YES'  
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO'  
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
     
    ELSE 
     
    DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'UPDATE TEST SERVICE'; 
     
    END IF; 
     
    */ 
    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Change D-BIL CREATE-OR Process function. Please check the order conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_CREATE_OR_WF1;

-- Dulip Fernando 2013/03/14

--- Dulip Fernando 2013-03-21
-- This function wil ppulate only  [COPY BEARER ATTRIBUTES and COPY BEARER ATTRIB_PART ] tasks based on "MIGRATION TYPE" attribute value.

PROCEDURE D_BIL_CREATE_TRSF_WF1_1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_mig_type VARCHAR2 (100); 
BEGIN 
    --v_mig_type 
    SELECT soa.seoa_defaultvalue 
    INTO   v_mig_type 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'MIGRATION TYPE'; 

    IF v_mig_type = 'NGN TO NGN' THEN --COPY BEARER ATTRIB_PART 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COPY BEARER ATT PART'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COPY BEARER ATT PART'; 
    END IF; 

    IF v_mig_type IS NULL THEN --COPY BEARER ATTRIBUT 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COPY BEARER ATTRIBUT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COPY BEARER ATTRIBUT'; 
    END IF; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Change D_BIL_CREATE_TRSF_WF1_1 Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_CREATE_TRSF_WF1_1;

--- Dulip Fernando 2013-03-21

--- Dulip Fernando 2013-03-21
-- This function wil poulate  tasks  for D-BIL CREATE-TRANSFER  except  [COPY BEARER ATTRIBUTES and COPY BEARER ATTRIB_PART ] 

PROCEDURE D_BIL_CREATE_TRSF_WF2 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_cir_status         VARCHAR2 (100); 
  v_new_bearer_id      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_acc_bear_status    VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_ntu_class          VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_ser_ctg            VARCHAR2 (100); 
  v_so_attr_name       VARCHAR2 (100); 
  v_so_attr_val        VARCHAR2 (100); 
  v_bearer_id          VARCHAR2 (100); 
  v_mig_type           VARCHAR2 (100); 
  v_ntu_model_chg      VARCHAR2 (100); 
  v_cpes_class         VARCHAR2 (100); 
  v_net_aggre          VARCHAR2 (100); 
  --v_net_aggri_1          VARCHAR2 (100); 
  --v_net_aggri_2          VARCHAR2 (100); 
  v_model_chg          VARCHAR2 (100); 
BEGIN 
    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_bear_status 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER STATUS'; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   AREAS ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_cpe 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'CPE-NC' 
                          || '%'; 

    --SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'VPLS CORE NETWORK'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_medium 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU CLASS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_cpes_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CLASS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_ser_ctg 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SERVICE CATEGORY'; 

    --v_mig_type 
    SELECT soa.seoa_defaultvalue 
    INTO   v_mig_type 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'MIGRATION TYPE'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_model_chg 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU MODEL CHANGE?'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_net_aggre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'AGGREGATE NETWORK'; 

    --SELECT soa.seoa_defaultvalue INTO v_net_aggri_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_model_chg 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CHANGE?'; 

    --VERIFY NTU  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_mig_type = 'NGN TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'VERIFY NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'VERIFY NTU'; 
    END IF; 

    --CONFIG. MEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_net_aggre = 'MEN' 
       AND v_acc_nw <> 'MEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. MEN VLAN'; 
    END IF; 

    --CONFIG. CEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_net_aggre = 'CEN' 
       AND v_acc_nw <> 'CEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'CONFIG. CEN VLAN'; 
    END IF; 

    --ACTIVATE SHDSL PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_mig_type = 'LEGACY TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE SHDSL PORT'; 
    END IF; 

    --ACTIVATE TRIB. PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_mig_type = 'NGN TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE TRIB. PORT'; 
    END IF; 

    --TTEST AGGREGATE LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_mig_type = 'LEGACY TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-CONDESK' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'TEST AGGREGATE LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'TEST AGGREGATE LINK'; 
    END IF; 

    --SWAP SERVICE PROFILE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_mig_type = 'NGN TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'SWAP SERVICE PROFILE'; 
    END IF; 

    --INSTALL  NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_ntu_model_chg = 'YES' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL  NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL  NTU'; 
    END IF; 

    --RECONFIG NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_ntu_model_chg = 'NO' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    END IF; 

    --MODIFY NTU LABEL 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_ntu_model_chg = 'NO' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU LABEL'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU LABEL'; 
    END IF; 

    --MODIFY CPE    
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_model_chg = 'YES' 
       AND v_cpes_class = 'SLT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    END IF; 

    --RECONFIG CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_model_chg = 'NO' 
       AND v_cpes_class = 'SLT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    END IF; 

    --RECONFIRM MIGRATION 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_mig_type = 'LEGACY TO NGN' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-CONDESK' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIRM MIGRATION'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIRM MIGRATION'; 
    END IF; 

    --ACTIVATE ACC BEARER 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' 
       AND v_acc_bear_status = 'COMMISSIONED' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ACTIVATE ACC BEARER'; 
    END IF; 

    --ISSUE DEL-TRNSFER SO  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'CREATE-TRANSFER' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'ISSUE DEL-TRNSFER SO'; 
    END IF; 

    /* VERIFY PRICING 
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%' 
     
    THEN  
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM' WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'VERIFY PRICING'; 
     
    ELSE  
     
    DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'VERIFY PRICING';  
     
    END IF; 
     */ 
    /* APPROVE SO 
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND (   (v_section_hndle LIKE 'SALES-ENT-%') 
    OR (v_section_hndle LIKE 'SALES-WSALE-%'))  
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'SALES-SIU-MGR' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSIF     
     
    v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_section_hndle LIKE 'SALES-SME-%'  
     
    THEN  
     
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_rtom_code || '-RTOM' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSE  
     
    DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO';   
          
    END IF; 
     
    */ 
    /*IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND (v_core_network = 'MEN' and v_acc_nw <> 'MEN PORT') 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; 
     
    ELSIF v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND ((v_core_network = 'CEN' and v_acc_nw <> 'CEN PORT')  
    OR (v_core_network = 'MPLS' and v_acc_nw <> 'MPLS PORT'))  
     
    THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT';  
     
    ELSE  
     
    DELETE  service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG VPLS PORT'; END IF;*/ 
    /* 
    IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') 
    AND v_mig_type = 'NGN TO NGN' THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-OPR-NM' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; ELSE DELETE  service_implementation_tasks sit  
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG SERVICE PORT'; END IF;   
    */ 
    /*IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN' THEN 
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSIF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' 
    AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'ACTIVATE VPLS PORT'; END IF; 
    */ 
    /*IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_core_network = 'MEN' 
    THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'DS-MEN' WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSIF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' 
    AND (v_core_network = 'MPLS' OR v_core_network = 'CEN') THEN UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIRM  W/ CUSTOMER'; END IF;*/ 
    /* 
    IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND (v_net_aggri_1 = 'CEN' OR v_net_aggri_2 = 'CEN') AND v_acc_nw <> 'CEN PORT' THEN 
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG CEN VLAN'; 
    ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname =  'CONFIG CEN VLAN'; END IF; */ 
    /* 
    IF     v_service_type = 'D-BIL' AND v_service_order = 'CREATE-TRANSFER' AND v_acc_nw <> 'MPLS PORT' THEN 
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'CONFIG IPVPN PORT'; 
    ELSE DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname =  'CONFIG IPVPN PORT'; END IF;  
     
    */ 
    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Change D_BIL_CREATE_TRSF_WF2 Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_CREATE_TRSF_WF2;

--- Dulip Fernando 2013-03-21

--- Dulip Fernando 2013-03-18
--This function will populate tasks for D-BIL DELETE .

PROCEDURE D_BIL_DELETE_WF1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR cur_tributer ( 
    parent_name VARCHAR2, 
    order_cir   VARCHAR2)IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   CIRCUITS c, 
           CIRCUIT_HIERARCHY ch, 
           CIRCUITS ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname <> order_cir 
           AND c.cirt_displayname = parent_name; 
  CURSOR cur_equi_type IS 
    SELECT DISTINCT e.equp_equt_abbreviation 
    FROM   SERVICE_ORDERS so, 
           PORTS p, 
           EQUIPMENT e 
    WHERE  so.sero_cirt_name = p.port_cirt_name 
           AND p.port_equp_id = e.equp_id 
           AND so.sero_id = p_sero_id; 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_access_bear_id     VARCHAR2 (100); 
  parent_name          VARCHAR2 (100); 
  v_ch_parent          VARCHAR2 (100); 
  v_ch_dis             VARCHAR2 (100); 
  v_cir_trib_status    VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  v_media_type         VARCHAR2 (100); 
  v_equip_type         VARCHAR2 (100); 
  v_work_group_mdf     VARCHAR2 (100); 
  v_ntu_class          VARCHAR2 (100); 
  v_cpe_class          VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_new_cir_name       VARCHAR2 (100); 
  order_cir            VARCHAR2 (100); 
  --v_aggr_1               VARCHAR2 (100);  
  --v_aggr_2               VARCHAR2 (100);  
  v_aggre              VARCHAR2 (100); 
  v_work_group_en      VARCHAR2 (100); 
  v_work_group_nw      VARCHAR2 (100); 
BEGIN 
    OPEN cur_equi_type; 

    FETCH cur_equi_type INTO v_equip_type; 

    CLOSE cur_equi_type; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_bear_id 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS_ID'; 

    SELECT DISTINCT c.cirt_displayname 
    INTO   v_new_cir_name 
    FROM   SERVICE_ORDERS so, 
           CIRCUITS c 
    WHERE  so.sero_cirt_name = c.cirt_name 
           AND so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   AREAS ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_nw 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'ENG-NW' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_cpe 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'CPE-NC' 
                          || '%'; 

    --SELECT wg.worg_name INTO v_work_group_EN FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NM' || '%'; 
    SELECT wg.worg_name 
    INTO   v_work_group_mdf 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'MDF' 
                          || '%'; 

    --SELECT soa.seoa_defaultvalue INTO v_core_network  
    --FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_medium 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    --SELECT soa.seoa_defaultvalue INTO v_media_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id  
    --AND soa.seoa_name = 'MEDIA TYPE'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU CLASS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_cpe_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CLASS'; 

    --SELECT soa.seoa_defaultvalue INTO v_aggr_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id  
    --AND soa.seoa_name = 'AGGREGATE NETWORK 1'; 
    --SELECT soa.seoa_defaultvalue INTO v_aggr_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name =  
    --'AGGREGATE NETWORK 2'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_aggre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'AGGREGATE NETWORK'; 

    OPEN cur_tributer (v_access_bear_id, v_new_cir_name); 

    FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status; 

    CLOSE cur_tributer; 

    --close Cur_Tributer; 
    /* 
     
    --APPROVE SO 
     
    IF   
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE' AND ((v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle LIKE 'SALES-WSALE-%') ) 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-MGR' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSIF      
     
    v_service_type = 'D-BIL'AND v_service_order = 'DELETE' AND v_section_hndle LIKE 'SALES-SME-%' 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSE  
     
    DELETE      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; END IF;  
     
    IF  
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE'  
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN'; 
     
    ELSE D 
     
    ELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN'; 
    END IF; I 
     
    */ 
    --DEACT MEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND ( v_aggre = 'MEN' ) 
       AND ( v_acc_nw <> 'MEN PORT' ) THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT MEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT MEN VLAN'; 
    END IF; 

    --DEACT CEA VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND ( v_aggre = 'CEN' ) 
       AND ( v_acc_nw <> 'CEN PORT' ) THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT CEA VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT CEA VLAN'; 
    END IF; 

    --DEACTIVATE MEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; 
    END IF; 

    --DEACTIVATE CEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE CEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE CEN PORT'; 
    END IF; 

    --DEACTIVATE MPLS PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MPLS PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MPLS PORT'; 
    END IF; 

    --REMOVE MEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MEN SUB PORT'; 
    END IF; 

    --REMOVE CEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE CEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE CEN SUB PORT'; 
    END IF; 

    --REMOVE MPLS SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MPLS SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MPLS SUB PORT'; 
    END IF; 

    --DEACT. SHDSL PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT. SHDSL PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT. SHDSL PORT'; 
    END IF; 

    --DEACT. TRIP PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE TRIB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE TRIB PORT'; 
    END IF; 

    --UNINSTALL FIBER LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_medium = 'FIBER' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UNINSTALL FIBER LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UNINSTALL FIBER LINK'; 
    END IF; 

    --REMOVE ACC LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND ( v_acc_medium = 'FIBER' 
              OR v_acc_medium = 'COPPER-UTP' ) 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group_nw 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE ACC LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE ACC LINK'; 
    END IF; 

    --REMOVE SLT-END NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_medium = 'P2P RADIO' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE SLT-END NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE SLT-END NTU'; 
    END IF; 

    --REMOVE OSP LINE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_medium = 'COPPER' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE OSP LINE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE OSP LINE'; 
    END IF; 

    --REMOVE RADIO LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_acc_medium = 'P2P RADIO' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'TX-RADIO-LAB' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE RADIO LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE RADIO LINK'; 
    END IF; 

    /* 
    --COLLECT NTU 
     
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') 
    AND v_ntu_class = 'SLT' AND v_ch_dis IS NULL 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
     
     
    */ 
    --COLLECT CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_cpe_class = 'SLT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    END IF; 

    --DEACTIVATE ACC BEARER 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT ACCESS BEARER'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT ACCESS BEARER'; 
    END IF; 

    /* 
     
    --DELETE INTERNET PORT 
     
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE' AND v_acc_nw <> 'MPLS PORT' 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DELETE IPVPN PORT'; 
     
     
    ELSE  
     
    DELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DELETE IPVPN PORT'; 
     
    END IF; 
     
     
     IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE' AND v_acc_nw = 'MPLS PORT' 
    AND v_ch_dis IS NOT NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DELETE MPLS SUB PORT'; 
    ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DELETE MPLS SUB PORT'; 
    END IF; 
     
     
    ----------------------------------------------------- 
    IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE' 
    AND v_acc_nw = 'CEN PORT' 
    AND v_ch_dis IS   NULL 
    THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_EN 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'REMOVE AGG LINK'; 
    ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'REMOVE AGG LINK'; 
    END IF; 
     
     
    ELSIF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE' 
    AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') 
    AND v_ntu_class = 'SLT' 
    AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_nw 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
    ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
    END IF; 
        
     
     
    IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE' 
    AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_section_hndle || '-FO' 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DEACT. ACC BEARER'; 
    ELSE DELETE      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DEACT. ACC BEARER'; 
    END IF; 
     
    */ 
    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 
  'Failed to Change D-BIL DELETE Process function. Please check the conditions:' 
  || ' - Erro is:' 
  || TO_CHAR (SQLCODE) 
  || '-' 
  || SQLERRM; 

  p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
  'ERROR' 
  ); 

  INSERT INTO SERVICE_TASK_COMMENTS 
              (setc_seit_id, 
               setc_id, 
               setc_userid, 
               setc_timestamp, 
               setc_text) 
  VALUES      (p_seit_id, 
               setc_id_seq.NEXTVAL, 
               'CLARITYB', 
               SYSDATE, 
               p_ret_msg ); 
END D_BIL_DELETE_WF1;

--- Dulip Fernando 2013-03-18

--- Dulip Fernando 2013-03-18 ////
--This function will populate tasks for D-BIL DELETE-OR.

PROCEDURE D_BIL_DELETE_OR_WF1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR cur_tributer ( 
    parent_name VARCHAR2, 
    order_cir   VARCHAR2)IS 
    SELECT DISTINCT ci.cirt_displayname, 
                    ci.cirt_status 
    FROM   CIRCUITS c, 
           CIRCUIT_HIERARCHY ch, 
           CIRCUITS ci 
    WHERE  c.cirt_name = ch.cirh_parent 
           AND ch.cirh_child = ci.cirt_name 
           AND ( ci.cirt_status LIKE 'INSERVICE%' 
                  OR ci.cirt_status LIKE 'PROPOSED%' 
                  OR ci.cirt_status LIKE 'SUSPEND%' 
                  OR ci.cirt_status LIKE 'COMMISS%' ) 
           AND ( ci.cirt_status NOT LIKE 'CANCE%' 
                  OR ci.cirt_status NOT LIKE 'PENDING%' ) 
           AND ci.cirt_displayname <> order_cir 
           AND c.cirt_displayname = parent_name; 
  CURSOR cur_equi_type IS 
    SELECT DISTINCT e.equp_equt_abbreviation 
    FROM   SERVICE_ORDERS so, 
           PORTS p, 
           EQUIPMENT e 
    WHERE  so.sero_cirt_name = p.port_cirt_name 
           AND p.port_equp_id = e.equp_id 
           AND so.sero_id = p_sero_id; 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_access_bear_id     VARCHAR2 (100); 
  parent_name          VARCHAR2 (100); 
  v_ch_parent          VARCHAR2 (100); 
  v_ch_dis             VARCHAR2 (100); 
  v_cir_trib_status    VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  --v_media_type           VARCHAR2 (100); 
  v_equip_type         VARCHAR2 (100); 
  v_work_group_mdf     VARCHAR2 (100); 
  v_ntu_class          VARCHAR2 (100); 
  v_cpe_class          VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_new_cir_name       VARCHAR2 (100); 
  order_cir            VARCHAR2 (100); 
  --v_aggr_1               VARCHAR2 (100);  
  --v_aggr_2               VARCHAR2 (100);  
  v_aggre              VARCHAR2 (100); 
  v_work_group_en      VARCHAR2 (100); 
  v_work_group_nw      VARCHAR2 (100); 
BEGIN 
    OPEN cur_equi_type; 

    FETCH cur_equi_type INTO v_equip_type; 

    CLOSE cur_equi_type; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_access_bear_id 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS_ID'; 

    SELECT DISTINCT c.cirt_displayname 
    INTO   v_new_cir_name 
    FROM   SERVICE_ORDERS so, 
           CIRCUITS c 
    WHERE  so.sero_cirt_name = c.cirt_name 
           AND so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   AREAS ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_nw 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'ENG-NW' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_cpe 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'CPE-NC' 
                          || '%'; 

    --SELECT wg.worg_name INTO v_work_group_EN FROM work_groups wg WHERE worg_name LIKE v_rtom_code || '-' || '%' || 'ENG-NM' || '%'; 
    SELECT wg.worg_name 
    INTO   v_work_group_mdf 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'MDF' 
                          || '%'; 

    --SELECT soa.seoa_defaultvalue INTO v_core_network FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_nw 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS N/W INTF'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_medium 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS MEDIUM'; 

    --SELECT soa.seoa_defaultvalue INTO v_media_type FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'MEDIA TYPE'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_ntu_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU CLASS'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_cpe_class 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CLASS'; 

    --SELECT soa.seoa_defaultvalue INTO v_aggr_1 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 1'; 
    --SELECT soa.seoa_defaultvalue INTO v_aggr_2 FROM service_order_attributes soa WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'AGGREGATE NETWORK 2'; 
    SELECT soa.seoa_defaultvalue 
    INTO   v_aggre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'AGGREGATE NETWORK'; 

    OPEN cur_tributer (v_access_bear_id, v_new_cir_name); 

    FETCH cur_tributer INTO v_ch_dis, v_cir_trib_status; 

    CLOSE cur_tributer; 

    -- close Cur_Tributer; 
    /* 
     
    --APPROVE SO 
     
    IF   
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE-OR' AND ((v_section_hndle LIKE 'SALES-ENT-%')OR (v_section_hndle LIKE 'SALES-WSALE-%') ) 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-MGR' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSIF      
     
    v_service_type = 'D-BIL'AND v_service_order = 'DELETE-OR' AND v_section_hndle LIKE 'SALES-SME-%' 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-PSM' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
     
    ELSE  
     
    DELETE-OR      service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; END IF;  
     
    IF  
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE-OR'  
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_section_hndle || '-FO' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN'; 
     
    ELSE D 
     
    ELETE  service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'MODIFY PRICE PLAN'; 
    END IF; I 
     
    */ 
    --DEACT MEN VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND ( v_aggre = 'MEN' ) 
       AND v_acc_nw <> 'MEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT MEN VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT MEN VLAN'; 
    END IF; 

    --DEACT CEA VLAN 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND ( v_aggre = 'CEN' ) 
       AND v_acc_nw <> 'CEN PORT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT CEA VLAN'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT CEA VLAN'; 
    END IF; 

    --DEACTIVATE MEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MEN PORT'; 
    END IF; 

    --DEACTIVATE CEN PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE CEN PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE CEN PORT'; 
    END IF; 

    --DEACTIVATE MPLS PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MPLS PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE MPLS PORT'; 
    END IF; 

    --REMOVE MEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'MEN PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-MEN' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MEN SUB PORT'; 
    END IF; 

    --REMOVE CEN SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'CEN PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE CEN SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE CEN SUB PORT'; 
    END IF; 

    --REMOVE MPLS SUB PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_nw = 'MPLS PORT' 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'IPNET-PROV' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MPLS SUB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE MPLS SUB PORT'; 
    END IF; 

    --DEACT. SHDSL PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT. SHDSL PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT. SHDSL PORT'; 
    END IF; 

    --DEACT. TRIP PORT 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND ( v_acc_nw = 'MSAN PORT' 
              OR v_acc_nw = 'DSLAM PORT' ) 
       AND v_ch_dis IS NOT NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-OPR-NM' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE TRIB PORT'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACTIVATE TRIB PORT'; 
    END IF; 

    --UNINSTALL FIBER LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_medium = 'FIBER' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'CORP-SSU' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UNINSTALL FIBER LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UNINSTALL FIBER LINK'; 
    END IF; 

    --REMOVE ACC LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND ( v_acc_medium = 'FIBER' 
              OR v_acc_medium = 'COPPER-UTP' ) 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group_nw 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE ACC LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE ACC LINK'; 
    END IF; 

    --REMOVE SLT-END NTU  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_medium = 'P2P RADIO' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE SLT-END NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE SLT-END NTU'; 
    END IF; 

    --REMOVE OSP LINE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_medium = 'COPPER' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE OSP LINE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE OSP LINE'; 
    END IF; 

    --REMOVE RADIO LINK 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_acc_medium = 'P2P RADIO' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'TX-RADIO-LAB' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE RADIO LINK'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'REMOVE RADIO LINK'; 
    END IF; 

    /* 
    --COLLECT NTU 
     
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE-OR' AND (v_acc_nw = 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') 
    AND v_ntu_class = 'SLT' AND v_ch_dis IS NULL 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = v_work_group WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
     
     
    */ 
    --COLLECT CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_cpe_class = 'SLT' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    END IF; 

    --DEACTIVATE ACC BEARER 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'DELETE-OR' 
       AND v_ch_dis IS NULL THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  ||'-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT ACCESS BEARER'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'DEACT ACCESS BEARER'; 
    END IF; 

    /* 
     
    --DELETE-OR INTERNET PORT 
     
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'DELETE-OR' AND v_acc_nw <> 'MPLS PORT' 
     
    THEN  
     
    UPDATE service_implementation_tasks sit SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DELETE-OR IPVPN PORT'; 
     
     
    ELSE  
     
    DELETE service_implementation_tasks sit WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'DELETE-OR IPVPN PORT'; 
     
    END IF; 
     
     
     IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE-OR' AND v_acc_nw = 'MPLS PORT' 
    AND v_ch_dis IS NOT NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = 'IPNET-PROV' 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DELETE-OR MPLS SUB PORT'; 
    ELSE DELETE-OR      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DELETE-OR MPLS SUB PORT'; 
    END IF; 
     
     
    ----------------------------------------------------- 
    IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE-OR' 
    AND v_acc_nw = 'CEN PORT' 
    AND v_ch_dis IS   NULL 
    THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_EN 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'REMOVE AGG LINK'; 
    ELSE DELETE-OR      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'REMOVE AGG LINK'; 
    END IF; 
     
     
    ELSIF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE-OR' 
    AND (v_acc_nw <> 'MSAN PORT' OR v_acc_nw = 'DSLAM PORT') 
    AND v_ntu_class = 'SLT' 
    AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_work_group_nw 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
    ELSE DELETE-OR      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'COLLECT NTU'; 
    END IF; 
        
     
     
    IF     v_service_type = 'D-BIL' 
    AND v_service_order = 'DELETE-OR' 
    AND v_ch_dis IS NULL THEN UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_section_hndle || '-FO' 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DEACT. ACC BEARER'; 
    ELSE DELETE-OR      service_implementation_tasks sit 
    WHERE sit.seit_sero_id = p_sero_id 
    AND sit.seit_taskname = 'DEACT. ACC BEARER'; 
    END IF; 
     
    */ 
    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Change D-BIL DELETE-OR Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_DELETE_OR_WF1;

--- Dulip Fernando 2013-03-18

--- Jayan Liyanage 2013/01/30
--This function will populate implementation tasks of D-BILL MODIFY_CPE order,

PROCEDURE D_BIL_MODIFY_CPE_WF1 (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  v_cir_status         VARCHAR2 (100); 
  v_new_bearer_id      VARCHAR2 (100); 
  v_section_hndle      VARCHAR2 (100); 
  v_service_type       VARCHAR2 (100); 
  v_service_order      VARCHAR2 (100); 
  v_service_order_area VARCHAR2 (100); 
  v_rtom_code          VARCHAR2 (100); 
  v_lea_code           VARCHAR2 (100); 
  v_acc_bear_status    VARCHAR2 (100); 
  v_core_network       VARCHAR2 (100); 
  v_acc_medium         VARCHAR2 (100); 
  v_work_group         VARCHAR2 (100); 
  v_acc_nw             VARCHAR2 (100); 
  v_ntu_class_cur      VARCHAR2 (100); 
  v_ntu_class_pre      VARCHAR2 (100); 
  v_work_group_cpe     VARCHAR2 (100); 
  v_ser_ctg            VARCHAR2 (100); 
  v_so_attr_name       VARCHAR2 (100); 
  v_so_attr_val        VARCHAR2 (100); 
  v_bearer_id          VARCHAR2 (100); 
  v_ntu_model_cur      VARCHAR2 (100); 
  v_ntu_model_pre      VARCHAR2 (100); 
  v_cpe_class_cur      VARCHAR2 (100); 
  v_cpe_class_pre      VARCHAR2 (100); 
  v_cpe_type_cur       VARCHAR2 (100); 
  v_cpe_type_pre       VARCHAR2 (100); 
  v_cpe_model_cur      VARCHAR2 (100); 
  v_cpe_model_pre      VARCHAR2 (100); 
BEGIN 
    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_section_hndle 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'SECTION HANDLED BY'; 

    SELECT soa.seoa_defaultvalue 
    INTO   v_acc_bear_status 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER STATUS'; 

    SELECT DISTINCT so.sero_area_code 
    INTO   v_service_order_area 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT SUBSTR (ar.area_area_code, 3, INSTR (ar.area_area_code, '-', 1) + 1) 
           AS 
           codes, 
           ar.area_code 
    INTO   v_rtom_code, v_lea_code 
    FROM   AREAS ar 
    WHERE  ar.area_code = v_service_order_area 
           AND ar.area_aret_code = 'LEA'; 

    SELECT wg.worg_name 
    INTO   v_work_group 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || v_lea_code 
                          || '%' 
                          || 'OSP-NC' 
                          || '%'; 

    SELECT wg.worg_name 
    INTO   v_work_group_cpe 
    FROM   WORK_GROUPS wg 
    WHERE  worg_name LIKE v_rtom_code 
                          || '-' 
                          || '%' 
                          || 'CPE-NC' 
                          || '%'; 

    /* 
    SELECT soa.seoa_defaultvalue 
    INTO v_core_network 
    FROM service_order_attributes soa 
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'CORE NETWORK';*/ 
    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_ntu_class_cur, v_ntu_class_pre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU CLASS'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_ntu_model_cur, v_ntu_model_pre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'NTU MODEL'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_cpe_class_cur, v_cpe_class_pre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE CLASS'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_cpe_type_cur, v_cpe_type_pre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE TYPE'; 

    SELECT soa.seoa_defaultvalue, 
           soa.seoa_prev_value 
    INTO   v_cpe_model_cur, v_cpe_model_pre 
    FROM   SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  soa.seoa_sero_id = p_sero_id 
           AND soa.seoa_name = 'CPE MODEL'; 

    --MODIFY NTU  
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_ntu_class_cur = 'SLT' 
       AND v_ntu_model_cur <> v_ntu_model_pre THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_work_group 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY NTU'; 
    END IF; 

    --RECONFIG NTU 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_ntu_class_cur = 'SLT' 
       AND v_ntu_model_cur = v_ntu_model_pre THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG NTU'; 
    END IF; 

    --MODIFY CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_cpe_class_cur = 'SLT' 
       AND v_cpe_class_pre = 'SLT' 
       AND v_cpe_model_cur <> v_cpe_model_pre THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'MODIFY CPE'; 
    END IF; 

    --RECONFIG CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_cpe_class_cur = 'SLT' 
       AND v_cpe_model_cur = v_cpe_model_pre THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'RECONFIG CPE'; 
    END IF; 

    --INSTALL CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_cpe_class_cur = 'SLT' 
       AND v_cpe_class_pre <> 'SLT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'INSTALL CPE'; 
    END IF; 

    --COLLECT CPE 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' 
       AND v_cpe_class_cur <> 'SLT' 
       AND v_cpe_class_pre = 'SLT' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = 'DS-CPEI' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    ELSE 
      DELETE SERVICE_IMPLEMENTATION_TASKS sit 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'COLLECT CPE'; 
    END IF; 

    --UPDATE ACC. BEARER 
    IF v_service_type = 'D-BIL' 
       AND v_service_order = 'MODIFY-CPE' THEN 
      UPDATE SERVICE_IMPLEMENTATION_TASKS sit 
      SET    sit.seit_worg_name = v_section_hndle 
                                  || '-FO' 
      WHERE  sit.seit_sero_id = p_sero_id 
             AND sit.seit_taskname = 'UPDATE ACC. BEARER'; 
    END IF; 

    /* 
    IF      
     
    v_service_type = 'D-BIL' AND v_service_order = 'MODIFY-CPE' 
    AND (   (v_section_hndle LIKE 'SALES-ENT-%') 
    OR (v_section_hndle LIKE 'SALES-WSALE-%') 
    ) 
    THEN 
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = 'SALES-SIU-MGR' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
    ELSIF     v_service_type = 'D-BIL' 
    AND v_service_order = 'MODIFY-CPE' 
    AND v_section_hndle LIKE 'SALES-SME-%' 
    THEN 
    UPDATE service_implementation_tasks sit 
    SET sit.seit_worg_name = v_rtom_code || '-RTOM' 
    WHERE sit.seit_sero_id = p_sero_id AND sit.seit_taskname = 'APPROVE SO'; 
    END IF; 
    */ 
    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
                       p_ret_msg := 
'Failed to Change D-BIL Modify CPE Process function. Please check the conditions:' 
|| ' - Erro is:' 
|| TO_CHAR (SQLCODE) 
|| '-' 
|| SQLERRM; 

p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 'ERROR' 
); 

INSERT INTO SERVICE_TASK_COMMENTS 
            (setc_seit_id, 
             setc_id, 
             setc_userid, 
             setc_timestamp, 
             setc_text) 
VALUES      (p_seit_id, 
             setc_id_seq.NEXTVAL, 
             'CLARITYB', 
             SYSDATE, 
             p_ret_msg ); 
END D_BIL_MODIFY_CPE_WF1;

--- Dulip Fernando 2013-03-15

--Indika De Silva 10/04/2013  / Jayan Liyanage Modified 20/10/2015

PROCEDURE D_BIL_M_CPE_EQUI_TO_BEA_ATT_CP (
p_serv_id       IN services.serv_id%TYPE, 
p_sero_id       IN service_orders.sero_id%TYPE, 
p_seit_id       IN service_implementation_tasks.seit_id%TYPE, 
p_impt_taskname IN implementation_tasks.impt_taskname%TYPE, 
p_woro_id       IN work_order.woro_id%TYPE, 
p_ret_char      OUT VARCHAR2, 
p_ret_number    OUT NUMBER, 
p_ret_msg       OUT VARCHAR2) 
IS 
  CURSOR bearer IS 
    SELECT DISTINCT soa.seoa_defaultvalue 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND soa.seoa_name = 'ACCESS BEARER ID' 
           AND so.sero_id = p_sero_id; 
  CURSOR so_copyattr ( 
    v_new_bearer_id VARCHAR) IS 
    SELECT DISTINCT soa.seoa_sero_id, 
                    c.cirt_status, 
                    c.cirt_serv_id 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa, 
           CIRCUITS c 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_cirt_name = c.cirt_name 
           AND ( c.cirt_status <> 'CANCELLED' 
                 AND c.cirt_status <> 'PENDINGDELETE' ) 
           AND so.sero_stas_abbreviation <> 'CANCELLED' 
           AND so.sero_id IN (SELECT MAX (s.sero_id) 
                              FROM   SERVICE_ORDERS s, 
                                     CIRCUITS ci 
                              WHERE  s.sero_cirt_name = ci.cirt_name 
                                     AND s.sero_stas_abbreviation <> 'CANCELLED' 
                                     AND ci.cirt_displayname = v_new_bearer_id); 
  CURSOR so_att_mapping IS 
    SELECT DISTINCT soa.seoa_name, 
                    soa.seoa_defaultvalue 
    FROM   SERVICE_ORDERS so, 
           SERVICE_ORDER_ATTRIBUTES soa 
    WHERE  so.sero_id = soa.seoa_sero_id 
           AND so.sero_id = p_sero_id; 
  v_cir_status    VARCHAR2 (100); 
  v_bearer_so_id  VARCHAR2 (100); 
  v_so_attr_name  VARCHAR2 (100); 
  v_so_att_val    VARCHAR2 (100); 
  v_new_bearer_id VARCHAR2 (100); 
  v_bearer_id     VARCHAR2 (100); 
  v_service_type  VARCHAR2 (100); 
  v_service_order VARCHAR2 (100); 
  v_new_service   VARCHAR2 (100); 
  v_cir_id        VARCHAR2 (100); 
  v_acc_bearer_sts  VARCHAR2 (100); 
BEGIN 
    OPEN bearer; 

    FETCH bearer INTO v_bearer_id; 

    SELECT DISTINCT so.sero_sert_abbreviation 
    INTO   v_service_type 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 

    SELECT DISTINCT so.sero_ordt_type 
    INTO   v_service_order 
    FROM   SERVICE_ORDERS so 
    WHERE  so.sero_id = p_sero_id; 
    
    SELECT soa.seoa_defaultvalue
    INTO v_acc_bearer_sts
    FROM service_order_attributes soa
    WHERE soa.seoa_sero_id = p_sero_id AND soa.seoa_name = 'ACCESS BEARER STATUS';

    OPEN so_copyattr (v_bearer_id); 

    FETCH so_copyattr INTO v_bearer_so_id, v_cir_status, v_cir_id; 

    CLOSE bearer; 

    OPEN so_att_mapping; 

    LOOP 
        FETCH so_att_mapping INTO v_so_attr_name, v_so_att_val; 

        EXIT WHEN so_att_mapping%NOTFOUND; 

        IF v_cir_status = 'INSERVICE' THEN 
          --MODIFY-CPE 
          IF v_service_type = 'D-BIL' 
             AND v_service_order = 'MODIFY-CPE' 
             AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'CPE SERIAL NUMBER'; 
          ELSIF v_service_type = 'D-BIL' 
                AND v_service_order = 'MODIFY-CPE' 
                AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'NTU SERIAL NUMBER'; 
          ELSIF v_service_type = 'D-BIL' 
                AND v_service_order = 'MODIFY-CPE' 
                AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'ADDITIONAL NTU S/N'; 
          END IF; 

         

        END IF; 
         --MODIFY-EQUIPMENT 
        IF v_acc_bearer_sts =  'TO BE MODIFIED' THEN
          
                  IF v_service_type = 'D-BIL' 
             AND v_service_order = 'MODIFY-EQUIPMENT' 
             AND v_so_attr_name = 'CPE SERIAL NUMBER' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'CPE SERIAL NUMBER'; 
          ELSIF v_service_type = 'D-BIL' 
                AND v_service_order = 'MODIFY-EQUIPMENT' 
                AND v_so_attr_name = 'NTU SERIAL NUMBER' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'NTU SERIAL NUMBER'; 
          ELSIF v_service_type = 'D-BIL' 
                AND v_service_order = 'MODIFY-EQUIPMENT' 
                AND v_so_attr_name = 'ADDITIONAL NTU S/N' THEN 
            UPDATE SERVICE_ORDER_ATTRIBUTES soa 
            SET    soa.seoa_defaultvalue = v_so_att_val 
            WHERE  soa.seoa_sero_id = v_bearer_so_id 
                   AND soa.seoa_name = 'ADDITIONAL NTU S/N'; 
          END IF; 
        END IF;
    END LOOP; 

    CLOSE so_att_mapping; 

    CLOSE so_copyattr; 

    p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, p_seit_id, 
    'COMPLETED'); 
EXCEPTION 
  WHEN OTHERS THEN 
             p_ret_msg := 'Failed to Change D_BIL_M_CPE_EQUI_TO_BEA_ATT_CP Process function. Please check  the conditions:' 
                          || ' - Erro is:' 
                          || TO_CHAR (SQLCODE) 
                          || '-' 
                          || SQLERRM; 

             p_implementation_tasks.UPDATE_TASK_STATUS_BYID (p_sero_id, 0, 
             p_seit_id, 
             'ERROR' 
             ); 

             INSERT INTO SERVICE_TASK_COMMENTS 
                         (setc_seit_id, 
                          setc_id, 
                          setc_userid, 
                          setc_timestamp, 
                          setc_text) 
             VALUES      (p_seit_id, 
                          setc_id_seq.NEXTVAL, 
                          'CLARITYB', 
                          SYSDATE, 
                          p_ret_msg); 
END D_BIL_M_CPE_EQUI_TO_BEA_ATT_CP;

--Indika De Silva 10/04/2013


/* Formatted on 5/29/2013 12:16:37 AM (QP5 v5.240.12305.39476) */
--Dulip Fernando 2013-03-19
--This work group function will change the wg of the tasks to
--"SALES-SIU-MGR" if section handled by ='SALES-ENT-XX or 'SALES-WSALES-XX and
--to "SECTION HANDLE BY - PSM" IF SECTION HANDLED BY ='SALES-SME-XX

PROCEDURE SEC_HAN_PSM_SIU_MGR (
   p_serv_id         IN     Services.serv_id%TYPE,
   p_sero_id         IN     Service_Orders.sero_id%TYPE,
   p_seit_id         IN     Service_Implementation_Tasks.seit_id%TYPE,
   p_impt_taskname   IN     Implementation_Tasks.impt_taskname%TYPE,
   p_woro_id         IN     work_order.woro_id%TYPE,
   p_ret_char           OUT VARCHAR2,
   p_ret_number         OUT NUMBER,
   p_ret_msg            OUT VARCHAR2)
IS
   v_sec_handel_by   VARCHAR2 (100) := NULL;
   v_rtom            VARCHAR2 (100);


   CURSOR seoa_cur
   IS
      SELECT SEOA_DEFAULTVALUE
        FROM service_order_attributes
       WHERE seoa_sero_id = p_sero_id AND seoa_name = 'SECTION HANDLED BY';

BEGIN
   p_ret_char := '';

   OPEN seoa_cur;

   FETCH seoa_cur INTO v_sec_handel_by;

   CLOSE seoa_cur;


   IF v_sec_handel_by IS NULL
   THEN
      p_ret_char := 'CLARITY';
   ELSIF    (v_sec_handel_by LIKE 'SALES-ENT-%')
         OR (v_sec_handel_by LIKE 'SALES-WSALE-%')
   THEN
      p_ret_char := 'SALES-SIU-MGR';

      UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
       WHERE SIT.SEIT_SERO_ID = p_sero_id;
   ELSIF (v_sec_handel_by LIKE 'SALES-SME-%')
   THEN
      p_ret_char := v_sec_handel_by || '-PSM';

      UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
       WHERE SIT.SEIT_SERO_ID = p_sero_id;
   END IF;

   p_ret_msg := '';
EXCEPTION
   WHEN OTHERS
   THEN
      p_ret_msg :=
            'Failed to change workgroup:Please check SECTION_HANDLE_WG '
         || TO_CHAR (SQLCODE)
         || '-'
         || SQLERRM;
END SEC_HAN_PSM_SIU_MGR;

--Dulip Fernando 2013-03-19

---31-03-2013 Indika de silva

PROCEDURE  D_DAB_SEC_HAN_PSM_OR_MGR(

      p_serv_id                      IN     Services.serv_id%TYPE,
      p_sero_id                      IN     Service_Orders.sero_id%TYPE,
      p_seit_id                      IN     Service_Implementation_Tasks.seit_id%TYPE,
      p_impt_taskname                IN     Implementation_Tasks.impt_taskname%TYPE,
      p_woro_id                      IN     work_order.woro_id%TYPE,
      p_ret_char                     OUT    VARCHAR2,
      p_ret_number                   OUT    NUMBER,
      p_ret_msg                      OUT    VARCHAR2) IS


v_sec_handel_by      VARCHAR2(100) := null;
v_rtom               VARCHAR2(100);


CURSOR seoa_cur IS
SELECT SEOA_DEFAULTVALUE
FROM service_order_attributes
WHERE seoa_sero_id = p_sero_id
AND seoa_name = 'SECTION_HANDLED_BY';


BEGIN

p_ret_char := '';

OPEN  seoa_cur;
FETCH seoa_cur INTO v_sec_handel_by;
CLOSE seoa_cur;


IF v_sec_handel_by is null 

THEN 

p_ret_char := 'CORP-SSU';

ELSIf (v_sec_handel_by LIKE 'SALES-ENT-%') OR (v_sec_handel_by  LIKE 'SALES-WSALE-%') OR (v_sec_handel_by  LIKE 'SLT-INTL-SERVIC%')

THEN
       
p_ret_char := v_sec_handel_by || '-MGR';
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
         WHERE SIT.SEIT_SERO_ID = p_sero_id;
         

ELSIF  (v_sec_handel_by LIKE 'SALES-SME-%') 

THEN
       
p_ret_char := v_sec_handel_by || '-PSM';
 
         UPDATE SERVICE_IMPLEMENTATION_TASKS SIT
         SET sit.SEIT_WORG_NAME = p_ret_char
         WHERE SIT.SEIT_SERO_ID =  p_sero_id;
         

END IF;

p_ret_msg := '';

EXCEPTION

WHEN OTHERS THEN
p_ret_msg  := 'Failed to change workgroup:Please check SECTION_HANDLE_WG ' || TO_CHAR(SQLCODE) ||'-'|| SQLERRM;
END D_DAB_SEC_HAN_PSM_OR_MGR;

---31-03-2013 Indika de silva


END P_SLT_FUNCTIONS_V2;
/
